<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Python for Data Analysis, 3E - 13&nbsp; Data Analysis Examples</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./advanced-numpy.html" rel="next">
<link href="./modeling.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Python for Data Analysis, 3E - 13&nbsp; Data Analysis Examples">
<meta property="og:description" content="">
<meta property="og:image" content="images/cover.png">
<meta property="og:site-name" content="Python for Data Analysis, 3E">
<meta name="twitter:title" content="Python for Data Analysis, 3E - 13&nbsp; Data Analysis Examples">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="images/cover.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class='navbar-brand' href='/book/'>
    <span class="navbar-title">Python for Data Analysis, 3E</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class='nav-link' href='https://wesmckinney.com/archives' rel target>
 <span class="menu-text">Wes’s Blog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/wesmckinn" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/wesm/pydata-book" rel="" target="">
 <span class="dropdown-text">Data and Notebooks (GitHub)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://gitee.com/wesmckinn/pydata-book" rel="" target="">
 <span class="dropdown-text">Data and Notebooks (Gitee)</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href='/book/preface'>Chapters</a></li><li class="breadcrumb-item"><a href='/book/data-analysis-examples'><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Data Analysis Examples</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/'>
 <span class="menu-text">About the Open Edition</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Chapters</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/preface'>
 <span class="menu-text">Preface</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/preliminaries'>
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Preliminaries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/python-basics'>
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Python Language Basics, IPython, and Jupyter Notebooks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/python-builtin'>
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Built-In Data Structures, Functions, and Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/numpy-basics'>
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">NumPy Basics: Arrays and Vectorized Computation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/pandas-basics'>
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Getting Started with pandas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/accessing-data'>
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Loading, Storage, and File Formats</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/data-cleaning'>
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Cleaning and Preparation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/data-wrangling'>
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data Wrangling: Join, Combine, and Reshape</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/plotting-and-visualization'>
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Plotting and Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/data-aggregation'>
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Aggregation and Group Operations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/time-series'>
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Time Series</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/modeling'>
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to Modeling Libraries in Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link active' href='/book/data-analysis-examples'>
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Data Analysis Examples</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/advanced-numpy'>
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Advanced NumPy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/ipython'>
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">More on the IPython System</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<a href="https://amzn.to/3DyLaJc"><img src="images/cover.png" class="img-fluid"></a>
<div data-ea-publisher="wesmckinneycom" data-ea-type="image">

</div>
</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#whetting_usa_gov" id="toc-whetting_usa_gov" class="nav-link active" data-scroll-target="#whetting_usa_gov"><span class="header-section-number">13.1</span> Bitly Data from 1.USA.gov</a>
  <ul class="collapse">
  <li><a href="#usa_gov_timezones" id="toc-usa_gov_timezones" class="nav-link" data-scroll-target="#usa_gov_timezones">Counting Time Zones in Pure Python</a></li>
  <li><a href="#usa_gov_pandas" id="toc-usa_gov_pandas" class="nav-link" data-scroll-target="#usa_gov_pandas">Counting Time Zones with pandas</a></li>
  </ul></li>
  <li><a href="#whetting_movielens" id="toc-whetting_movielens" class="nav-link" data-scroll-target="#whetting_movielens"><span class="header-section-number">13.2</span> MovieLens 1M Dataset</a>
  <ul class="collapse">
  <li><a href="#movielens_disagreement" id="toc-movielens_disagreement" class="nav-link" data-scroll-target="#movielens_disagreement">Measuring Rating Disagreement</a></li>
  </ul></li>
  <li><a href="#baby_names" id="toc-baby_names" class="nav-link" data-scroll-target="#baby_names"><span class="header-section-number">13.3</span> US Baby Names 1880–2010</a>
  <ul class="collapse">
  <li><a href="#baby_names_trends" id="toc-baby_names_trends" class="nav-link" data-scroll-target="#baby_names_trends">Analyzing Naming Trends</a></li>
  </ul></li>
  <li><a href="#prep_example" id="toc-prep_example" class="nav-link" data-scroll-target="#prep_example"><span class="header-section-number">13.4</span> USDA Food Database</a></li>
  <li><a href="#groupby_fec" id="toc-groupby_fec" class="nav-link" data-scroll-target="#groupby_fec"><span class="header-section-number">13.5</span> 2012 Federal Election Commission Database</a>
  <ul class="collapse">
  <li><a href="#groupby_fec_occupations" id="toc-groupby_fec_occupations" class="nav-link" data-scroll-target="#groupby_fec_occupations">Donation Statistics by Occupation and Employer</a></li>
  <li><a href="#groupby_fec_bucket" id="toc-groupby_fec_bucket" class="nav-link" data-scroll-target="#groupby_fec_bucket">Bucketing Donation Amounts</a></li>
  <li><a href="#groupby_fec_top_states" id="toc-groupby_fec_top_states" class="nav-link" data-scroll-target="#groupby_fec_top_states">Donation Statistics by State</a></li>
  </ul></li>
  <li><a href="#data-analysis-examples-conclusion" id="toc-data-analysis-examples-conclusion" class="nav-link" data-scroll-target="#data-analysis-examples-conclusion"><span class="header-section-number">13.6</span> Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Data Analysis Examples</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>This Open Access web version of <em>Python for Data Analysis 3rd Edition</em> is now available as a companion to the <a href="https://amzn.to/3DyLaJc">print and digital editions</a>. If you encounter any errata, <a href="https://oreilly.com/catalog/0636920519829/errata">please report them here</a>. Please note that some aspects of this site as produced by Quarto will differ from the formatting of the print and eBook versions from O’Reilly.</p>
<p>If you find the online edition of the book useful, please consider <a href="https://amzn.to/3DyLaJc">ordering a paper copy</a> or a <a href="https://www.ebooks.com/en-us/book/210644288/python-for-data-analysis/wes-mckinney/?affId=WES398681F">DRM-free eBook</a> to support the author. The content from this website may not be copied or reproduced. The code examples are MIT licensed and can be found on GitHub or Gitee.</p>
</div>
</div>
</div>
<p>Now that we've reached the final chapter of this book, we're going to take a look at a number of real-world datasets. For each dataset, we'll use the techniques presented in this book to extract meaning from the raw data. The demonstrated techniques can be applied to all manner of other datasets. This chapter contains a collection of miscellaneous example datasets that you can use for practice with the tools in this book.</p>
<p>The example datasets are found in the book's accompanying <a href="http://github.com/wesm/pydata-book">GitHub repository</a>. If you are unable to access GitHub, you can also get them from the <a href="https://gitee.com/wesmckinn/pydata-book">repository mirror on Gitee</a>.</p>
<section id="whetting_usa_gov" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="whetting_usa_gov"><span class="header-section-number">13.1</span> Bitly Data from 1.USA.gov</h2>
<p>In 2011, the URL shortening service <a href="https://bitly.com">Bitly</a> partnered with the US government website <a href="https://www.usa.gov">USA.gov</a> to provide a feed of anonymous data gathered from users who shorten links ending with <em>.gov</em> or <em>.mil</em>. In 2011, a live feed as well as hourly snapshots were available as downloadable text files. This service is shut down at the time of this writing (2022), but we preserved one of the data files for the book's examples.</p>
<p>In the case of the hourly snapshots, each line in each file contains a common form of web data known as JSON, which stands for JavaScript Object Notation. For example, if we read just the first line of a file, we may see something like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">5</span>]: path <span class="op">=</span> <span class="st">"datasets/bitly_usagov/example.txt"</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">6</span>]: <span class="cf">with</span> <span class="bu">open</span>(path) <span class="im">as</span> f:</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>   ...:     <span class="bu">print</span>(f.readline())</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>   ...:</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>{ <span class="st">"a"</span>: <span class="st">"Mozilla</span><span class="ch">\\</span><span class="st">/5.0 (Windows NT 6.1; WOW64) AppleWebKit</span><span class="ch">\\</span><span class="st">/535.11</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="er">(KHTML, like Gecko) Chrome\\/17.0.963.78 Safari\\/535.11", "c": "US", "nk": 1,</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="er">"tz": "America\\/New_York", "gr": "MA", "g": "A6qOVH", "h": "wfLQtf", "l":</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="er">"orofrog", "al": "en-US,en;q=0.8", "hh": "1.usa.gov", "r":</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="er">"http:\\/\\/www.facebook.com\\/l\\/7AQEFzjSi\\/1.usa.gov\\/wfLQtf", "u":</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="er">"http:\\/\\/www.ncbi.nlm.nih.gov\\/pubmed\\/22415991", "t": 1331923247, "hc":</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="er">1331822918, "cy": "Danvers", "ll": [ 42.576698, -70.954903 ] }</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Python has both built-in and third-party libraries for converting a JSON string into a Python dictionary. Here we’ll use the <code>json</code> module and its <code>loads</code> function invoked on each line in the sample file we downloaded:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(path) <span class="im">as</span> f:</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    records <span class="op">=</span> [json.loads(line) <span class="cf">for</span> line <span class="kw">in</span> f]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The resulting object <code>records</code> is now a list of Python dictionaries:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">18</span>]: records[<span class="dv">0</span>]</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">18</span>]:</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>{<span class="st">'a'</span>: <span class="st">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.11 (KHTML, like Gecko)</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="er">Chrome/17.0.963.78 Safari/535.11',</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'al'</span>: <span class="st">'en-US,en;q=0.8'</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'c'</span>: <span class="st">'US'</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'cy'</span>: <span class="st">'Danvers'</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'g'</span>: <span class="st">'A6qOVH'</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'gr'</span>: <span class="st">'MA'</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'h'</span>: <span class="st">'wfLQtf'</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'hc'</span>: <span class="dv">1331822918</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a> <span class="st">'hh'</span>: <span class="st">'1.usa.gov'</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a> <span class="st">'l'</span>: <span class="st">'orofrog'</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a> <span class="st">'ll'</span>: [<span class="fl">42.576698</span>, <span class="op">-</span><span class="fl">70.954903</span>],</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a> <span class="st">'nk'</span>: <span class="dv">1</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a> <span class="st">'r'</span>: <span class="st">'http://www.facebook.com/l/7AQEFzjSi/1.usa.gov/wfLQtf'</span>,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a> <span class="st">'t'</span>: <span class="dv">1331923247</span>,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a> <span class="st">'tz'</span>: <span class="st">'America/New_York'</span>,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a> <span class="st">'u'</span>: <span class="st">'http://www.ncbi.nlm.nih.gov/pubmed/22415991'</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="usa_gov_timezones" class="level3">
<h3 class="anchored" data-anchor-id="usa_gov_timezones">Counting Time Zones in Pure Python</h3>
<p>Suppose we were interested in finding the time zones that occur most often in the dataset (the <code>tz</code> field). There are many ways we could do this. First, let’s extract a list of time zones again using a list comprehension:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">15</span>]: time_zones <span class="op">=</span> [rec[<span class="st">"tz"</span>] <span class="cf">for</span> rec <span class="kw">in</span> records]</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="op">---------------------------------------------------------------------------</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="pp">KeyError</span>                                  Traceback (most recent call last)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>ipython<span class="op">-</span><span class="bu">input</span><span class="op">-</span><span class="dv">15</span><span class="op">-</span>abdeba901c13<span class="op">&gt;</span> <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="op">----&gt;</span> <span class="dv">1</span> time_zones <span class="op">=</span> [rec[<span class="st">"tz"</span>] <span class="cf">for</span> rec <span class="kw">in</span> records]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>ipython<span class="op">-</span><span class="bu">input</span><span class="op">-</span><span class="dv">15</span><span class="op">-</span>abdeba901c13<span class="op">&gt;</span> <span class="kw">in</span> <span class="op">&lt;</span>listcomp<span class="op">&gt;</span>(<span class="fl">.0</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="op">----&gt;</span> <span class="dv">1</span> time_zones <span class="op">=</span> [rec[<span class="st">"tz"</span>] <span class="cf">for</span> rec <span class="kw">in</span> records]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="pp">KeyError</span>: <span class="st">'tz'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Oops! Turns out that not all of the records have a time zone field. We can handle this by adding the check <code>if "tz" in rec</code> at the end of the list comprehension:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">16</span>]: time_zones <span class="op">=</span> [rec[<span class="st">"tz"</span>] <span class="cf">for</span> rec <span class="kw">in</span> records <span class="cf">if</span> <span class="st">"tz"</span> <span class="kw">in</span> rec]</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">17</span>]: time_zones[:<span class="dv">10</span>]</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">17</span>]: </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>[<span class="st">'America/New_York'</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'America/Denver'</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'America/New_York'</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'America/Sao_Paulo'</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'America/New_York'</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'America/New_York'</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'Europe/Warsaw'</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a> <span class="st">''</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a> <span class="st">''</span>,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a> <span class="st">''</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Just looking at the first 10 time zones, we see that some of them are unknown (empty string). You can filter these out also, but I’ll leave them in for now. Next, to produce counts by time zone, I’ll show two approaches: a harder way (using just the Python standard library) and a simpler way (using pandas). One way to do the counting is to use a dictionary to store counts while we iterate through the time zones:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_counts(sequence):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    counts <span class="op">=</span> {}</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> sequence:</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> x <span class="kw">in</span> counts:</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>            counts[x] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>            counts[x] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Using more advanced tools in the Python standard library, you can write the same thing more briefly:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> defaultdict</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_counts2(sequence):</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    counts <span class="op">=</span> defaultdict(<span class="bu">int</span>) <span class="co"># values will initialize to 0</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> sequence:</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        counts[x] <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>I put this logic in a function just to make it more reusable. To use it on the time zones, just pass the <code>time_zones</code> list:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">20</span>]: counts <span class="op">=</span> get_counts(time_zones)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">21</span>]: counts[<span class="st">"America/New_York"</span>]</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">21</span>]: <span class="dv">1251</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">22</span>]: <span class="bu">len</span>(time_zones)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">22</span>]: <span class="dv">3440</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If we wanted the top 10 time zones and their counts, we can make a list of tuples by <code>(count, timezone)</code> and sort it:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> top_counts(count_dict, n<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    value_key_pairs <span class="op">=</span> [(count, tz) <span class="cf">for</span> tz, count <span class="kw">in</span> count_dict.items()]</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    value_key_pairs.sort()</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> value_key_pairs[<span class="op">-</span>n:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We have then:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">24</span>]: top_counts(counts)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">24</span>]: </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>[(<span class="dv">33</span>, <span class="st">'America/Sao_Paulo'</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a> (<span class="dv">35</span>, <span class="st">'Europe/Madrid'</span>),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a> (<span class="dv">36</span>, <span class="st">'Pacific/Honolulu'</span>),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a> (<span class="dv">37</span>, <span class="st">'Asia/Tokyo'</span>),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a> (<span class="dv">74</span>, <span class="st">'Europe/London'</span>),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a> (<span class="dv">191</span>, <span class="st">'America/Denver'</span>),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a> (<span class="dv">382</span>, <span class="st">'America/Los_Angeles'</span>),</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a> (<span class="dv">400</span>, <span class="st">'America/Chicago'</span>),</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a> (<span class="dv">521</span>, <span class="st">''</span>),</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a> (<span class="dv">1251</span>, <span class="st">'America/New_York'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you search the Python standard library, you may find the <code>collections.Counter</code> class, which makes this task even simpler:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">25</span>]: <span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">26</span>]: counts <span class="op">=</span> Counter(time_zones)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">27</span>]: counts.most_common(<span class="dv">10</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">27</span>]: </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>[(<span class="st">'America/New_York'</span>, <span class="dv">1251</span>),</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a> (<span class="st">''</span>, <span class="dv">521</span>),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a> (<span class="st">'America/Chicago'</span>, <span class="dv">400</span>),</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a> (<span class="st">'America/Los_Angeles'</span>, <span class="dv">382</span>),</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a> (<span class="st">'America/Denver'</span>, <span class="dv">191</span>),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a> (<span class="st">'Europe/London'</span>, <span class="dv">74</span>),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a> (<span class="st">'Asia/Tokyo'</span>, <span class="dv">37</span>),</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a> (<span class="st">'Pacific/Honolulu'</span>, <span class="dv">36</span>),</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a> (<span class="st">'Europe/Madrid'</span>, <span class="dv">35</span>),</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a> (<span class="st">'America/Sao_Paulo'</span>, <span class="dv">33</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="usa_gov_pandas" class="level3">
<h3 class="anchored" data-anchor-id="usa_gov_pandas">Counting Time Zones with pandas</h3>
<p>You can create a DataFrame from the original set of records by passing the list of records to <code>pandas.DataFrame</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">28</span>]: frame <span class="op">=</span> pd.DataFrame(records)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can look at some basic information about this new DataFrame, such as column names, inferred column types, or number of missing values, using <code>frame.info()</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">29</span>]: frame.info()</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span><span class="kw">class</span> <span class="st">'pandas.core.frame.DataFrame'</span><span class="op">&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>RangeIndex: <span class="dv">3560</span> entries, <span class="dv">0</span> to <span class="dv">3559</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>Data columns (total <span class="dv">18</span> columns):</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a> <span class="co">#   Column       Non-Null Count  Dtype  </span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>  <span class="op">------</span>       <span class="op">--------------</span>  <span class="op">-----</span>  </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a> <span class="dv">0</span>   a            <span class="dv">3440</span> non<span class="op">-</span>null   <span class="bu">object</span> </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span>   c            <span class="dv">2919</span> non<span class="op">-</span>null   <span class="bu">object</span> </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span>   nk           <span class="dv">3440</span> non<span class="op">-</span>null   float64</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span>   tz           <span class="dv">3440</span> non<span class="op">-</span>null   <span class="bu">object</span> </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span>   gr           <span class="dv">2919</span> non<span class="op">-</span>null   <span class="bu">object</span> </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span>   g            <span class="dv">3440</span> non<span class="op">-</span>null   <span class="bu">object</span> </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span>   h            <span class="dv">3440</span> non<span class="op">-</span>null   <span class="bu">object</span> </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span>   l            <span class="dv">3440</span> non<span class="op">-</span>null   <span class="bu">object</span> </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span>   al           <span class="dv">3094</span> non<span class="op">-</span>null   <span class="bu">object</span> </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span>   hh           <span class="dv">3440</span> non<span class="op">-</span>null   <span class="bu">object</span> </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a> <span class="dv">10</span>  r            <span class="dv">3440</span> non<span class="op">-</span>null   <span class="bu">object</span> </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a> <span class="dv">11</span>  u            <span class="dv">3440</span> non<span class="op">-</span>null   <span class="bu">object</span> </span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a> <span class="dv">12</span>  t            <span class="dv">3440</span> non<span class="op">-</span>null   float64</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a> <span class="dv">13</span>  hc           <span class="dv">3440</span> non<span class="op">-</span>null   float64</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a> <span class="dv">14</span>  cy           <span class="dv">2919</span> non<span class="op">-</span>null   <span class="bu">object</span> </span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a> <span class="dv">15</span>  ll           <span class="dv">2919</span> non<span class="op">-</span>null   <span class="bu">object</span> </span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a> <span class="dv">16</span>  _heartbeat_  <span class="dv">120</span> non<span class="op">-</span>null    float64</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a> <span class="dv">17</span>  kw           <span class="dv">93</span> non<span class="op">-</span>null     <span class="bu">object</span> </span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>dtypes: float64(<span class="dv">4</span>), <span class="bu">object</span>(<span class="dv">14</span>)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>memory usage: <span class="fl">500.8</span><span class="op">+</span> KB</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">30</span>]: frame[<span class="st">"tz"</span>].head()</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">30</span>]: </span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     America<span class="op">/</span>New_York</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>       America<span class="op">/</span>Denver</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>     America<span class="op">/</span>New_York</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    America<span class="op">/</span>Sao_Paulo</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>     America<span class="op">/</span>New_York</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>Name: tz, dtype: <span class="bu">object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The output shown for the <code>frame</code> is the <em>summary view</em>, shown for large DataFrame objects. We can then use the <code>value_counts</code> method for the Series:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">31</span>]: tz_counts <span class="op">=</span> frame[<span class="st">"tz"</span>].value_counts()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">32</span>]: tz_counts.head()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">32</span>]: </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>tz</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>America<span class="op">/</span>New_York       <span class="dv">1251</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>                        <span class="dv">521</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>America<span class="op">/</span>Chicago         <span class="dv">400</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>America<span class="op">/</span>Los_Angeles     <span class="dv">382</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>America<span class="op">/</span>Denver          <span class="dv">191</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>Name: count, dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can visualize this data using matplotlib. We can make the plots a bit nicer by filling in a substitute value for unknown or missing time zone data in the records. We replace the missing values with the <code>fillna</code> method and use Boolean array indexing for the empty strings:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">33</span>]: clean_tz <span class="op">=</span> frame[<span class="st">"tz"</span>].fillna(<span class="st">"Missing"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">34</span>]: clean_tz[clean_tz <span class="op">==</span> <span class="st">""</span>] <span class="op">=</span> <span class="st">"Unknown"</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">35</span>]: tz_counts <span class="op">=</span> clean_tz.value_counts()</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">36</span>]: tz_counts.head()</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">36</span>]: </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>tz</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>America<span class="op">/</span>New_York       <span class="dv">1251</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>Unknown                 <span class="dv">521</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>America<span class="op">/</span>Chicago         <span class="dv">400</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>America<span class="op">/</span>Los_Angeles     <span class="dv">382</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>America<span class="op">/</span>Denver          <span class="dv">191</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>Name: count, dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>At this point, we can use the <a href="http://seaborn.pydata.org">seaborn package</a> to make a horizontal bar plot (see <a href="#usa_gov_counts">Top time zones in the 1.usa.gov sample data</a> for the resulting visualization):</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">38</span>]: <span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">39</span>]: subset <span class="op">=</span> tz_counts.head()</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">40</span>]: sns.barplot(y<span class="op">=</span>subset.index, x<span class="op">=</span>subset.to_numpy())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-usa_gov_counts" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figs/usa_gov_counts.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;13.1: Top time zones in the 1.usa.gov sample data</figcaption>
</figure>
</div>
<p>The <code>a</code> field contains information about the browser, device, or application used to perform the URL shortening:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">41</span>]: frame[<span class="st">"a"</span>][<span class="dv">1</span>]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">41</span>]: <span class="st">'GoogleMaps/RochesterNY'</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">42</span>]: frame[<span class="st">"a"</span>][<span class="dv">50</span>]</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">42</span>]: <span class="st">'Mozilla/5.0 (Windows NT 5.1; rv:10.0.2) Gecko/20100101 Firefox/10.0.2'</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">43</span>]: frame[<span class="st">"a"</span>][<span class="dv">51</span>][:<span class="dv">50</span>]  <span class="co"># long line</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">43</span>]: <span class="st">'Mozilla/5.0 (Linux; U; Android 2.2.2; en-us; LG-P9'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Parsing all of the interesting information in these “agent” strings may seem like a daunting task. One possible strategy is to split off the first token in the string (corresponding roughly to the browser capability) and make another summary of the user behavior:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">44</span>]: results <span class="op">=</span> pd.Series([x.split()[<span class="dv">0</span>] <span class="cf">for</span> x <span class="kw">in</span> frame[<span class="st">"a"</span>].dropna()])</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">45</span>]: results.head(<span class="dv">5</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">45</span>]: </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>               Mozilla<span class="op">/</span><span class="fl">5.0</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    GoogleMaps<span class="op">/</span>RochesterNY</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>               Mozilla<span class="op">/</span><span class="fl">4.0</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>               Mozilla<span class="op">/</span><span class="fl">5.0</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>               Mozilla<span class="op">/</span><span class="fl">5.0</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">object</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">46</span>]: results.value_counts().head(<span class="dv">8</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">46</span>]: </span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>Mozilla<span class="op">/</span><span class="fl">5.0</span>                 <span class="dv">2594</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>Mozilla<span class="op">/</span><span class="fl">4.0</span>                  <span class="dv">601</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>GoogleMaps<span class="op">/</span>RochesterNY       <span class="dv">121</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>Opera<span class="op">/</span><span class="fl">9.80</span>                    <span class="dv">34</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>TEST_INTERNET_AGENT           <span class="dv">24</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>GoogleProducer                <span class="dv">21</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>Mozilla<span class="op">/</span><span class="fl">6.0</span>                    <span class="dv">5</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>BlackBerry8520<span class="op">/</span><span class="fl">5.0.0.681</span>       <span class="dv">4</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>Name: count, dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, suppose you wanted to decompose the top time zones into Windows and non-Windows users. As a simplification, let’s say that a user is on Windows if the string <code>"Windows"</code> is in the agent string. Since some of the agents are missing, we’ll exclude these from the data:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">47</span>]: cframe <span class="op">=</span> frame[frame[<span class="st">"a"</span>].notna()].copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We want to then compute a value for whether or not each row is Windows:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">48</span>]: cframe[<span class="st">"os"</span>] <span class="op">=</span> np.where(cframe[<span class="st">"a"</span>].<span class="bu">str</span>.contains(<span class="st">"Windows"</span>),</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>   ....:                         <span class="st">"Windows"</span>, <span class="st">"Not Windows"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">49</span>]: cframe[<span class="st">"os"</span>].head(<span class="dv">5</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">49</span>]: </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>        Windows</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    Not Windows</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>        Windows</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    Not Windows</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>        Windows</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>Name: os, dtype: <span class="bu">object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then, you can group the data by its time zone column and this new list of operating systems:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">50</span>]: by_tz_os <span class="op">=</span> cframe.groupby([<span class="st">"tz"</span>, <span class="st">"os"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The group counts, analogous to the <code>value_counts</code> function, can be computed with <code>size</code>. This result is then reshaped into a table with <code>unstack</code>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">51</span>]: agg_counts <span class="op">=</span> by_tz_os.size().unstack().fillna(<span class="dv">0</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">52</span>]: agg_counts.head()</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">52</span>]: </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>os                   Not Windows  Windows</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>tz                                       </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                           <span class="fl">245.0</span>    <span class="fl">276.0</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>Africa<span class="op">/</span>Cairo                 <span class="fl">0.0</span>      <span class="fl">3.0</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>Africa<span class="op">/</span>Casablanca            <span class="fl">0.0</span>      <span class="fl">1.0</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>Africa<span class="op">/</span>Ceuta                 <span class="fl">0.0</span>      <span class="fl">2.0</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>Africa<span class="op">/</span>Johannesburg          <span class="fl">0.0</span>      <span class="fl">1.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Finally, let’s select the top overall time zones. To do so, I construct an indirect index array from the row counts in <code>agg_counts</code>. After computing the row counts with <code>agg_counts.sum("columns")</code>, I can call <code>argsort()</code> to obtain an index array that can be used to sort in ascending order:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">53</span>]: indexer <span class="op">=</span> agg_counts.<span class="bu">sum</span>(<span class="st">"columns"</span>).argsort()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">54</span>]: indexer.values[:<span class="dv">10</span>]</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">54</span>]: array([<span class="dv">24</span>, <span class="dv">20</span>, <span class="dv">21</span>, <span class="dv">92</span>, <span class="dv">87</span>, <span class="dv">53</span>, <span class="dv">54</span>, <span class="dv">57</span>, <span class="dv">26</span>, <span class="dv">55</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>I use <code>take</code> to select the rows in that order, then slice off the last 10 rows (largest values):</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">55</span>]: count_subset <span class="op">=</span> agg_counts.take(indexer[<span class="op">-</span><span class="dv">10</span>:])</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">56</span>]: count_subset</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">56</span>]: </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>os                   Not Windows  Windows</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>tz                                       </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>America<span class="op">/</span>Sao_Paulo           <span class="fl">13.0</span>     <span class="fl">20.0</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>Europe<span class="op">/</span>Madrid               <span class="fl">16.0</span>     <span class="fl">19.0</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>Pacific<span class="op">/</span>Honolulu             <span class="fl">0.0</span>     <span class="fl">36.0</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>Asia<span class="op">/</span>Tokyo                   <span class="fl">2.0</span>     <span class="fl">35.0</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>Europe<span class="op">/</span>London               <span class="fl">43.0</span>     <span class="fl">31.0</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>America<span class="op">/</span>Denver             <span class="fl">132.0</span>     <span class="fl">59.0</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>America<span class="op">/</span>Los_Angeles        <span class="fl">130.0</span>    <span class="fl">252.0</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>America<span class="op">/</span>Chicago            <span class="fl">115.0</span>    <span class="fl">285.0</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>                           <span class="fl">245.0</span>    <span class="fl">276.0</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>America<span class="op">/</span>New_York           <span class="fl">339.0</span>    <span class="fl">912.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>pandas has a convenience method called <code>nlargest</code> that does the same thing:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">57</span>]: agg_counts.<span class="bu">sum</span>(axis<span class="op">=</span><span class="st">"columns"</span>).nlargest(<span class="dv">10</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">57</span>]: </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>tz</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>America<span class="op">/</span>New_York       <span class="fl">1251.0</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">521.0</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>America<span class="op">/</span>Chicago         <span class="fl">400.0</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>America<span class="op">/</span>Los_Angeles     <span class="fl">382.0</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>America<span class="op">/</span>Denver          <span class="fl">191.0</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>Europe<span class="op">/</span>London            <span class="fl">74.0</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>Asia<span class="op">/</span>Tokyo               <span class="fl">37.0</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>Pacific<span class="op">/</span>Honolulu         <span class="fl">36.0</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>Europe<span class="op">/</span>Madrid            <span class="fl">35.0</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>America<span class="op">/</span>Sao_Paulo        <span class="fl">33.0</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then, this can be plotted in a grouped bar plot comparing the number of Windows and non-Windows users, using seaborn's <code>barplot</code> function (see <a href="#usa_gov_tz_os">Top time zones by Windows and non-Windows users</a>). I first call <code>count_subset.stack()</code> and reset the index to rearrange the data for better compatibility with seaborn:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">59</span>]: count_subset <span class="op">=</span> count_subset.stack()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">60</span>]: count_subset.name <span class="op">=</span> <span class="st">"total"</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">61</span>]: count_subset <span class="op">=</span> count_subset.reset_index()</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">62</span>]: count_subset.head(<span class="dv">10</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">62</span>]: </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>                  tz           os  total</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  America<span class="op">/</span>Sao_Paulo  Not Windows   <span class="fl">13.0</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  America<span class="op">/</span>Sao_Paulo      Windows   <span class="fl">20.0</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>      Europe<span class="op">/</span>Madrid  Not Windows   <span class="fl">16.0</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>      Europe<span class="op">/</span>Madrid      Windows   <span class="fl">19.0</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   Pacific<span class="op">/</span>Honolulu  Not Windows    <span class="fl">0.0</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>   Pacific<span class="op">/</span>Honolulu      Windows   <span class="fl">36.0</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>         Asia<span class="op">/</span>Tokyo  Not Windows    <span class="fl">2.0</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>         Asia<span class="op">/</span>Tokyo      Windows   <span class="fl">35.0</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>      Europe<span class="op">/</span>London  Not Windows   <span class="fl">43.0</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>      Europe<span class="op">/</span>London      Windows   <span class="fl">31.0</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">63</span>]: sns.barplot(x<span class="op">=</span><span class="st">"total"</span>, y<span class="op">=</span><span class="st">"tz"</span>, hue<span class="op">=</span><span class="st">"os"</span>,  data<span class="op">=</span>count_subset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-usa_gov_tz_os" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figs/usa_gov_tz_os.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;13.2: Top time zones by Windows and non-Windows users</figcaption>
</figure>
</div>
<p>It is a bit difficult to see the relative percentage of Windows users in the smaller groups, so let's normalize the group percentages to sum to 1:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> norm_total(group):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    group[<span class="st">"normed_total"</span>] <span class="op">=</span> group[<span class="st">"total"</span>] <span class="op">/</span> group[<span class="st">"total"</span>].<span class="bu">sum</span>()</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> group</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> count_subset.groupby(<span class="st">"tz"</span>).<span class="bu">apply</span>(norm_total)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then plot this in <a href="#usa_gov_tz_os_normed">Percentage Windows and non-Windows users in top occurring time zones</a>:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">66</span>]: sns.barplot(x<span class="op">=</span><span class="st">"normed_total"</span>, y<span class="op">=</span><span class="st">"tz"</span>, hue<span class="op">=</span><span class="st">"os"</span>,  data<span class="op">=</span>results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-usa_gov_tz_os_normed" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figs/usa_gov_tz_os_normed.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;13.3: Percentage Windows and non-Windows users in top occurring time zones</figcaption>
</figure>
</div>
<p>We could have computed the normalized sum more efficiently by using the <code>transform</code> method with <code>groupby</code>:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">67</span>]: g <span class="op">=</span> count_subset.groupby(<span class="st">"tz"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">68</span>]: results2 <span class="op">=</span> count_subset[<span class="st">"total"</span>] <span class="op">/</span> g[<span class="st">"total"</span>].transform(<span class="st">"sum"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="whetting_movielens" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="whetting_movielens"><span class="header-section-number">13.2</span> MovieLens 1M Dataset</h2>
<p><a href="https://grouplens.org/datasets/movielens">GroupLens Research</a> provides a number of collections of movie ratings data collected from users of MovieLens in the late 1990s and early 2000s. The data provides movie ratings, movie metadata (genres and year), and demographic data about the users (age, zip code, gender identification, and occupation). Such data is often of interest in the development of recommendation systems based on machine learning algorithms. While we do not explore machine learning techniques in detail in this book, I will show you how to slice and dice datasets like these into the exact form you need.</p>
<p>The MovieLens 1M dataset contains one million ratings collected from six thousand users on four thousand movies. It’s spread across three tables: ratings, user information, and movie information. We can load each table into a pandas DataFrame object using <code>pandas.read_table</code>. Run the following code in a Jupyter cell:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>unames <span class="op">=</span> [<span class="st">"user_id"</span>, <span class="st">"gender"</span>, <span class="st">"age"</span>, <span class="st">"occupation"</span>, <span class="st">"zip"</span>]</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>users <span class="op">=</span> pd.read_table(<span class="st">"datasets/movielens/users.dat"</span>, sep<span class="op">=</span><span class="st">"::"</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                      header<span class="op">=</span><span class="va">None</span>, names<span class="op">=</span>unames, engine<span class="op">=</span><span class="st">"python"</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>rnames <span class="op">=</span> [<span class="st">"user_id"</span>, <span class="st">"movie_id"</span>, <span class="st">"rating"</span>, <span class="st">"timestamp"</span>]</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>ratings <span class="op">=</span> pd.read_table(<span class="st">"datasets/movielens/ratings.dat"</span>, sep<span class="op">=</span><span class="st">"::"</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>                        header<span class="op">=</span><span class="va">None</span>, names<span class="op">=</span>rnames, engine<span class="op">=</span><span class="st">"python"</span>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>mnames <span class="op">=</span> [<span class="st">"movie_id"</span>, <span class="st">"title"</span>, <span class="st">"genres"</span>]</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>movies <span class="op">=</span> pd.read_table(<span class="st">"datasets/movielens/movies.dat"</span>, sep<span class="op">=</span><span class="st">"::"</span>,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>                       header<span class="op">=</span><span class="va">None</span>, names<span class="op">=</span>mnames, engine<span class="op">=</span><span class="st">"python"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can verify that everything succeeded by looking at each DataFrame:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">70</span>]: users.head(<span class="dv">5</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">70</span>]: </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>   user_id gender  age  occupation    <span class="bu">zip</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>        <span class="dv">1</span>      F    <span class="dv">1</span>          <span class="dv">10</span>  <span class="dv">48067</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>        <span class="dv">2</span>      M   <span class="dv">56</span>          <span class="dv">16</span>  <span class="dv">70072</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>        <span class="dv">3</span>      M   <span class="dv">25</span>          <span class="dv">15</span>  <span class="dv">55117</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>        <span class="dv">4</span>      M   <span class="dv">45</span>           <span class="dv">7</span>  <span class="dv">0</span><span class="er">2460</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>        <span class="dv">5</span>      M   <span class="dv">25</span>          <span class="dv">20</span>  <span class="dv">55455</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">71</span>]: ratings.head(<span class="dv">5</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">71</span>]: </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>   user_id  movie_id  rating  timestamp</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>        <span class="dv">1</span>      <span class="dv">1193</span>       <span class="dv">5</span>  <span class="dv">978300760</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>        <span class="dv">1</span>       <span class="dv">661</span>       <span class="dv">3</span>  <span class="dv">978302109</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>        <span class="dv">1</span>       <span class="dv">914</span>       <span class="dv">3</span>  <span class="dv">978301968</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>        <span class="dv">1</span>      <span class="dv">3408</span>       <span class="dv">4</span>  <span class="dv">978300275</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>        <span class="dv">1</span>      <span class="dv">2355</span>       <span class="dv">5</span>  <span class="dv">978824291</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">72</span>]: movies.head(<span class="dv">5</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">72</span>]: </span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>   movie_id                               title                        genres</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>         <span class="dv">1</span>                    Toy Story (<span class="dv">1995</span>)   Animation<span class="op">|</span>Children<span class="st">'s|Comedy</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="er">1         2                      Jumanji </span>(<span class="dv">1995</span>)  Adventure<span class="op">|</span>Children<span class="st">'s|Fantasy</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a><span class="er">2         3             Grumpier Old Men </span>(<span class="dv">1995</span>)                Comedy<span class="op">|</span>Romance</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>         <span class="dv">4</span>            Waiting to Exhale (<span class="dv">1995</span>)                  Comedy<span class="op">|</span>Drama</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>         <span class="dv">5</span>  Father of the Bride Part II (<span class="dv">1995</span>)                        Comedy</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">73</span>]: ratings</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">73</span>]: </span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>         user_id  movie_id  rating  timestamp</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>              <span class="dv">1</span>      <span class="dv">1193</span>       <span class="dv">5</span>  <span class="dv">978300760</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>              <span class="dv">1</span>       <span class="dv">661</span>       <span class="dv">3</span>  <span class="dv">978302109</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>              <span class="dv">1</span>       <span class="dv">914</span>       <span class="dv">3</span>  <span class="dv">978301968</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>              <span class="dv">1</span>      <span class="dv">3408</span>       <span class="dv">4</span>  <span class="dv">978300275</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>              <span class="dv">1</span>      <span class="dv">2355</span>       <span class="dv">5</span>  <span class="dv">978824291</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>...          ...       ...     ...        ...</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a><span class="dv">1000204</span>     <span class="dv">6040</span>      <span class="dv">1091</span>       <span class="dv">1</span>  <span class="dv">956716541</span></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a><span class="dv">1000205</span>     <span class="dv">6040</span>      <span class="dv">1094</span>       <span class="dv">5</span>  <span class="dv">956704887</span></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a><span class="dv">1000206</span>     <span class="dv">6040</span>       <span class="dv">562</span>       <span class="dv">5</span>  <span class="dv">956704746</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a><span class="dv">1000207</span>     <span class="dv">6040</span>      <span class="dv">1096</span>       <span class="dv">4</span>  <span class="dv">956715648</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a><span class="dv">1000208</span>     <span class="dv">6040</span>      <span class="dv">1097</span>       <span class="dv">4</span>  <span class="dv">956715569</span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1000209</span> rows x <span class="dv">4</span> columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that ages and occupations are coded as integers indicating groups described in the dataset’s <em>README</em> file. Analyzing the data spread across three tables is not a simple task; for example, suppose you wanted to compute mean ratings for a particular movie by gender identity and age. As you will see, this is more convenient to do with all of the data merged together into a single table. Using pandas’s <code>merge</code> function, we first merge <code>ratings</code> with <code>users</code> and then merge that result with the <code>movies</code> data. pandas infers which columns to use as the merge (or <em>join</em>) keys based on overlapping names:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">74</span>]: data <span class="op">=</span> pd.merge(pd.merge(ratings, users), movies)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">75</span>]: data</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">75</span>]: </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>         user_id  movie_id  rating  timestamp gender  age  occupation    <span class="bu">zip</span>   </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>              <span class="dv">1</span>      <span class="dv">1193</span>       <span class="dv">5</span>  <span class="dv">978300760</span>      F    <span class="dv">1</span>          <span class="dv">10</span>  <span class="dv">48067</span>  <span class="op">\</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>              <span class="dv">2</span>      <span class="dv">1193</span>       <span class="dv">5</span>  <span class="dv">978298413</span>      M   <span class="dv">56</span>          <span class="dv">16</span>  <span class="dv">70072</span>   </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>             <span class="dv">12</span>      <span class="dv">1193</span>       <span class="dv">4</span>  <span class="dv">978220179</span>      M   <span class="dv">25</span>          <span class="dv">12</span>  <span class="dv">32793</span>   </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>             <span class="dv">15</span>      <span class="dv">1193</span>       <span class="dv">4</span>  <span class="dv">978199279</span>      M   <span class="dv">25</span>           <span class="dv">7</span>  <span class="dv">22903</span>   </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>             <span class="dv">17</span>      <span class="dv">1193</span>       <span class="dv">5</span>  <span class="dv">978158471</span>      M   <span class="dv">50</span>           <span class="dv">1</span>  <span class="dv">95350</span>   </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>...          ...       ...     ...        ...    ...  ...         ...    ...   </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1000204</span>     <span class="dv">5949</span>      <span class="dv">2198</span>       <span class="dv">5</span>  <span class="dv">958846401</span>      M   <span class="dv">18</span>          <span class="dv">17</span>  <span class="dv">47901</span>   </span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="dv">1000205</span>     <span class="dv">5675</span>      <span class="dv">2703</span>       <span class="dv">3</span>  <span class="dv">976029116</span>      M   <span class="dv">35</span>          <span class="dv">14</span>  <span class="dv">30030</span>   </span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="dv">1000206</span>     <span class="dv">5780</span>      <span class="dv">2845</span>       <span class="dv">1</span>  <span class="dv">958153068</span>      M   <span class="dv">18</span>          <span class="dv">17</span>  <span class="dv">92886</span>   </span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="dv">1000207</span>     <span class="dv">5851</span>      <span class="dv">3607</span>       <span class="dv">5</span>  <span class="dv">957756608</span>      F   <span class="dv">18</span>          <span class="dv">20</span>  <span class="dv">55410</span>   </span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="dv">1000208</span>     <span class="dv">5938</span>      <span class="dv">2909</span>       <span class="dv">4</span>  <span class="dv">957273353</span>      M   <span class="dv">25</span>           <span class="dv">1</span>  <span class="dv">35401</span>   </span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>                                               title                genres  </span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>             One Flew Over the Cuckoo<span class="st">'s Nest (1975)                 Drama  </span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="er">1             One Flew Over the Cuckoo's Nest (1975)                 Drama  </span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>             One Flew Over the Cuckoo<span class="st">'s Nest (1975)                 Drama  </span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="er">3             One Flew Over the Cuckoo's Nest (1975)                 Drama  </span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>             One Flew Over the Cuckoo<span class="st">'s Nest (1975)                 Drama  </span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="er">...                                              ...                   ...  </span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="dv">1000204</span>                           Modulations (<span class="dv">1998</span>)           Documentary  </span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a><span class="dv">1000205</span>                        Broken Vessels (<span class="dv">1998</span>)                 Drama  </span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="dv">1000206</span>                            White Boys (<span class="dv">1999</span>)                 Drama  </span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="dv">1000207</span>                     One Little Indian (<span class="dv">1973</span>)  Comedy<span class="op">|</span>Drama<span class="op">|</span>Western  </span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a><span class="dv">1000208</span>  Five Wives, Three Secretaries <span class="kw">and</span> Me (<span class="dv">1998</span>)           Documentary  </span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1000209</span> rows x <span class="dv">10</span> columns]</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">76</span>]: data.iloc[<span class="dv">0</span>]</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">76</span>]: </span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>user_id                                            <span class="dv">1</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>movie_id                                        <span class="dv">1193</span></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>rating                                             <span class="dv">5</span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>timestamp                                  <span class="dv">978300760</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>gender                                             F</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>age                                                <span class="dv">1</span></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>occupation                                        <span class="dv">10</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a><span class="bu">zip</span>                                            <span class="dv">48067</span></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>title         One Flew Over the Cuckoo<span class="st">'s Nest (1975)</span></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a><span class="er">genres                                         Drama</span></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>Name: <span class="dv">0</span>, dtype: <span class="bu">object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To get mean movie ratings for each film grouped by gender, we can use the <code>pivot_table</code> method:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">77</span>]: mean_ratings <span class="op">=</span> data.pivot_table(<span class="st">"rating"</span>, index<span class="op">=</span><span class="st">"title"</span>,</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>   ....:                                 columns<span class="op">=</span><span class="st">"gender"</span>, aggfunc<span class="op">=</span><span class="st">"mean"</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">78</span>]: mean_ratings.head(<span class="dv">5</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">78</span>]: </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>gender                                F         M</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>title                                            </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>$<span class="dv">1</span>,<span class="dv">000</span>,<span class="dv">000</span> Duck (<span class="dv">1971</span>)         <span class="fl">3.375000</span>  <span class="fl">2.761905</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co">'Night Mother (1986)           3.388889  3.352941</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="er">'Til There Was You (1997)      2.675676  2.733333</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="er">'burbs, The (1989)             2.793478  2.962085</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="er">...And Justice for All </span>(<span class="dv">1979</span>)  <span class="fl">3.828571</span>  <span class="fl">3.689024</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This produced another DataFrame containing mean ratings with movie titles as row labels (the "index") and gender as column labels. I first filter down to movies that received at least 250 ratings (an arbitrary number); to do this, I group the data by title, and use <code>size()</code> to get a Series of group sizes for each title:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">79</span>]: ratings_by_title <span class="op">=</span> data.groupby(<span class="st">"title"</span>).size()</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">80</span>]: ratings_by_title.head()</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">80</span>]: </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>title</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>$<span class="dv">1</span>,<span class="dv">000</span>,<span class="dv">000</span> Duck (<span class="dv">1971</span>)            <span class="dv">37</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">'Night Mother (1986)              70</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="er">'Til There Was You (1997)         52</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="er">'burbs, The (1989)               303</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="er">...And Justice for All </span>(<span class="dv">1979</span>)    <span class="dv">199</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>dtype: int64</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">81</span>]: active_titles <span class="op">=</span> ratings_by_title.index[ratings_by_title <span class="op">&gt;=</span> <span class="dv">250</span>]</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">82</span>]: active_titles</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">82</span>]: </span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>Index([<span class="st">''</span>burbs, The (<span class="dv">1989</span>)<span class="st">', '</span><span class="dv">10</span> Things I Hate About You (<span class="dv">1999</span>)<span class="st">',</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="er">       '101 Dalmatians (1961)', '101 Dalmatians (1996)', '12 Angry Men (1957)',</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>       <span class="st">'13th Warrior, The (1999)'</span>, <span class="st">'2 Days in the Valley (1996)'</span>,</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>       <span class="st">'20,000 Leagues Under the Sea (1954)'</span>, <span class="st">'2001: A Space Odyssey (1968)'</span>,</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>       <span class="st">'2010 (1984)'</span>,</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>       ...</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>       <span class="st">'X-Men (2000)'</span>, <span class="st">'Year of Living Dangerously (1982)'</span>,</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Yellow Submarine (1968)'</span>, <span class="st">'You'</span>ve Got Mail (<span class="dv">1998</span>)<span class="st">',</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="er">       'Young Frankenstein (1974)', 'Young Guns (1988)',</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Young Guns II (1990)'</span>, <span class="st">'Young Sherlock Holmes (1985)'</span>,</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Zero Effect (1998)'</span>, <span class="st">'eXistenZ (1999)'</span>],</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>      dtype<span class="op">=</span><span class="st">'object'</span>, name<span class="op">=</span><span class="st">'title'</span>, length<span class="op">=</span><span class="dv">1216</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The index of titles receiving at least 250 ratings can then be used to select rows from <code>mean_ratings</code> using <code>.loc</code>:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">83</span>]: mean_ratings <span class="op">=</span> mean_ratings.loc[active_titles]</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">84</span>]: mean_ratings</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">84</span>]: </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>gender                                    F         M</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>title                                                </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">'burbs, The (1989)                 2.793478  2.962085</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="er">10 Things I Hate About You </span>(<span class="dv">1999</span>)  <span class="fl">3.646552</span>  <span class="fl">3.311966</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="dv">101</span> Dalmatians (<span class="dv">1961</span>)              <span class="fl">3.791444</span>  <span class="fl">3.500000</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="dv">101</span> Dalmatians (<span class="dv">1996</span>)              <span class="fl">3.240000</span>  <span class="fl">2.911215</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span> Angry Men (<span class="dv">1957</span>)                <span class="fl">4.184397</span>  <span class="fl">4.328421</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>...                                     ...       ...</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>Young Guns (<span class="dv">1988</span>)                  <span class="fl">3.371795</span>  <span class="fl">3.425620</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>Young Guns II (<span class="dv">1990</span>)               <span class="fl">2.934783</span>  <span class="fl">2.904025</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>Young Sherlock Holmes (<span class="dv">1985</span>)       <span class="fl">3.514706</span>  <span class="fl">3.363344</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>Zero Effect (<span class="dv">1998</span>)                 <span class="fl">3.864407</span>  <span class="fl">3.723140</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>eXistenZ (<span class="dv">1999</span>)                    <span class="fl">3.098592</span>  <span class="fl">3.289086</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1216</span> rows x <span class="dv">2</span> columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To see the top films among female viewers, we can sort by the <code>F</code> column in descending order:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">86</span>]: top_female_ratings <span class="op">=</span> mean_ratings.sort_values(<span class="st">"F"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">87</span>]: top_female_ratings.head()</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">87</span>]: </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>gender                                                         F         M</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>title                                                                     </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>Close Shave, A (<span class="dv">1995</span>)                                   <span class="fl">4.644444</span>  <span class="fl">4.473795</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>Wrong Trousers, The (<span class="dv">1993</span>)                              <span class="fl">4.588235</span>  <span class="fl">4.478261</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>Sunset Blvd. (a.k.a. Sunset Boulevard) (<span class="dv">1950</span>)           <span class="fl">4.572650</span>  <span class="fl">4.464589</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>Wallace <span class="op">&amp;</span> Gromit: The Best of Aardman Animation (<span class="dv">1996</span>)  <span class="fl">4.563107</span>  <span class="fl">4.385075</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>Schindler<span class="st">'s List (1993)                                 4.562602  4.491415</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="movielens_disagreement" class="level3">
<h3 class="anchored" data-anchor-id="movielens_disagreement">Measuring Rating Disagreement</h3>
<p>Suppose you wanted to find the movies that are most divisive between male and female viewers. One way is to add a column to <code>mean_ratings</code> containing the difference in means, then sort by that:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">88</span>]: mean_ratings[<span class="st">"diff"</span>] <span class="op">=</span> mean_ratings[<span class="st">"M"</span>] <span class="op">-</span> mean_ratings[<span class="st">"F"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Sorting by <code>"diff"</code> yields the movies with the greatest rating difference so that we can see which ones were preferred by women:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">89</span>]: sorted_by_diff <span class="op">=</span> mean_ratings.sort_values(<span class="st">"diff"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">90</span>]: sorted_by_diff.head()</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">90</span>]: </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>gender                            F         M      diff</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>title                                                  </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>Dirty Dancing (<span class="dv">1987</span>)       <span class="fl">3.790378</span>  <span class="fl">2.959596</span> <span class="op">-</span><span class="fl">0.830782</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>Jumpin<span class="st">' Jack Flash (1986)  3.254717  2.578358 -0.676359</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="er">Grease </span>(<span class="dv">1978</span>)              <span class="fl">3.975265</span>  <span class="fl">3.367041</span> <span class="op">-</span><span class="fl">0.608224</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>Little Women (<span class="dv">1994</span>)        <span class="fl">3.870588</span>  <span class="fl">3.321739</span> <span class="op">-</span><span class="fl">0.548849</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>Steel Magnolias (<span class="dv">1989</span>)     <span class="fl">3.901734</span>  <span class="fl">3.365957</span> <span class="op">-</span><span class="fl">0.535777</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Reversing the order of the rows and again slicing off the top 10 rows, we get the movies preferred by men that women didn’t rate as highly:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">91</span>]: sorted_by_diff[::<span class="op">-</span><span class="dv">1</span>].head()</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">91</span>]: </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>gender                                         F         M      diff</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>title                                                               </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>Good, The Bad <span class="kw">and</span> The Ugly, The (<span class="dv">1966</span>)  <span class="fl">3.494949</span>  <span class="fl">4.221300</span>  <span class="fl">0.726351</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>Kentucky Fried Movie, The (<span class="dv">1977</span>)        <span class="fl">2.878788</span>  <span class="fl">3.555147</span>  <span class="fl">0.676359</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>Dumb <span class="op">&amp;</span> Dumber (<span class="dv">1994</span>)                    <span class="fl">2.697987</span>  <span class="fl">3.336595</span>  <span class="fl">0.638608</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>Longest Day, The (<span class="dv">1962</span>)                 <span class="fl">3.411765</span>  <span class="fl">4.031447</span>  <span class="fl">0.619682</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>Cable Guy, The (<span class="dv">1996</span>)                   <span class="fl">2.250000</span>  <span class="fl">2.863787</span>  <span class="fl">0.613787</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Suppose instead you wanted the movies that elicited the most disagreement among viewers, independent of gender identification. Disagreement can be measured by the variance or standard deviation of the ratings. To get this, we first compute the rating standard deviation by title and then filter down to the active titles:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">92</span>]: rating_std_by_title <span class="op">=</span> data.groupby(<span class="st">"title"</span>)[<span class="st">"rating"</span>].std()</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">93</span>]: rating_std_by_title <span class="op">=</span> rating_std_by_title.loc[active_titles]</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">94</span>]: rating_std_by_title.head()</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">94</span>]: </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>title</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co">'burbs, The (1989)                   1.107760</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="er">10 Things I Hate About You </span>(<span class="dv">1999</span>)    <span class="fl">0.989815</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="dv">101</span> Dalmatians (<span class="dv">1961</span>)                <span class="fl">0.982103</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="dv">101</span> Dalmatians (<span class="dv">1996</span>)                <span class="fl">1.098717</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="dv">12</span> Angry Men (<span class="dv">1957</span>)                  <span class="fl">0.812731</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>Name: rating, dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then, we sort in descending order and select the first 10 rows, which are roughly the 10 most divisively rated movies:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">95</span>]: rating_std_by_title.sort_values(ascending<span class="op">=</span><span class="va">False</span>)[:<span class="dv">10</span>]</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">95</span>]: </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>title</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>Dumb <span class="op">&amp;</span> Dumber (<span class="dv">1994</span>)                     <span class="fl">1.321333</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>Blair Witch Project, The (<span class="dv">1999</span>)          <span class="fl">1.316368</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>Natural Born Killers (<span class="dv">1994</span>)              <span class="fl">1.307198</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>Tank Girl (<span class="dv">1995</span>)                         <span class="fl">1.277695</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>Rocky Horror Picture Show, The (<span class="dv">1975</span>)    <span class="fl">1.260177</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>Eyes Wide Shut (<span class="dv">1999</span>)                    <span class="fl">1.259624</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>Evita (<span class="dv">1996</span>)                             <span class="fl">1.253631</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>Billy Madison (<span class="dv">1995</span>)                     <span class="fl">1.249970</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>Fear <span class="kw">and</span> Loathing <span class="kw">in</span> Las Vegas (<span class="dv">1998</span>)    <span class="fl">1.246408</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>Bicentennial Man (<span class="dv">1999</span>)                  <span class="fl">1.245533</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>Name: rating, dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You may have noticed that movie genres are given as a pipe-separated (<code>|</code>) string, since a single movie can belong to multiple genres. To help us group the ratings data by genre, we can use the <code>explode</code> method on DataFrame. Let's take a look at how this works. First, we can split the genres string into a list of genres using the <code>str.split</code> method on the Series:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">96</span>]: movies[<span class="st">"genres"</span>].head()</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">96</span>]: </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     Animation<span class="op">|</span>Children<span class="st">'s|Comedy</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="er">1    Adventure|Children's|Fantasy</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>                  Comedy<span class="op">|</span>Romance</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>                    Comedy<span class="op">|</span>Drama</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>                          Comedy</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>Name: genres, dtype: <span class="bu">object</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">97</span>]: movies[<span class="st">"genres"</span>].head().<span class="bu">str</span>.split(<span class="st">"|"</span>)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">97</span>]: </span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     [Animation, Children<span class="st">'s, Comedy]</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="er">1    </span>[Adventure, Children<span class="st">'s, Fantasy]</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="er">2                   </span>[Comedy, Romance]</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>                     [Comedy, Drama]</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>                            [Comedy]</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>Name: genres, dtype: <span class="bu">object</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">98</span>]: movies[<span class="st">"genre"</span>] <span class="op">=</span> movies.pop(<span class="st">"genres"</span>).<span class="bu">str</span>.split(<span class="st">"|"</span>)</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">99</span>]: movies.head()</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">99</span>]: </span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>   movie_id                               title   </span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>         <span class="dv">1</span>                    Toy Story (<span class="dv">1995</span>)  <span class="op">\</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>         <span class="dv">2</span>                      Jumanji (<span class="dv">1995</span>)   </span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>         <span class="dv">3</span>             Grumpier Old Men (<span class="dv">1995</span>)   </span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>         <span class="dv">4</span>            Waiting to Exhale (<span class="dv">1995</span>)   </span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>         <span class="dv">5</span>  Father of the Bride Part II (<span class="dv">1995</span>)   </span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>                              genre  </span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   [Animation, Children<span class="st">'s, Comedy]  </span></span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a><span class="er">1  [Adventure, Children's, Fantasy]  </span></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a><span class="er">2                 </span>[Comedy, Romance]  </span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>                   [Comedy, Drama]  </span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>                          [Comedy]  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, calling <code>movies.explode("genre")</code> generates a new DataFrame with one row for each "inner" element in each list of movie genres. For example, if a movie is classified as both a comedy and a romance, then there will be two rows in the result, one with just <code>"Comedy"</code> and the other with just <code>"Romance"</code>:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">100</span>]: movies_exploded <span class="op">=</span> movies.explode(<span class="st">"genre"</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">101</span>]: movies_exploded[:<span class="dv">10</span>]</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">101</span>]: </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>   movie_id                     title       genre</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>         <span class="dv">1</span>          Toy Story (<span class="dv">1995</span>)   Animation</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>         <span class="dv">1</span>          Toy Story (<span class="dv">1995</span>)  Children<span class="st">'s</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="er">0         1          Toy Story </span>(<span class="dv">1995</span>)      Comedy</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>         <span class="dv">2</span>            Jumanji (<span class="dv">1995</span>)   Adventure</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>         <span class="dv">2</span>            Jumanji (<span class="dv">1995</span>)  Children<span class="st">'s</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="er">1         2            Jumanji </span>(<span class="dv">1995</span>)     Fantasy</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>         <span class="dv">3</span>   Grumpier Old Men (<span class="dv">1995</span>)      Comedy</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>         <span class="dv">3</span>   Grumpier Old Men (<span class="dv">1995</span>)     Romance</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>         <span class="dv">4</span>  Waiting to Exhale (<span class="dv">1995</span>)      Comedy</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>         <span class="dv">4</span>  Waiting to Exhale (<span class="dv">1995</span>)       Drama</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, we can merge all three tables together and group by genre:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">102</span>]: ratings_with_genre <span class="op">=</span> pd.merge(pd.merge(movies_exploded, ratings), users</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">103</span>]: ratings_with_genre.iloc[<span class="dv">0</span>]</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">103</span>]: </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>movie_id                     <span class="dv">1</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>title         Toy Story (<span class="dv">1995</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>genre                Animation</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>user_id                      <span class="dv">1</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>rating                       <span class="dv">5</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>timestamp            <span class="dv">978824268</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>gender                       F</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>age                          <span class="dv">1</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>occupation                  <span class="dv">10</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="bu">zip</span>                      <span class="dv">48067</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>Name: <span class="dv">0</span>, dtype: <span class="bu">object</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">104</span>]: genre_ratings <span class="op">=</span> (ratings_with_genre.groupby([<span class="st">"genre"</span>, <span class="st">"age"</span>])</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>   .....:                  [<span class="st">"rating"</span>].mean()</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>   .....:                  .unstack(<span class="st">"age"</span>))</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">105</span>]: genre_ratings[:<span class="dv">10</span>]</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">105</span>]: </span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>age                <span class="dv">1</span>         <span class="dv">18</span>        <span class="dv">25</span>        <span class="dv">35</span>        <span class="dv">45</span>        <span class="dv">50</span>   </span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>genre                                                                     </span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>Action       <span class="fl">3.506385</span>  <span class="fl">3.447097</span>  <span class="fl">3.453358</span>  <span class="fl">3.538107</span>  <span class="fl">3.528543</span>  <span class="fl">3.611333</span>  <span class="op">\</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>Adventure    <span class="fl">3.449975</span>  <span class="fl">3.408525</span>  <span class="fl">3.443163</span>  <span class="fl">3.515291</span>  <span class="fl">3.528963</span>  <span class="fl">3.628163</span>   </span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>Animation    <span class="fl">3.476113</span>  <span class="fl">3.624014</span>  <span class="fl">3.701228</span>  <span class="fl">3.740545</span>  <span class="fl">3.734856</span>  <span class="fl">3.780020</span>   </span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>Children<span class="st">'s   3.241642  3.294257  3.426873  3.518423  3.527593  3.556555   </span></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a><span class="er">Comedy       3.497491  3.460417  3.490385  3.561984  3.591789  3.646868   </span></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>Crime        <span class="fl">3.710170</span>  <span class="fl">3.668054</span>  <span class="fl">3.680321</span>  <span class="fl">3.733736</span>  <span class="fl">3.750661</span>  <span class="fl">3.810688</span>   </span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>Documentary  <span class="fl">3.730769</span>  <span class="fl">3.865865</span>  <span class="fl">3.946690</span>  <span class="fl">3.953747</span>  <span class="fl">3.966521</span>  <span class="fl">3.908108</span>   </span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>Drama        <span class="fl">3.794735</span>  <span class="fl">3.721930</span>  <span class="fl">3.726428</span>  <span class="fl">3.782512</span>  <span class="fl">3.784356</span>  <span class="fl">3.878415</span>   </span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>Fantasy      <span class="fl">3.317647</span>  <span class="fl">3.353778</span>  <span class="fl">3.452484</span>  <span class="fl">3.482301</span>  <span class="fl">3.532468</span>  <span class="fl">3.581570</span>   </span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>Film<span class="op">-</span>Noir    <span class="fl">4.145455</span>  <span class="fl">3.997368</span>  <span class="fl">4.058725</span>  <span class="fl">4.064910</span>  <span class="fl">4.105376</span>  <span class="fl">4.175401</span>   </span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>age                <span class="dv">56</span>  </span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>genre                  </span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>Action       <span class="fl">3.610709</span>  </span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>Adventure    <span class="fl">3.649064</span>  </span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a>Animation    <span class="fl">3.756233</span>  </span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a>Children<span class="st">'s   3.621822  </span></span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a><span class="er">Comedy       3.650949  </span></span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a>Crime        <span class="fl">3.832549</span>  </span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a>Documentary  <span class="fl">3.961538</span>  </span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a>Drama        <span class="fl">3.933465</span>  </span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a>Fantasy      <span class="fl">3.532700</span>  </span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a>Film<span class="op">-</span>Noir    <span class="fl">4.125932</span>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="baby_names" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="baby_names"><span class="header-section-number">13.3</span> US Baby Names 1880–2010</h2>
<p>The United States Social Security Administration (SSA) has made available data on the frequency of baby names from 1880 through the present. Hadley Wickham, an author of several popular R packages, has this dataset in illustrating data manipulation in R.</p>
<p>We need to do some data wrangling to load this dataset, but once we do that we will have a DataFrame that looks like this:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">4</span>]: names.head(<span class="dv">10</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">4</span>]:</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>        name sex  births  year</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>       Mary   F    <span class="dv">7065</span>  <span class="dv">1880</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>       Anna   F    <span class="dv">2604</span>  <span class="dv">1880</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>       Emma   F    <span class="dv">2003</span>  <span class="dv">1880</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  Elizabeth   F    <span class="dv">1939</span>  <span class="dv">1880</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>     Minnie   F    <span class="dv">1746</span>  <span class="dv">1880</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>   Margaret   F    <span class="dv">1578</span>  <span class="dv">1880</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>        Ida   F    <span class="dv">1472</span>  <span class="dv">1880</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>      Alice   F    <span class="dv">1414</span>  <span class="dv">1880</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>     Bertha   F    <span class="dv">1320</span>  <span class="dv">1880</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>      Sarah   F    <span class="dv">1288</span>  <span class="dv">1880</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>There are many things you might want to do with the dataset:</p>
<ul>
<li><p>Visualize the proportion of babies given a particular name (your own, or another name) over time</p></li>
<li><p>Determine the relative rank of a name</p></li>
<li><p>Determine the most popular names in each year or the names whose popularity has advanced or declined the most</p></li>
<li><p>Analyze trends in names: vowels, consonants, length, overall diversity, changes in spelling, first and last letters</p></li>
<li><p>Analyze external sources of trends: biblical names, celebrities, demographics</p></li>
</ul>
<p>With the tools in this book, many of these kinds of analyses are within reach, so I will walk you through some of them.</p>
<p>As of this writing, the US Social Security Administration makes available data files, one per year, containing the total number of births for each sex/name combination. You can download the <a href="http://www.ssa.gov/oact/babynames/limits.html">raw archive</a> of these files.</p>
<p>If this page has been moved by the time you’re reading this, it can most likely be located again with an internet search. After downloading the “National data” file <em>names.zip</em> and unzipping it, you will have a directory containing a series of files like <em>yob1880.txt</em>. I use the Unix <code>head</code> command to look at the first 10 lines of one of the files (on Windows, you can use the <code>more</code> command or open it in a text editor):</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">106</span>]: <span class="op">!</span>head <span class="op">-</span>n <span class="dv">10</span> datasets<span class="op">/</span>babynames<span class="op">/</span>yob1880.txt</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>Mary,F,<span class="dv">7065</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>Anna,F,<span class="dv">2604</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>Emma,F,<span class="dv">2003</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>Elizabeth,F,<span class="dv">1939</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>Minnie,F,<span class="dv">1746</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>Margaret,F,<span class="dv">1578</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>Ida,F,<span class="dv">1472</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>Alice,F,<span class="dv">1414</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>Bertha,F,<span class="dv">1320</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>Sarah,F,<span class="dv">1288</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As this is already in comma-separated form, it can be loaded into a DataFrame with <code>pandas.read_csv</code>:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">107</span>]: names1880 <span class="op">=</span> pd.read_csv(<span class="st">"datasets/babynames/yob1880.txt"</span>,</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>   .....:                         names<span class="op">=</span>[<span class="st">"name"</span>, <span class="st">"sex"</span>, <span class="st">"births"</span>])</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">108</span>]: names1880</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">108</span>]: </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>           name sex  births</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>          Mary   F    <span class="dv">7065</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>          Anna   F    <span class="dv">2604</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>          Emma   F    <span class="dv">2003</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     Elizabeth   F    <span class="dv">1939</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>        Minnie   F    <span class="dv">1746</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>...         ...  ..     ...</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="dv">1995</span>     Woodie   M       <span class="dv">5</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="dv">1996</span>     Worthy   M       <span class="dv">5</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="dv">1997</span>     Wright   M       <span class="dv">5</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="dv">1998</span>       York   M       <span class="dv">5</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="dv">1999</span>  Zachariah   M       <span class="dv">5</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>[<span class="dv">2000</span> rows x <span class="dv">3</span> columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These files only contain names with at least five occurrences in each year, so for simplicity’s sake we can use the sum of the births column by sex as the total number of births in that year:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">109</span>]: names1880.groupby(<span class="st">"sex"</span>)[<span class="st">"births"</span>].<span class="bu">sum</span>()</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">109</span>]: </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>sex</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>F     <span class="dv">90993</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>M    <span class="dv">110493</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>Name: births, dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Since the dataset is split into files by year, one of the first things to do is to assemble all of the data into a single DataFrame and further add a <code>year</code> field. You can do this using <code>pandas.concat</code>. Run the following in a Jupyter cell:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>pieces <span class="op">=</span> []</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> year <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1880</span>, <span class="dv">2011</span>):</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    path <span class="op">=</span> <span class="ss">f"datasets/babynames/yob</span><span class="sc">{</span>year<span class="sc">}</span><span class="ss">.txt"</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    frame <span class="op">=</span> pd.read_csv(path, names<span class="op">=</span>[<span class="st">"name"</span>, <span class="st">"sex"</span>, <span class="st">"births"</span>])</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a column for the year</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    frame[<span class="st">"year"</span>] <span class="op">=</span> year</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    pieces.append(frame)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate everything into a single DataFrame</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>names <span class="op">=</span> pd.concat(pieces, ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>There are a couple things to note here. First, remember that <code>concat</code> combines the DataFrame objects by row by default. Second, you have to pass <code>ignore_index=True</code> because we’re not interested in preserving the original row numbers returned from <code>pandas.read_csv</code>. So we now have a single DataFrame containing all of the names data across all years:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">111</span>]: names</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">111</span>]: </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>              name sex  births  year</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>             Mary   F    <span class="dv">7065</span>  <span class="dv">1880</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>             Anna   F    <span class="dv">2604</span>  <span class="dv">1880</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>             Emma   F    <span class="dv">2003</span>  <span class="dv">1880</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>        Elizabeth   F    <span class="dv">1939</span>  <span class="dv">1880</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>           Minnie   F    <span class="dv">1746</span>  <span class="dv">1880</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>...            ...  ..     ...   ...</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1690779</span>    Zymaire   M       <span class="dv">5</span>  <span class="dv">2010</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="dv">1690780</span>     Zyonne   M       <span class="dv">5</span>  <span class="dv">2010</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1690781</span>  Zyquarius   M       <span class="dv">5</span>  <span class="dv">2010</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="dv">1690782</span>      Zyran   M       <span class="dv">5</span>  <span class="dv">2010</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="dv">1690783</span>      Zzyzx   M       <span class="dv">5</span>  <span class="dv">2010</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1690784</span> rows x <span class="dv">4</span> columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With this data in hand, we can already start aggregating the data at the year and sex level using <code>groupby</code> or <code>pivot_table</code> (see <a href="#baby_names_total_births">Total births by sex and year</a>):</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">112</span>]: total_births <span class="op">=</span> names.pivot_table(<span class="st">"births"</span>, index<span class="op">=</span><span class="st">"year"</span>,</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>   .....:                                  columns<span class="op">=</span><span class="st">"sex"</span>, aggfunc<span class="op">=</span><span class="bu">sum</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">113</span>]: total_births.tail()</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">113</span>]: </span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>sex         F        M</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>year                  </span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2006</span>  <span class="dv">1896468</span>  <span class="dv">2050234</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2007</span>  <span class="dv">1916888</span>  <span class="dv">2069242</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2008</span>  <span class="dv">1883645</span>  <span class="dv">2032310</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2009</span>  <span class="dv">1827643</span>  <span class="dv">1973359</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="dv">2010</span>  <span class="dv">1759010</span>  <span class="dv">1898382</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">114</span>]: total_births.plot(title<span class="op">=</span><span class="st">"Total births by sex and year"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-baby_names_total_births" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figs/baby_names_total_births.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;13.4: Total births by sex and year</figcaption>
</figure>
</div>
<p>Next, let’s insert a column <code>prop</code> with the fraction of babies given each name relative to the total number of births. A <code>prop</code> value of <code>0.02</code> would indicate that 2 out of every 100 babies were given a particular name. Thus, we group the data by year and sex, then add the new column to each group:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_prop(group):</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    group[<span class="st">"prop"</span>] <span class="op">=</span> group[<span class="st">"births"</span>] <span class="op">/</span> group[<span class="st">"births"</span>].<span class="bu">sum</span>()</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> group</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>names <span class="op">=</span> names.groupby([<span class="st">"year"</span>, <span class="st">"sex"</span>], group_keys<span class="op">=</span><span class="va">False</span>).<span class="bu">apply</span>(add_prop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The resulting complete dataset now has the following columns:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">116</span>]: names</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">116</span>]: </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>              name sex  births  year      prop</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>             Mary   F    <span class="dv">7065</span>  <span class="dv">1880</span>  <span class="fl">0.077643</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>             Anna   F    <span class="dv">2604</span>  <span class="dv">1880</span>  <span class="fl">0.028618</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>             Emma   F    <span class="dv">2003</span>  <span class="dv">1880</span>  <span class="fl">0.022013</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>        Elizabeth   F    <span class="dv">1939</span>  <span class="dv">1880</span>  <span class="fl">0.021309</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>           Minnie   F    <span class="dv">1746</span>  <span class="dv">1880</span>  <span class="fl">0.019188</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>...            ...  ..     ...   ...       ...</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1690779</span>    Zymaire   M       <span class="dv">5</span>  <span class="dv">2010</span>  <span class="fl">0.000003</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="dv">1690780</span>     Zyonne   M       <span class="dv">5</span>  <span class="dv">2010</span>  <span class="fl">0.000003</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1690781</span>  Zyquarius   M       <span class="dv">5</span>  <span class="dv">2010</span>  <span class="fl">0.000003</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="dv">1690782</span>      Zyran   M       <span class="dv">5</span>  <span class="dv">2010</span>  <span class="fl">0.000003</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="dv">1690783</span>      Zzyzx   M       <span class="dv">5</span>  <span class="dv">2010</span>  <span class="fl">0.000003</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1690784</span> rows x <span class="dv">5</span> columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When performing a group operation like this, it's often valuable to do a sanity check, like verifying that the <code>prop</code> column sums to 1 within all the groups:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">117</span>]: names.groupby([<span class="st">"year"</span>, <span class="st">"sex"</span>])[<span class="st">"prop"</span>].<span class="bu">sum</span>()</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">117</span>]: </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>year  sex</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1880</span>  F      <span class="fl">1.0</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>      M      <span class="fl">1.0</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1881</span>  F      <span class="fl">1.0</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>      M      <span class="fl">1.0</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1882</span>  F      <span class="fl">1.0</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>            ... </span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2008</span>  M      <span class="fl">1.0</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2009</span>  F      <span class="fl">1.0</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>      M      <span class="fl">1.0</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="dv">2010</span>  F      <span class="fl">1.0</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>      M      <span class="fl">1.0</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>Name: prop, Length: <span class="dv">262</span>, dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now that this is done, I’m going to extract a subset of the data to facilitate further analysis: the top 1,000 names for each sex/year combination. This is yet another group operation:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">118</span>]: <span class="kw">def</span> get_top1000(group):</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>   .....:     <span class="cf">return</span> group.sort_values(<span class="st">"births"</span>, ascending<span class="op">=</span><span class="va">False</span>)[:<span class="dv">1000</span>]</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">119</span>]: grouped <span class="op">=</span> names.groupby([<span class="st">"year"</span>, <span class="st">"sex"</span>])</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">120</span>]: top1000 <span class="op">=</span> grouped.<span class="bu">apply</span>(get_top1000)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">121</span>]: top1000.head()</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">121</span>]: </span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>                 name sex  births  year      prop</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>year sex                                         </span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1880</span> F   <span class="dv">0</span>       Mary   F    <span class="dv">7065</span>  <span class="dv">1880</span>  <span class="fl">0.077643</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>         <span class="dv">1</span>       Anna   F    <span class="dv">2604</span>  <span class="dv">1880</span>  <span class="fl">0.028618</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>         <span class="dv">2</span>       Emma   F    <span class="dv">2003</span>  <span class="dv">1880</span>  <span class="fl">0.022013</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>         <span class="dv">3</span>  Elizabeth   F    <span class="dv">1939</span>  <span class="dv">1880</span>  <span class="fl">0.021309</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>         <span class="dv">4</span>     Minnie   F    <span class="dv">1746</span>  <span class="dv">1880</span>  <span class="fl">0.019188</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can drop the group index since we don't need it for our analysis:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">122</span>]: top1000 <span class="op">=</span> top1000.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The resulting dataset is now quite a bit smaller:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">123</span>]: top1000.head()</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">123</span>]: </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>        name sex  births  year      prop</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>       Mary   F    <span class="dv">7065</span>  <span class="dv">1880</span>  <span class="fl">0.077643</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>       Anna   F    <span class="dv">2604</span>  <span class="dv">1880</span>  <span class="fl">0.028618</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>       Emma   F    <span class="dv">2003</span>  <span class="dv">1880</span>  <span class="fl">0.022013</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  Elizabeth   F    <span class="dv">1939</span>  <span class="dv">1880</span>  <span class="fl">0.021309</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>     Minnie   F    <span class="dv">1746</span>  <span class="dv">1880</span>  <span class="fl">0.019188</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We’ll use this top one thousand dataset in the following investigations into the data.</p>
<section id="baby_names_trends" class="level3">
<h3 class="anchored" data-anchor-id="baby_names_trends">Analyzing Naming Trends</h3>
<p>With the full dataset and the top one thousand dataset in hand, we can start analyzing various naming trends of interest. First, we can split the top one thousand names into the boy and girl portions:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">124</span>]: boys <span class="op">=</span> top1000[top1000[<span class="st">"sex"</span>] <span class="op">==</span> <span class="st">"M"</span>]</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">125</span>]: girls <span class="op">=</span> top1000[top1000[<span class="st">"sex"</span>] <span class="op">==</span> <span class="st">"F"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Simple time series, like the number of Johns or Marys for each year, can be plotted but require some manipulation to be more useful. Let’s form a pivot table of the total number of births by year and name:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">126</span>]: total_births <span class="op">=</span> top1000.pivot_table(<span class="st">"births"</span>, index<span class="op">=</span><span class="st">"year"</span>,</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>   .....:                                    columns<span class="op">=</span><span class="st">"name"</span>,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>   .....:                                    aggfunc<span class="op">=</span><span class="bu">sum</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, this can be plotted for a handful of names with DataFrame’s <code>plot</code> method (<a href="#baby_names_some_names">A few boy and girl names over time</a> shows the result):</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">127</span>]: total_births.info()</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span><span class="kw">class</span> <span class="st">'pandas.core.frame.DataFrame'</span><span class="op">&gt;</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>Index: <span class="dv">131</span> entries, <span class="dv">1880</span> to <span class="dv">2010</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>Columns: <span class="dv">6868</span> entries, Aaden to Zuri</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>dtypes: float64(<span class="dv">6868</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>memory usage: <span class="fl">6.9</span> MB</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">128</span>]: subset <span class="op">=</span> total_births[[<span class="st">"John"</span>, <span class="st">"Harry"</span>, <span class="st">"Mary"</span>, <span class="st">"Marilyn"</span>]]</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">129</span>]: subset.plot(subplots<span class="op">=</span><span class="va">True</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>),</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>   .....:             title<span class="op">=</span><span class="st">"Number of births per year"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-baby_names_some_names" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figs/baby_names_some_names.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;13.5: A few boy and girl names over time</figcaption>
</figure>
</div>
<p>On looking at this, you might conclude that these names have grown out of favor with the American population. But the story is actually more complicated than that, as will be explored in the next section.</p>
<section id="baby_names_diversity" class="level4">
<h4 class="anchored" data-anchor-id="baby_names_diversity">Measuring the increase in naming diversity</h4>
<p>One explanation for the decrease in plots is that fewer parents are choosing common names for their children. This hypothesis can be explored and confirmed in the data. One measure is the proportion of births represented by the top 1,000 most popular names, which I aggregate and plot by year and sex (<a href="#baby_names_tot_prop">Proportion of births represented in top one thousand names by sex</a> shows the resulting plot):</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">131</span>]: table <span class="op">=</span> top1000.pivot_table(<span class="st">"prop"</span>, index<span class="op">=</span><span class="st">"year"</span>,</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>   .....:                             columns<span class="op">=</span><span class="st">"sex"</span>, aggfunc<span class="op">=</span><span class="bu">sum</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">132</span>]: table.plot(title<span class="op">=</span><span class="st">"Sum of table1000.prop by year and sex"</span>,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>   .....:            yticks<span class="op">=</span>np.linspace(<span class="dv">0</span>, <span class="fl">1.2</span>, <span class="dv">13</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-baby_names_tot_prop" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figs/baby_names_tot_prop.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;13.6: Proportion of births represented in top one thousand names by sex</figcaption>
</figure>
</div>
<p>You can see that, indeed, there appears to be increasing name diversity (decreasing total proportion in the top one thousand). Another interesting metric is the number of distinct names, taken in order of popularity from highest to lowest, in the top 50% of births. This number is trickier to compute. Let’s consider just the boy names from 2010:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">133</span>]: df <span class="op">=</span> boys[boys[<span class="st">"year"</span>] <span class="op">==</span> <span class="dv">2010</span>]</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">134</span>]: df</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">134</span>]: </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>           name sex  births  year      prop</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="dv">260877</span>    Jacob   M   <span class="dv">21875</span>  <span class="dv">2010</span>  <span class="fl">0.011523</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="dv">260878</span>    Ethan   M   <span class="dv">17866</span>  <span class="dv">2010</span>  <span class="fl">0.009411</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="dv">260879</span>  Michael   M   <span class="dv">17133</span>  <span class="dv">2010</span>  <span class="fl">0.009025</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="dv">260880</span>   Jayden   M   <span class="dv">17030</span>  <span class="dv">2010</span>  <span class="fl">0.008971</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="dv">260881</span>  William   M   <span class="dv">16870</span>  <span class="dv">2010</span>  <span class="fl">0.008887</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>...         ...  ..     ...   ...       ...</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="dv">261872</span>   Camilo   M     <span class="dv">194</span>  <span class="dv">2010</span>  <span class="fl">0.000102</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="dv">261873</span>   Destin   M     <span class="dv">194</span>  <span class="dv">2010</span>  <span class="fl">0.000102</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="dv">261874</span>   Jaquan   M     <span class="dv">194</span>  <span class="dv">2010</span>  <span class="fl">0.000102</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="dv">261875</span>   Jaydan   M     <span class="dv">194</span>  <span class="dv">2010</span>  <span class="fl">0.000102</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a><span class="dv">261876</span>   Maxton   M     <span class="dv">193</span>  <span class="dv">2010</span>  <span class="fl">0.000102</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1000</span> rows x <span class="dv">5</span> columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>After sorting <code>prop</code> in descending order, we want to know how many of the most popular names it takes to reach 50%. You could write a <code>for</code> loop to do this, but a vectorized NumPy way is more computationally efficient. Taking the cumulative sum, <code>cumsum</code>, of <code>prop</code> and then calling the method <code>searchsorted</code> returns the position in the cumulative sum at which <code>0.5</code> would need to be inserted to keep it in sorted order:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">135</span>]: prop_cumsum <span class="op">=</span> df[<span class="st">"prop"</span>].sort_values(ascending<span class="op">=</span><span class="va">False</span>).cumsum()</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">136</span>]: prop_cumsum[:<span class="dv">10</span>]</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">136</span>]: </span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="dv">260877</span>    <span class="fl">0.011523</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="dv">260878</span>    <span class="fl">0.020934</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="dv">260879</span>    <span class="fl">0.029959</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="dv">260880</span>    <span class="fl">0.038930</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="dv">260881</span>    <span class="fl">0.047817</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="dv">260882</span>    <span class="fl">0.056579</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="dv">260883</span>    <span class="fl">0.065155</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="dv">260884</span>    <span class="fl">0.073414</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="dv">260885</span>    <span class="fl">0.081528</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="dv">260886</span>    <span class="fl">0.089621</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>Name: prop, dtype: float64</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">137</span>]: prop_cumsum.searchsorted(<span class="fl">0.5</span>)</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">137</span>]: <span class="dv">116</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Since arrays are zero-indexed, adding 1 to this result gives you a result of 117. By contrast, in 1900 this number was much smaller:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">138</span>]: df <span class="op">=</span> boys[boys.year <span class="op">==</span> <span class="dv">1900</span>]</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">139</span>]: in1900 <span class="op">=</span> df.sort_values(<span class="st">"prop"</span>, ascending<span class="op">=</span><span class="va">False</span>).prop.cumsum()</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">140</span>]: in1900.searchsorted(<span class="fl">0.5</span>) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">140</span>]: <span class="dv">25</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can now apply this operation to each year/sex combination, <code>groupby</code> those fields, and <code>apply</code> a function returning the count for each group:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_quantile_count(group, q<span class="op">=</span><span class="fl">0.5</span>):</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    group <span class="op">=</span> group.sort_values(<span class="st">"prop"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> group.prop.cumsum().searchsorted(q) <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>diversity <span class="op">=</span> top1000.groupby([<span class="st">"year"</span>, <span class="st">"sex"</span>]).<span class="bu">apply</span>(get_quantile_count)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>diversity <span class="op">=</span> diversity.unstack()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This resulting DataFrame <code>diversity</code> now has two time series, one for each sex, indexed by year. This can be inspected and plotted as before (see <a href="#baby_names_diversity_fig">Plot of diversity metric by year</a>):</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">143</span>]: diversity.head()</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">143</span>]: </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>sex    F   M</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>year        </span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1880</span>  <span class="dv">38</span>  <span class="dv">14</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1881</span>  <span class="dv">38</span>  <span class="dv">14</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1882</span>  <span class="dv">38</span>  <span class="dv">15</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1883</span>  <span class="dv">39</span>  <span class="dv">15</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1884</span>  <span class="dv">39</span>  <span class="dv">16</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">144</span>]: diversity.plot(title<span class="op">=</span><span class="st">"Number of popular names in top 50%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-baby_names_diversity_fig" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figs/baby_names_diversity_fig.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;13.7: Plot of diversity metric by year</figcaption>
</figure>
</div>
<p>As you can see, girl names have always been more diverse than boy names, and they have only become more so over time. Further analysis of what exactly is driving the diversity, like the increase of alternative spellings, is left to the reader.</p>
</section>
<section id="baby_names_trends_last_letters" class="level4">
<h4 class="anchored" data-anchor-id="baby_names_trends_last_letters">The “last letter” revolution</h4>
<p>In 2007, baby name researcher Laura Wattenberg pointed out that the distribution of boy names by final letter has changed significantly over the last 100 years. To see this, we first aggregate all of the births in the full dataset by year, sex, and final letter:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_last_letter(x):</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>last_letters <span class="op">=</span> names[<span class="st">"name"</span>].<span class="bu">map</span>(get_last_letter)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>last_letters.name <span class="op">=</span> <span class="st">"last_letter"</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> names.pivot_table(<span class="st">"births"</span>, index<span class="op">=</span>last_letters,</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>                          columns<span class="op">=</span>[<span class="st">"sex"</span>, <span class="st">"year"</span>], aggfunc<span class="op">=</span><span class="bu">sum</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then we select three representative years spanning the history and print the first few rows:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">146</span>]: subtable <span class="op">=</span> table.reindex(columns<span class="op">=</span>[<span class="dv">1910</span>, <span class="dv">1960</span>, <span class="dv">2010</span>], level<span class="op">=</span><span class="st">"year"</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">147</span>]: subtable.head()</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">147</span>]: </span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>sex                 F                            M                    </span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>year             <span class="dv">1910</span>      <span class="dv">1960</span>      <span class="dv">2010</span>     <span class="dv">1910</span>      <span class="dv">1960</span>      <span class="dv">2010</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>last_letter                                                           </span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>a            <span class="fl">108376.0</span>  <span class="fl">691247.0</span>  <span class="fl">670605.0</span>    <span class="fl">977.0</span>    <span class="fl">5204.0</span>   <span class="fl">28438.0</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>b                 NaN     <span class="fl">694.0</span>     <span class="fl">450.0</span>    <span class="fl">411.0</span>    <span class="fl">3912.0</span>   <span class="fl">38859.0</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>c                 <span class="fl">5.0</span>      <span class="fl">49.0</span>     <span class="fl">946.0</span>    <span class="fl">482.0</span>   <span class="fl">15476.0</span>   <span class="fl">23125.0</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>d              <span class="fl">6750.0</span>    <span class="fl">3729.0</span>    <span class="fl">2607.0</span>  <span class="fl">22111.0</span>  <span class="fl">262112.0</span>   <span class="fl">44398.0</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>e            <span class="fl">133569.0</span>  <span class="fl">435013.0</span>  <span class="fl">313833.0</span>  <span class="fl">28655.0</span>  <span class="fl">178823.0</span>  <span class="fl">129012.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next, normalize the table by total births to compute a new table containing the proportion of total births for each sex ending in each letter:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">148</span>]: subtable.<span class="bu">sum</span>()</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">148</span>]: </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>sex  year</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>F    <span class="dv">1910</span>     <span class="fl">396416.0</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>     <span class="dv">1960</span>    <span class="fl">2022062.0</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>     <span class="dv">2010</span>    <span class="fl">1759010.0</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>M    <span class="dv">1910</span>     <span class="fl">194198.0</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>     <span class="dv">1960</span>    <span class="fl">2132588.0</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>     <span class="dv">2010</span>    <span class="fl">1898382.0</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>dtype: float64</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">149</span>]: letter_prop <span class="op">=</span> subtable <span class="op">/</span> subtable.<span class="bu">sum</span>()</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">150</span>]: letter_prop</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">150</span>]: </span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>sex                 F                             M                    </span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>year             <span class="dv">1910</span>      <span class="dv">1960</span>      <span class="dv">2010</span>      <span class="dv">1910</span>      <span class="dv">1960</span>      <span class="dv">2010</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>last_letter                                                            </span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>a            <span class="fl">0.273390</span>  <span class="fl">0.341853</span>  <span class="fl">0.381240</span>  <span class="fl">0.005031</span>  <span class="fl">0.002440</span>  <span class="fl">0.014980</span></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>b                 NaN  <span class="fl">0.000343</span>  <span class="fl">0.000256</span>  <span class="fl">0.002116</span>  <span class="fl">0.001834</span>  <span class="fl">0.020470</span></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>c            <span class="fl">0.000013</span>  <span class="fl">0.000024</span>  <span class="fl">0.000538</span>  <span class="fl">0.002482</span>  <span class="fl">0.007257</span>  <span class="fl">0.012181</span></span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>d            <span class="fl">0.017028</span>  <span class="fl">0.001844</span>  <span class="fl">0.001482</span>  <span class="fl">0.113858</span>  <span class="fl">0.122908</span>  <span class="fl">0.023387</span></span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>e            <span class="fl">0.336941</span>  <span class="fl">0.215133</span>  <span class="fl">0.178415</span>  <span class="fl">0.147556</span>  <span class="fl">0.083853</span>  <span class="fl">0.067959</span></span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>...               ...       ...       ...       ...       ...       ...</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>v                 NaN  <span class="fl">0.000060</span>  <span class="fl">0.000117</span>  <span class="fl">0.000113</span>  <span class="fl">0.000037</span>  <span class="fl">0.001434</span></span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>w            <span class="fl">0.000020</span>  <span class="fl">0.000031</span>  <span class="fl">0.001182</span>  <span class="fl">0.006329</span>  <span class="fl">0.007711</span>  <span class="fl">0.016148</span></span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>x            <span class="fl">0.000015</span>  <span class="fl">0.000037</span>  <span class="fl">0.000727</span>  <span class="fl">0.003965</span>  <span class="fl">0.001851</span>  <span class="fl">0.008614</span></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>y            <span class="fl">0.110972</span>  <span class="fl">0.152569</span>  <span class="fl">0.116828</span>  <span class="fl">0.077349</span>  <span class="fl">0.160987</span>  <span class="fl">0.058168</span></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>z            <span class="fl">0.002439</span>  <span class="fl">0.000659</span>  <span class="fl">0.000704</span>  <span class="fl">0.000170</span>  <span class="fl">0.000184</span>  <span class="fl">0.001831</span></span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>[<span class="dv">26</span> rows x <span class="dv">6</span> columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With the letter proportions now in hand, we can make bar plots for each sex, broken down by year (see <a href="#baby_names_last_letter">Proportion of boy and girl names ending in each letter</a>):</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>letter_prop[<span class="st">"M"</span>].plot(kind<span class="op">=</span><span class="st">"bar"</span>, rot<span class="op">=</span><span class="dv">0</span>, ax<span class="op">=</span>axes[<span class="dv">0</span>], title<span class="op">=</span><span class="st">"Male"</span>)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>letter_prop[<span class="st">"F"</span>].plot(kind<span class="op">=</span><span class="st">"bar"</span>, rot<span class="op">=</span><span class="dv">0</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>], title<span class="op">=</span><span class="st">"Female"</span>,</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>                      legend<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-baby_names_last_letter" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figs/baby_names_last_letter.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;13.8: Proportion of boy and girl names ending in each letter</figcaption>
</figure>
</div>
<p>As you can see, boy names ending in <em>n</em> have experienced significant growth since the 1960s. Going back to the full table created before, I again normalize by year and sex and select a subset of letters for the boy names, finally transposing to make each column a time series:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">153</span>]: letter_prop <span class="op">=</span> table <span class="op">/</span> table.<span class="bu">sum</span>()</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">154</span>]: dny_ts <span class="op">=</span> letter_prop.loc[[<span class="st">"d"</span>, <span class="st">"n"</span>, <span class="st">"y"</span>], <span class="st">"M"</span>].T</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">155</span>]: dny_ts.head()</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">155</span>]: </span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>last_letter         d         n         y</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>year                                     </span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1880</span>         <span class="fl">0.083055</span>  <span class="fl">0.153213</span>  <span class="fl">0.075760</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1881</span>         <span class="fl">0.083247</span>  <span class="fl">0.153214</span>  <span class="fl">0.077451</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="dv">1882</span>         <span class="fl">0.085340</span>  <span class="fl">0.149560</span>  <span class="fl">0.077537</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1883</span>         <span class="fl">0.084066</span>  <span class="fl">0.151646</span>  <span class="fl">0.079144</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a><span class="dv">1884</span>         <span class="fl">0.086120</span>  <span class="fl">0.149915</span>  <span class="fl">0.080405</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With this DataFrame of time series in hand, I can make a plot of the trends over time again with its <code>plot</code> method (see <a href="#baby_names_letter_over_time">Proportion of boys born with names ending in d/n/y over time</a>):</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">158</span>]: dny_ts.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-baby_names_letter_over_time" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figs/baby_names_letter_over_time.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;13.9: Proportion of boys born with names ending in d/n/y over time</figcaption>
</figure>
</div>
</section>
<section id="baby_names_change" class="level4">
<h4 class="anchored" data-anchor-id="baby_names_change">Boy names that became girl names (and vice versa)</h4>
<p>Another fun trend is looking at names that were more popular with one gender earlier in the sample but have become preferred as a name for the other gender over time. One example is the name Lesley or Leslie. Going back to the <code>top1000</code> DataFrame, I compute a list of names occurring in the dataset starting with "Lesl":</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">159</span>]: all_names <span class="op">=</span> pd.Series(top1000[<span class="st">"name"</span>].unique())</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">160</span>]: lesley_like <span class="op">=</span> all_names[all_names.<span class="bu">str</span>.contains(<span class="st">"Lesl"</span>)]</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">161</span>]: lesley_like</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">161</span>]: </span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="dv">632</span>     Leslie</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2294</span>    Lesley</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4262</span>    Leslee</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4728</span>     Lesli</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="dv">6103</span>     Lesly</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>From there, we can filter down to just those names and sum births grouped by name to see the relative frequencies:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">162</span>]: filtered <span class="op">=</span> top1000[top1000[<span class="st">"name"</span>].isin(lesley_like)]</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">163</span>]: filtered.groupby(<span class="st">"name"</span>)[<span class="st">"births"</span>].<span class="bu">sum</span>()</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">163</span>]: </span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>name</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>Leslee      <span class="dv">1082</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>Lesley     <span class="dv">35022</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>Lesli        <span class="dv">929</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>Leslie    <span class="dv">370429</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>Lesly      <span class="dv">10067</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>Name: births, dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next, let’s aggregate by sex and year, and normalize within year:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">164</span>]: table <span class="op">=</span> filtered.pivot_table(<span class="st">"births"</span>, index<span class="op">=</span><span class="st">"year"</span>,</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>   .....:                              columns<span class="op">=</span><span class="st">"sex"</span>, aggfunc<span class="op">=</span><span class="st">"sum"</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">165</span>]: table <span class="op">=</span> table.div(table.<span class="bu">sum</span>(axis<span class="op">=</span><span class="st">"columns"</span>), axis<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">166</span>]: table.tail()</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">166</span>]: </span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>sex     F   M</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>year         </span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2006</span>  <span class="fl">1.0</span> NaN</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2007</span>  <span class="fl">1.0</span> NaN</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a><span class="dv">2008</span>  <span class="fl">1.0</span> NaN</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a><span class="dv">2009</span>  <span class="fl">1.0</span> NaN</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a><span class="dv">2010</span>  <span class="fl">1.0</span> NaN</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Lastly, it’s now possible to make a plot of the breakdown by sex over time (see <a href="#baby_names_lesley">Proportion of male/female Lesley-like names over time</a>):</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">168</span>]: table.plot(style<span class="op">=</span>{<span class="st">"M"</span>: <span class="st">"k-"</span>, <span class="st">"F"</span>: <span class="st">"k--"</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-baby_names_lesley" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figs/baby_names_lesley.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;13.10: Proportion of male/female Lesley-like names over time</figcaption>
</figure>
</div>
</section>
</section>
</section>
<section id="prep_example" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="prep_example"><span class="header-section-number">13.4</span> USDA Food Database</h2>
<p>The US Department of Agriculture (USDA) makes available a database of food nutrient information. Programmer Ashley Williams created a version of this database in JSON format. The records look like this:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"id"</span><span class="fu">:</span> <span class="dv">21441</span><span class="fu">,</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"KENTUCKY FRIED CHICKEN, Fried Chicken, EXTRA CRISPY,</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="st">Wing, meat and skin with breading"</span><span class="fu">,</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"tags"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"KFC"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"manufacturer"</span><span class="fu">:</span> <span class="st">"Kentucky Fried Chicken"</span><span class="fu">,</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"group"</span><span class="fu">:</span> <span class="st">"Fast Foods"</span><span class="fu">,</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"portions"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"amount"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"unit"</span><span class="fu">:</span> <span class="st">"wing, with skin"</span><span class="fu">,</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"grams"</span><span class="fu">:</span> <span class="fl">68.0</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>    <span class="er">...</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"nutrients"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">{</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"value"</span><span class="fu">:</span> <span class="fl">20.8</span><span class="fu">,</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"units"</span><span class="fu">:</span> <span class="st">"g"</span><span class="fu">,</span></span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"Protein"</span><span class="fu">,</span></span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"group"</span><span class="fu">:</span> <span class="st">"Composition"</span></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>    <span class="er">...</span></span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>  <span class="ot">]</span></span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Each food has a number of identifying attributes along with two lists of nutrients and portion sizes. Data in this form is not particularly amenable to analysis, so we need to do some work to wrangle the data into a better form.</p>
<p>You can load this file into Python with any JSON library of your choosing. I’ll use the built-in Python <code>json</code> module:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">169</span>]: <span class="im">import</span> json</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">170</span>]: db <span class="op">=</span> json.load(<span class="bu">open</span>(<span class="st">"datasets/usda_food/database.json"</span>))</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">171</span>]: <span class="bu">len</span>(db)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">171</span>]: <span class="dv">6636</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Each entry in <code>db</code> is a dictionary containing all the data for a single food. The <code>"nutrients"</code> field is a list of dictionaries, one for each nutrient:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">172</span>]: db[<span class="dv">0</span>].keys()</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">172</span>]: dict_keys([<span class="st">'id'</span>, <span class="st">'description'</span>, <span class="st">'tags'</span>, <span class="st">'manufacturer'</span>, <span class="st">'group'</span>, <span class="st">'porti</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="er">ons', 'nutrients'])</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="er">In [173]: db[0]["nutrients"][0]</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="er">Out[173]: </span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="er">{'value': 25.18,</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="er"> 'units': 'g',</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="er"> 'description': 'Protein',</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a><span class="er"> 'group': 'Composition'}</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a><span class="er">In [174]: nutrients = pd.DataFrame(db[0]["nutrients"])</span></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a><span class="er">In [175]: nutrients.head(7)</span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a><span class="er">Out[175]: </span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a><span class="er">     value units                  description        group</span></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="fl">25.18</span>     g                      Protein  Composition</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="fl">29.20</span>     g            Total lipid (fat)  Composition</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>     <span class="fl">3.06</span>     g  Carbohydrate, by difference  Composition</span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     <span class="fl">3.28</span>     g                          Ash        Other</span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   <span class="fl">376.00</span>  kcal                       Energy       Energy</span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    <span class="fl">39.28</span>     g                        Water  Composition</span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  <span class="fl">1573.00</span>    kJ                       Energy       Energy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When converting a list of dictionaries to a DataFrame, we can specify a list of fields to extract. We’ll take the food names, group, ID, and manufacturer:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">176</span>]: info_keys <span class="op">=</span> [<span class="st">"description"</span>, <span class="st">"group"</span>, <span class="st">"id"</span>, <span class="st">"manufacturer"</span>]</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">177</span>]: info <span class="op">=</span> pd.DataFrame(db, columns<span class="op">=</span>info_keys)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">178</span>]: info.head()</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">178</span>]: </span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>                          description                   group    <span class="bu">id</span>   </span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>                     Cheese, caraway  Dairy <span class="kw">and</span> Egg Products  <span class="dv">1008</span>  <span class="op">\</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>                     Cheese, cheddar  Dairy <span class="kw">and</span> Egg Products  <span class="dv">1009</span>   </span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>                        Cheese, edam  Dairy <span class="kw">and</span> Egg Products  <span class="dv">1018</span>   </span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>                        Cheese, feta  Dairy <span class="kw">and</span> Egg Products  <span class="dv">1019</span>   </span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  Cheese, mozzarella, part skim milk  Dairy <span class="kw">and</span> Egg Products  <span class="dv">1028</span>   </span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>  manufacturer  </span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>               </span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>               </span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>               </span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>               </span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>               </span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">179</span>]: info.info()</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span><span class="kw">class</span> <span class="st">'pandas.core.frame.DataFrame'</span><span class="op">&gt;</span></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>RangeIndex: <span class="dv">6636</span> entries, <span class="dv">0</span> to <span class="dv">6635</span></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>Data columns (total <span class="dv">4</span> columns):</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a> <span class="co">#   Column        Non-Null Count  Dtype </span></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>  <span class="op">------</span>        <span class="op">--------------</span>  <span class="op">-----</span> </span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a> <span class="dv">0</span>   description   <span class="dv">6636</span> non<span class="op">-</span>null   <span class="bu">object</span></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span>   group         <span class="dv">6636</span> non<span class="op">-</span>null   <span class="bu">object</span></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span>   <span class="bu">id</span>            <span class="dv">6636</span> non<span class="op">-</span>null   int64 </span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span>   manufacturer  <span class="dv">5195</span> non<span class="op">-</span>null   <span class="bu">object</span></span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>dtypes: int64(<span class="dv">1</span>), <span class="bu">object</span>(<span class="dv">3</span>)</span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>memory usage: <span class="fl">207.5</span><span class="op">+</span> KB</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>From the output of <code>info.info()</code>, we can see that there is missing data in the <code>manufacturer</code> column.</p>
<p>You can see the distribution of food groups with <code>value_counts</code>:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">180</span>]: pd.value_counts(info[<span class="st">"group"</span>])[:<span class="dv">10</span>]</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">180</span>]: </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>group</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>Vegetables <span class="kw">and</span> Vegetable Products    <span class="dv">812</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>Beef Products                        <span class="dv">618</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>Baked Products                       <span class="dv">496</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>Breakfast Cereals                    <span class="dv">403</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>Legumes <span class="kw">and</span> Legume Products          <span class="dv">365</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>Fast Foods                           <span class="dv">365</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>Lamb, Veal, <span class="kw">and</span> Game Products        <span class="dv">345</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>Sweets                               <span class="dv">341</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>Fruits <span class="kw">and</span> Fruit Juices              <span class="dv">328</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>Pork Products                        <span class="dv">328</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>Name: count, dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, to do some analysis on all of the nutrient data, it’s easiest to assemble the nutrients for each food into a single large table. To do so, we need to take several steps. First, I’ll convert each list of food nutrients to a DataFrame, add a column for the food <code>id</code>, and append the DataFrame to a list. Then, these can be concatenated with <code>concat</code>. Run the following code in a Jupyter cell:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>nutrients <span class="op">=</span> []</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> rec <span class="kw">in</span> db:</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    fnuts <span class="op">=</span> pd.DataFrame(rec[<span class="st">"nutrients"</span>])</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    fnuts[<span class="st">"id"</span>] <span class="op">=</span> rec[<span class="st">"id"</span>]</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    nutrients.append(fnuts)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>nutrients <span class="op">=</span> pd.concat(nutrients, ignore_index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If all goes well, <code>nutrients</code> should look like this:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">182</span>]: nutrients</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">182</span>]: </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>          value units                         description        group     <span class="bu">id</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>        <span class="fl">25.180</span>     g                             Protein  Composition   <span class="dv">1008</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>        <span class="fl">29.200</span>     g                   Total lipid (fat)  Composition   <span class="dv">1008</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>         <span class="fl">3.060</span>     g         Carbohydrate, by difference  Composition   <span class="dv">1008</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>         <span class="fl">3.280</span>     g                                 Ash        Other   <span class="dv">1008</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>       <span class="fl">376.000</span>  kcal                              Energy       Energy   <span class="dv">1008</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>...         ...   ...                                 ...          ...    ...</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a><span class="dv">389350</span>    <span class="fl">0.000</span>   mcg                 Vitamin B<span class="op">-</span><span class="dv">12</span>, added     Vitamins  <span class="dv">43546</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a><span class="dv">389351</span>    <span class="fl">0.000</span>    mg                         Cholesterol        Other  <span class="dv">43546</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a><span class="dv">389352</span>    <span class="fl">0.072</span>     g        Fatty acids, total saturated        Other  <span class="dv">43546</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a><span class="dv">389353</span>    <span class="fl">0.028</span>     g  Fatty acids, total monounsaturated        Other  <span class="dv">43546</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a><span class="dv">389354</span>    <span class="fl">0.041</span>     g  Fatty acids, total polyunsaturated        Other  <span class="dv">43546</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>[<span class="dv">389355</span> rows x <span class="dv">5</span> columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>I noticed that there are duplicates in this DataFrame, so it makes things easier to drop them:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">183</span>]: nutrients.duplicated().<span class="bu">sum</span>()  <span class="co"># number of duplicates</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">183</span>]: <span class="dv">14179</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">184</span>]: nutrients <span class="op">=</span> nutrients.drop_duplicates()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Since <code>"group"</code> and <code>"description"</code> are in both DataFrame objects, we can rename for clarity:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">185</span>]: col_mapping <span class="op">=</span> {<span class="st">"description"</span> : <span class="st">"food"</span>,</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>   .....:                <span class="st">"group"</span>       : <span class="st">"fgroup"</span>}</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">186</span>]: info <span class="op">=</span> info.rename(columns<span class="op">=</span>col_mapping, copy<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">187</span>]: info.info()</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span><span class="kw">class</span> <span class="st">'pandas.core.frame.DataFrame'</span><span class="op">&gt;</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>RangeIndex: <span class="dv">6636</span> entries, <span class="dv">0</span> to <span class="dv">6635</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>Data columns (total <span class="dv">4</span> columns):</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a> <span class="co">#   Column        Non-Null Count  Dtype </span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>  <span class="op">------</span>        <span class="op">--------------</span>  <span class="op">-----</span> </span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a> <span class="dv">0</span>   food          <span class="dv">6636</span> non<span class="op">-</span>null   <span class="bu">object</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span>   fgroup        <span class="dv">6636</span> non<span class="op">-</span>null   <span class="bu">object</span></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span>   <span class="bu">id</span>            <span class="dv">6636</span> non<span class="op">-</span>null   int64 </span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span>   manufacturer  <span class="dv">5195</span> non<span class="op">-</span>null   <span class="bu">object</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>dtypes: int64(<span class="dv">1</span>), <span class="bu">object</span>(<span class="dv">3</span>)</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>memory usage: <span class="fl">207.5</span><span class="op">+</span> KB</span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">188</span>]: col_mapping <span class="op">=</span> {<span class="st">"description"</span> : <span class="st">"nutrient"</span>,</span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>   .....:                <span class="st">"group"</span> : <span class="st">"nutgroup"</span>}</span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">189</span>]: nutrients <span class="op">=</span> nutrients.rename(columns<span class="op">=</span>col_mapping, copy<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">190</span>]: nutrients</span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">190</span>]: </span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a>          value units                            nutrient     nutgroup     <span class="bu">id</span></span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>        <span class="fl">25.180</span>     g                             Protein  Composition   <span class="dv">1008</span></span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>        <span class="fl">29.200</span>     g                   Total lipid (fat)  Composition   <span class="dv">1008</span></span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>         <span class="fl">3.060</span>     g         Carbohydrate, by difference  Composition   <span class="dv">1008</span></span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>         <span class="fl">3.280</span>     g                                 Ash        Other   <span class="dv">1008</span></span>
<span id="cb85-31"><a href="#cb85-31" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>       <span class="fl">376.000</span>  kcal                              Energy       Energy   <span class="dv">1008</span></span>
<span id="cb85-32"><a href="#cb85-32" aria-hidden="true" tabindex="-1"></a>...         ...   ...                                 ...          ...    ...</span>
<span id="cb85-33"><a href="#cb85-33" aria-hidden="true" tabindex="-1"></a><span class="dv">389350</span>    <span class="fl">0.000</span>   mcg                 Vitamin B<span class="op">-</span><span class="dv">12</span>, added     Vitamins  <span class="dv">43546</span></span>
<span id="cb85-34"><a href="#cb85-34" aria-hidden="true" tabindex="-1"></a><span class="dv">389351</span>    <span class="fl">0.000</span>    mg                         Cholesterol        Other  <span class="dv">43546</span></span>
<span id="cb85-35"><a href="#cb85-35" aria-hidden="true" tabindex="-1"></a><span class="dv">389352</span>    <span class="fl">0.072</span>     g        Fatty acids, total saturated        Other  <span class="dv">43546</span></span>
<span id="cb85-36"><a href="#cb85-36" aria-hidden="true" tabindex="-1"></a><span class="dv">389353</span>    <span class="fl">0.028</span>     g  Fatty acids, total monounsaturated        Other  <span class="dv">43546</span></span>
<span id="cb85-37"><a href="#cb85-37" aria-hidden="true" tabindex="-1"></a><span class="dv">389354</span>    <span class="fl">0.041</span>     g  Fatty acids, total polyunsaturated        Other  <span class="dv">43546</span></span>
<span id="cb85-38"><a href="#cb85-38" aria-hidden="true" tabindex="-1"></a>[<span class="dv">375176</span> rows x <span class="dv">5</span> columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With all of this done, we’re ready to merge <code>info</code> with <code>nutrients</code>:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">191</span>]: ndata <span class="op">=</span> pd.merge(nutrients, info, on<span class="op">=</span><span class="st">"id"</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">192</span>]: ndata.info()</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span><span class="kw">class</span> <span class="st">'pandas.core.frame.DataFrame'</span><span class="op">&gt;</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>RangeIndex: <span class="dv">375176</span> entries, <span class="dv">0</span> to <span class="dv">375175</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>Data columns (total <span class="dv">8</span> columns):</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a> <span class="co">#   Column        Non-Null Count   Dtype  </span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>  <span class="op">------</span>        <span class="op">--------------</span>   <span class="op">-----</span>  </span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a> <span class="dv">0</span>   value         <span class="dv">375176</span> non<span class="op">-</span>null  float64</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span>   units         <span class="dv">375176</span> non<span class="op">-</span>null  <span class="bu">object</span> </span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span>   nutrient      <span class="dv">375176</span> non<span class="op">-</span>null  <span class="bu">object</span> </span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span>   nutgroup      <span class="dv">375176</span> non<span class="op">-</span>null  <span class="bu">object</span> </span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span>   <span class="bu">id</span>            <span class="dv">375176</span> non<span class="op">-</span>null  int64  </span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span>   food          <span class="dv">375176</span> non<span class="op">-</span>null  <span class="bu">object</span> </span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span>   fgroup        <span class="dv">375176</span> non<span class="op">-</span>null  <span class="bu">object</span> </span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span>   manufacturer  <span class="dv">293054</span> non<span class="op">-</span>null  <span class="bu">object</span> </span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>dtypes: float64(<span class="dv">1</span>), int64(<span class="dv">1</span>), <span class="bu">object</span>(<span class="dv">6</span>)</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>memory usage: <span class="fl">22.9</span><span class="op">+</span> MB</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">193</span>]: ndata.iloc[<span class="dv">30000</span>]</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">193</span>]: </span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>value                                             <span class="fl">0.04</span></span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>units                                                g</span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>nutrient                                       Glycine</span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>nutgroup                                   Amino Acids</span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span>                                                <span class="dv">6158</span></span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>food            Soup, tomato bisque, canned, condensed</span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>fgroup                      Soups, Sauces, <span class="kw">and</span> Gravies</span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>manufacturer                                          </span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>Name: <span class="dv">30000</span>, dtype: <span class="bu">object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We could now make a plot of median values by food group and nutrient type (see <a href="#fig_wrangle_zinc">Median zinc values by food group</a>):</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">195</span>]: result <span class="op">=</span> ndata.groupby([<span class="st">"nutrient"</span>, <span class="st">"fgroup"</span>])[<span class="st">"value"</span>].quantile(<span class="fl">0.5</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">196</span>]: result[<span class="st">"Zinc, Zn"</span>].sort_values().plot(kind<span class="op">=</span><span class="st">"barh"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-fig_wrangle_zinc" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figs/fig_wrangle_zinc.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;13.11: Median zinc values by food group</figcaption>
</figure>
</div>
<p>Using the <code>idxmax</code> or <code>argmax</code> Series methods, you can find which food is most dense in each nutrient. Run the following in a Jupyter cell:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>by_nutrient <span class="op">=</span> ndata.groupby([<span class="st">"nutgroup"</span>, <span class="st">"nutrient"</span>])</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_maximum(x):</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x.loc[x.value.idxmax()]</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>max_foods <span class="op">=</span> by_nutrient.<span class="bu">apply</span>(get_maximum)[[<span class="st">"value"</span>, <span class="st">"food"</span>]]</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="co"># make the food a little smaller</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>max_foods[<span class="st">"food"</span>] <span class="op">=</span> max_foods[<span class="st">"food"</span>].<span class="bu">str</span>[:<span class="dv">50</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The resulting DataFrame is a bit too large to display in the book; here is only the <code>"Amino Acids"</code> nutrient group:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">198</span>]: max_foods.loc[<span class="st">"Amino Acids"</span>][<span class="st">"food"</span>]</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">198</span>]: </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>nutrient</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>Alanine                            Gelatins, dry powder, unsweetened</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>Arginine                                Seeds, sesame flour, low<span class="op">-</span>fat</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>Aspartic acid                                    Soy protein isolate</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>Cystine                 Seeds, cottonseed flour, low fat (glandless)</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>Glutamic acid                                    Soy protein isolate</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>Glycine                            Gelatins, dry powder, unsweetened</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>Histidine                 Whale, beluga, meat, dried (Alaska Native)</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>Hydroxyproline    KENTUCKY FRIED CHICKEN, Fried Chicken, ORIGINAL RE</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>Isoleucine        Soy protein isolate, PROTEIN TECHNOLOGIES INTERNAT</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>Leucine           Soy protein isolate, PROTEIN TECHNOLOGIES INTERNAT</span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>Lysine            Seal, bearded (Oogruk), meat, dried (Alaska Native</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>Methionine                     Fish, cod, Atlantic, dried <span class="kw">and</span> salted</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>Phenylalanine     Soy protein isolate, PROTEIN TECHNOLOGIES INTERNAT</span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>Proline                            Gelatins, dry powder, unsweetened</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>Serine            Soy protein isolate, PROTEIN TECHNOLOGIES INTERNAT</span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>Threonine         Soy protein isolate, PROTEIN TECHNOLOGIES INTERNAT</span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>Tryptophan          Sea lion, Steller, meat <span class="cf">with</span> fat (Alaska Native)</span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>Tyrosine          Soy protein isolate, PROTEIN TECHNOLOGIES INTERNAT</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>Valine            Soy protein isolate, PROTEIN TECHNOLOGIES INTERNAT</span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>Name: food, dtype: <span class="bu">object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="groupby_fec" class="level2" data-number="13.5">
<h2 data-number="13.5" class="anchored" data-anchor-id="groupby_fec"><span class="header-section-number">13.5</span> 2012 Federal Election Commission Database</h2>
<p>The US Federal Election Commission (FEC) publishes data on contributions to political campaigns. This includes contributor names, occupation and employer, address, and contribution amount. The contribution data from the 2012 US presidential election was available as a single 150-megabyte CSV file <em>P00000001-ALL.csv</em> (see the book's data repository), which can be loaded with <code>pandas.read_csv</code>:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">199</span>]: fec <span class="op">=</span> pd.read_csv(<span class="st">"datasets/fec/P00000001-ALL.csv"</span>, low_memory<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">200</span>]: fec.info()</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span><span class="kw">class</span> <span class="st">'pandas.core.frame.DataFrame'</span><span class="op">&gt;</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>RangeIndex: <span class="dv">1001731</span> entries, <span class="dv">0</span> to <span class="dv">1001730</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>Data columns (total <span class="dv">16</span> columns):</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a> <span class="co">#   Column             Non-Null Count    Dtype  </span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>  <span class="op">------</span>             <span class="op">--------------</span>    <span class="op">-----</span>  </span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a> <span class="dv">0</span>   cmte_id            <span class="dv">1001731</span> non<span class="op">-</span>null  <span class="bu">object</span> </span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span>   cand_id            <span class="dv">1001731</span> non<span class="op">-</span>null  <span class="bu">object</span> </span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span>   cand_nm            <span class="dv">1001731</span> non<span class="op">-</span>null  <span class="bu">object</span> </span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span>   contbr_nm          <span class="dv">1001731</span> non<span class="op">-</span>null  <span class="bu">object</span> </span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a> <span class="dv">4</span>   contbr_city        <span class="dv">1001712</span> non<span class="op">-</span>null  <span class="bu">object</span> </span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a> <span class="dv">5</span>   contbr_st          <span class="dv">1001727</span> non<span class="op">-</span>null  <span class="bu">object</span> </span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a> <span class="dv">6</span>   contbr_zip         <span class="dv">1001620</span> non<span class="op">-</span>null  <span class="bu">object</span> </span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a> <span class="dv">7</span>   contbr_employer    <span class="dv">988002</span> non<span class="op">-</span>null   <span class="bu">object</span> </span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a> <span class="dv">8</span>   contbr_occupation  <span class="dv">993301</span> non<span class="op">-</span>null   <span class="bu">object</span> </span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a> <span class="dv">9</span>   contb_receipt_amt  <span class="dv">1001731</span> non<span class="op">-</span>null  float64</span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a> <span class="dv">10</span>  contb_receipt_dt   <span class="dv">1001731</span> non<span class="op">-</span>null  <span class="bu">object</span> </span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a> <span class="dv">11</span>  receipt_desc       <span class="dv">14166</span> non<span class="op">-</span>null    <span class="bu">object</span> </span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a> <span class="dv">12</span>  memo_cd            <span class="dv">92482</span> non<span class="op">-</span>null    <span class="bu">object</span> </span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a> <span class="dv">13</span>  memo_text          <span class="dv">97770</span> non<span class="op">-</span>null    <span class="bu">object</span> </span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a> <span class="dv">14</span>  form_tp            <span class="dv">1001731</span> non<span class="op">-</span>null  <span class="bu">object</span> </span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a> <span class="dv">15</span>  file_num           <span class="dv">1001731</span> non<span class="op">-</span>null  int64  </span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>dtypes: float64(<span class="dv">1</span>), int64(<span class="dv">1</span>), <span class="bu">object</span>(<span class="dv">14</span>)</span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>memory usage: <span class="fl">122.3</span><span class="op">+</span> MB</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Several people asked me to update the dataset from the 2012 election to the 2016 or 2020 elections. Unfortunately, the more recent datasets provided by the FEC have become larger and more complex, and I decided that working with them here would be a distraction from the analysis techniques that I wanted to illustrate.</p>
</div>
</div>
<p>A sample record in the DataFrame looks like this:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">201</span>]: fec.iloc[<span class="dv">123456</span>]</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">201</span>]: </span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>cmte_id                             C00431445</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>cand_id                             P80003338</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>cand_nm                         Obama, Barack</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>contbr_nm                         ELLMAN, IRA</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>contbr_city                             TEMPE</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>contbr_st                                  AZ</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>contbr_zip                          <span class="dv">852816719</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>contbr_employer      ARIZONA STATE UNIVERSITY</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>contbr_occupation                   PROFESSOR</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>contb_receipt_amt                        <span class="fl">50.0</span></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>contb_receipt_dt                    <span class="dv">0</span><span class="er">1</span><span class="op">-</span>DEC<span class="op">-</span><span class="dv">11</span></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>receipt_desc                              NaN</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>memo_cd                                   NaN</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>memo_text                                 NaN</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>form_tp                                 SA17A</span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>file_num                               <span class="dv">772372</span></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>Name: <span class="dv">123456</span>, dtype: <span class="bu">object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You may think of some ways to start slicing and dicing this data to extract informative statistics about donors and patterns in the campaign contributions. I’ll show you a number of different analyses that apply the techniques in this book.</p>
<p>You can see that there are no political party affiliations in the data, so this would be useful to add. You can get a list of all the unique political candidates using <code>unique</code>:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">202</span>]: unique_cands <span class="op">=</span> fec[<span class="st">"cand_nm"</span>].unique()</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">203</span>]: unique_cands</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">203</span>]: </span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>array([<span class="st">'Bachmann, Michelle'</span>, <span class="st">'Romney, Mitt'</span>, <span class="st">'Obama, Barack'</span>,</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Roemer, Charles E. 'Buddy' III"</span>, <span class="st">'Pawlenty, Timothy'</span>,</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Johnson, Gary Earl'</span>, <span class="st">'Paul, Ron'</span>, <span class="st">'Santorum, Rick'</span>,</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Cain, Herman'</span>, <span class="st">'Gingrich, Newt'</span>, <span class="st">'McCotter, Thaddeus G'</span>,</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Huntsman, Jon'</span>, <span class="st">'Perry, Rick'</span>], dtype<span class="op">=</span><span class="bu">object</span>)</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">204</span>]: unique_cands[<span class="dv">2</span>]</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">204</span>]: <span class="st">'Obama, Barack'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>One way to indicate party affiliation is using a dictionary:<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="sourceCode" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>parties <span class="op">=</span> {<span class="st">"Bachmann, Michelle"</span>: <span class="st">"Republican"</span>,</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Cain, Herman"</span>: <span class="st">"Republican"</span>,</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Gingrich, Newt"</span>: <span class="st">"Republican"</span>,</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Huntsman, Jon"</span>: <span class="st">"Republican"</span>,</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Johnson, Gary Earl"</span>: <span class="st">"Republican"</span>,</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>           <span class="st">"McCotter, Thaddeus G"</span>: <span class="st">"Republican"</span>,</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Obama, Barack"</span>: <span class="st">"Democrat"</span>,</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Paul, Ron"</span>: <span class="st">"Republican"</span>,</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Pawlenty, Timothy"</span>: <span class="st">"Republican"</span>,</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Perry, Rick"</span>: <span class="st">"Republican"</span>,</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Roemer, Charles E. 'Buddy' III"</span>: <span class="st">"Republican"</span>,</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Romney, Mitt"</span>: <span class="st">"Republican"</span>,</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>           <span class="st">"Santorum, Rick"</span>: <span class="st">"Republican"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, using this mapping and the <code>map</code> method on Series objects, you can compute an array of political parties from the candidate names:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">206</span>]: fec[<span class="st">"cand_nm"</span>][<span class="dv">123456</span>:<span class="dv">123461</span>]</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">206</span>]: </span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="dv">123456</span>    Obama, Barack</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="dv">123457</span>    Obama, Barack</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="dv">123458</span>    Obama, Barack</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="dv">123459</span>    Obama, Barack</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="dv">123460</span>    Obama, Barack</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>Name: cand_nm, dtype: <span class="bu">object</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">207</span>]: fec[<span class="st">"cand_nm"</span>][<span class="dv">123456</span>:<span class="dv">123461</span>].<span class="bu">map</span>(parties)</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">207</span>]: </span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a><span class="dv">123456</span>    Democrat</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a><span class="dv">123457</span>    Democrat</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a><span class="dv">123458</span>    Democrat</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a><span class="dv">123459</span>    Democrat</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a><span class="dv">123460</span>    Democrat</span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>Name: cand_nm, dtype: <span class="bu">object</span></span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Add it as a column</span></span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">208</span>]: fec[<span class="st">"party"</span>] <span class="op">=</span> fec[<span class="st">"cand_nm"</span>].<span class="bu">map</span>(parties)</span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">209</span>]: fec[<span class="st">"party"</span>].value_counts()</span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">209</span>]: </span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>party</span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a>Democrat      <span class="dv">593746</span></span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>Republican    <span class="dv">407985</span></span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>Name: count, dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A couple of data preparation points. First, this data includes both contributions and refunds (negative contribution amount):</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">210</span>]: (fec[<span class="st">"contb_receipt_amt"</span>] <span class="op">&gt;</span> <span class="dv">0</span>).value_counts()</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">210</span>]: </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>contb_receipt_amt</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="va">True</span>     <span class="dv">991475</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="va">False</span>     <span class="dv">10256</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>Name: count, dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To simplify the analysis, I’ll restrict the dataset to positive contributions:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">211</span>]: fec <span class="op">=</span> fec[fec[<span class="st">"contb_receipt_amt"</span>] <span class="op">&gt;</span> <span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Since Barack Obama and Mitt Romney were the main two candidates, I’ll also prepare a subset that just has contributions to their campaigns:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">212</span>]: fec_mrbo <span class="op">=</span> fec[fec[<span class="st">"cand_nm"</span>].isin([<span class="st">"Obama, Barack"</span>, <span class="st">"Romney, Mitt"</span>])]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="groupby_fec_occupations" class="level3">
<h3 class="anchored" data-anchor-id="groupby_fec_occupations">Donation Statistics by Occupation and Employer</h3>
<p>Donations by occupation is another oft-studied statistic. For example, attorneys tend to donate more money to Democrats, while business executives tend to donate more to Republicans. You have no reason to believe me; you can see for yourself in the data. First, the total number of donations by occupation can be computed with <code>value_counts</code>:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">213</span>]: fec[<span class="st">"contbr_occupation"</span>].value_counts()[:<span class="dv">10</span>]</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">213</span>]: </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>contbr_occupation</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>RETIRED                                   <span class="dv">233990</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>INFORMATION REQUESTED                      <span class="dv">35107</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>ATTORNEY                                   <span class="dv">34286</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>HOMEMAKER                                  <span class="dv">29931</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>PHYSICIAN                                  <span class="dv">23432</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>INFORMATION REQUESTED PER BEST EFFORTS     <span class="dv">21138</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>ENGINEER                                   <span class="dv">14334</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>TEACHER                                    <span class="dv">13990</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>CONSULTANT                                 <span class="dv">13273</span></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>PROFESSOR                                  <span class="dv">12555</span></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>Name: count, dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You will notice by looking at the occupations that many refer to the same basic job type, or there are several variants of the same thing. The following code snippet illustrates a technique for cleaning up a few of them by mapping from one occupation to another; note the “trick” of using <code>dict.get</code> to allow occupations with no mapping to “pass through”:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>occ_mapping <span class="op">=</span> {</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>   <span class="st">"INFORMATION REQUESTED PER BEST EFFORTS"</span> : <span class="st">"NOT PROVIDED"</span>,</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>   <span class="st">"INFORMATION REQUESTED"</span> : <span class="st">"NOT PROVIDED"</span>,</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>   <span class="st">"INFORMATION REQUESTED (BEST EFFORTS)"</span> : <span class="st">"NOT PROVIDED"</span>,</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>   <span class="st">"C.E.O."</span>: <span class="st">"CEO"</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_occ(x):</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If no mapping provided, return x</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> occ_mapping.get(x, x)</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>fec[<span class="st">"contbr_occupation"</span>] <span class="op">=</span> fec[<span class="st">"contbr_occupation"</span>].<span class="bu">map</span>(get_occ)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>I’ll also do the same thing for employers:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>emp_mapping <span class="op">=</span> {</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>   <span class="st">"INFORMATION REQUESTED PER BEST EFFORTS"</span> : <span class="st">"NOT PROVIDED"</span>,</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>   <span class="st">"INFORMATION REQUESTED"</span> : <span class="st">"NOT PROVIDED"</span>,</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>   <span class="st">"SELF"</span> : <span class="st">"SELF-EMPLOYED"</span>,</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>   <span class="st">"SELF EMPLOYED"</span> : <span class="st">"SELF-EMPLOYED"</span>,</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_emp(x):</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If no mapping provided, return x</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> emp_mapping.get(x, x)</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>fec[<span class="st">"contbr_employer"</span>] <span class="op">=</span> fec[<span class="st">"contbr_employer"</span>].<span class="bu">map</span>(get_emp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, you can use <code>pivot_table</code> to aggregate the data by party and occupation, then filter down to the subset that donated at least $2 million overall:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">216</span>]: by_occupation <span class="op">=</span> fec.pivot_table(<span class="st">"contb_receipt_amt"</span>,</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>   .....:                                 index<span class="op">=</span><span class="st">"contbr_occupation"</span>,</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>   .....:                                 columns<span class="op">=</span><span class="st">"party"</span>, aggfunc<span class="op">=</span><span class="st">"sum"</span>)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">217</span>]: over_2mm <span class="op">=</span> by_occupation[by_occupation.<span class="bu">sum</span>(axis<span class="op">=</span><span class="st">"columns"</span>) <span class="op">&gt;</span> <span class="dv">2000000</span>]</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">218</span>]: over_2mm</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">218</span>]: </span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>party                 Democrat   Republican</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>contbr_occupation                          </span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>ATTORNEY           <span class="fl">11141982.97</span>   <span class="fl">7477194.43</span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>CEO                 <span class="fl">2074974.79</span>   <span class="fl">4211040.52</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>CONSULTANT          <span class="fl">2459912.71</span>   <span class="fl">2544725.45</span></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>ENGINEER             <span class="fl">951525.55</span>   <span class="fl">1818373.70</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>EXECUTIVE           <span class="fl">1355161.05</span>   <span class="fl">4138850.09</span></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>HOMEMAKER           <span class="fl">4248875.80</span>  <span class="fl">13634275.78</span></span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>INVESTOR             <span class="fl">884133.00</span>   <span class="fl">2431768.92</span></span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>LAWYER              <span class="fl">3160478.87</span>    <span class="fl">391224.32</span></span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>MANAGER              <span class="fl">762883.22</span>   <span class="fl">1444532.37</span></span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>NOT PROVIDED        <span class="fl">4866973.96</span>  <span class="fl">20565473.01</span></span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>OWNER               <span class="fl">1001567.36</span>   <span class="fl">2408286.92</span></span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>PHYSICIAN           <span class="fl">3735124.94</span>   <span class="fl">3594320.24</span></span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a>PRESIDENT           <span class="fl">1878509.95</span>   <span class="fl">4720923.76</span></span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>PROFESSOR           <span class="fl">2165071.08</span>    <span class="fl">296702.73</span></span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a>REAL ESTATE          <span class="fl">528902.09</span>   <span class="fl">1625902.25</span></span>
<span id="cb101-26"><a href="#cb101-26" aria-hidden="true" tabindex="-1"></a>RETIRED            <span class="fl">25305116.38</span>  <span class="fl">23561244.49</span></span>
<span id="cb101-27"><a href="#cb101-27" aria-hidden="true" tabindex="-1"></a>SELF<span class="op">-</span>EMPLOYED        <span class="fl">672393.40</span>   <span class="fl">1640252.54</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It can be easier to look at this data graphically as a bar plot (<code>"barh"</code> means horizontal bar plot; see <a href="#groupby_fec_occ_party">Total donations by party for top occupations</a>):</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">220</span>]: over_2mm.plot(kind<span class="op">=</span><span class="st">"barh"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-groupby_fec_occ_party" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figs/groupby_fec_occ_party.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;13.12: Total donations by party for top occupations</figcaption>
</figure>
</div>
<p>You might be interested in the top donor occupations or top companies that donated to Obama and Romney. To do this, you can group by candidate name and use a variant of the <code>top</code> method from earlier in the chapter:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_top_amounts(group, key, n<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>    totals <span class="op">=</span> group.groupby(key)[<span class="st">"contb_receipt_amt"</span>].<span class="bu">sum</span>()</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> totals.nlargest(n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then aggregate by occupation and employer:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">222</span>]: grouped <span class="op">=</span> fec_mrbo.groupby(<span class="st">"cand_nm"</span>)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">223</span>]: grouped.<span class="bu">apply</span>(get_top_amounts, <span class="st">"contbr_occupation"</span>, n<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">223</span>]: </span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>cand_nm        contbr_occupation                     </span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>Obama, Barack  RETIRED                                   <span class="fl">25305116.38</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>               ATTORNEY                                  <span class="fl">11141982.97</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>               INFORMATION REQUESTED                      <span class="fl">4866973.96</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>               HOMEMAKER                                  <span class="fl">4248875.80</span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>               PHYSICIAN                                  <span class="fl">3735124.94</span></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>               LAWYER                                     <span class="fl">3160478.87</span></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>               CONSULTANT                                 <span class="fl">2459912.71</span></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>Romney, Mitt   RETIRED                                   <span class="fl">11508473.59</span></span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>               INFORMATION REQUESTED PER BEST EFFORTS    <span class="fl">11396894.84</span></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>               HOMEMAKER                                  <span class="fl">8147446.22</span></span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>               ATTORNEY                                   <span class="fl">5364718.82</span></span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>               PRESIDENT                                  <span class="fl">2491244.89</span></span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>               EXECUTIVE                                  <span class="fl">2300947.03</span></span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>               C.E.O.                                     <span class="fl">1968386.11</span></span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>Name: contb_receipt_amt, dtype: float64</span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">224</span>]: grouped.<span class="bu">apply</span>(get_top_amounts, <span class="st">"contbr_employer"</span>, n<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">224</span>]: </span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a>cand_nm        contbr_employer                       </span>
<span id="cb104-25"><a href="#cb104-25" aria-hidden="true" tabindex="-1"></a>Obama, Barack  RETIRED                                   <span class="fl">22694358.85</span></span>
<span id="cb104-26"><a href="#cb104-26" aria-hidden="true" tabindex="-1"></a>               SELF<span class="op">-</span>EMPLOYED                             <span class="fl">17080985.96</span></span>
<span id="cb104-27"><a href="#cb104-27" aria-hidden="true" tabindex="-1"></a>               NOT EMPLOYED                               <span class="fl">8586308.70</span></span>
<span id="cb104-28"><a href="#cb104-28" aria-hidden="true" tabindex="-1"></a>               INFORMATION REQUESTED                      <span class="fl">5053480.37</span></span>
<span id="cb104-29"><a href="#cb104-29" aria-hidden="true" tabindex="-1"></a>               HOMEMAKER                                  <span class="fl">2605408.54</span></span>
<span id="cb104-30"><a href="#cb104-30" aria-hidden="true" tabindex="-1"></a>               SELF                                       <span class="fl">1076531.20</span></span>
<span id="cb104-31"><a href="#cb104-31" aria-hidden="true" tabindex="-1"></a>               SELF EMPLOYED                               <span class="fl">469290.00</span></span>
<span id="cb104-32"><a href="#cb104-32" aria-hidden="true" tabindex="-1"></a>               STUDENT                                     <span class="fl">318831.45</span></span>
<span id="cb104-33"><a href="#cb104-33" aria-hidden="true" tabindex="-1"></a>               VOLUNTEER                                   <span class="fl">257104.00</span></span>
<span id="cb104-34"><a href="#cb104-34" aria-hidden="true" tabindex="-1"></a>               MICROSOFT                                   <span class="fl">215585.36</span></span>
<span id="cb104-35"><a href="#cb104-35" aria-hidden="true" tabindex="-1"></a>Romney, Mitt   INFORMATION REQUESTED PER BEST EFFORTS    <span class="fl">12059527.24</span></span>
<span id="cb104-36"><a href="#cb104-36" aria-hidden="true" tabindex="-1"></a>               RETIRED                                   <span class="fl">11506225.71</span></span>
<span id="cb104-37"><a href="#cb104-37" aria-hidden="true" tabindex="-1"></a>               HOMEMAKER                                  <span class="fl">8147196.22</span></span>
<span id="cb104-38"><a href="#cb104-38" aria-hidden="true" tabindex="-1"></a>               SELF<span class="op">-</span>EMPLOYED                              <span class="fl">7409860.98</span></span>
<span id="cb104-39"><a href="#cb104-39" aria-hidden="true" tabindex="-1"></a>               STUDENT                                     <span class="fl">496490.94</span></span>
<span id="cb104-40"><a href="#cb104-40" aria-hidden="true" tabindex="-1"></a>               CREDIT SUISSE                               <span class="fl">281150.00</span></span>
<span id="cb104-41"><a href="#cb104-41" aria-hidden="true" tabindex="-1"></a>               MORGAN STANLEY                              <span class="fl">267266.00</span></span>
<span id="cb104-42"><a href="#cb104-42" aria-hidden="true" tabindex="-1"></a>               GOLDMAN SACH <span class="op">&amp;</span> CO.                          <span class="fl">238250.00</span></span>
<span id="cb104-43"><a href="#cb104-43" aria-hidden="true" tabindex="-1"></a>               BARCLAYS CAPITAL                            <span class="fl">162750.00</span></span>
<span id="cb104-44"><a href="#cb104-44" aria-hidden="true" tabindex="-1"></a>               H.I.G. CAPITAL                              <span class="fl">139500.00</span></span>
<span id="cb104-45"><a href="#cb104-45" aria-hidden="true" tabindex="-1"></a>Name: contb_receipt_amt, dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="groupby_fec_bucket" class="level3">
<h3 class="anchored" data-anchor-id="groupby_fec_bucket">Bucketing Donation Amounts</h3>
<p>A useful way to analyze this data is to use the <code>cut</code> function to discretize the contributor amounts into buckets by contribution size:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">225</span>]: bins <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">10000</span>,</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>   .....:                  <span class="dv">100_000</span>, <span class="dv">1_000_000</span>, <span class="dv">10_000_000</span>])</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">226</span>]: labels <span class="op">=</span> pd.cut(fec_mrbo[<span class="st">"contb_receipt_amt"</span>], bins)</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">227</span>]: labels</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">227</span>]: </span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a><span class="dv">411</span>         (<span class="dv">10</span>, <span class="dv">100</span>]</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="dv">412</span>       (<span class="dv">100</span>, <span class="dv">1000</span>]</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a><span class="dv">413</span>       (<span class="dv">100</span>, <span class="dv">1000</span>]</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a><span class="dv">414</span>         (<span class="dv">10</span>, <span class="dv">100</span>]</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a><span class="dv">415</span>         (<span class="dv">10</span>, <span class="dv">100</span>]</span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>             ...     </span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a><span class="dv">701381</span>      (<span class="dv">10</span>, <span class="dv">100</span>]</span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a><span class="dv">701382</span>    (<span class="dv">100</span>, <span class="dv">1000</span>]</span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a><span class="dv">701383</span>        (<span class="dv">1</span>, <span class="dv">10</span>]</span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a><span class="dv">701384</span>      (<span class="dv">10</span>, <span class="dv">100</span>]</span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a><span class="dv">701385</span>    (<span class="dv">100</span>, <span class="dv">1000</span>]</span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>Name: contb_receipt_amt, Length: <span class="dv">694282</span>, dtype: category</span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a>Categories (<span class="dv">8</span>, interval[int64, right]): [(<span class="dv">0</span>, <span class="dv">1</span>] <span class="op">&lt;</span> (<span class="dv">1</span>, <span class="dv">10</span>] <span class="op">&lt;</span> (<span class="dv">10</span>, <span class="dv">100</span>] <span class="op">&lt;</span> (<span class="dv">100</span>, <span class="dv">100</span></span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>] <span class="op">&lt;</span></span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a>                                         (<span class="dv">1000</span>, <span class="dv">10000</span>] <span class="op">&lt;</span> (<span class="dv">10000</span>, <span class="dv">100000</span>] <span class="op">&lt;</span> (<span class="dv">10000</span></span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>, <span class="dv">1000000</span>] <span class="op">&lt;</span></span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a>                                         (<span class="dv">1000000</span>, <span class="dv">10000000</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can then group the data for Obama and Romney by name and bin label to get a histogram by donation size:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">228</span>]: grouped <span class="op">=</span> fec_mrbo.groupby([<span class="st">"cand_nm"</span>, labels])</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">229</span>]: grouped.size().unstack(level<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">229</span>]: </span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>cand_nm              Obama, Barack  Romney, Mitt</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>contb_receipt_amt                               </span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>(<span class="dv">0</span>, <span class="dv">1</span>]                         <span class="dv">493</span>            <span class="dv">77</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span>, <span class="dv">10</span>]                      <span class="dv">40070</span>          <span class="dv">3681</span></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>(<span class="dv">10</span>, <span class="dv">100</span>]                   <span class="dv">372280</span>         <span class="dv">31853</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>(<span class="dv">100</span>, <span class="dv">1000</span>]                 <span class="dv">153991</span>         <span class="dv">43357</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1000</span>, <span class="dv">10000</span>]                <span class="dv">22284</span>         <span class="dv">26186</span></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>(<span class="dv">10000</span>, <span class="dv">100000</span>]                  <span class="dv">2</span>             <span class="dv">1</span></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>(<span class="dv">100000</span>, <span class="dv">1000000</span>]                <span class="dv">3</span>             <span class="dv">0</span></span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1000000</span>, <span class="dv">10000000</span>]              <span class="dv">4</span>             <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This data shows that Obama received a significantly larger number of small donations than Romney. You can also sum the contribution amounts and normalize within buckets to visualize the percentage of total donations of each size by candidate (<a href="#fig_groupby_fec_bucket">Percentage of total donations received by candidates for each donation size</a> shows the resulting plot):</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">231</span>]: bucket_sums <span class="op">=</span> grouped[<span class="st">"contb_receipt_amt"</span>].<span class="bu">sum</span>().unstack(level<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">232</span>]: normed_sums <span class="op">=</span> bucket_sums.div(bucket_sums.<span class="bu">sum</span>(axis<span class="op">=</span><span class="st">"columns"</span>),</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>   .....:                               axis<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">233</span>]: normed_sums</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">233</span>]: </span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>cand_nm              Obama, Barack  Romney, Mitt</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>contb_receipt_amt                               </span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>(<span class="dv">0</span>, <span class="dv">1</span>]                    <span class="fl">0.805182</span>      <span class="fl">0.194818</span></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span>, <span class="dv">10</span>]                   <span class="fl">0.918767</span>      <span class="fl">0.081233</span></span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>(<span class="dv">10</span>, <span class="dv">100</span>]                 <span class="fl">0.910769</span>      <span class="fl">0.089231</span></span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>(<span class="dv">100</span>, <span class="dv">1000</span>]               <span class="fl">0.710176</span>      <span class="fl">0.289824</span></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1000</span>, <span class="dv">10000</span>]             <span class="fl">0.447326</span>      <span class="fl">0.552674</span></span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>(<span class="dv">10000</span>, <span class="dv">100000</span>]           <span class="fl">0.823120</span>      <span class="fl">0.176880</span></span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>(<span class="dv">100000</span>, <span class="dv">1000000</span>]         <span class="fl">1.000000</span>      <span class="fl">0.000000</span></span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1000000</span>, <span class="dv">10000000</span>]       <span class="fl">1.000000</span>      <span class="fl">0.000000</span></span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">234</span>]: normed_sums[:<span class="op">-</span><span class="dv">2</span>].plot(kind<span class="op">=</span><span class="st">"barh"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-fig_groupby_fec_bucket" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="figs/fig_groupby_fec_bucket.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;13.13: Percentage of total donations received by candidates for each donation size</figcaption>
</figure>
</div>
<p>I excluded the two largest bins, as these are not donations by individuals.</p>
<p>This analysis can be refined and improved in many ways. For example, you could aggregate donations by donor name and zip code to adjust for donors who gave many small amounts versus one or more large donations. I encourage you to explore the dataset yourself.</p>
</section>
<section id="groupby_fec_top_states" class="level3">
<h3 class="anchored" data-anchor-id="groupby_fec_top_states">Donation Statistics by State</h3>
<p>We can start by aggregating the data by candidate and state:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">235</span>]: grouped <span class="op">=</span> fec_mrbo.groupby([<span class="st">"cand_nm"</span>, <span class="st">"contbr_st"</span>])</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">236</span>]: totals <span class="op">=</span> grouped[<span class="st">"contb_receipt_amt"</span>].<span class="bu">sum</span>().unstack(level<span class="op">=</span><span class="dv">0</span>).fillna(<span class="dv">0</span>)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">237</span>]: totals <span class="op">=</span> totals[totals.<span class="bu">sum</span>(axis<span class="op">=</span><span class="st">"columns"</span>) <span class="op">&gt;</span> <span class="dv">100000</span>]</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">238</span>]: totals.head(<span class="dv">10</span>)</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">238</span>]: </span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>cand_nm    Obama, Barack  Romney, Mitt</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>contbr_st                             </span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>AK             <span class="fl">281840.15</span>      <span class="fl">86204.24</span></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>AL             <span class="fl">543123.48</span>     <span class="fl">527303.51</span></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>AR             <span class="fl">359247.28</span>     <span class="fl">105556.00</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>AZ            <span class="fl">1506476.98</span>    <span class="fl">1888436.23</span></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>CA           <span class="fl">23824984.24</span>   <span class="fl">11237636.60</span></span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>CO            <span class="fl">2132429.49</span>    <span class="fl">1506714.12</span></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>CT            <span class="fl">2068291.26</span>    <span class="fl">3499475.45</span></span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>DC            <span class="fl">4373538.80</span>    <span class="fl">1025137.50</span></span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>DE             <span class="fl">336669.14</span>      <span class="fl">82712.00</span></span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>FL            <span class="fl">7318178.58</span>    <span class="fl">8338458.81</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you divide each row by the total contribution amount, you get the relative percentage of total donations by state for each candidate:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">239</span>]: percent <span class="op">=</span> totals.div(totals.<span class="bu">sum</span>(axis<span class="op">=</span><span class="st">"columns"</span>), axis<span class="op">=</span><span class="st">"index"</span>)</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">240</span>]: percent.head(<span class="dv">10</span>)</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">240</span>]: </span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>cand_nm    Obama, Barack  Romney, Mitt</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>contbr_st                             </span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>AK              <span class="fl">0.765778</span>      <span class="fl">0.234222</span></span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>AL              <span class="fl">0.507390</span>      <span class="fl">0.492610</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>AR              <span class="fl">0.772902</span>      <span class="fl">0.227098</span></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>AZ              <span class="fl">0.443745</span>      <span class="fl">0.556255</span></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>CA              <span class="fl">0.679498</span>      <span class="fl">0.320502</span></span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>CO              <span class="fl">0.585970</span>      <span class="fl">0.414030</span></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>CT              <span class="fl">0.371476</span>      <span class="fl">0.628524</span></span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>DC              <span class="fl">0.810113</span>      <span class="fl">0.189887</span></span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>DE              <span class="fl">0.802776</span>      <span class="fl">0.197224</span></span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>FL              <span class="fl">0.467417</span>      <span class="fl">0.532583</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="data-analysis-examples-conclusion" class="level2" data-number="13.6">
<h2 data-number="13.6" class="anchored" data-anchor-id="data-analysis-examples-conclusion"><span class="header-section-number">13.6</span> Conclusion</h2>
<p>We've reached the end of this book. I have included some additional content you may find useful in the appendixes.</p>
<p>In the 10 years since the first edition of this book was published, Python has become a popular and widespread language for data analysis. The programming skills you have developed here will stay relevant for a long time into the future. I hope the programming tools and libraries we've explored will serve you well.</p>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>This makes the simplifying assumption that Gary Johnson is a Republican even though he later became the Libertarian party candidate.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

<script async="" defer="" src="https://scripts.simpleanalyticscdn.com/latest.js"></script></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a class='pagination-link' href='/book/modeling'>
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to Modeling Libraries in Python</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a class='pagination-link' href='/book/advanced-numpy'>
        <span class="nav-page-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Advanced NumPy</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2023, Wes McKinney. All Rights Reserved.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/wesmckinn">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<script async="" src="https://media.ethicalads.io/media/client/ethicalads.min.js"></script>



</body></html>