<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Python for Data Analysis, 3E - 7&nbsp; Data Cleaning and Preparation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./data-wrangling.html" rel="next">
<link href="./accessing-data.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Python for Data Analysis, 3E - 7&nbsp; Data Cleaning and Preparation">
<meta property="og:description" content="">
<meta property="og:image" content="images/cover.png">
<meta property="og:site-name" content="Python for Data Analysis, 3E">
<meta name="twitter:title" content="Python for Data Analysis, 3E - 7&nbsp; Data Cleaning and Preparation">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="images/cover.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class='navbar-brand' href='/book/'>
    <span class="navbar-title">Python for Data Analysis, 3E</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class='nav-link' href='https://wesmckinney.com/archives' rel target>
 <span class="menu-text">Wes’s Blog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/wesmckinn" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/wesm/pydata-book" rel="" target="">
 <span class="dropdown-text">Data and Notebooks (GitHub)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://gitee.com/wesmckinn/pydata-book" rel="" target="">
 <span class="dropdown-text">Data and Notebooks (Gitee)</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href='/book/preface'>Chapters</a></li><li class="breadcrumb-item"><a href='/book/data-cleaning'><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Cleaning and Preparation</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/'>
 <span class="menu-text">About the Open Edition</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Chapters</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/preface'>
 <span class="menu-text">Preface</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/preliminaries'>
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Preliminaries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/python-basics'>
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Python Language Basics, IPython, and Jupyter Notebooks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/python-builtin'>
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Built-In Data Structures, Functions, and Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/numpy-basics'>
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">NumPy Basics: Arrays and Vectorized Computation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/pandas-basics'>
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Getting Started with pandas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/accessing-data'>
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Loading, Storage, and File Formats</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link active' href='/book/data-cleaning'>
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Cleaning and Preparation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/data-wrangling'>
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data Wrangling: Join, Combine, and Reshape</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/plotting-and-visualization'>
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Plotting and Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/data-aggregation'>
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Aggregation and Group Operations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/time-series'>
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Time Series</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/modeling'>
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to Modeling Libraries in Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/data-analysis-examples'>
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Data Analysis Examples</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/advanced-numpy'>
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Advanced NumPy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/ipython'>
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">More on the IPython System</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<a href="https://amzn.to/3DyLaJc"><img src="images/cover.png" class="img-fluid"></a>
<div data-ea-publisher="wesmckinneycom" data-ea-type="image">

</div>
</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#pandas_missing_data" id="toc-pandas_missing_data" class="nav-link active" data-scroll-target="#pandas_missing_data"><span class="header-section-number">7.1</span> Handling Missing Data</a>
  <ul class="collapse">
  <li><a href="#pandas_missing_filtering" id="toc-pandas_missing_filtering" class="nav-link" data-scroll-target="#pandas_missing_filtering">Filtering Out Missing Data</a></li>
  <li><a href="#pandas_missing_filling" id="toc-pandas_missing_filling" class="nav-link" data-scroll-target="#pandas_missing_filling">Filling In Missing Data</a></li>
  </ul></li>
  <li><a href="#prep_clean_transform" id="toc-prep_clean_transform" class="nav-link" data-scroll-target="#prep_clean_transform"><span class="header-section-number">7.2</span> Data Transformation</a>
  <ul class="collapse">
  <li><a href="#prep_clean_deduplicate" id="toc-prep_clean_deduplicate" class="nav-link" data-scroll-target="#prep_clean_deduplicate">Removing Duplicates</a></li>
  <li><a href="#prep_mapping_values" id="toc-prep_mapping_values" class="nav-link" data-scroll-target="#prep_mapping_values">Transforming Data Using a Function or Mapping</a></li>
  <li><a href="#prep_replace" id="toc-prep_replace" class="nav-link" data-scroll-target="#prep_replace">Replacing Values</a></li>
  <li><a href="#prep_renaming" id="toc-prep_renaming" class="nav-link" data-scroll-target="#prep_renaming">Renaming Axis Indexes</a></li>
  <li><a href="#prep_discretization" id="toc-prep_discretization" class="nav-link" data-scroll-target="#prep_discretization">Discretization and Binning</a></li>
  <li><a href="#prep_trim_filter" id="toc-prep_trim_filter" class="nav-link" data-scroll-target="#prep_trim_filter">Detecting and Filtering Outliers</a></li>
  <li><a href="#prep_sampling" id="toc-prep_sampling" class="nav-link" data-scroll-target="#prep_sampling">Permutation and Random Sampling</a></li>
  <li><a href="#prep_dummy_vars" id="toc-prep_dummy_vars" class="nav-link" data-scroll-target="#prep_dummy_vars">Computing Indicator/Dummy Variables</a></li>
  </ul></li>
  <li><a href="#pandas-ext-types" id="toc-pandas-ext-types" class="nav-link" data-scroll-target="#pandas-ext-types"><span class="header-section-number">7.3</span> Extension Data Types</a></li>
  <li><a href="#text_string_manip" id="toc-text_string_manip" class="nav-link" data-scroll-target="#text_string_manip"><span class="header-section-number">7.4</span> String Manipulation</a>
  <ul class="collapse">
  <li><a href="#text_string_methods" id="toc-text_string_methods" class="nav-link" data-scroll-target="#text_string_methods">Python Built-In String Object Methods</a></li>
  <li><a href="#text_string_manip_re" id="toc-text_string_manip_re" class="nav-link" data-scroll-target="#text_string_manip_re">Regular Expressions</a></li>
  <li><a href="#text_string_manip_vectorized" id="toc-text_string_manip_vectorized" class="nav-link" data-scroll-target="#text_string_manip_vectorized">String Functions in pandas</a></li>
  </ul></li>
  <li><a href="#pandas-categorical" id="toc-pandas-categorical" class="nav-link" data-scroll-target="#pandas-categorical"><span class="header-section-number">7.5</span> Categorical Data</a>
  <ul class="collapse">
  <li><a href="#pandas-categorical-background" id="toc-pandas-categorical-background" class="nav-link" data-scroll-target="#pandas-categorical-background">Background and Motivation</a></li>
  <li><a href="#pandas-categorical-intro" id="toc-pandas-categorical-intro" class="nav-link" data-scroll-target="#pandas-categorical-intro">Categorical Extension Type in pandas</a></li>
  <li><a href="#pandas-categorical-compute" id="toc-pandas-categorical-compute" class="nav-link" data-scroll-target="#pandas-categorical-compute">Computations with Categoricals</a></li>
  <li><a href="#pandas-categorical-methods" id="toc-pandas-categorical-methods" class="nav-link" data-scroll-target="#pandas-categorical-methods">Categorical Methods</a></li>
  </ul></li>
  <li><a href="#data-preparation-conclusions" id="toc-data-preparation-conclusions" class="nav-link" data-scroll-target="#data-preparation-conclusions"><span class="header-section-number">7.6</span> Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="data-preparation" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Cleaning and Preparation</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>This Open Access web version of <em>Python for Data Analysis 3rd Edition</em> is now available as a companion to the <a href="https://amzn.to/3DyLaJc">print and digital editions</a>. If you encounter any errata, <a href="https://oreilly.com/catalog/0636920519829/errata">please report them here</a>. Please note that some aspects of this site as produced by Quarto will differ from the formatting of the print and eBook versions from O’Reilly.</p>
<p>If you find the online edition of the book useful, please consider <a href="https://amzn.to/3DyLaJc">ordering a paper copy</a> or a <a href="https://www.ebooks.com/en-us/book/210644288/python-for-data-analysis/wes-mckinney/?affId=WES398681F">DRM-free eBook</a> to support the author. The content from this website may not be copied or reproduced. The code examples are MIT licensed and can be found on GitHub or Gitee.</p>
</div>
</div>
</div>
<p>During the course of doing data analysis and modeling, a significant amount of time is spent on data preparation: loading, cleaning, transforming, and rearranging. Such tasks are often reported to take up 80% or more of an analyst's time. Sometimes the way that data is stored in files or databases is not in the right format for a particular task. Many researchers choose to do ad hoc processing of data from one form to another using a general-purpose programming language, like Python, Perl, R, or Java, or Unix text-processing tools like sed or awk. Fortunately, pandas, along with the built-in Python language features, provides you with a high-level, flexible, and fast set of tools to enable you to manipulate data into the right form.</p>
<p>If you identify a type of data manipulation that isn’t anywhere in this book or elsewhere in the pandas library, feel free to share your use case on one of the Python mailing lists or on the pandas GitHub site. Indeed, much of the design and implementation of pandas have been driven by the needs of real-world applications.</p>
<p>In this chapter I discuss tools for missing data, duplicate data, string manipulation, and some other analytical data transformations. In the next chapter, I focus on combining and rearranging datasets in various ways.</p>
<section id="pandas_missing_data" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="pandas_missing_data"><span class="header-section-number">7.1</span> Handling Missing Data</h2>
<p>Missing data occurs commonly in many data analysis applications. One of the goals of pandas is to make working with missing data as painless as possible. For example, all of the descriptive statistics on pandas objects exclude missing data by default.</p>
<p>The way that missing data is represented in pandas objects is somewhat imperfect, but it is sufficient for most real-world use. For data with <code>float64</code> dtype, pandas uses the floating-point value <code>NaN</code> (Not a Number) to represent missing data.</p>
<p>We call this a <em>sentinel value</em>: when present, it indicates a missing (or <em>null</em>) value:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">14</span>]: float_data <span class="op">=</span> pd.Series([<span class="fl">1.2</span>, <span class="op">-</span><span class="fl">3.5</span>, np.nan, <span class="dv">0</span>])</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">15</span>]: float_data</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">15</span>]: </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="fl">1.2</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   <span class="op">-</span><span class="fl">3.5</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    NaN</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="fl">0.0</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>isna</code> method gives us a Boolean Series with <code>True</code> where values are null:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">16</span>]: float_data.isna()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">16</span>]: </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="va">False</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="va">False</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>     <span class="va">True</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="va">False</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">bool</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In pandas, we've adopted a convention used in the R programming language by referring to missing data as NA, which stands for <em>not available</em>. In statistics applications, NA data may either be data that does not exist or that exists but was not observed (through problems with data collection, for example). When cleaning up data for analysis, it is often important to do analysis on the missing data itself to identify data collection problems or potential biases in the data caused by missing data.</p>
<p>The built-in Python <code>None</code> value is also treated as NA:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">17</span>]: string_data <span class="op">=</span> pd.Series([<span class="st">"aardvark"</span>, np.nan, <span class="va">None</span>, <span class="st">"avocado"</span>])</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">18</span>]: string_data</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">18</span>]: </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    aardvark</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>         NaN</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>        <span class="va">None</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     avocado</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">object</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">19</span>]: string_data.isna()</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">19</span>]: </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="va">False</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     <span class="va">True</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>     <span class="va">True</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="va">False</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">bool</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">20</span>]: float_data <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, <span class="va">None</span>], dtype<span class="op">=</span><span class="st">'float64'</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">21</span>]: float_data</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">21</span>]: </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="fl">1.0</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="fl">2.0</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    NaN</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>dtype: float64</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">22</span>]: float_data.isna()</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">22</span>]: </span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="va">False</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="va">False</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>     <span class="va">True</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">bool</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The pandas project has attempted to make working with missing data consistent across data types. Functions like <code>pandas.isna</code> abstract away many of the annoying details. See <a href="#tbl-table_na_method">Table&nbsp;<span>7.1</span></a> for a list of some functions related to missing data handling.</p>
<div id="tbl-table_na_method" class="anchored">
<table class="table">
<caption>Table&nbsp;7.1: NA handling object methods</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Method</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>dropna</code></td>
<td style="text-align: left;">Filter axis labels based on whether values for each label have missing data, with varying thresholds for how much missing data to tolerate.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>fillna</code></td>
<td style="text-align: left;">Fill in missing data with some value or using an interpolation method such as <code>"ffill"</code> or <code>"bfill"</code>.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>isna</code></td>
<td style="text-align: left;">Return Boolean values indicating which values are missing/NA.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>notna</code></td>
<td style="text-align: left;">Negation of <code>isna</code>, returns <code>True</code> for non-NA values and <code>False</code> for NA values.</td>
</tr>
</tbody>
</table>
</div>
<section id="pandas_missing_filtering" class="level3">
<h3 class="anchored" data-anchor-id="pandas_missing_filtering">Filtering Out Missing Data</h3>
<p>There are a few ways to filter out missing data. While you always have the option to do it by hand using <code>pandas.isna</code> and Boolean indexing, <code>dropna</code> can be helpful. On a Series, it returns the Series with only the nonnull data and index values:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">23</span>]: data <span class="op">=</span> pd.Series([<span class="dv">1</span>, np.nan, <span class="fl">3.5</span>, np.nan, <span class="dv">7</span>])</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">24</span>]: data.dropna()</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">24</span>]: </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="fl">1.0</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="fl">3.5</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="fl">7.0</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This is the same thing as doing:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">25</span>]: data[data.notna()]</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">25</span>]: </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="fl">1.0</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="fl">3.5</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="fl">7.0</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With DataFrame objects, there are different ways to remove missing data. You may want to drop rows or columns that are all NA, or only those rows or columns containing any NAs at all. <code>dropna</code> by default drops any row containing a missing value:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">26</span>]: data <span class="op">=</span> pd.DataFrame([[<span class="fl">1.</span>, <span class="fl">6.5</span>, <span class="fl">3.</span>], [<span class="fl">1.</span>, np.nan, np.nan],</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>   ....:                      [np.nan, np.nan, np.nan], [np.nan, <span class="fl">6.5</span>, <span class="fl">3.</span>]])</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">27</span>]: data</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">27</span>]: </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>    <span class="dv">1</span>    <span class="dv">2</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="fl">1.0</span>  <span class="fl">6.5</span>  <span class="fl">3.0</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">1.0</span>  NaN  NaN</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  NaN  NaN  NaN</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  NaN  <span class="fl">6.5</span>  <span class="fl">3.0</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">28</span>]: data.dropna()</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">28</span>]: </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>    <span class="dv">1</span>    <span class="dv">2</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="fl">1.0</span>  <span class="fl">6.5</span>  <span class="fl">3.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Passing <code>how="all"</code> will drop only rows that are all NA:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">29</span>]: data.dropna(how<span class="op">=</span><span class="st">"all"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">29</span>]: </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>    <span class="dv">1</span>    <span class="dv">2</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="fl">1.0</span>  <span class="fl">6.5</span>  <span class="fl">3.0</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">1.0</span>  NaN  NaN</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  NaN  <span class="fl">6.5</span>  <span class="fl">3.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Keep in mind that these functions return new objects by default and do not modify the contents of the original object.</p>
<p>To drop columns in the same way, pass <code>axis="columns"</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">30</span>]: data[<span class="dv">4</span>] <span class="op">=</span> np.nan</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">31</span>]: data</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">31</span>]: </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>    <span class="dv">1</span>    <span class="dv">2</span>   <span class="dv">4</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="fl">1.0</span>  <span class="fl">6.5</span>  <span class="fl">3.0</span> NaN</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">1.0</span>  NaN  NaN NaN</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  NaN  NaN  NaN NaN</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  NaN  <span class="fl">6.5</span>  <span class="fl">3.0</span> NaN</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">32</span>]: data.dropna(axis<span class="op">=</span><span class="st">"columns"</span>, how<span class="op">=</span><span class="st">"all"</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">32</span>]: </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>    <span class="dv">1</span>    <span class="dv">2</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="fl">1.0</span>  <span class="fl">6.5</span>  <span class="fl">3.0</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">1.0</span>  NaN  NaN</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  NaN  NaN  NaN</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  NaN  <span class="fl">6.5</span>  <span class="fl">3.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Suppose you want to keep only rows containing at most a certain number of missing observations. You can indicate this with the <code>thresh</code> argument:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">33</span>]: df <span class="op">=</span> pd.DataFrame(np.random.standard_normal((<span class="dv">7</span>, <span class="dv">3</span>)))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">34</span>]: df.iloc[:<span class="dv">4</span>, <span class="dv">1</span>] <span class="op">=</span> np.nan</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">35</span>]: df.iloc[:<span class="dv">2</span>, <span class="dv">2</span>] <span class="op">=</span> np.nan</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">36</span>]: df</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">36</span>]: </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span>         <span class="dv">1</span>         <span class="dv">2</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> <span class="op">-</span><span class="fl">0.204708</span>       NaN       NaN</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="op">-</span><span class="fl">0.555730</span>       NaN       NaN</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">0.092908</span>       NaN  <span class="fl">0.769023</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="fl">1.246435</span>       NaN <span class="op">-</span><span class="fl">1.296221</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="fl">0.274992</span>  <span class="fl">0.228913</span>  <span class="fl">1.352917</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="fl">0.886429</span> <span class="op">-</span><span class="fl">2.001637</span> <span class="op">-</span><span class="fl">0.371843</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  <span class="fl">1.669025</span> <span class="op">-</span><span class="fl">0.438570</span> <span class="op">-</span><span class="fl">0.539741</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">37</span>]: df.dropna()</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">37</span>]: </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span>         <span class="dv">1</span>         <span class="dv">2</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="fl">0.274992</span>  <span class="fl">0.228913</span>  <span class="fl">1.352917</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="fl">0.886429</span> <span class="op">-</span><span class="fl">2.001637</span> <span class="op">-</span><span class="fl">0.371843</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  <span class="fl">1.669025</span> <span class="op">-</span><span class="fl">0.438570</span> <span class="op">-</span><span class="fl">0.539741</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">38</span>]: df.dropna(thresh<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">38</span>]: </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span>         <span class="dv">1</span>         <span class="dv">2</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">0.092908</span>       NaN  <span class="fl">0.769023</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="fl">1.246435</span>       NaN <span class="op">-</span><span class="fl">1.296221</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="fl">0.274992</span>  <span class="fl">0.228913</span>  <span class="fl">1.352917</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="fl">0.886429</span> <span class="op">-</span><span class="fl">2.001637</span> <span class="op">-</span><span class="fl">0.371843</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  <span class="fl">1.669025</span> <span class="op">-</span><span class="fl">0.438570</span> <span class="op">-</span><span class="fl">0.539741</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="pandas_missing_filling" class="level3">
<h3 class="anchored" data-anchor-id="pandas_missing_filling">Filling In Missing Data</h3>
<p>Rather than filtering out missing data (and potentially discarding other data along with it), you may want to fill in the “holes” in any number of ways. For most purposes, the <code>fillna</code> method is the workhorse function to use. Calling <code>fillna</code> with a constant replaces missing values with that value:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">39</span>]: df.fillna(<span class="dv">0</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">39</span>]: </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span>         <span class="dv">1</span>         <span class="dv">2</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> <span class="op">-</span><span class="fl">0.204708</span>  <span class="fl">0.000000</span>  <span class="fl">0.000000</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="op">-</span><span class="fl">0.555730</span>  <span class="fl">0.000000</span>  <span class="fl">0.000000</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">0.092908</span>  <span class="fl">0.000000</span>  <span class="fl">0.769023</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="fl">1.246435</span>  <span class="fl">0.000000</span> <span class="op">-</span><span class="fl">1.296221</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="fl">0.274992</span>  <span class="fl">0.228913</span>  <span class="fl">1.352917</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="fl">0.886429</span> <span class="op">-</span><span class="fl">2.001637</span> <span class="op">-</span><span class="fl">0.371843</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  <span class="fl">1.669025</span> <span class="op">-</span><span class="fl">0.438570</span> <span class="op">-</span><span class="fl">0.539741</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Calling <code>fillna</code> with a dictionary, you can use a different fill value for each column:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">40</span>]: df.fillna({<span class="dv">1</span>: <span class="fl">0.5</span>, <span class="dv">2</span>: <span class="dv">0</span>})</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">40</span>]: </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span>         <span class="dv">1</span>         <span class="dv">2</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> <span class="op">-</span><span class="fl">0.204708</span>  <span class="fl">0.500000</span>  <span class="fl">0.000000</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="op">-</span><span class="fl">0.555730</span>  <span class="fl">0.500000</span>  <span class="fl">0.000000</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">0.092908</span>  <span class="fl">0.500000</span>  <span class="fl">0.769023</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="fl">1.246435</span>  <span class="fl">0.500000</span> <span class="op">-</span><span class="fl">1.296221</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="fl">0.274992</span>  <span class="fl">0.228913</span>  <span class="fl">1.352917</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="fl">0.886429</span> <span class="op">-</span><span class="fl">2.001637</span> <span class="op">-</span><span class="fl">0.371843</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  <span class="fl">1.669025</span> <span class="op">-</span><span class="fl">0.438570</span> <span class="op">-</span><span class="fl">0.539741</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The same interpolation methods available for reindexing (see <a href='/book/pandas-basics#tbl-table_reindex_function'>Table&nbsp;<span>5.3</span></a>) can be used with <code>fillna</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">41</span>]: df <span class="op">=</span> pd.DataFrame(np.random.standard_normal((<span class="dv">6</span>, <span class="dv">3</span>)))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">42</span>]: df.iloc[<span class="dv">2</span>:, <span class="dv">1</span>] <span class="op">=</span> np.nan</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">43</span>]: df.iloc[<span class="dv">4</span>:, <span class="dv">2</span>] <span class="op">=</span> np.nan</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">44</span>]: df</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">44</span>]: </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span>         <span class="dv">1</span>         <span class="dv">2</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="fl">0.476985</span>  <span class="fl">3.248944</span> <span class="op">-</span><span class="fl">1.021228</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="op">-</span><span class="fl">0.577087</span>  <span class="fl">0.124121</span>  <span class="fl">0.302614</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">0.523772</span>       NaN  <span class="fl">1.343810</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="op">-</span><span class="fl">0.713544</span>       NaN <span class="op">-</span><span class="fl">2.370232</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="op">-</span><span class="fl">1.860761</span>       NaN       NaN</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="op">-</span><span class="fl">1.265934</span>       NaN       NaN</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">45</span>]: df.fillna(method<span class="op">=</span><span class="st">"ffill"</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">45</span>]: </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span>         <span class="dv">1</span>         <span class="dv">2</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="fl">0.476985</span>  <span class="fl">3.248944</span> <span class="op">-</span><span class="fl">1.021228</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="op">-</span><span class="fl">0.577087</span>  <span class="fl">0.124121</span>  <span class="fl">0.302614</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">0.523772</span>  <span class="fl">0.124121</span>  <span class="fl">1.343810</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="op">-</span><span class="fl">0.713544</span>  <span class="fl">0.124121</span> <span class="op">-</span><span class="fl">2.370232</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="op">-</span><span class="fl">1.860761</span>  <span class="fl">0.124121</span> <span class="op">-</span><span class="fl">2.370232</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="op">-</span><span class="fl">1.265934</span>  <span class="fl">0.124121</span> <span class="op">-</span><span class="fl">2.370232</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">46</span>]: df.fillna(method<span class="op">=</span><span class="st">"ffill"</span>, limit<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">46</span>]: </span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>          <span class="dv">0</span>         <span class="dv">1</span>         <span class="dv">2</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="fl">0.476985</span>  <span class="fl">3.248944</span> <span class="op">-</span><span class="fl">1.021228</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="op">-</span><span class="fl">0.577087</span>  <span class="fl">0.124121</span>  <span class="fl">0.302614</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">0.523772</span>  <span class="fl">0.124121</span>  <span class="fl">1.343810</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="op">-</span><span class="fl">0.713544</span>  <span class="fl">0.124121</span> <span class="op">-</span><span class="fl">2.370232</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="op">-</span><span class="fl">1.860761</span>       NaN <span class="op">-</span><span class="fl">2.370232</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="op">-</span><span class="fl">1.265934</span>       NaN <span class="op">-</span><span class="fl">2.370232</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With <code>fillna</code> you can do lots of other things such as simple data imputation using the median or mean statistics:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">47</span>]: data <span class="op">=</span> pd.Series([<span class="fl">1.</span>, np.nan, <span class="fl">3.5</span>, np.nan, <span class="dv">7</span>])</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">48</span>]: data.fillna(data.mean())</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">48</span>]: </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="fl">1.000000</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="fl">3.833333</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="fl">3.500000</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="fl">3.833333</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="fl">7.000000</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>See <a href="#tbl-table_fillna_function">Table&nbsp;<span>7.2</span></a> for a reference on <code>fillna</code> function arguments.</p>
<div id="tbl-table_fillna_function" class="anchored">
<table class="table">
<caption>Table&nbsp;7.2: <code>fillna</code> function arguments</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Argument</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>value</code></td>
<td style="text-align: left;">Scalar value or dictionary-like object to use to fill missing values</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>method</code></td>
<td style="text-align: left;">Interpolation method: one of <code>"bfill"</code> (backward fill) or <code>"ffill"</code> (forward fill); default is <code>None</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>axis</code></td>
<td style="text-align: left;">Axis to fill on (<code>"index"</code> or <code>"columns"</code>); default is <code>axis="index"</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>limit</code></td>
<td style="text-align: left;">For forward and backward filling, maximum number of consecutive periods to fill</td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="prep_clean_transform" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="prep_clean_transform"><span class="header-section-number">7.2</span> Data Transformation</h2>
<p>So far in this chapter we’ve been concerned with handling missing data. Filtering, cleaning, and other transformations are another class of important operations.</p>
<section id="prep_clean_deduplicate" class="level3">
<h3 class="anchored" data-anchor-id="prep_clean_deduplicate">Removing Duplicates</h3>
<p>Duplicate rows may be found in a DataFrame for any number of reasons. Here is an example:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">49</span>]: data <span class="op">=</span> pd.DataFrame({<span class="st">"k1"</span>: [<span class="st">"one"</span>, <span class="st">"two"</span>] <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> [<span class="st">"two"</span>],</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>   ....:                      <span class="st">"k2"</span>: [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>]})</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">50</span>]: data</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">50</span>]: </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    k1  k2</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  one   <span class="dv">1</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  two   <span class="dv">1</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  one   <span class="dv">2</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  two   <span class="dv">3</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  one   <span class="dv">3</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  two   <span class="dv">4</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  two   <span class="dv">4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The DataFrame method <code>duplicated</code> returns a Boolean Series indicating whether each row is a duplicate (its column values are exactly equal to those in an earlier row) or not:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">51</span>]: data.duplicated()</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">51</span>]: </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="va">False</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="va">False</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="va">False</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="va">False</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="va">False</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    <span class="va">False</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>     <span class="va">True</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">bool</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Relatedly, <code>drop_duplicates</code> returns a DataFrame with rows where the <code>duplicated</code> array is <code>False</code> filtered out:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">52</span>]: data.drop_duplicates()</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">52</span>]: </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    k1  k2</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  one   <span class="dv">1</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  two   <span class="dv">1</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  one   <span class="dv">2</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  two   <span class="dv">3</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  one   <span class="dv">3</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  two   <span class="dv">4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Both methods by default consider all of the columns; alternatively, you can specify any subset of them to detect duplicates. Suppose we had an additional column of values and wanted to filter duplicates based only on the <code>"k1"</code> column:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">53</span>]: data[<span class="st">"v1"</span>] <span class="op">=</span> <span class="bu">range</span>(<span class="dv">7</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">54</span>]: data</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">54</span>]: </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    k1  k2  v1</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  one   <span class="dv">1</span>   <span class="dv">0</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  two   <span class="dv">1</span>   <span class="dv">1</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  one   <span class="dv">2</span>   <span class="dv">2</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  two   <span class="dv">3</span>   <span class="dv">3</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  one   <span class="dv">3</span>   <span class="dv">4</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  two   <span class="dv">4</span>   <span class="dv">5</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  two   <span class="dv">4</span>   <span class="dv">6</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">55</span>]: data.drop_duplicates(subset<span class="op">=</span>[<span class="st">"k1"</span>])</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">55</span>]: </span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    k1  k2  v1</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  one   <span class="dv">1</span>   <span class="dv">0</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  two   <span class="dv">1</span>   <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>duplicated</code> and <code>drop_duplicates</code> by default keep the first observed value combination. Passing <code>keep="last"</code> will return the last one:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">56</span>]: data.drop_duplicates([<span class="st">"k1"</span>, <span class="st">"k2"</span>], keep<span class="op">=</span><span class="st">"last"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">56</span>]: </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    k1  k2  v1</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  one   <span class="dv">1</span>   <span class="dv">0</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  two   <span class="dv">1</span>   <span class="dv">1</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  one   <span class="dv">2</span>   <span class="dv">2</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  two   <span class="dv">3</span>   <span class="dv">3</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  one   <span class="dv">3</span>   <span class="dv">4</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  two   <span class="dv">4</span>   <span class="dv">6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="prep_mapping_values" class="level3">
<h3 class="anchored" data-anchor-id="prep_mapping_values">Transforming Data Using a Function or Mapping</h3>
<p>For many datasets, you may wish to perform some transformation based on the values in an array, Series, or column in a DataFrame. Consider the following hypothetical data collected about various kinds of meat:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">57</span>]: data <span class="op">=</span> pd.DataFrame({<span class="st">"food"</span>: [<span class="st">"bacon"</span>, <span class="st">"pulled pork"</span>, <span class="st">"bacon"</span>,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>   ....:                               <span class="st">"pastrami"</span>, <span class="st">"corned beef"</span>, <span class="st">"bacon"</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>   ....:                               <span class="st">"pastrami"</span>, <span class="st">"honey ham"</span>, <span class="st">"nova lox"</span>],</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>   ....:                      <span class="st">"ounces"</span>: [<span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">12</span>, <span class="dv">6</span>, <span class="fl">7.5</span>, <span class="dv">8</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">6</span>]})</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">58</span>]: data</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">58</span>]: </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>          food  ounces</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>        bacon     <span class="fl">4.0</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  pulled pork     <span class="fl">3.0</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>        bacon    <span class="fl">12.0</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     pastrami     <span class="fl">6.0</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  corned beef     <span class="fl">7.5</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>        bacon     <span class="fl">8.0</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>     pastrami     <span class="fl">3.0</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>    honey ham     <span class="fl">5.0</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>     nova lox     <span class="fl">6.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Suppose you wanted to add a column indicating the type of animal that each food came from. Let’s write down a mapping of each distinct meat type to the kind of animal:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>meat_to_animal <span class="op">=</span> {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bacon"</span>: <span class="st">"pig"</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pulled pork"</span>: <span class="st">"pig"</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pastrami"</span>: <span class="st">"cow"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"corned beef"</span>: <span class="st">"cow"</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"honey ham"</span>: <span class="st">"pig"</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nova lox"</span>: <span class="st">"salmon"</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>map</code> method on a Series (also discussed in <a href='/book/pandas-basics#pandas_apply'>Ch 5.2.5: Function Application and Mapping</a>) accepts a function or dictionary-like object containing a mapping to do the transformation of values:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">60</span>]: data[<span class="st">"animal"</span>] <span class="op">=</span> data[<span class="st">"food"</span>].<span class="bu">map</span>(meat_to_animal)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">61</span>]: data</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">61</span>]: </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>          food  ounces  animal</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>        bacon     <span class="fl">4.0</span>     pig</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  pulled pork     <span class="fl">3.0</span>     pig</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>        bacon    <span class="fl">12.0</span>     pig</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     pastrami     <span class="fl">6.0</span>     cow</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  corned beef     <span class="fl">7.5</span>     cow</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>        bacon     <span class="fl">8.0</span>     pig</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>     pastrami     <span class="fl">3.0</span>     cow</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>    honey ham     <span class="fl">5.0</span>     pig</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>     nova lox     <span class="fl">6.0</span>  salmon</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We could also have passed a function that does all the work:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">62</span>]: <span class="kw">def</span> get_animal(x):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>   ....:     <span class="cf">return</span> meat_to_animal[x]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">63</span>]: data[<span class="st">"food"</span>].<span class="bu">map</span>(get_animal)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">63</span>]: </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>       pig</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>       pig</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>       pig</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>       cow</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>       cow</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>       pig</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>       cow</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>       pig</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>    salmon</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>Name: food, dtype: <span class="bu">object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Using <code>map</code> is a convenient way to perform element-wise transformations and other data cleaning-related operations.</p>
</section>
<section id="prep_replace" class="level3">
<h3 class="anchored" data-anchor-id="prep_replace">Replacing Values</h3>
<p>Filling in missing data with the <code>fillna</code> method is a special case of more general value replacement. As you've already seen, <code>map</code> can be used to modify a subset of values in an object, but <code>replace</code> provides a simpler and more flexible way to do so. Let’s consider this Series:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">64</span>]: data <span class="op">=</span> pd.Series([<span class="fl">1.</span>, <span class="op">-</span><span class="fl">999.</span>, <span class="fl">2.</span>, <span class="op">-</span><span class="fl">999.</span>, <span class="op">-</span><span class="fl">1000.</span>, <span class="fl">3.</span>])</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">65</span>]: data</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">65</span>]: </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>       <span class="fl">1.0</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="op">-</span><span class="fl">999.0</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>       <span class="fl">2.0</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="op">-</span><span class="fl">999.0</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   <span class="op">-</span><span class="fl">1000.0</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>       <span class="fl">3.0</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>-999</code> values might be sentinel values for missing data. To replace these with NA values that pandas understands, we can use <code>replace</code>, producing a new Series:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">66</span>]: data.replace(<span class="op">-</span><span class="dv">999</span>, np.nan)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">66</span>]: </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>       <span class="fl">1.0</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>       NaN</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>       <span class="fl">2.0</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>       NaN</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   <span class="op">-</span><span class="fl">1000.0</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>       <span class="fl">3.0</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you want to replace multiple values at once, you instead pass a list and then the substitute value:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">67</span>]: data.replace([<span class="op">-</span><span class="dv">999</span>, <span class="op">-</span><span class="dv">1000</span>], np.nan)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">67</span>]: </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="fl">1.0</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    NaN</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="fl">2.0</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    NaN</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    NaN</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    <span class="fl">3.0</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To use a different replacement for each value, pass a list of substitutes:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">68</span>]: data.replace([<span class="op">-</span><span class="dv">999</span>, <span class="op">-</span><span class="dv">1000</span>], [np.nan, <span class="dv">0</span>])</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">68</span>]: </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="fl">1.0</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    NaN</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="fl">2.0</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    NaN</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="fl">0.0</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    <span class="fl">3.0</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The argument passed can also be a dictionary:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">69</span>]: data.replace({<span class="op">-</span><span class="dv">999</span>: np.nan, <span class="op">-</span><span class="dv">1000</span>: <span class="dv">0</span>})</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">69</span>]: </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="fl">1.0</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    NaN</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="fl">2.0</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    NaN</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="fl">0.0</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    <span class="fl">3.0</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>data.replace</code> method is distinct from <code>data.str.replace</code>, which performs element-wise string substitution. We look at these string methods on Series later in the chapter.</p>
</div>
</div>
</section>
<section id="prep_renaming" class="level3">
<h3 class="anchored" data-anchor-id="prep_renaming">Renaming Axis Indexes</h3>
<p>Like values in a Series, axis labels can be similarly transformed by a function or mapping of some form to produce new, differently labeled objects. You can also modify the axes in place without creating a new data structure. Here’s a simple example:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">70</span>]: data <span class="op">=</span> pd.DataFrame(np.arange(<span class="dv">12</span>).reshape((<span class="dv">3</span>, <span class="dv">4</span>)),</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>   ....:                     index<span class="op">=</span>[<span class="st">"Ohio"</span>, <span class="st">"Colorado"</span>, <span class="st">"New York"</span>],</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>   ....:                     columns<span class="op">=</span>[<span class="st">"one"</span>, <span class="st">"two"</span>, <span class="st">"three"</span>, <span class="st">"four"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Like a Series, the axis indexes have a <code>map</code> method:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">71</span>]: <span class="kw">def</span> transform(x):</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>   ....:     <span class="cf">return</span> x[:<span class="dv">4</span>].upper()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">72</span>]: data.index.<span class="bu">map</span>(transform)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">72</span>]: Index([<span class="st">'OHIO'</span>, <span class="st">'COLO'</span>, <span class="st">'NEW '</span>], dtype<span class="op">=</span><span class="st">'object'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can assign to the <code>index</code> attribute, modifying the DataFrame in place:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">73</span>]: data.index <span class="op">=</span> data.index.<span class="bu">map</span>(transform)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">74</span>]: data</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">74</span>]: </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>      one  two  three  four</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>OHIO    <span class="dv">0</span>    <span class="dv">1</span>      <span class="dv">2</span>     <span class="dv">3</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>COLO    <span class="dv">4</span>    <span class="dv">5</span>      <span class="dv">6</span>     <span class="dv">7</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>NEW     <span class="dv">8</span>    <span class="dv">9</span>     <span class="dv">10</span>    <span class="dv">11</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you want to create a transformed version of a dataset without modifying the original, a useful method is <code>rename</code>:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">75</span>]: data.rename(index<span class="op">=</span><span class="bu">str</span>.title, columns<span class="op">=</span><span class="bu">str</span>.upper)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">75</span>]: </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>      ONE  TWO  THREE  FOUR</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>Ohio    <span class="dv">0</span>    <span class="dv">1</span>      <span class="dv">2</span>     <span class="dv">3</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>Colo    <span class="dv">4</span>    <span class="dv">5</span>      <span class="dv">6</span>     <span class="dv">7</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>New     <span class="dv">8</span>    <span class="dv">9</span>     <span class="dv">10</span>    <span class="dv">11</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notably, <code>rename</code> can be used in conjunction with a dictionary-like object, providing new values for a subset of the axis labels:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">76</span>]: data.rename(index<span class="op">=</span>{<span class="st">"OHIO"</span>: <span class="st">"INDIANA"</span>},</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>   ....:             columns<span class="op">=</span>{<span class="st">"three"</span>: <span class="st">"peekaboo"</span>})</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">76</span>]: </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>         one  two  peekaboo  four</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>INDIANA    <span class="dv">0</span>    <span class="dv">1</span>         <span class="dv">2</span>     <span class="dv">3</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>COLO       <span class="dv">4</span>    <span class="dv">5</span>         <span class="dv">6</span>     <span class="dv">7</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>NEW        <span class="dv">8</span>    <span class="dv">9</span>        <span class="dv">10</span>    <span class="dv">11</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>rename</code> saves you from the chore of copying the DataFrame manually and assigning new values to its <code>index</code> and <code>columns</code> attributes.</p>
</section>
<section id="prep_discretization" class="level3">
<h3 class="anchored" data-anchor-id="prep_discretization">Discretization and Binning</h3>
<p>Continuous data is often discretized or otherwise separated into “bins” for analysis. Suppose you have data about a group of people in a study, and you want to group them into discrete age buckets:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">77</span>]: ages <span class="op">=</span> [<span class="dv">20</span>, <span class="dv">22</span>, <span class="dv">25</span>, <span class="dv">27</span>, <span class="dv">21</span>, <span class="dv">23</span>, <span class="dv">37</span>, <span class="dv">31</span>, <span class="dv">61</span>, <span class="dv">45</span>, <span class="dv">41</span>, <span class="dv">32</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s divide these into bins of 18 to 25, 26 to 35, 36 to 60, and finally 61 and older. To do so, you have to use <code>pandas.cut</code>:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">78</span>]: bins <span class="op">=</span> [<span class="dv">18</span>, <span class="dv">25</span>, <span class="dv">35</span>, <span class="dv">60</span>, <span class="dv">100</span>]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">79</span>]: age_categories <span class="op">=</span> pd.cut(ages, bins)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">80</span>]: age_categories</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">80</span>]: </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>[(<span class="dv">18</span>, <span class="dv">25</span>], (<span class="dv">18</span>, <span class="dv">25</span>], (<span class="dv">18</span>, <span class="dv">25</span>], (<span class="dv">25</span>, <span class="dv">35</span>], (<span class="dv">18</span>, <span class="dv">25</span>], ..., (<span class="dv">25</span>, <span class="dv">35</span>], (<span class="dv">60</span>, <span class="dv">100</span>], (<span class="dv">35</span>,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a> <span class="dv">60</span>], (<span class="dv">35</span>, <span class="dv">60</span>], (<span class="dv">25</span>, <span class="dv">35</span>]]</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>Length: <span class="dv">12</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>Categories (<span class="dv">4</span>, interval[int64, right]): [(<span class="dv">18</span>, <span class="dv">25</span>] <span class="op">&lt;</span> (<span class="dv">25</span>, <span class="dv">35</span>] <span class="op">&lt;</span> (<span class="dv">35</span>, <span class="dv">60</span>] <span class="op">&lt;</span> (<span class="dv">60</span>, <span class="dv">10</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The object pandas returns is a special Categorical object. The output you see describes the bins computed by <code>pandas.cut</code>. Each bin is identified by a special (unique to pandas) interval value type containing the lower and upper limit of each bin:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">81</span>]: age_categories.codes</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">81</span>]: array([<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>], dtype<span class="op">=</span>int8)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">82</span>]: age_categories.categories</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">82</span>]: IntervalIndex([(<span class="dv">18</span>, <span class="dv">25</span>], (<span class="dv">25</span>, <span class="dv">35</span>], (<span class="dv">35</span>, <span class="dv">60</span>], (<span class="dv">60</span>, <span class="dv">100</span>]], dtype<span class="op">=</span><span class="st">'interval</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="er">[int64, right]')</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="er">In [83]: age_categories.categories[0]</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="er">Out[83]: Interval(18, 25, closed='right')</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="er">In [84]: pd.value_counts(age_categories)</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="er">Out[84]: </span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="er">(18, 25]     5</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="er">(25, 35]     3</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="er">(35, 60]     3</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="er">(60, 100]    1</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="er">Name: count, dtype: int64</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that <code>pd.value_counts(categories)</code> are the bin counts for the result of <code>pandas.cut</code>.</p>
<p>In the string representation of an interval, a parenthesis means that the side is <em>open</em> (exclusive), while the square bracket means it is <em>closed</em> (inclusive). You can change which side is closed by passing <code>right=False</code>:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">85</span>]: pd.cut(ages, bins, right<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">85</span>]: </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>[[<span class="dv">18</span>, <span class="dv">25</span>), [<span class="dv">18</span>, <span class="dv">25</span>), [<span class="dv">25</span>, <span class="dv">35</span>), [<span class="dv">25</span>, <span class="dv">35</span>), [<span class="dv">18</span>, <span class="dv">25</span>), ..., [<span class="dv">25</span>, <span class="dv">35</span>), [<span class="dv">60</span>, <span class="dv">100</span>), [<span class="dv">35</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a> <span class="dv">60</span>), [<span class="dv">35</span>, <span class="dv">60</span>), [<span class="dv">25</span>, <span class="dv">35</span>)]</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>Length: <span class="dv">12</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>Categories (<span class="dv">4</span>, interval[int64, left]): [[<span class="dv">18</span>, <span class="dv">25</span>) <span class="op">&lt;</span> [<span class="dv">25</span>, <span class="dv">35</span>) <span class="op">&lt;</span> [<span class="dv">35</span>, <span class="dv">60</span>) <span class="op">&lt;</span> [<span class="dv">60</span>, <span class="dv">100</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can override the default interval-based bin labeling by passing a list or array to the <code>labels</code> option:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">86</span>]: group_names <span class="op">=</span> [<span class="st">"Youth"</span>, <span class="st">"YoungAdult"</span>, <span class="st">"MiddleAged"</span>, <span class="st">"Senior"</span>]</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">87</span>]: pd.cut(ages, bins, labels<span class="op">=</span>group_names)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">87</span>]: </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>[<span class="st">'Youth'</span>, <span class="st">'Youth'</span>, <span class="st">'Youth'</span>, <span class="st">'YoungAdult'</span>, <span class="st">'Youth'</span>, ..., <span class="st">'YoungAdult'</span>, <span class="st">'Senior'</span>, <span class="st">'</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="er">MiddleAged', 'MiddleAged', 'YoungAdult']</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>Length: <span class="dv">12</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>Categories (<span class="dv">4</span>, <span class="bu">object</span>): [<span class="st">'Youth'</span> <span class="op">&lt;</span> <span class="st">'YoungAdult'</span> <span class="op">&lt;</span> <span class="st">'MiddleAged'</span> <span class="op">&lt;</span> <span class="st">'Senior'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you pass an integer number of bins to <code>pandas.cut</code> instead of explicit bin edges, it will compute equal-length bins based on the minimum and maximum values in the data. Consider the case of some uniformly distributed data chopped into fourths:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">88</span>]: data <span class="op">=</span> np.random.uniform(size<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">89</span>]: pd.cut(data, <span class="dv">4</span>, precision<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">89</span>]: </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>[(<span class="fl">0.34</span>, <span class="fl">0.55</span>], (<span class="fl">0.34</span>, <span class="fl">0.55</span>], (<span class="fl">0.76</span>, <span class="fl">0.97</span>], (<span class="fl">0.76</span>, <span class="fl">0.97</span>], (<span class="fl">0.34</span>, <span class="fl">0.55</span>], ..., (<span class="fl">0.34</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>, <span class="fl">0.55</span>], (<span class="fl">0.34</span>, <span class="fl">0.55</span>], (<span class="fl">0.55</span>, <span class="fl">0.76</span>], (<span class="fl">0.34</span>, <span class="fl">0.55</span>], (<span class="fl">0.12</span>, <span class="fl">0.34</span>]]</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>Length: <span class="dv">20</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>Categories (<span class="dv">4</span>, interval[float64, right]): [(<span class="fl">0.12</span>, <span class="fl">0.34</span>] <span class="op">&lt;</span> (<span class="fl">0.34</span>, <span class="fl">0.55</span>] <span class="op">&lt;</span> (<span class="fl">0.55</span>, <span class="dv">0</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="fl">.76</span>] <span class="op">&lt;</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>                                           (<span class="fl">0.76</span>, <span class="fl">0.97</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>precision=2</code> option limits the decimal precision to two digits.</p>
<p>A closely related function, <code>pandas.qcut</code>, bins the data based on sample quantiles. Depending on the distribution of the data, using <code>pandas.cut</code> will not usually result in each bin having the same number of data points. Since <code>pandas.qcut</code> uses sample quantiles instead, you will obtain roughly equally sized bins:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">90</span>]: data <span class="op">=</span> np.random.standard_normal(<span class="dv">1000</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">91</span>]: quartiles <span class="op">=</span> pd.qcut(data, <span class="dv">4</span>, precision<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">92</span>]: quartiles</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">92</span>]: </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>[(<span class="op">-</span><span class="fl">0.026</span>, <span class="fl">0.62</span>], (<span class="fl">0.62</span>, <span class="fl">3.93</span>], (<span class="op">-</span><span class="fl">0.68</span>, <span class="op">-</span><span class="fl">0.026</span>], (<span class="fl">0.62</span>, <span class="fl">3.93</span>], (<span class="op">-</span><span class="fl">0.026</span>, <span class="fl">0.62</span>], ...</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>, (<span class="op">-</span><span class="fl">0.68</span>, <span class="op">-</span><span class="fl">0.026</span>], (<span class="op">-</span><span class="fl">0.68</span>, <span class="op">-</span><span class="fl">0.026</span>], (<span class="op">-</span><span class="fl">2.96</span>, <span class="op">-</span><span class="fl">0.68</span>], (<span class="fl">0.62</span>, <span class="fl">3.93</span>], (<span class="op">-</span><span class="fl">0.68</span>, <span class="op">-</span><span class="fl">0.026</span>]</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>Length: <span class="dv">1000</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>Categories (<span class="dv">4</span>, interval[float64, right]): [(<span class="op">-</span><span class="fl">2.96</span>, <span class="op">-</span><span class="fl">0.68</span>] <span class="op">&lt;</span> (<span class="op">-</span><span class="fl">0.68</span>, <span class="op">-</span><span class="fl">0.026</span>] <span class="op">&lt;</span> (<span class="op">-</span><span class="dv">0</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="fl">.026</span>, <span class="fl">0.62</span>] <span class="op">&lt;</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>                                           (<span class="fl">0.62</span>, <span class="fl">3.93</span>]]</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">93</span>]: pd.value_counts(quartiles)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">93</span>]: </span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span><span class="fl">2.96</span>, <span class="op">-</span><span class="fl">0.68</span>]     <span class="dv">250</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span><span class="fl">0.68</span>, <span class="op">-</span><span class="fl">0.026</span>]    <span class="dv">250</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span><span class="fl">0.026</span>, <span class="fl">0.62</span>]     <span class="dv">250</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>(<span class="fl">0.62</span>, <span class="fl">3.93</span>]       <span class="dv">250</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>Name: count, dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Similar to <code>pandas.cut</code>, you can pass your own quantiles (numbers between 0 and 1, inclusive):</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">94</span>]: pd.qcut(data, [<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="fl">1.</span>]).value_counts()</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">94</span>]: </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span><span class="fl">2.9499999999999997</span>, <span class="op">-</span><span class="fl">1.187</span>]    <span class="dv">100</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span><span class="fl">1.187</span>, <span class="op">-</span><span class="fl">0.0265</span>]                <span class="dv">400</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span><span class="fl">0.0265</span>, <span class="fl">1.286</span>]                 <span class="dv">400</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>(<span class="fl">1.286</span>, <span class="fl">3.928</span>]                   <span class="dv">100</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>Name: count, dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We’ll return to <code>pandas.cut</code> and <code>pandas.qcut</code> later in the chapter during our discussion of aggregation and group operations, as these discretization functions are especially useful for quantile and group analysis.</p>
</section>
<section id="prep_trim_filter" class="level3">
<h3 class="anchored" data-anchor-id="prep_trim_filter">Detecting and Filtering Outliers</h3>
<p>Filtering or transforming outliers is largely a matter of applying array operations. Consider a DataFrame with some normally distributed data:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">95</span>]: data <span class="op">=</span> pd.DataFrame(np.random.standard_normal((<span class="dv">1000</span>, <span class="dv">4</span>)))</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">96</span>]: data.describe()</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">96</span>]: </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                 <span class="dv">0</span>            <span class="dv">1</span>            <span class="dv">2</span>            <span class="dv">3</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>count  <span class="fl">1000.000000</span>  <span class="fl">1000.000000</span>  <span class="fl">1000.000000</span>  <span class="fl">1000.000000</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>mean      <span class="fl">0.049091</span>     <span class="fl">0.026112</span>    <span class="op">-</span><span class="fl">0.002544</span>    <span class="op">-</span><span class="fl">0.051827</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>std       <span class="fl">0.996947</span>     <span class="fl">1.007458</span>     <span class="fl">0.995232</span>     <span class="fl">0.998311</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="bu">min</span>      <span class="op">-</span><span class="fl">3.645860</span>    <span class="op">-</span><span class="fl">3.184377</span>    <span class="op">-</span><span class="fl">3.745356</span>    <span class="op">-</span><span class="fl">3.428254</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="dv">25</span><span class="op">%</span>      <span class="op">-</span><span class="fl">0.599807</span>    <span class="op">-</span><span class="fl">0.612162</span>    <span class="op">-</span><span class="fl">0.687373</span>    <span class="op">-</span><span class="fl">0.747478</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="dv">50</span><span class="op">%</span>       <span class="fl">0.047101</span>    <span class="op">-</span><span class="fl">0.013609</span>    <span class="op">-</span><span class="fl">0.022158</span>    <span class="op">-</span><span class="fl">0.088274</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="dv">75</span><span class="op">%</span>       <span class="fl">0.756646</span>     <span class="fl">0.695298</span>     <span class="fl">0.699046</span>     <span class="fl">0.623331</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="bu">max</span>       <span class="fl">2.653656</span>     <span class="fl">3.525865</span>     <span class="fl">2.735527</span>     <span class="fl">3.366626</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Suppose you wanted to find values in one of the columns exceeding 3 in absolute value:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">97</span>]: col <span class="op">=</span> data[<span class="dv">2</span>]</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">98</span>]: col[col.<span class="bu">abs</span>() <span class="op">&gt;</span> <span class="dv">3</span>]</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">98</span>]: </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="dv">41</span>    <span class="op">-</span><span class="fl">3.399312</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="dv">136</span>   <span class="op">-</span><span class="fl">3.745356</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>Name: <span class="dv">2</span>, dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To select all rows having a value exceeding 3 or –3, you can use the <code>any</code> method on a Boolean DataFrame:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">99</span>]: data[(data.<span class="bu">abs</span>() <span class="op">&gt;</span> <span class="dv">3</span>).<span class="bu">any</span>(axis<span class="op">=</span><span class="st">"columns"</span>)]</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">99</span>]: </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>            <span class="dv">0</span>         <span class="dv">1</span>         <span class="dv">2</span>         <span class="dv">3</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="dv">41</span>   <span class="fl">0.457246</span> <span class="op">-</span><span class="fl">0.025907</span> <span class="op">-</span><span class="fl">3.399312</span> <span class="op">-</span><span class="fl">0.974657</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="dv">60</span>   <span class="fl">1.951312</span>  <span class="fl">3.260383</span>  <span class="fl">0.963301</span>  <span class="fl">1.201206</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="dv">136</span>  <span class="fl">0.508391</span> <span class="op">-</span><span class="fl">0.196713</span> <span class="op">-</span><span class="fl">3.745356</span> <span class="op">-</span><span class="fl">1.520113</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="dv">235</span> <span class="op">-</span><span class="fl">0.242459</span> <span class="op">-</span><span class="fl">3.056990</span>  <span class="fl">1.918403</span> <span class="op">-</span><span class="fl">0.578828</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="dv">258</span>  <span class="fl">0.682841</span>  <span class="fl">0.326045</span>  <span class="fl">0.425384</span> <span class="op">-</span><span class="fl">3.428254</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="dv">322</span>  <span class="fl">1.179227</span> <span class="op">-</span><span class="fl">3.184377</span>  <span class="fl">1.369891</span> <span class="op">-</span><span class="fl">1.074833</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="dv">544</span> <span class="op">-</span><span class="fl">3.548824</span>  <span class="fl">1.553205</span> <span class="op">-</span><span class="fl">2.186301</span>  <span class="fl">1.277104</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="dv">635</span> <span class="op">-</span><span class="fl">0.578093</span>  <span class="fl">0.193299</span>  <span class="fl">1.397822</span>  <span class="fl">3.366626</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="dv">782</span> <span class="op">-</span><span class="fl">0.207434</span>  <span class="fl">3.525865</span>  <span class="fl">0.283070</span>  <span class="fl">0.544635</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="dv">803</span> <span class="op">-</span><span class="fl">3.645860</span>  <span class="fl">0.255475</span> <span class="op">-</span><span class="fl">0.549574</span> <span class="op">-</span><span class="fl">1.907459</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The parentheses around <code>data.abs() &gt; 3</code> are necessary in order to call the <code>any</code> method on the result of the comparison operation.</p>
<p>Values can be set based on these criteria. Here is code to cap values outside the interval –3 to 3:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">100</span>]: data[data.<span class="bu">abs</span>() <span class="op">&gt;</span> <span class="dv">3</span>] <span class="op">=</span> np.sign(data) <span class="op">*</span> <span class="dv">3</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">101</span>]: data.describe()</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">101</span>]: </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>                 <span class="dv">0</span>            <span class="dv">1</span>            <span class="dv">2</span>            <span class="dv">3</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>count  <span class="fl">1000.000000</span>  <span class="fl">1000.000000</span>  <span class="fl">1000.000000</span>  <span class="fl">1000.000000</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>mean      <span class="fl">0.050286</span>     <span class="fl">0.025567</span>    <span class="op">-</span><span class="fl">0.001399</span>    <span class="op">-</span><span class="fl">0.051765</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>std       <span class="fl">0.992920</span>     <span class="fl">1.004214</span>     <span class="fl">0.991414</span>     <span class="fl">0.995761</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="bu">min</span>      <span class="op">-</span><span class="fl">3.000000</span>    <span class="op">-</span><span class="fl">3.000000</span>    <span class="op">-</span><span class="fl">3.000000</span>    <span class="op">-</span><span class="fl">3.000000</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="dv">25</span><span class="op">%</span>      <span class="op">-</span><span class="fl">0.599807</span>    <span class="op">-</span><span class="fl">0.612162</span>    <span class="op">-</span><span class="fl">0.687373</span>    <span class="op">-</span><span class="fl">0.747478</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="dv">50</span><span class="op">%</span>       <span class="fl">0.047101</span>    <span class="op">-</span><span class="fl">0.013609</span>    <span class="op">-</span><span class="fl">0.022158</span>    <span class="op">-</span><span class="fl">0.088274</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="dv">75</span><span class="op">%</span>       <span class="fl">0.756646</span>     <span class="fl">0.695298</span>     <span class="fl">0.699046</span>     <span class="fl">0.623331</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="bu">max</span>       <span class="fl">2.653656</span>     <span class="fl">3.000000</span>     <span class="fl">2.735527</span>     <span class="fl">3.000000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The statement <code>np.sign(data)</code> produces 1 and –1 values based on whether the values in <code>data</code> are positive or negative:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">102</span>]: np.sign(data).head()</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">102</span>]: </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>     <span class="dv">0</span>    <span class="dv">1</span>    <span class="dv">2</span>    <span class="dv">3</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> <span class="op">-</span><span class="fl">1.0</span>  <span class="fl">1.0</span> <span class="op">-</span><span class="fl">1.0</span>  <span class="fl">1.0</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">1.0</span> <span class="op">-</span><span class="fl">1.0</span>  <span class="fl">1.0</span> <span class="op">-</span><span class="fl">1.0</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">1.0</span>  <span class="fl">1.0</span>  <span class="fl">1.0</span> <span class="op">-</span><span class="fl">1.0</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="op">-</span><span class="fl">1.0</span> <span class="op">-</span><span class="fl">1.0</span>  <span class="fl">1.0</span> <span class="op">-</span><span class="fl">1.0</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="op">-</span><span class="fl">1.0</span>  <span class="fl">1.0</span> <span class="op">-</span><span class="fl">1.0</span> <span class="op">-</span><span class="fl">1.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="prep_sampling" class="level3">
<h3 class="anchored" data-anchor-id="prep_sampling">Permutation and Random Sampling</h3>
<p>Permuting (randomly reordering) a Series or the rows in a DataFrame is possible using the <code>numpy.random.permutation</code> function. Calling <code>permutation</code> with the length of the axis you want to permute produces an array of integers indicating the new ordering:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">103</span>]: df <span class="op">=</span> pd.DataFrame(np.arange(<span class="dv">5</span> <span class="op">*</span> <span class="dv">7</span>).reshape((<span class="dv">5</span>, <span class="dv">7</span>)))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">104</span>]: df</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">104</span>]: </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>   <span class="dv">1</span>   <span class="dv">2</span>   <span class="dv">3</span>   <span class="dv">4</span>   <span class="dv">5</span>   <span class="dv">6</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   <span class="dv">0</span>   <span class="dv">1</span>   <span class="dv">2</span>   <span class="dv">3</span>   <span class="dv">4</span>   <span class="dv">5</span>   <span class="dv">6</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   <span class="dv">7</span>   <span class="dv">8</span>   <span class="dv">9</span>  <span class="dv">10</span>  <span class="dv">11</span>  <span class="dv">12</span>  <span class="dv">13</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="dv">14</span>  <span class="dv">15</span>  <span class="dv">16</span>  <span class="dv">17</span>  <span class="dv">18</span>  <span class="dv">19</span>  <span class="dv">20</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="dv">21</span>  <span class="dv">22</span>  <span class="dv">23</span>  <span class="dv">24</span>  <span class="dv">25</span>  <span class="dv">26</span>  <span class="dv">27</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="dv">28</span>  <span class="dv">29</span>  <span class="dv">30</span>  <span class="dv">31</span>  <span class="dv">32</span>  <span class="dv">33</span>  <span class="dv">34</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">105</span>]: sampler <span class="op">=</span> np.random.permutation(<span class="dv">5</span>)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">106</span>]: sampler</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">106</span>]: array([<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>That array can then be used in <code>iloc</code>-based indexing or the equivalent <code>take</code> function:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">107</span>]: df.take(sampler)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">107</span>]: </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>   <span class="dv">1</span>   <span class="dv">2</span>   <span class="dv">3</span>   <span class="dv">4</span>   <span class="dv">5</span>   <span class="dv">6</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="dv">21</span>  <span class="dv">22</span>  <span class="dv">23</span>  <span class="dv">24</span>  <span class="dv">25</span>  <span class="dv">26</span>  <span class="dv">27</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   <span class="dv">7</span>   <span class="dv">8</span>   <span class="dv">9</span>  <span class="dv">10</span>  <span class="dv">11</span>  <span class="dv">12</span>  <span class="dv">13</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="dv">28</span>  <span class="dv">29</span>  <span class="dv">30</span>  <span class="dv">31</span>  <span class="dv">32</span>  <span class="dv">33</span>  <span class="dv">34</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="dv">14</span>  <span class="dv">15</span>  <span class="dv">16</span>  <span class="dv">17</span>  <span class="dv">18</span>  <span class="dv">19</span>  <span class="dv">20</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   <span class="dv">0</span>   <span class="dv">1</span>   <span class="dv">2</span>   <span class="dv">3</span>   <span class="dv">4</span>   <span class="dv">5</span>   <span class="dv">6</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">108</span>]: df.iloc[sampler]</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">108</span>]: </span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>   <span class="dv">1</span>   <span class="dv">2</span>   <span class="dv">3</span>   <span class="dv">4</span>   <span class="dv">5</span>   <span class="dv">6</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="dv">21</span>  <span class="dv">22</span>  <span class="dv">23</span>  <span class="dv">24</span>  <span class="dv">25</span>  <span class="dv">26</span>  <span class="dv">27</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   <span class="dv">7</span>   <span class="dv">8</span>   <span class="dv">9</span>  <span class="dv">10</span>  <span class="dv">11</span>  <span class="dv">12</span>  <span class="dv">13</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="dv">28</span>  <span class="dv">29</span>  <span class="dv">30</span>  <span class="dv">31</span>  <span class="dv">32</span>  <span class="dv">33</span>  <span class="dv">34</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="dv">14</span>  <span class="dv">15</span>  <span class="dv">16</span>  <span class="dv">17</span>  <span class="dv">18</span>  <span class="dv">19</span>  <span class="dv">20</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   <span class="dv">0</span>   <span class="dv">1</span>   <span class="dv">2</span>   <span class="dv">3</span>   <span class="dv">4</span>   <span class="dv">5</span>   <span class="dv">6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By invoking <code>take</code> with <code>axis="columns"</code>, we could also select a permutation of the columns:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">109</span>]: column_sampler <span class="op">=</span> np.random.permutation(<span class="dv">7</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">110</span>]: column_sampler</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">110</span>]: array([<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">5</span>])</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">111</span>]: df.take(column_sampler, axis<span class="op">=</span><span class="st">"columns"</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">111</span>]: </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">4</span>   <span class="dv">6</span>   <span class="dv">3</span>   <span class="dv">2</span>   <span class="dv">1</span>   <span class="dv">0</span>   <span class="dv">5</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   <span class="dv">4</span>   <span class="dv">6</span>   <span class="dv">3</span>   <span class="dv">2</span>   <span class="dv">1</span>   <span class="dv">0</span>   <span class="dv">5</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">11</span>  <span class="dv">13</span>  <span class="dv">10</span>   <span class="dv">9</span>   <span class="dv">8</span>   <span class="dv">7</span>  <span class="dv">12</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="dv">18</span>  <span class="dv">20</span>  <span class="dv">17</span>  <span class="dv">16</span>  <span class="dv">15</span>  <span class="dv">14</span>  <span class="dv">19</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="dv">25</span>  <span class="dv">27</span>  <span class="dv">24</span>  <span class="dv">23</span>  <span class="dv">22</span>  <span class="dv">21</span>  <span class="dv">26</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="dv">32</span>  <span class="dv">34</span>  <span class="dv">31</span>  <span class="dv">30</span>  <span class="dv">29</span>  <span class="dv">28</span>  <span class="dv">33</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To select a random subset without replacement (the same row cannot appear twice), you can use the <code>sample</code> method on Series and DataFrame:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">112</span>]: df.sample(n<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">112</span>]: </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>   <span class="dv">1</span>   <span class="dv">2</span>   <span class="dv">3</span>   <span class="dv">4</span>   <span class="dv">5</span>   <span class="dv">6</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="dv">14</span>  <span class="dv">15</span>  <span class="dv">16</span>  <span class="dv">17</span>  <span class="dv">18</span>  <span class="dv">19</span>  <span class="dv">20</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="dv">28</span>  <span class="dv">29</span>  <span class="dv">30</span>  <span class="dv">31</span>  <span class="dv">32</span>  <span class="dv">33</span>  <span class="dv">34</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   <span class="dv">0</span>   <span class="dv">1</span>   <span class="dv">2</span>   <span class="dv">3</span>   <span class="dv">4</span>   <span class="dv">5</span>   <span class="dv">6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To generate a sample <em>with</em> replacement (to allow repeat choices), pass <code>replace=True</code> to <code>sample</code>:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">113</span>]: choices <span class="op">=</span> pd.Series([<span class="dv">5</span>, <span class="dv">7</span>, <span class="op">-</span><span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">4</span>])</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">114</span>]: choices.sample(n<span class="op">=</span><span class="dv">10</span>, replace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">114</span>]: </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   <span class="op">-</span><span class="dv">1</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">5</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="dv">6</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="dv">7</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="dv">4</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">5</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="dv">4</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">5</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="dv">4</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="dv">4</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="prep_dummy_vars" class="level3">
<h3 class="anchored" data-anchor-id="prep_dummy_vars">Computing Indicator/Dummy Variables</h3>
<p>Another type of transformation for statistical modeling or machine learning applications is converting a categorical variable into a <em>dummy</em> or <em>indicator</em> matrix. If a column in a DataFrame has <code>k</code> distinct values, you would derive a matrix or DataFrame with <code>k</code> columns containing all 1s and 0s. pandas has a <code>pandas.get_dummies</code> function for doing this, though you could also devise one yourself. Let’s consider an example DataFrame:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">115</span>]: df <span class="op">=</span> pd.DataFrame({<span class="st">"key"</span>: [<span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>],</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>   .....:                    <span class="st">"data1"</span>: <span class="bu">range</span>(<span class="dv">6</span>)})</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">116</span>]: df</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">116</span>]: </span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  key  data1</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   b      <span class="dv">0</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   b      <span class="dv">1</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   a      <span class="dv">2</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   c      <span class="dv">3</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   a      <span class="dv">4</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>   b      <span class="dv">5</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">117</span>]: pd.get_dummies(df[<span class="st">"key"</span>], dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">117</span>]: </span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>     a    b    c</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="fl">0.0</span>  <span class="fl">1.0</span>  <span class="fl">0.0</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">0.0</span>  <span class="fl">1.0</span>  <span class="fl">0.0</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">1.0</span>  <span class="fl">0.0</span>  <span class="fl">0.0</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="fl">0.0</span>  <span class="fl">0.0</span>  <span class="fl">1.0</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="fl">1.0</span>  <span class="fl">0.0</span>  <span class="fl">0.0</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="fl">0.0</span>  <span class="fl">1.0</span>  <span class="fl">0.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here I passed <code>dtype=float</code> to change the output type from boolean (the default in more recent versions of pandas) to floating point.</p>
<p>In some cases, you may want to add a prefix to the columns in the indicator DataFrame, which can then be merged with the other data. <code>pandas.get_dummies</code> has a prefix argument for doing this:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">118</span>]: dummies <span class="op">=</span> pd.get_dummies(df[<span class="st">"key"</span>], prefix<span class="op">=</span><span class="st">"key"</span>, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">119</span>]: df_with_dummy <span class="op">=</span> df[[<span class="st">"data1"</span>]].join(dummies)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">120</span>]: df_with_dummy</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">120</span>]: </span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>   data1  key_a  key_b  key_c</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>      <span class="dv">0</span>    <span class="fl">0.0</span>    <span class="fl">1.0</span>    <span class="fl">0.0</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>      <span class="dv">1</span>    <span class="fl">0.0</span>    <span class="fl">1.0</span>    <span class="fl">0.0</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>      <span class="dv">2</span>    <span class="fl">1.0</span>    <span class="fl">0.0</span>    <span class="fl">0.0</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>      <span class="dv">3</span>    <span class="fl">0.0</span>    <span class="fl">0.0</span>    <span class="fl">1.0</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>      <span class="dv">4</span>    <span class="fl">1.0</span>    <span class="fl">0.0</span>    <span class="fl">0.0</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>      <span class="dv">5</span>    <span class="fl">0.0</span>    <span class="fl">1.0</span>    <span class="fl">0.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>DataFrame.join</code> method will be explained in more detail in the next chapter.</p>
<p>If a row in a DataFrame belongs to multiple categories, we have to use a different approach to create the dummy variables. Let’s look at the MovieLens 1M dataset, which is investigated in more detail in <a href="#data-analysis-examples">Ch 13: Data Analysis Examples</a>:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">121</span>]: mnames <span class="op">=</span> [<span class="st">"movie_id"</span>, <span class="st">"title"</span>, <span class="st">"genres"</span>]</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">122</span>]: movies <span class="op">=</span> pd.read_table(<span class="st">"datasets/movielens/movies.dat"</span>, sep<span class="op">=</span><span class="st">"::"</span>,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>   .....:                        header<span class="op">=</span><span class="va">None</span>, names<span class="op">=</span>mnames, engine<span class="op">=</span><span class="st">"python"</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">123</span>]: movies[:<span class="dv">10</span>]</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">123</span>]: </span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>   movie_id                               title                        genres</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>         <span class="dv">1</span>                    Toy Story (<span class="dv">1995</span>)   Animation<span class="op">|</span>Children<span class="st">'s|Comedy</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="er">1         2                      Jumanji </span>(<span class="dv">1995</span>)  Adventure<span class="op">|</span>Children<span class="st">'s|Fantasy</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="er">2         3             Grumpier Old Men </span>(<span class="dv">1995</span>)                Comedy<span class="op">|</span>Romance</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>         <span class="dv">4</span>            Waiting to Exhale (<span class="dv">1995</span>)                  Comedy<span class="op">|</span>Drama</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>         <span class="dv">5</span>  Father of the Bride Part II (<span class="dv">1995</span>)                        Comedy</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>         <span class="dv">6</span>                         Heat (<span class="dv">1995</span>)         Action<span class="op">|</span>Crime<span class="op">|</span>Thriller</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>         <span class="dv">7</span>                      Sabrina (<span class="dv">1995</span>)                Comedy<span class="op">|</span>Romance</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>         <span class="dv">8</span>                 Tom <span class="kw">and</span> Huck (<span class="dv">1995</span>)          Adventure<span class="op">|</span>Children<span class="st">'s</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="er">8         9                 Sudden Death </span>(<span class="dv">1995</span>)                        Action</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>        <span class="dv">10</span>                    GoldenEye (<span class="dv">1995</span>)     Action<span class="op">|</span>Adventure<span class="op">|</span>Thriller</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>pandas has implemented a special Series method <code>str.get_dummies</code> (methods that start with <code>str.</code> are discussed in more detail later in <a href="#text_string_manip">String Manipulation</a>) that handles this scenario of multiple group membership encoded as a delimited string:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">124</span>]: dummies <span class="op">=</span> movies[<span class="st">"genres"</span>].<span class="bu">str</span>.get_dummies(<span class="st">"|"</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">125</span>]: dummies.iloc[:<span class="dv">10</span>, :<span class="dv">6</span>]</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">125</span>]: </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>   Action  Adventure  Animation  Children<span class="st">'s  Comedy  Crime</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="er">0       0          0          1           1       1      0</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>       <span class="dv">0</span>          <span class="dv">1</span>          <span class="dv">0</span>           <span class="dv">1</span>       <span class="dv">0</span>      <span class="dv">0</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>       <span class="dv">0</span>          <span class="dv">0</span>          <span class="dv">0</span>           <span class="dv">0</span>       <span class="dv">1</span>      <span class="dv">0</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>       <span class="dv">0</span>          <span class="dv">0</span>          <span class="dv">0</span>           <span class="dv">0</span>       <span class="dv">1</span>      <span class="dv">0</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>       <span class="dv">0</span>          <span class="dv">0</span>          <span class="dv">0</span>           <span class="dv">0</span>       <span class="dv">1</span>      <span class="dv">0</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>       <span class="dv">1</span>          <span class="dv">0</span>          <span class="dv">0</span>           <span class="dv">0</span>       <span class="dv">0</span>      <span class="dv">1</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>       <span class="dv">0</span>          <span class="dv">0</span>          <span class="dv">0</span>           <span class="dv">0</span>       <span class="dv">1</span>      <span class="dv">0</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>       <span class="dv">0</span>          <span class="dv">1</span>          <span class="dv">0</span>           <span class="dv">1</span>       <span class="dv">0</span>      <span class="dv">0</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>       <span class="dv">1</span>          <span class="dv">0</span>          <span class="dv">0</span>           <span class="dv">0</span>       <span class="dv">0</span>      <span class="dv">0</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>       <span class="dv">1</span>          <span class="dv">1</span>          <span class="dv">0</span>           <span class="dv">0</span>       <span class="dv">0</span>      <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then, as before, you can combine this with <code>movies</code> while adding a <code>"Genre_"</code> to the column names in the <code>dummies</code> DataFrame with the <code>add_prefix</code> method:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">126</span>]: movies_windic <span class="op">=</span> movies.join(dummies.add_prefix(<span class="st">"Genre_"</span>))</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">127</span>]: movies_windic.iloc[<span class="dv">0</span>]</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">127</span>]: </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>movie_id                                       <span class="dv">1</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>title                           Toy Story (<span class="dv">1995</span>)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>genres               Animation<span class="op">|</span>Children<span class="st">'s|Comedy</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="er">Genre_Action                                   0</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>Genre_Adventure                                <span class="dv">0</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>Genre_Animation                                <span class="dv">1</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>Genre_Children<span class="st">'s                               1</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="er">Genre_Comedy                                   1</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>Genre_Crime                                    <span class="dv">0</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>Genre_Documentary                              <span class="dv">0</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>Genre_Drama                                    <span class="dv">0</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>Genre_Fantasy                                  <span class="dv">0</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>Genre_Film<span class="op">-</span>Noir                                <span class="dv">0</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>Genre_Horror                                   <span class="dv">0</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>Genre_Musical                                  <span class="dv">0</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>Genre_Mystery                                  <span class="dv">0</span></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>Genre_Romance                                  <span class="dv">0</span></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>Genre_Sci<span class="op">-</span>Fi                                   <span class="dv">0</span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>Genre_Thriller                                 <span class="dv">0</span></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>Genre_War                                      <span class="dv">0</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>Genre_Western                                  <span class="dv">0</span></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>Name: <span class="dv">0</span>, dtype: <span class="bu">object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>For much larger data, this method of constructing indicator variables with multiple membership is not especially speedy. It would be better to write a lower-level function that writes directly to a NumPy array, and then wrap the result in a DataFrame.</p>
</div>
</div>
<p>A useful recipe for statistical applications is to combine <code>pandas.get_dummies</code> with a discretization function like <code>pandas.cut</code>:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">128</span>]: np.random.seed(<span class="dv">12345</span>) <span class="co"># to make the example repeatable</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">129</span>]: values <span class="op">=</span> np.random.uniform(size<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">130</span>]: values</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">130</span>]: </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>array([<span class="fl">0.9296</span>, <span class="fl">0.3164</span>, <span class="fl">0.1839</span>, <span class="fl">0.2046</span>, <span class="fl">0.5677</span>, <span class="fl">0.5955</span>, <span class="fl">0.9645</span>, <span class="fl">0.6532</span>,</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>       <span class="fl">0.7489</span>, <span class="fl">0.6536</span>])</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">131</span>]: bins <span class="op">=</span> [<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="dv">1</span>]</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">132</span>]: pd.get_dummies(pd.cut(values, bins))</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">132</span>]: </span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>   (<span class="fl">0.0</span>, <span class="fl">0.2</span>]  (<span class="fl">0.2</span>, <span class="fl">0.4</span>]  (<span class="fl">0.4</span>, <span class="fl">0.6</span>]  (<span class="fl">0.6</span>, <span class="fl">0.8</span>]  (<span class="fl">0.8</span>, <span class="fl">1.0</span>]</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>       <span class="va">False</span>       <span class="va">False</span>       <span class="va">False</span>       <span class="va">False</span>        <span class="va">True</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>       <span class="va">False</span>        <span class="va">True</span>       <span class="va">False</span>       <span class="va">False</span>       <span class="va">False</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>        <span class="va">True</span>       <span class="va">False</span>       <span class="va">False</span>       <span class="va">False</span>       <span class="va">False</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>       <span class="va">False</span>        <span class="va">True</span>       <span class="va">False</span>       <span class="va">False</span>       <span class="va">False</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>       <span class="va">False</span>       <span class="va">False</span>        <span class="va">True</span>       <span class="va">False</span>       <span class="va">False</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>       <span class="va">False</span>       <span class="va">False</span>        <span class="va">True</span>       <span class="va">False</span>       <span class="va">False</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>       <span class="va">False</span>       <span class="va">False</span>       <span class="va">False</span>       <span class="va">False</span>        <span class="va">True</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>       <span class="va">False</span>       <span class="va">False</span>       <span class="va">False</span>        <span class="va">True</span>       <span class="va">False</span></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>       <span class="va">False</span>       <span class="va">False</span>       <span class="va">False</span>        <span class="va">True</span>       <span class="va">False</span></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>       <span class="va">False</span>       <span class="va">False</span>       <span class="va">False</span>        <span class="va">True</span>       <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We will look again at <code>pandas.get_dummies</code> later in <a href="#pandas-categorical-dummy">Creating dummy variables for modeling</a>.</p>
</section>
</section>
<section id="pandas-ext-types" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="pandas-ext-types"><span class="header-section-number">7.3</span> Extension Data Types</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is a newer and more advanced topic that many pandas users do not need to know a lot about, but I present it here for completeness since I will reference and use extension data types in various places in the upcoming chapters.</p>
</div>
</div>
<p>pandas was originally built upon the capabilities present in NumPy, an array computing library used primarily for working with numerical data. Many pandas concepts, such as missing data, were implemented using what was available in NumPy while trying to maximize compatibility between libraries that used NumPy and pandas together.</p>
<p>Building on NumPy led to a number of shortcomings, such as:</p>
<ul>
<li><p>Missing data handling for some numerical data types, such as integers and Booleans, was incomplete. As a result, when missing data was introduced into such data, pandas converted the data type to <code>float64</code> and used <code>np.nan</code> to represent null values. This had compounding effects by introducing subtle issues into many pandas algorithms.</p></li>
<li><p>Datasets with a lot of string data were computationally expensive and used a lot of memory.</p></li>
<li><p>Some data types, like time intervals, timedeltas, and timestamps with time zones, could not be supported efficiently without using computationally expensive arrays of Python objects.</p></li>
</ul>
<p>More recently, pandas has developed an <em>extension type</em> system allowing for new data types to be added even if they are not supported natively by NumPy. These new data types can be treated as first class alongside data coming from NumPy arrays.</p>
<p>Let's look at an example where we create a Series of integers with a missing value:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">133</span>]: s <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="va">None</span>])</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">134</span>]: s</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">134</span>]: </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="fl">1.0</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="fl">2.0</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="fl">3.0</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    NaN</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>dtype: float64</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">135</span>]: s.dtype</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">135</span>]: dtype(<span class="st">'float64'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Mainly for backward compatibility reasons, Series uses the legacy behavior of using a <code>float64</code> data type and <code>np.nan</code> for the missing value. We could create this Series instead using <code>pandas.Int64Dtype</code>:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">136</span>]: s <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="va">None</span>], dtype<span class="op">=</span>pd.Int64Dtype())</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">137</span>]: s</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">137</span>]: </span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>       <span class="dv">1</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>       <span class="dv">2</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>       <span class="dv">3</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>dtype: Int64</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">138</span>]: s.isna()</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">138</span>]: </span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="va">False</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="va">False</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="va">False</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     <span class="va">True</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">bool</span></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">139</span>]: s.dtype</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">139</span>]: Int64Dtype()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The output <code>&lt;NA&gt;</code> indicates that a value is missing for an extension type array. This uses the special <code>pandas.NA</code> sentinel value:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">140</span>]: s[<span class="dv">3</span>]</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">140</span>]: <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">141</span>]: s[<span class="dv">3</span>] <span class="kw">is</span> pd.NA</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">141</span>]: <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We also could have used the shorthand <code>"Int64"</code> instead of <code>pd.Int64Dtype()</code> to specify the type. The capitalization is necessary, otherwise it will be a NumPy-based nonextension type:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">142</span>]: s <span class="op">=</span> pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="va">None</span>], dtype<span class="op">=</span><span class="st">"Int64"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>pandas also has an extension type specialized for string data that does not use NumPy object arrays (it requires the pyarrow library, which you may need to install separately):</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">143</span>]: s <span class="op">=</span> pd.Series([<span class="st">'one'</span>, <span class="st">'two'</span>, <span class="va">None</span>, <span class="st">'three'</span>], dtype<span class="op">=</span>pd.StringDtype())</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">144</span>]: s</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">144</span>]: </span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>      one</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>      two</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>     <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    three</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>dtype: string</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These string arrays generally use much less memory and are frequently computationally more efficient for doing operations on large datasets.</p>
<p>Another important extension type is <code>Categorical</code>, which we discuss in more detail in <a href="#pandas-categorical">Categorical Data</a>. A reasonably complete list of extension types available as of this writing is in <a href="#tbl-table_pandas_extension_types">Table&nbsp;<span>7.3</span></a>.</p>
<p>Extension types can be passed to the Series <code>astype</code> method, allowing you to convert easily as part of your data cleaning process:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">145</span>]: df <span class="op">=</span> pd.DataFrame({<span class="st">"A"</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="va">None</span>, <span class="dv">4</span>],</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>   .....:                    <span class="st">"B"</span>: [<span class="st">"one"</span>, <span class="st">"two"</span>, <span class="st">"three"</span>, <span class="va">None</span>],</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>   .....:                    <span class="st">"C"</span>: [<span class="va">False</span>, <span class="va">None</span>, <span class="va">False</span>, <span class="va">True</span>]})</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">146</span>]: df</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">146</span>]: </span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>     A      B      C</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="fl">1.0</span>    one  <span class="va">False</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">2.0</span>    two   <span class="va">None</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  NaN  three  <span class="va">False</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="fl">4.0</span>   <span class="va">None</span>   <span class="va">True</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">147</span>]: df[<span class="st">"A"</span>] <span class="op">=</span> df[<span class="st">"A"</span>].astype(<span class="st">"Int64"</span>)</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">148</span>]: df[<span class="st">"B"</span>] <span class="op">=</span> df[<span class="st">"B"</span>].astype(<span class="st">"string"</span>)</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">149</span>]: df[<span class="st">"C"</span>] <span class="op">=</span> df[<span class="st">"C"</span>].astype(<span class="st">"boolean"</span>)</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">150</span>]: df</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">150</span>]: </span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>      A      B      C</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     <span class="dv">1</span>    one  <span class="va">False</span></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     <span class="dv">2</span>    two   <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span>  three  <span class="va">False</span></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     <span class="dv">4</span>   <span class="op">&lt;</span>NA<span class="op">&gt;</span>   <span class="va">True</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-table_pandas_extension_types" class="anchored">
<table class="table">
<caption>Table&nbsp;7.3: pandas extension data types</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Extension type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>BooleanDtype</code></td>
<td style="text-align: left;">Nullable Boolean data, use <code>"boolean"</code> when passing as string</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>CategoricalDtype</code></td>
<td style="text-align: left;">Categorical data type, use <code>"category"</code> when passing as string</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>DatetimeTZDtype</code></td>
<td style="text-align: left;">Datetime with time zone</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Float32Dtype</code></td>
<td style="text-align: left;">32-bit nullable floating point, use <code>"Float32"</code> when passing as string</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Float64Dtype</code></td>
<td style="text-align: left;">64-bit nullable floating point, use <code>"Float64"</code> when passing as string</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Int8Dtype</code></td>
<td style="text-align: left;">8-bit nullable signed integer, use <code>"Int8"</code> when passing as string</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Int16Dtype</code></td>
<td style="text-align: left;">16-bit nullable signed integer, use <code>"Int16"</code> when passing as string</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Int32Dtype</code></td>
<td style="text-align: left;">32-bit nullable signed integer, use <code>"Int32"</code> when passing as string</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Int64Dtype</code></td>
<td style="text-align: left;">64-bit nullable signed integer, use <code>"Int64"</code> when passing as string</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>UInt8Dtype</code></td>
<td style="text-align: left;">8-bit nullable unsigned integer, use <code>"UInt8"</code> when passing as string</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>UInt16Dtype</code></td>
<td style="text-align: left;">16-bit nullable unsigned integer, use <code>"UInt16"</code> when passing as string</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>UInt32Dtype</code></td>
<td style="text-align: left;">32-bit nullable unsigned integer, use <code>"UInt32"</code> when passing as string</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>UInt64Dtype</code></td>
<td style="text-align: left;">64-bit nullable unsigned integer, use <code>"UInt64"</code> when passing as string</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="text_string_manip" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="text_string_manip"><span class="header-section-number">7.4</span> String Manipulation</h2>
<p>Python has long been a popular raw data manipulation language in part due to its ease of use for string and text processing. Most text operations are made simple with the string object’s built-in methods. For more complex pattern matching and text manipulations, regular expressions may be needed. pandas adds to the mix by enabling you to apply string and regular expressions concisely on whole arrays of data, additionally handling the annoyance of missing data.</p>
<section id="text_string_methods" class="level3">
<h3 class="anchored" data-anchor-id="text_string_methods">Python Built-In String Object Methods</h3>
<p>In many string munging and scripting applications, built-in string methods are sufficient. As an example, a comma-separated string can be broken into pieces with <code>split</code>:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">151</span>]: val <span class="op">=</span> <span class="st">"a,b,  guido"</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">152</span>]: val.split(<span class="st">","</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">152</span>]: [<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'  guido'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>split</code> is often combined with <code>strip</code> to trim whitespace (including line breaks):</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">153</span>]: pieces <span class="op">=</span> [x.strip() <span class="cf">for</span> x <span class="kw">in</span> val.split(<span class="st">","</span>)]</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">154</span>]: pieces</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">154</span>]: [<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'guido'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These substrings could be concatenated together with a two-colon delimiter using addition:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">155</span>]: first, second, third <span class="op">=</span> pieces</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">156</span>]: first <span class="op">+</span> <span class="st">"::"</span> <span class="op">+</span> second <span class="op">+</span> <span class="st">"::"</span> <span class="op">+</span> third</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">156</span>]: <span class="st">'a::b::guido'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>But this isn’t a practical generic method. A faster and more Pythonic way is to pass a list or tuple to the <code>join</code> method on the string <code>"::"</code>:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">157</span>]: <span class="st">"::"</span>.join(pieces)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">157</span>]: <span class="st">'a::b::guido'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Other methods are concerned with locating substrings. Using Python’s <code>in</code> keyword is the best way to detect a substring, though <code>index</code> and <code>find</code> can also be used:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">158</span>]: <span class="st">"guido"</span> <span class="kw">in</span> val</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">158</span>]: <span class="va">True</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">159</span>]: val.index(<span class="st">","</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">159</span>]: <span class="dv">1</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">160</span>]: val.find(<span class="st">":"</span>)</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">160</span>]: <span class="op">-</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that the difference between <code>find</code> and <code>index</code> is that <code>index</code> raises an exception if the string isn’t found (versus returning –1):</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">161</span>]: val.index(<span class="st">":"</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="op">---------------------------------------------------------------------------</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="pp">ValueError</span>                                Traceback (most recent call last)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>ipython<span class="op">-</span><span class="bu">input</span><span class="op">-</span><span class="dv">161</span><span class="op">-</span>bea4c4c30248<span class="op">&gt;</span> <span class="kw">in</span> <span class="op">&lt;</span>module<span class="op">&gt;</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="op">----&gt;</span> <span class="dv">1</span> val.index(<span class="st">":"</span>)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="pp">ValueError</span>: substring <span class="kw">not</span> found</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Relatedly, <code>count</code> returns the number of occurrences of a particular substring:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">162</span>]: val.count(<span class="st">","</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">162</span>]: <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>replace</code> will substitute occurrences of one pattern for another. It is commonly used to delete patterns, too, by passing an empty string:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">163</span>]: val.replace(<span class="st">","</span>, <span class="st">"::"</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">163</span>]: <span class="st">'a::b::  guido'</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">164</span>]: val.replace(<span class="st">","</span>, <span class="st">""</span>)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">164</span>]: <span class="st">'ab  guido'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>See <a href="#tbl-table_string_methods">Table&nbsp;<span>7.4</span></a> for a listing of some of Python's string methods.</p>
<p>Regular expressions can also be used with many of these operations, as you’ll see.</p>
<div id="tbl-table_string_methods" class="anchored">
<table class="table">
<caption>Table&nbsp;7.4: Python built-in string methods</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Method</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>count</code></td>
<td style="text-align: left;">Return the number of nonoverlapping occurrences of substring in the string</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>endswith</code></td>
<td style="text-align: left;">Return <code>True</code> if string ends with suffix</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>startswith</code></td>
<td style="text-align: left;">Return <code>True</code> if string starts with prefix</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>join</code></td>
<td style="text-align: left;">Use string as delimiter for concatenating a sequence of other strings</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>index</code></td>
<td style="text-align: left;">Return starting index of the first occurrence of passed substring if found in the string; otherwise, raises <code>ValueError</code> if not found</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>find</code></td>
<td style="text-align: left;">Return position of first character of <em>first</em> occurrence of substring in the string; like <code>index</code>, but returns –1 if not found</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>rfind</code></td>
<td style="text-align: left;">Return position of first character of <em>last</em> occurrence of substring in the string; returns –1 if not found</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>replace</code></td>
<td style="text-align: left;">Replace occurrences of string with another string</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>strip, rstrip, lstrip</code></td>
<td style="text-align: left;">Trim whitespace, including newlines on both sides, on the right side, or on the left side, respectively</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>split</code></td>
<td style="text-align: left;">Break string into list of substrings using passed delimiter</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>lower</code></td>
<td style="text-align: left;">Convert alphabet characters to lowercase</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>upper</code></td>
<td style="text-align: left;">Convert alphabet characters to uppercase</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>casefold</code></td>
<td style="text-align: left;">Convert characters to lowercase, and convert any region-specific variable character combinations to a common comparable form</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>ljust, rjust</code></td>
<td style="text-align: left;">Left justify or right justify, respectively; pad opposite side of string with spaces (or some other fill character) to return a string with a minimum width</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="text_string_manip_re" class="level3">
<h3 class="anchored" data-anchor-id="text_string_manip_re">Regular Expressions</h3>
<p><em>Regular expressions</em> provide a flexible way to search or match (often more complex) string patterns in text. A single expression, commonly called a <em>regex</em>, is a string formed according to the regular expression language. Python’s built-in <code>re</code> module is responsible for applying regular expressions to strings; I’ll give a number of examples of its use here.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The art of writing regular expressions could be a chapter of its own and thus is outside the book’s scope. There are many excellent tutorials and references available on the internet and in other books.</p>
</div>
</div>
<p>The <code>re</code> module functions fall into three categories: pattern matching, substitution, and splitting. Naturally these are all related; a regex describes a pattern to locate in the text, which can then be used for many purposes. Let’s look at a simple example: suppose we wanted to split a string with a variable number of whitespace characters (tabs, spaces, and newlines).</p>
<p>The regex describing one or more whitespace characters is <code>\s+</code>:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">165</span>]: <span class="im">import</span> re</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">166</span>]: text <span class="op">=</span> <span class="st">"foo    bar</span><span class="ch">\t</span><span class="st"> baz  </span><span class="ch">\t</span><span class="st">qux"</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">167</span>]: re.split(<span class="vs">r"\s+"</span>, text)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">167</span>]: [<span class="st">'foo'</span>, <span class="st">'bar'</span>, <span class="st">'baz'</span>, <span class="st">'qux'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When you call <code>re.split(r"\s+", text)</code>, the regular expression is first <em>compiled</em>, and then its <code>split</code> method is called on the passed text. You can compile the regex yourself with <code>re.compile</code>, forming a reusable regex object:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">168</span>]: regex <span class="op">=</span> re.<span class="bu">compile</span>(<span class="vs">r"\s+"</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">169</span>]: regex.split(text)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">169</span>]: [<span class="st">'foo'</span>, <span class="st">'bar'</span>, <span class="st">'baz'</span>, <span class="st">'qux'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If, instead, you wanted to get a list of all patterns matching the regex, you can use the <code>findall</code> method:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">170</span>]: regex.findall(text)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">170</span>]: [<span class="st">'    '</span>, <span class="st">'</span><span class="ch">\t</span><span class="st"> '</span>, <span class="st">'  </span><span class="ch">\t</span><span class="st">'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>To avoid unwanted escaping with <code>\</code> in a regular expression, use <em>raw</em> string literals like <code>r"C:\x"</code> instead of the equivalent <code>"C:\\x"</code>.</p>
</div>
</div>
<p>Creating a regex object with <code>re.compile</code> is highly recommended if you intend to apply the same expression to many strings; doing so will save CPU cycles.</p>
<p><code>match</code> and <code>search</code> are closely related to <code>findall</code>. While <code>findall</code> returns all matches in a string, <code>search</code> returns only the first match. More rigidly, <code>match</code> <em>only</em> matches at the beginning of the string. As a less trivial example, let’s consider a block of text and a regular expression capable of identifying most email addresses:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>text <span class="op">=</span> <span class="st">"""Dave dave@google.com</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="st">Steve steve@gmail.com</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="st">Rob rob@gmail.com</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="st">Ryan ryan@yahoo.com"""</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>pattern <span class="op">=</span> <span class="vs">r"[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}"</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="co"># re.IGNORECASE makes the regex case insensitive</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>regex <span class="op">=</span> re.<span class="bu">compile</span>(pattern, flags<span class="op">=</span>re.IGNORECASE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Using <code>findall</code> on the text produces a list of the email addresses:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">172</span>]: regex.findall(text)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">172</span>]: </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>[<span class="st">'dave@google.com'</span>,</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'steve@gmail.com'</span>,</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'rob@gmail.com'</span>,</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'ryan@yahoo.com'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>search</code> returns a special match object for the first email address in the text. For the preceding regex, the match object can only tell us the start and end position of the pattern in the string:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">173</span>]: m <span class="op">=</span> regex.search(text)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">174</span>]: m</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">174</span>]: <span class="op">&lt;</span>re.Match <span class="bu">object</span><span class="op">;</span> span<span class="op">=</span>(<span class="dv">5</span>, <span class="dv">20</span>), match<span class="op">=</span><span class="st">'dave@google.com'</span><span class="op">&gt;</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">175</span>]: text[m.start():m.end()]</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">175</span>]: <span class="st">'dave@google.com'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>regex.match</code> returns <code>None</code>, as it will match only if the pattern occurs at the start of the string:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">176</span>]: <span class="bu">print</span>(regex.match(text))</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Relatedly, <code>sub</code> will return a new string with occurrences of the pattern replaced by a new string:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">177</span>]: <span class="bu">print</span>(regex.sub(<span class="st">"REDACTED"</span>, text))</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>Dave REDACTED</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>Steve REDACTED</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>Rob REDACTED</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>Ryan REDACTED</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Suppose you wanted to find email addresses and simultaneously segment each address into its three components: username, domain name, and domain suffix. To do this, put parentheses around the parts of the pattern to segment:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">178</span>]: pattern <span class="op">=</span> <span class="vs">r"([A-Z0-9._%+-]+)@([A-Z0-9.-]+)\.([A-Z]{2,4})"</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">179</span>]: regex <span class="op">=</span> re.<span class="bu">compile</span>(pattern, flags<span class="op">=</span>re.IGNORECASE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A match object produced by this modified regex returns a tuple of the pattern components with its <code>groups</code> method:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">180</span>]: m <span class="op">=</span> regex.match(<span class="st">"wesm@bright.net"</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">181</span>]: m.groups()</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">181</span>]: (<span class="st">'wesm'</span>, <span class="st">'bright'</span>, <span class="st">'net'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>findall</code> returns a list of tuples when the pattern has groups:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">182</span>]: regex.findall(text)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">182</span>]: </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>[(<span class="st">'dave'</span>, <span class="st">'google'</span>, <span class="st">'com'</span>),</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a> (<span class="st">'steve'</span>, <span class="st">'gmail'</span>, <span class="st">'com'</span>),</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a> (<span class="st">'rob'</span>, <span class="st">'gmail'</span>, <span class="st">'com'</span>),</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a> (<span class="st">'ryan'</span>, <span class="st">'yahoo'</span>, <span class="st">'com'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>sub</code> also has access to groups in each match using special symbols like <code>\1</code> and <code>\2</code>. The symbol <code>\1</code> corresponds to the first matched group, <code>\2</code> corresponds to the second, and so forth:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">183</span>]: <span class="bu">print</span>(regex.sub(<span class="vs">r"Username: \1, Domain: \2, Suffix: \3"</span>, text))</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>Dave Username: dave, Domain: google, Suffix: com</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>Steve Username: steve, Domain: gmail, Suffix: com</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>Rob Username: rob, Domain: gmail, Suffix: com</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>Ryan Username: ryan, Domain: yahoo, Suffix: com</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>There is much more to regular expressions in Python, most of which is outside the book’s scope. <a href="#tbl-table_regex_method">Table&nbsp;<span>7.5</span></a> provides a brief summary.</p>
<div id="tbl-table_regex_method" class="anchored">
<table class="table">
<caption>Table&nbsp;7.5: Regular expression methods</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Method</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>findall</code></td>
<td style="text-align: left;">Return all nonoverlapping matching patterns in a string as a list</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>finditer</code></td>
<td style="text-align: left;">Like <code>findall</code>, but returns an iterator</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>match</code></td>
<td style="text-align: left;">Match pattern at start of string and optionally segment pattern components into groups; if the pattern matches, return a match object, and otherwise <code>None</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>search</code></td>
<td style="text-align: left;">Scan string for match to pattern, returning a match object if so; unlike <code>match</code>, the match can be anywhere in the string as opposed to only at the beginning</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>split</code></td>
<td style="text-align: left;">Break string into pieces at each occurrence of pattern</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>sub, subn</code></td>
<td style="text-align: left;">Replace all (<code>sub</code>) or first <code>n</code> occurrences (<code>subn</code>) of pattern in string with replacement expression; use symbols <code>\1, \2, ...</code> to refer to match group elements in the replacement string</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="text_string_manip_vectorized" class="level3">
<h3 class="anchored" data-anchor-id="text_string_manip_vectorized">String Functions in pandas</h3>
<p>Cleaning up a messy dataset for analysis often requires a lot of string manipulation. To complicate matters, a column containing strings will sometimes have missing data:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">184</span>]: data <span class="op">=</span> {<span class="st">"Dave"</span>: <span class="st">"dave@google.com"</span>, <span class="st">"Steve"</span>: <span class="st">"steve@gmail.com"</span>,</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>   .....:         <span class="st">"Rob"</span>: <span class="st">"rob@gmail.com"</span>, <span class="st">"Wes"</span>: np.nan}</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">185</span>]: data <span class="op">=</span> pd.Series(data)</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">186</span>]: data</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">186</span>]: </span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>Dave     dave<span class="op">@</span>google.com</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>Steve    steve<span class="op">@</span>gmail.com</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>Rob        rob<span class="op">@</span>gmail.com</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>Wes                  NaN</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">object</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">187</span>]: data.isna()</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">187</span>]: </span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>Dave     <span class="va">False</span></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>Steve    <span class="va">False</span></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>Rob      <span class="va">False</span></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>Wes       <span class="va">True</span></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">bool</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>String and regular expression methods can be applied (passing a <code>lambda</code> or other function) to each value using <code>data.map</code>, but it will fail on the NA (null) values. To cope with this, Series has array-oriented methods for string operations that skip over and propagate NA values. These are accessed through Series’s <code>str</code> attribute; for example, we could check whether each email address has <code>"gmail"</code> in it with <code>str.contains</code>:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">188</span>]: data.<span class="bu">str</span>.contains(<span class="st">"gmail"</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">188</span>]: </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>Dave     <span class="va">False</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>Steve     <span class="va">True</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>Rob       <span class="va">True</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>Wes        NaN</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that the result of this operation has an <code>object</code> dtype. pandas has <em>extension types</em> that provide for specialized treatment of strings, integers, and Boolean data which until recently have had some rough edges when working with missing data:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">189</span>]: data_as_string_ext <span class="op">=</span> data.astype(<span class="st">'string'</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">190</span>]: data_as_string_ext</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">190</span>]: </span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>Dave     dave<span class="op">@</span>google.com</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>Steve    steve<span class="op">@</span>gmail.com</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>Rob        rob<span class="op">@</span>gmail.com</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>Wes                 <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>dtype: string</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">191</span>]: data_as_string_ext.<span class="bu">str</span>.contains(<span class="st">"gmail"</span>)</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">191</span>]: </span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>Dave     <span class="va">False</span></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>Steve     <span class="va">True</span></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>Rob       <span class="va">True</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>Wes       <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>dtype: boolean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Extension types are discussed in more detail in <a href="#pandas-ext-types">Extension Data Types</a>.</p>
<p>Regular expressions can be used, too, along with any <code>re</code> options like <code>IGNORECASE</code>:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">192</span>]: pattern <span class="op">=</span> <span class="vs">r"([A-Z0-9._%+-]+)@([A-Z0-9.-]+)\.([A-Z]{2,4})"</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">193</span>]: data.<span class="bu">str</span>.findall(pattern, flags<span class="op">=</span>re.IGNORECASE)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">193</span>]: </span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>Dave     [(dave, google, com)]</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>Steve    [(steve, gmail, com)]</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>Rob        [(rob, gmail, com)]</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>Wes                        NaN</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>There are a couple of ways to do vectorized element retrieval. Either use <code>str.get</code> or index into the <code>str</code> attribute:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">194</span>]: matches <span class="op">=</span> data.<span class="bu">str</span>.findall(pattern, flags<span class="op">=</span>re.IGNORECASE).<span class="bu">str</span>[<span class="dv">0</span>]</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">195</span>]: matches</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">195</span>]: </span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>Dave     (dave, google, com)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>Steve    (steve, gmail, com)</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>Rob        (rob, gmail, com)</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>Wes                      NaN</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">object</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">196</span>]: matches.<span class="bu">str</span>.get(<span class="dv">1</span>)</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">196</span>]: </span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>Dave     google</span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>Steve     gmail</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>Rob       gmail</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>Wes         NaN</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can similarly slice strings using this syntax:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">197</span>]: data.<span class="bu">str</span>[:<span class="dv">5</span>]</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">197</span>]: </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>Dave     dave<span class="op">@</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>Steve    steve</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>Rob      rob<span class="op">@</span>g</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>Wes        NaN</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>str.extract</code> method will return the captured groups of a regular expression as a DataFrame:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">198</span>]: data.<span class="bu">str</span>.extract(pattern, flags<span class="op">=</span>re.IGNORECASE)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">198</span>]: </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>           <span class="dv">0</span>       <span class="dv">1</span>    <span class="dv">2</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>Dave    dave  google  com</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>Steve  steve   gmail  com</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>Rob      rob   gmail  com</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>Wes      NaN     NaN  NaN</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>See <a href="#tbl-table_vec_string">Table&nbsp;<span>7.6</span></a> for more pandas string methods.</p>
<div id="tbl-table_vec_string" class="anchored">
<table class="table">
<caption>Table&nbsp;7.6: Partial listing of Series string methods</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Method</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>cat</code></td>
<td style="text-align: left;">Concatenate strings element-wise with optional delimiter</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>contains</code></td>
<td style="text-align: left;">Return Boolean array if each string contains pattern/regex</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>count</code></td>
<td style="text-align: left;">Count occurrences of pattern</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>extract</code></td>
<td style="text-align: left;">Use a regular expression with groups to extract one or more strings from a Series of strings; the result will be a DataFrame with one column per group</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>endswith</code></td>
<td style="text-align: left;">Equivalent to <code>x.endswith(pattern)</code> for each element</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>startswith</code></td>
<td style="text-align: left;">Equivalent to <code>x.startswith(pattern)</code> for each element</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>findall</code></td>
<td style="text-align: left;">Compute list of all occurrences of pattern/regex for each string</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>get</code></td>
<td style="text-align: left;">Index into each element (retrieve <em>i</em>-th element)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>isalnum</code></td>
<td style="text-align: left;">Equivalent to built-in <code>str.alnum</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>isalpha</code></td>
<td style="text-align: left;">Equivalent to built-in <code>str.isalpha</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>isdecimal</code></td>
<td style="text-align: left;">Equivalent to built-in <code>str.isdecimal</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>isdigit</code></td>
<td style="text-align: left;">Equivalent to built-in <code>str.isdigit</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>islower</code></td>
<td style="text-align: left;">Equivalent to built-in <code>str.islower</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>isnumeric</code></td>
<td style="text-align: left;">Equivalent to built-in <code>str.isnumeric</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>isupper</code></td>
<td style="text-align: left;">Equivalent to built-in <code>str.isupper</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>join</code></td>
<td style="text-align: left;">Join strings in each element of the Series with passed separator</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>len</code></td>
<td style="text-align: left;">Compute length of each string</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>lower, upper</code></td>
<td style="text-align: left;">Convert cases; equivalent to <code>x.lower()</code> or <code>x.upper()</code> for each element</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>match</code></td>
<td style="text-align: left;">Use <code>re.match</code> with the passed regular expression on each element, returning <code>True</code> or <code>False</code> whether it matches</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>pad</code></td>
<td style="text-align: left;">Add whitespace to left, right, or both sides of strings</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>center</code></td>
<td style="text-align: left;">Equivalent to <code>pad(side="both")</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>repeat</code></td>
<td style="text-align: left;">Duplicate values (e.g., <code>s.str.repeat(3)</code> is equivalent to <code>x * 3</code> for each string)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>replace</code></td>
<td style="text-align: left;">Replace occurrences of pattern/regex with some other string</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>slice</code></td>
<td style="text-align: left;">Slice each string in the Series</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>split</code></td>
<td style="text-align: left;">Split strings on delimiter or regular expression</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>strip</code></td>
<td style="text-align: left;">Trim whitespace from both sides, including newlines</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>rstrip</code></td>
<td style="text-align: left;">Trim whitespace on right side</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>lstrip</code></td>
<td style="text-align: left;">Trim whitespace on left side</td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="pandas-categorical" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="pandas-categorical"><span class="header-section-number">7.5</span> Categorical Data</h2>
<p>This section introduces the pandas <code>Categorical</code> type. I will show how you can achieve better performance and memory use in some pandas operations by using it. I also introduce some tools that may help with using categorical data in statistics and machine learning applications.</p>
<section id="pandas-categorical-background" class="level3">
<h3 class="anchored" data-anchor-id="pandas-categorical-background">Background and Motivation</h3>
<p>Frequently, a column in a table may contain repeated instances of a smaller set of distinct values. We have already seen functions like <code>unique</code> and <code>value_counts</code>, which enable us to extract the distinct values from an array and compute their frequencies, respectively:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">199</span>]: values <span class="op">=</span> pd.Series([<span class="st">'apple'</span>, <span class="st">'orange'</span>, <span class="st">'apple'</span>,</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>   .....:                     <span class="st">'apple'</span>] <span class="op">*</span> <span class="dv">2</span>)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">200</span>]: values</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">200</span>]: </span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     apple</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    orange</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>     apple</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     apple</span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>     apple</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    orange</span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>     apple</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>     apple</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">object</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">201</span>]: pd.unique(values)</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">201</span>]: array([<span class="st">'apple'</span>, <span class="st">'orange'</span>], dtype<span class="op">=</span><span class="bu">object</span>)</span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">202</span>]: pd.value_counts(values)</span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">202</span>]: </span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a>apple     <span class="dv">6</span></span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>orange    <span class="dv">2</span></span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a>Name: count, dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Many data systems (for data warehousing, statistical computing, or other uses) have developed specialized approaches for representing data with repeated values for more efficient storage and computation. In data warehousing, a best practice is to use so-called <em>dimension tables</em> containing the distinct values and storing the primary observations as integer keys referencing the dimension table:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">203</span>]: values <span class="op">=</span> pd.Series([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>] <span class="op">*</span> <span class="dv">2</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">204</span>]: dim <span class="op">=</span> pd.Series([<span class="st">'apple'</span>, <span class="st">'orange'</span>])</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">205</span>]: values</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">205</span>]: </span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">0</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="dv">0</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="dv">0</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="dv">0</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    <span class="dv">1</span></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>    <span class="dv">0</span></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>    <span class="dv">0</span></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>dtype: int64</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">206</span>]: dim</span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">206</span>]: </span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     apple</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    orange</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can use the <code>take</code> method to restore the original Series of strings:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">207</span>]: dim.take(values)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">207</span>]: </span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     apple</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    orange</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     apple</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     apple</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     apple</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    orange</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     apple</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     apple</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">object</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This representation as integers is called the <em>categorical</em> or <em>dictionary-encoded</em> representation. The array of distinct values can be called the <em>categories</em>, <em>dictionary</em>, or <em>levels</em> of the data. In this book we will use the terms <em>categorical</em> and <em>categories</em>. The integer values that reference the categories are called the <em>category codes</em> or simply <em>codes</em>.</p>
<p>The categorical representation can yield significant performance improvements when you are doing analytics. You can also perform transformations on the categories while leaving the codes unmodified. Some example transformations that can be made at relatively low cost are:</p>
<ul>
<li><p>Renaming categories</p></li>
<li><p>Appending a new category without changing the order or position of the existing categories</p></li>
</ul>
</section>
<section id="pandas-categorical-intro" class="level3">
<h3 class="anchored" data-anchor-id="pandas-categorical-intro">Categorical Extension Type in pandas</h3>
<p>pandas has a special <code>Categorical</code> extension type for holding data that uses the integer-based categorical representation or <em>encoding</em>. This is a popular data compression technique for data with many occurrences of similar values and can provide significantly faster performance with lower memory use, especially for string data.</p>
<p>Let's consider the example Series from before:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">208</span>]: fruits <span class="op">=</span> [<span class="st">'apple'</span>, <span class="st">'orange'</span>, <span class="st">'apple'</span>, <span class="st">'apple'</span>] <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">209</span>]: N <span class="op">=</span> <span class="bu">len</span>(fruits)</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">210</span>]: rng <span class="op">=</span> np.random.default_rng(seed<span class="op">=</span><span class="dv">12345</span>)</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">211</span>]: df <span class="op">=</span> pd.DataFrame({<span class="st">'fruit'</span>: fruits,</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>   .....:                    <span class="st">'basket_id'</span>: np.arange(N),</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>   .....:                    <span class="st">'count'</span>: rng.integers(<span class="dv">3</span>, <span class="dv">15</span>, size<span class="op">=</span>N),</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>   .....:                    <span class="st">'weight'</span>: rng.uniform(<span class="dv">0</span>, <span class="dv">4</span>, size<span class="op">=</span>N)},</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>   .....:                   columns<span class="op">=</span>[<span class="st">'basket_id'</span>, <span class="st">'fruit'</span>, <span class="st">'count'</span>, <span class="st">'weight'</span>])</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">212</span>]: df</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">212</span>]: </span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>   basket_id   fruit  count    weight</span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>          <span class="dv">0</span>   apple     <span class="dv">11</span>  <span class="fl">1.564438</span></span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>          <span class="dv">1</span>  orange      <span class="dv">5</span>  <span class="fl">1.331256</span></span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>          <span class="dv">2</span>   apple     <span class="dv">12</span>  <span class="fl">2.393235</span></span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>          <span class="dv">3</span>   apple      <span class="dv">6</span>  <span class="fl">0.746937</span></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>          <span class="dv">4</span>   apple      <span class="dv">5</span>  <span class="fl">2.691024</span></span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>          <span class="dv">5</span>  orange     <span class="dv">12</span>  <span class="fl">3.767211</span></span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>          <span class="dv">6</span>   apple     <span class="dv">10</span>  <span class="fl">0.992983</span></span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>          <span class="dv">7</span>   apple     <span class="dv">11</span>  <span class="fl">3.795525</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here, <code>df['fruit']</code> is an array of Python string objects. We can convert it to categorical by calling:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">213</span>]: fruit_cat <span class="op">=</span> df[<span class="st">'fruit'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">214</span>]: fruit_cat</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">214</span>]: </span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     apple</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    orange</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>     apple</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     apple</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>     apple</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    orange</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>     apple</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>     apple</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>Name: fruit, dtype: category</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>Categories (<span class="dv">2</span>, <span class="bu">object</span>): [<span class="st">'apple'</span>, <span class="st">'orange'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The values for <code>fruit_cat</code> are now an instance of <code>pandas.Categorical</code>, which you can access via the <code>.array</code> attribute:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">215</span>]: c <span class="op">=</span> fruit_cat.array</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">216</span>]: <span class="bu">type</span>(c)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">216</span>]: pandas.core.arrays.categorical.Categorical</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>Categorical</code> object has <code>categories</code> and <code>codes</code> attributes:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">217</span>]: c.categories</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">217</span>]: Index([<span class="st">'apple'</span>, <span class="st">'orange'</span>], dtype<span class="op">=</span><span class="st">'object'</span>)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">218</span>]: c.codes</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">218</span>]: array([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>], dtype<span class="op">=</span>int8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These can be accessed more easily using the <code>cat</code> accessor, which will be explained soon in <a href="#pandas-categorical-methods">Categorical Methods</a>.</p>
<p>A useful trick to get a mapping between codes and categories is:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">219</span>]: <span class="bu">dict</span>(<span class="bu">enumerate</span>(c.categories))</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">219</span>]: {<span class="dv">0</span>: <span class="st">'apple'</span>, <span class="dv">1</span>: <span class="st">'orange'</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can convert a DataFrame column to categorical by assigning the converted result:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">220</span>]: df[<span class="st">'fruit'</span>] <span class="op">=</span> df[<span class="st">'fruit'</span>].astype(<span class="st">'category'</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">221</span>]: df[<span class="st">"fruit"</span>]</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">221</span>]: </span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     apple</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    orange</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>     apple</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     apple</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>     apple</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    orange</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>     apple</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>     apple</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>Name: fruit, dtype: category</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>Categories (<span class="dv">2</span>, <span class="bu">object</span>): [<span class="st">'apple'</span>, <span class="st">'orange'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can also create <code>pandas.Categorical</code> directly from other types of Python sequences:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">222</span>]: my_categories <span class="op">=</span> pd.Categorical([<span class="st">'foo'</span>, <span class="st">'bar'</span>, <span class="st">'baz'</span>, <span class="st">'foo'</span>, <span class="st">'bar'</span>])</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">223</span>]: my_categories</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">223</span>]: </span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>[<span class="st">'foo'</span>, <span class="st">'bar'</span>, <span class="st">'baz'</span>, <span class="st">'foo'</span>, <span class="st">'bar'</span>]</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>Categories (<span class="dv">3</span>, <span class="bu">object</span>): [<span class="st">'bar'</span>, <span class="st">'baz'</span>, <span class="st">'foo'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you have obtained categorical encoded data from another source, you can use the alternative <code>from_codes</code> constructor:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">224</span>]: categories <span class="op">=</span> [<span class="st">'foo'</span>, <span class="st">'bar'</span>, <span class="st">'baz'</span>]</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">225</span>]: codes <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">226</span>]: my_cats_2 <span class="op">=</span> pd.Categorical.from_codes(codes, categories)</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">227</span>]: my_cats_2</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">227</span>]: </span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>[<span class="st">'foo'</span>, <span class="st">'bar'</span>, <span class="st">'baz'</span>, <span class="st">'foo'</span>, <span class="st">'foo'</span>, <span class="st">'bar'</span>]</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>Categories (<span class="dv">3</span>, <span class="bu">object</span>): [<span class="st">'foo'</span>, <span class="st">'bar'</span>, <span class="st">'baz'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Unless explicitly specified, categorical conversions assume no specific ordering of the categories. So the <code>categories</code> array may be in a different order depending on the ordering of the input data. When using <code>from_codes</code> or any of the other constructors, you can indicate that the categories have a meaningful ordering:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">228</span>]: ordered_cat <span class="op">=</span> pd.Categorical.from_codes(codes, categories,</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>   .....:                                         ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">229</span>]: ordered_cat</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">229</span>]: </span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>[<span class="st">'foo'</span>, <span class="st">'bar'</span>, <span class="st">'baz'</span>, <span class="st">'foo'</span>, <span class="st">'foo'</span>, <span class="st">'bar'</span>]</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>Categories (<span class="dv">3</span>, <span class="bu">object</span>): [<span class="st">'foo'</span> <span class="op">&lt;</span> <span class="st">'bar'</span> <span class="op">&lt;</span> <span class="st">'baz'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The output <code>[foo &lt; bar &lt; baz]</code> indicates that <code>'foo'</code> precedes <code>'bar'</code> in the ordering, and so on. An unordered categorical instance can be made ordered with <code>as_ordered</code>:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">230</span>]: my_cats_2.as_ordered()</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">230</span>]: </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>[<span class="st">'foo'</span>, <span class="st">'bar'</span>, <span class="st">'baz'</span>, <span class="st">'foo'</span>, <span class="st">'foo'</span>, <span class="st">'bar'</span>]</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>Categories (<span class="dv">3</span>, <span class="bu">object</span>): [<span class="st">'foo'</span> <span class="op">&lt;</span> <span class="st">'bar'</span> <span class="op">&lt;</span> <span class="st">'baz'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As a last note, categorical data need not be strings, even though I have shown only string examples. A categorical array can consist of any immutable value types.</p>
</section>
<section id="pandas-categorical-compute" class="level3">
<h3 class="anchored" data-anchor-id="pandas-categorical-compute">Computations with Categoricals</h3>
<p>Using <code>Categorical</code> in pandas compared with the nonencoded version (like an array of strings) generally behaves the same way. Some parts of pandas, like the <code>groupby</code> function, perform better when working with categoricals. There are also some functions that can utilize the <code>ordered</code> flag.</p>
<p>Let's consider some random numeric data and use the <code>pandas.qcut</code> binning function. This returns <code>pandas.Categorical</code>; we used <code>pandas.cut</code> earlier in the book but glossed over the details of how categoricals work:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">231</span>]: rng <span class="op">=</span> np.random.default_rng(seed<span class="op">=</span><span class="dv">12345</span>)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">232</span>]: draws <span class="op">=</span> rng.standard_normal(<span class="dv">1000</span>)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">233</span>]: draws[:<span class="dv">5</span>]</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">233</span>]: array([<span class="op">-</span><span class="fl">1.4238</span>,  <span class="fl">1.2637</span>, <span class="op">-</span><span class="fl">0.8707</span>, <span class="op">-</span><span class="fl">0.2592</span>, <span class="op">-</span><span class="fl">0.0753</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let's compute a quartile binning of this data and extract some statistics:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">234</span>]: bins <span class="op">=</span> pd.qcut(draws, <span class="dv">4</span>)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">235</span>]: bins</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">235</span>]: </span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>[(<span class="op">-</span><span class="fl">3.121</span>, <span class="op">-</span><span class="fl">0.675</span>], (<span class="fl">0.687</span>, <span class="fl">3.211</span>], (<span class="op">-</span><span class="fl">3.121</span>, <span class="op">-</span><span class="fl">0.675</span>], (<span class="op">-</span><span class="fl">0.675</span>, <span class="fl">0.0134</span>], (<span class="op">-</span><span class="fl">0.675</span>, <span class="dv">0</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="fl">.0134</span>], ..., (<span class="fl">0.0134</span>, <span class="fl">0.687</span>], (<span class="fl">0.0134</span>, <span class="fl">0.687</span>], (<span class="op">-</span><span class="fl">0.675</span>, <span class="fl">0.0134</span>], (<span class="fl">0.0134</span>, <span class="fl">0.687</span>],</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a> (<span class="op">-</span><span class="fl">0.675</span>, <span class="fl">0.0134</span>]]</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>Length: <span class="dv">1000</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>Categories (<span class="dv">4</span>, interval[float64, right]): [(<span class="op">-</span><span class="fl">3.121</span>, <span class="op">-</span><span class="fl">0.675</span>] <span class="op">&lt;</span> (<span class="op">-</span><span class="fl">0.675</span>, <span class="fl">0.0134</span>] <span class="op">&lt;</span> </span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>(<span class="fl">0.0134</span>, <span class="fl">0.687</span>] <span class="op">&lt;</span></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>                                           (<span class="fl">0.687</span>, <span class="fl">3.211</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>While useful, the exact sample quartiles may be less useful for producing a report than quartile names. We can achieve this with the <code>labels</code> argument to <code>qcut</code>:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">236</span>]: bins <span class="op">=</span> pd.qcut(draws, <span class="dv">4</span>, labels<span class="op">=</span>[<span class="st">'Q1'</span>, <span class="st">'Q2'</span>, <span class="st">'Q3'</span>, <span class="st">'Q4'</span>])</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">237</span>]: bins</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">237</span>]: </span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>[<span class="st">'Q1'</span>, <span class="st">'Q4'</span>, <span class="st">'Q1'</span>, <span class="st">'Q2'</span>, <span class="st">'Q2'</span>, ..., <span class="st">'Q3'</span>, <span class="st">'Q3'</span>, <span class="st">'Q2'</span>, <span class="st">'Q3'</span>, <span class="st">'Q2'</span>]</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>Length: <span class="dv">1000</span></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>Categories (<span class="dv">4</span>, <span class="bu">object</span>): [<span class="st">'Q1'</span> <span class="op">&lt;</span> <span class="st">'Q2'</span> <span class="op">&lt;</span> <span class="st">'Q3'</span> <span class="op">&lt;</span> <span class="st">'Q4'</span>]</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">238</span>]: bins.codes[:<span class="dv">10</span>]</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">238</span>]: array([<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">0</span>], dtype<span class="op">=</span>int8)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The labeled <code>bins</code> categorical does not contain information about the bin edges in the data, so we can use <code>groupby</code> to extract some summary statistics:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">239</span>]: bins <span class="op">=</span> pd.Series(bins, name<span class="op">=</span><span class="st">'quartile'</span>)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">240</span>]: results <span class="op">=</span> (pd.Series(draws)</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>   .....:            .groupby(bins)</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>   .....:            .agg([<span class="st">'count'</span>, <span class="st">'min'</span>, <span class="st">'max'</span>])</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>   .....:            .reset_index())</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">241</span>]: results</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">241</span>]: </span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>  quartile  count       <span class="bu">min</span>       <span class="bu">max</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>       Q1    <span class="dv">250</span> <span class="op">-</span><span class="fl">3.119609</span> <span class="op">-</span><span class="fl">0.678494</span></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>       Q2    <span class="dv">250</span> <span class="op">-</span><span class="fl">0.673305</span>  <span class="fl">0.008009</span></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>       Q3    <span class="dv">250</span>  <span class="fl">0.018753</span>  <span class="fl">0.686183</span></span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>       Q4    <span class="dv">250</span>  <span class="fl">0.688282</span>  <span class="fl">3.211418</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>'quartile'</code> column in the result retains the original categorical information, including ordering, from <code>bins</code>:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">242</span>]: results[<span class="st">'quartile'</span>]</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">242</span>]: </span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    Q1</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    Q2</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    Q3</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    Q4</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>Name: quartile, dtype: category</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>Categories (<span class="dv">4</span>, <span class="bu">object</span>): [<span class="st">'Q1'</span> <span class="op">&lt;</span> <span class="st">'Q2'</span> <span class="op">&lt;</span> <span class="st">'Q3'</span> <span class="op">&lt;</span> <span class="st">'Q4'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="pandas-categorical-performance" class="level4">
<h4 class="anchored" data-anchor-id="pandas-categorical-performance">Better performance with categoricals</h4>
<p>At the beginning of the section, I said that categorical types can improve performance and memory use, so let's look at some examples. Consider some Series with 10 million elements and a small number of distinct categories:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">243</span>]: N <span class="op">=</span> <span class="dv">10_000_000</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">244</span>]: labels <span class="op">=</span> pd.Series([<span class="st">'foo'</span>, <span class="st">'bar'</span>, <span class="st">'baz'</span>, <span class="st">'qux'</span>] <span class="op">*</span> (N <span class="op">//</span> <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now we convert <code>labels</code> to categorical:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">245</span>]: categories <span class="op">=</span> labels.astype(<span class="st">'category'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now we note that <code>labels</code> uses significantly more memory than <code>categories</code>:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">246</span>]: labels.memory_usage(deep<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">246</span>]: <span class="dv">600000128</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">247</span>]: categories.memory_usage(deep<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">247</span>]: <span class="dv">10000540</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The conversion to category is not free, of course, but it is a one-time cost:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">248</span>]: <span class="op">%</span>time _ <span class="op">=</span> labels.astype(<span class="st">'category'</span>)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>CPU times: user <span class="dv">279</span> ms, sys: <span class="fl">6.06</span> ms, total: <span class="dv">285</span> ms</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>Wall time: <span class="dv">285</span> ms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>GroupBy operations can be significantly faster with categoricals because the underlying algorithms use the integer-based codes array instead of an array of strings. Here we compare the performance of <code>value_counts()</code>, which internally uses the GroupBy machinery:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">249</span>]: <span class="op">%</span>timeit labels.value_counts()</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="dv">331</span> ms <span class="op">+-</span> <span class="fl">5.39</span> ms per loop (mean <span class="op">+-</span> std. dev. of <span class="dv">7</span> runs, <span class="dv">1</span> loop each)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">250</span>]: <span class="op">%</span>timeit categories.value_counts()</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="fl">15.6</span> ms <span class="op">+-</span> <span class="dv">152</span> us per loop (mean <span class="op">+-</span> std. dev. of <span class="dv">7</span> runs, <span class="dv">100</span> loops each)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="pandas-categorical-methods" class="level3">
<h3 class="anchored" data-anchor-id="pandas-categorical-methods">Categorical Methods</h3>
<p>Series containing categorical data have several special methods similar to the <code>Series.str</code> specialized string methods. This also provides convenient access to the categories and codes. Consider the Series:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">251</span>]: s <span class="op">=</span> pd.Series([<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>] <span class="op">*</span> <span class="dv">2</span>)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">252</span>]: cat_s <span class="op">=</span> s.astype(<span class="st">'category'</span>)</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">253</span>]: cat_s</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">253</span>]: </span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    a</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    b</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    c</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    d</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    a</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    b</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>    c</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>    d</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>dtype: category</span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>Categories (<span class="dv">4</span>, <span class="bu">object</span>): [<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The special <em>accessor</em> attribute <code>cat</code> provides access to categorical methods:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">254</span>]: cat_s.cat.codes</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">254</span>]: </span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">0</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="dv">1</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="dv">2</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="dv">3</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="dv">0</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    <span class="dv">1</span></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>    <span class="dv">2</span></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>    <span class="dv">3</span></span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>dtype: int8</span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">255</span>]: cat_s.cat.categories</span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">255</span>]: Index([<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>], dtype<span class="op">=</span><span class="st">'object'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Suppose that we know the actual set of categories for this data extends beyond the four values observed in the data. We can use the <code>set_categories</code> method to change them:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">256</span>]: actual_categories <span class="op">=</span> [<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>, <span class="st">'e'</span>]</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">257</span>]: cat_s2 <span class="op">=</span> cat_s.cat.set_categories(actual_categories)</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">258</span>]: cat_s2</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">258</span>]: </span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    a</span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    b</span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    c</span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    d</span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    a</span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    b</span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>    c</span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>    d</span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>dtype: category</span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>Categories (<span class="dv">5</span>, <span class="bu">object</span>): [<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>, <span class="st">'e'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>While it appears that the data is unchanged, the new categories will be reflected in operations that use them. For example, <code>value_counts</code> respects the categories, if present:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">259</span>]: cat_s.value_counts()</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">259</span>]: </span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">2</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">2</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>c    <span class="dv">2</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>d    <span class="dv">2</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>Name: count, dtype: int64</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">260</span>]: cat_s2.value_counts()</span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">260</span>]: </span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">2</span></span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">2</span></span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>c    <span class="dv">2</span></span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>d    <span class="dv">2</span></span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true" tabindex="-1"></a>e    <span class="dv">0</span></span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true" tabindex="-1"></a>Name: count, dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In large datasets, categoricals are often used as a convenient tool for memory savings and better performance. After you filter a large DataFrame or Series, many of the categories may not appear in the data. To help with this, we can use the <code>remove_unused_categories</code> method to trim unobserved categories:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">261</span>]: cat_s3 <span class="op">=</span> cat_s[cat_s.isin([<span class="st">'a'</span>, <span class="st">'b'</span>])]</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">262</span>]: cat_s3</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">262</span>]: </span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    a</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    b</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    a</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    b</span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>dtype: category</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>Categories (<span class="dv">4</span>, <span class="bu">object</span>): [<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>]</span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">263</span>]: cat_s3.cat.remove_unused_categories()</span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">263</span>]: </span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    a</span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    b</span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    a</span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    b</span>
<span id="cb117-18"><a href="#cb117-18" aria-hidden="true" tabindex="-1"></a>dtype: category</span>
<span id="cb117-19"><a href="#cb117-19" aria-hidden="true" tabindex="-1"></a>Categories (<span class="dv">2</span>, <span class="bu">object</span>): [<span class="st">'a'</span>, <span class="st">'b'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>See <a href="#tbl-table_categorical_methods">Table&nbsp;<span>7.7</span></a> for a listing of available categorical methods.</p>
<div id="tbl-table_categorical_methods" class="anchored">
<table class="table">
<caption>Table&nbsp;7.7: Categorical methods for Series in pandas</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Method</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>add_categories</code></td>
<td style="text-align: left;">Append new (unused) categories at end of existing categories</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>as_ordered</code></td>
<td style="text-align: left;">Make categories ordered</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>as_unordered</code></td>
<td style="text-align: left;">Make categories unordered</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>remove_categories</code></td>
<td style="text-align: left;">Remove categories, setting any removed values to null</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>remove_unused_categories</code></td>
<td style="text-align: left;">Remove any category values that do not appear in the data</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>rename_categories</code></td>
<td style="text-align: left;">Replace categories with indicated set of new category names; cannot change the number of categories</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>reorder_categories</code></td>
<td style="text-align: left;">Behaves like <code>rename_categories</code>, but can also change the result to have ordered categories</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>set_categories</code></td>
<td style="text-align: left;">Replace the categories with the indicated set of new categories; can add or remove categories</td>
</tr>
</tbody>
</table>
</div>
<section id="pandas-categorical-dummy" class="level4">
<h4 class="anchored" data-anchor-id="pandas-categorical-dummy">Creating dummy variables for modeling</h4>
<p>When you're using statistics or machine learning tools, you'll often transform categorical data into <em>dummy variables</em>, also known as <em>one-hot</em> encoding. This involves creating a DataFrame with a column for each distinct category; these columns contain 1s for occurrences of a given category and 0 otherwise.</p>
<p>Consider the previous example:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">264</span>]: cat_s <span class="op">=</span> pd.Series([<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>] <span class="op">*</span> <span class="dv">2</span>, dtype<span class="op">=</span><span class="st">'category'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As mentioned previously in this chapter, the <code>pandas.get_dummies</code> function converts this one-dimensional categorical data into a DataFrame containing the dummy variable:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">265</span>]: pd.get_dummies(cat_s, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">265</span>]: </span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>     a    b    c    d</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="fl">1.0</span>  <span class="fl">0.0</span>  <span class="fl">0.0</span>  <span class="fl">0.0</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">0.0</span>  <span class="fl">1.0</span>  <span class="fl">0.0</span>  <span class="fl">0.0</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">0.0</span>  <span class="fl">0.0</span>  <span class="fl">1.0</span>  <span class="fl">0.0</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="fl">0.0</span>  <span class="fl">0.0</span>  <span class="fl">0.0</span>  <span class="fl">1.0</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="fl">1.0</span>  <span class="fl">0.0</span>  <span class="fl">0.0</span>  <span class="fl">0.0</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="fl">0.0</span>  <span class="fl">1.0</span>  <span class="fl">0.0</span>  <span class="fl">0.0</span></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  <span class="fl">0.0</span>  <span class="fl">0.0</span>  <span class="fl">1.0</span>  <span class="fl">0.0</span></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>  <span class="fl">0.0</span>  <span class="fl">0.0</span>  <span class="fl">0.0</span>  <span class="fl">1.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="data-preparation-conclusions" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="data-preparation-conclusions"><span class="header-section-number">7.6</span> Conclusion</h2>
<p>Effective data preparation can significantly improve productivity by enabling you to spend more time analyzing data and less time getting it ready for analysis. We have explored a number of tools in this chapter, but the coverage here is by no means comprehensive. In the next chapter, we will explore pandas's joining and grouping functionality.</p>


</section>

<script async="" defer="" src="https://scripts.simpleanalyticscdn.com/latest.js"></script></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a class='pagination-link' href='/book/accessing-data'>
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Loading, Storage, and File Formats</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a class='pagination-link' href='/book/data-wrangling'>
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data Wrangling: Join, Combine, and Reshape</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2023, Wes McKinney. All Rights Reserved.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/wesmckinn">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<script async="" src="https://media.ethicalads.io/media/client/ethicalads.min.js"></script>



</body></html>