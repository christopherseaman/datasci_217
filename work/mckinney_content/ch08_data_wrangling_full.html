<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Python for Data Analysis, 3E - 8&nbsp; Data Wrangling: Join, Combine, and Reshape</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./plotting-and-visualization.html" rel="next">
<link href="./data-cleaning.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Python for Data Analysis, 3E - 8&nbsp; Data Wrangling: Join, Combine, and Reshape">
<meta property="og:description" content="">
<meta property="og:image" content="images/cover.png">
<meta property="og:site-name" content="Python for Data Analysis, 3E">
<meta name="twitter:title" content="Python for Data Analysis, 3E - 8&nbsp; Data Wrangling: Join, Combine, and Reshape">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="images/cover.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class='navbar-brand' href='/book/'>
    <span class="navbar-title">Python for Data Analysis, 3E</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class='nav-link' href='https://wesmckinney.com/archives' rel target>
 <span class="menu-text">Wes’s Blog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/wesmckinn" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/wesm/pydata-book" rel="" target="">
 <span class="dropdown-text">Data and Notebooks (GitHub)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://gitee.com/wesmckinn/pydata-book" rel="" target="">
 <span class="dropdown-text">Data and Notebooks (Gitee)</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href='/book/preface'>Chapters</a></li><li class="breadcrumb-item"><a href='/book/data-wrangling'><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data Wrangling: Join, Combine, and Reshape</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/'>
 <span class="menu-text">About the Open Edition</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Chapters</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/preface'>
 <span class="menu-text">Preface</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/preliminaries'>
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Preliminaries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/python-basics'>
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Python Language Basics, IPython, and Jupyter Notebooks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/python-builtin'>
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Built-In Data Structures, Functions, and Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/numpy-basics'>
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">NumPy Basics: Arrays and Vectorized Computation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/pandas-basics'>
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Getting Started with pandas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/accessing-data'>
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Loading, Storage, and File Formats</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/data-cleaning'>
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Cleaning and Preparation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link active' href='/book/data-wrangling'>
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data Wrangling: Join, Combine, and Reshape</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/plotting-and-visualization'>
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Plotting and Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/data-aggregation'>
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Aggregation and Group Operations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/time-series'>
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Time Series</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/modeling'>
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to Modeling Libraries in Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/data-analysis-examples'>
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Data Analysis Examples</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/advanced-numpy'>
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Advanced NumPy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/ipython'>
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">More on the IPython System</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<a href="https://amzn.to/3DyLaJc"><img src="images/cover.png" class="img-fluid"></a>
<div data-ea-publisher="wesmckinneycom" data-ea-type="image">

</div>
</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#pandas_hierarchical" id="toc-pandas_hierarchical" class="nav-link active" data-scroll-target="#pandas_hierarchical"><span class="header-section-number">8.1</span> Hierarchical Indexing</a>
  <ul class="collapse">
  <li><a href="#pandas_hierarchical_reorder" id="toc-pandas_hierarchical_reorder" class="nav-link" data-scroll-target="#pandas_hierarchical_reorder">Reordering and Sorting Levels</a></li>
  <li><a href="#pandas_hierarchical_stats" id="toc-pandas_hierarchical_stats" class="nav-link" data-scroll-target="#pandas_hierarchical_stats">Summary Statistics by Level</a></li>
  <li><a href="#pandas_hierarchical_set_index" id="toc-pandas_hierarchical_set_index" class="nav-link" data-scroll-target="#pandas_hierarchical_set_index">Indexing with a DataFrame's columns</a></li>
  </ul></li>
  <li><a href="#prep_merge_join" id="toc-prep_merge_join" class="nav-link" data-scroll-target="#prep_merge_join"><span class="header-section-number">8.2</span> Combining and Merging Datasets</a>
  <ul class="collapse">
  <li><a href="#prep_merge_database" id="toc-prep_merge_database" class="nav-link" data-scroll-target="#prep_merge_database">Database-Style DataFrame Joins</a></li>
  <li><a href="#prep_merge_index" id="toc-prep_merge_index" class="nav-link" data-scroll-target="#prep_merge_index">Merging on Index</a></li>
  <li><a href="#prep_concat" id="toc-prep_concat" class="nav-link" data-scroll-target="#prep_concat">Concatenating Along an Axis</a></li>
  <li><a href="#combine_overlap" id="toc-combine_overlap" class="nav-link" data-scroll-target="#combine_overlap">Combining Data with Overlap</a></li>
  </ul></li>
  <li><a href="#prep_reshape" id="toc-prep_reshape" class="nav-link" data-scroll-target="#prep_reshape"><span class="header-section-number">8.3</span> Reshaping and Pivoting</a>
  <ul class="collapse">
  <li><a href="#prep_reshape_hier" id="toc-prep_reshape_hier" class="nav-link" data-scroll-target="#prep_reshape_hier">Reshaping with Hierarchical Indexing</a></li>
  <li><a href="#prep_reshape_pivot" id="toc-prep_reshape_pivot" class="nav-link" data-scroll-target="#prep_reshape_pivot">Pivoting “Long” to “Wide” Format</a></li>
  <li><a href="#prep_reshape_melt" id="toc-prep_reshape_melt" class="nav-link" data-scroll-target="#prep_reshape_melt">Pivoting “Wide” to “Long” Format</a></li>
  </ul></li>
  <li><a href="#wrangling-conclusion" id="toc-wrangling-conclusion" class="nav-link" data-scroll-target="#wrangling-conclusion"><span class="header-section-number">8.4</span> Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="wrangling" class="quarto-section-identifier"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data Wrangling: Join, Combine, and Reshape</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>This Open Access web version of <em>Python for Data Analysis 3rd Edition</em> is now available as a companion to the <a href="https://amzn.to/3DyLaJc">print and digital editions</a>. If you encounter any errata, <a href="https://oreilly.com/catalog/0636920519829/errata">please report them here</a>. Please note that some aspects of this site as produced by Quarto will differ from the formatting of the print and eBook versions from O’Reilly.</p>
<p>If you find the online edition of the book useful, please consider <a href="https://amzn.to/3DyLaJc">ordering a paper copy</a> or a <a href="https://www.ebooks.com/en-us/book/210644288/python-for-data-analysis/wes-mckinney/?affId=WES398681F">DRM-free eBook</a> to support the author. The content from this website may not be copied or reproduced. The code examples are MIT licensed and can be found on GitHub or Gitee.</p>
</div>
</div>
</div>
<p>In many applications, data may be spread across a number of files or databases, or be arranged in a form that is not convenient to analyze. This chapter focuses on tools to help combine, join, and rearrange data.</p>
<p>First, I introduce the concept of <em>hierarchical indexing</em> in pandas, which is used extensively in some of these operations. I then dig into the particular data manipulations. You can see various applied usages of these tools in <a href="#data-analysis-examples">Ch 13: Data Analysis Examples</a>.</p>
<section id="pandas_hierarchical" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="pandas_hierarchical"><span class="header-section-number">8.1</span> Hierarchical Indexing</h2>
<p><em>Hierarchical indexing</em> is an important feature of pandas that enables you to have multiple (two or more) index <em>levels</em> on an axis. Another way of thinking about it is that it provides a way for you to work with higher dimensional data in a lower dimensional form. Let’s start with a simple example: create a Series with a list of lists (or arrays) as the index:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">11</span>]: data <span class="op">=</span> pd.Series(np.random.uniform(size<span class="op">=</span><span class="dv">9</span>),</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>   ....:                  index<span class="op">=</span>[[<span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"d"</span>],</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>   ....:                         [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>]])</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">12</span>]: data</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">12</span>]: </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>a  <span class="dv">1</span>    <span class="fl">0.929616</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>   <span class="dv">2</span>    <span class="fl">0.316376</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>   <span class="dv">3</span>    <span class="fl">0.183919</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>b  <span class="dv">1</span>    <span class="fl">0.204560</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>   <span class="dv">3</span>    <span class="fl">0.567725</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>c  <span class="dv">1</span>    <span class="fl">0.595545</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>   <span class="dv">2</span>    <span class="fl">0.964515</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>d  <span class="dv">2</span>    <span class="fl">0.653177</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>   <span class="dv">3</span>    <span class="fl">0.748907</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>What you’re seeing is a prettified view of a Series with a <code>MultiIndex</code> as its index. The “gaps” in the index display mean “use the label directly above”:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">13</span>]: data.index</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">13</span>]: </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>MultiIndex([(<span class="st">'a'</span>, <span class="dv">1</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'a'</span>, <span class="dv">2</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'a'</span>, <span class="dv">3</span>),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'b'</span>, <span class="dv">1</span>),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'b'</span>, <span class="dv">3</span>),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'c'</span>, <span class="dv">1</span>),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'c'</span>, <span class="dv">2</span>),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'d'</span>, <span class="dv">2</span>),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>            (<span class="st">'d'</span>, <span class="dv">3</span>)],</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>           )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With a hierarchically indexed object, so-called <em>partial</em> indexing is possible, enabling you to concisely select subsets of the data:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">14</span>]: data[<span class="st">"b"</span>]</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">14</span>]: </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="fl">0.204560</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="fl">0.567725</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>dtype: float64</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">15</span>]: data[<span class="st">"b"</span>:<span class="st">"c"</span>]</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">15</span>]: </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>b  <span class="dv">1</span>    <span class="fl">0.204560</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>   <span class="dv">3</span>    <span class="fl">0.567725</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>c  <span class="dv">1</span>    <span class="fl">0.595545</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>   <span class="dv">2</span>    <span class="fl">0.964515</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>dtype: float64</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">16</span>]: data.loc[[<span class="st">"b"</span>, <span class="st">"d"</span>]]</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">16</span>]: </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>b  <span class="dv">1</span>    <span class="fl">0.204560</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>   <span class="dv">3</span>    <span class="fl">0.567725</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>d  <span class="dv">2</span>    <span class="fl">0.653177</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>   <span class="dv">3</span>    <span class="fl">0.748907</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Selection is even possible from an “inner” level. Here I select all of the values having the value <code>2</code> from the second index level:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">17</span>]: data.loc[:, <span class="dv">2</span>]</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">17</span>]: </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>a    <span class="fl">0.316376</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>c    <span class="fl">0.964515</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>d    <span class="fl">0.653177</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Hierarchical indexing plays an important role in reshaping data and in group-based operations like forming a pivot table. For example, you can rearrange this data into a DataFrame using its <code>unstack</code> method:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">18</span>]: data.unstack()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">18</span>]: </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>          <span class="dv">1</span>         <span class="dv">2</span>         <span class="dv">3</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>a  <span class="fl">0.929616</span>  <span class="fl">0.316376</span>  <span class="fl">0.183919</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>b  <span class="fl">0.204560</span>       NaN  <span class="fl">0.567725</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>c  <span class="fl">0.595545</span>  <span class="fl">0.964515</span>       NaN</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>d       NaN  <span class="fl">0.653177</span>  <span class="fl">0.748907</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The inverse operation of <code>unstack</code> is <code>stack</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">19</span>]: data.unstack().stack()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">19</span>]: </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>a  <span class="dv">1</span>    <span class="fl">0.929616</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>   <span class="dv">2</span>    <span class="fl">0.316376</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>   <span class="dv">3</span>    <span class="fl">0.183919</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>b  <span class="dv">1</span>    <span class="fl">0.204560</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>   <span class="dv">3</span>    <span class="fl">0.567725</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>c  <span class="dv">1</span>    <span class="fl">0.595545</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>   <span class="dv">2</span>    <span class="fl">0.964515</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>d  <span class="dv">2</span>    <span class="fl">0.653177</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>   <span class="dv">3</span>    <span class="fl">0.748907</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>stack</code> and <code>unstack</code> will be explored in more detail later in <a href="#prep_reshape">Reshaping and Pivoting</a>.</p>
<p>With a DataFrame, either axis can have a hierarchical index:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">20</span>]: frame <span class="op">=</span> pd.DataFrame(np.arange(<span class="dv">12</span>).reshape((<span class="dv">4</span>, <span class="dv">3</span>)),</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>   ....:                      index<span class="op">=</span>[[<span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>]],</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>   ....:                      columns<span class="op">=</span>[[<span class="st">"Ohio"</span>, <span class="st">"Ohio"</span>, <span class="st">"Colorado"</span>],</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>   ....:                               [<span class="st">"Green"</span>, <span class="st">"Red"</span>, <span class="st">"Green"</span>]])</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">21</span>]: frame</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">21</span>]: </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>     Ohio     Colorado</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    Green Red    Green</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>a <span class="dv">1</span>     <span class="dv">0</span>   <span class="dv">1</span>        <span class="dv">2</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>     <span class="dv">3</span>   <span class="dv">4</span>        <span class="dv">5</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>b <span class="dv">1</span>     <span class="dv">6</span>   <span class="dv">7</span>        <span class="dv">8</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>     <span class="dv">9</span>  <span class="dv">10</span>       <span class="dv">11</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The hierarchical levels can have names (as strings or any Python objects). If so, these will show up in the console output:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">22</span>]: frame.index.names <span class="op">=</span> [<span class="st">"key1"</span>, <span class="st">"key2"</span>]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">23</span>]: frame.columns.names <span class="op">=</span> [<span class="st">"state"</span>, <span class="st">"color"</span>]</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">24</span>]: frame</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">24</span>]: </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>state      Ohio     Colorado</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>color     Green Red    Green</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>key1 key2                   </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">1</span>        <span class="dv">0</span>   <span class="dv">1</span>        <span class="dv">2</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>     <span class="dv">2</span>        <span class="dv">3</span>   <span class="dv">4</span>        <span class="dv">5</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">1</span>        <span class="dv">6</span>   <span class="dv">7</span>        <span class="dv">8</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>     <span class="dv">2</span>        <span class="dv">9</span>  <span class="dv">10</span>       <span class="dv">11</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These names supersede the <code>name</code> attribute, which is used only with single-level indexes.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Be careful to note that the index names <code>"state"</code> and <code>"color"</code> are not part of the row labels (the <code>frame.index</code> values).</p>
</div>
</div>
<p>You can see how many levels an index has by accessing its <code>nlevels</code> attribute:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">25</span>]: frame.index.nlevels</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">25</span>]: <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With partial column indexing you can similarly select groups of columns:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">26</span>]: frame[<span class="st">"Ohio"</span>]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">26</span>]: </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>color      Green  Red</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>key1 key2            </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">1</span>         <span class="dv">0</span>    <span class="dv">1</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>     <span class="dv">2</span>         <span class="dv">3</span>    <span class="dv">4</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">1</span>         <span class="dv">6</span>    <span class="dv">7</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>     <span class="dv">2</span>         <span class="dv">9</span>   <span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A <code>MultiIndex</code> can be created by itself and then reused; the columns in the preceding DataFrame with level names could also be created like this:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>pd.MultiIndex.from_arrays([[<span class="st">"Ohio"</span>, <span class="st">"Ohio"</span>, <span class="st">"Colorado"</span>],</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                          [<span class="st">"Green"</span>, <span class="st">"Red"</span>, <span class="st">"Green"</span>]],</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                          names<span class="op">=</span>[<span class="st">"state"</span>, <span class="st">"color"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="pandas_hierarchical_reorder" class="level3">
<h3 class="anchored" data-anchor-id="pandas_hierarchical_reorder">Reordering and Sorting Levels</h3>
<p>At times you may need to rearrange the order of the levels on an axis or sort the data by the values in one specific level. The <code>swaplevel</code> method takes two level numbers or names and returns a new object with the levels interchanged (but the data is otherwise unaltered):</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">27</span>]: frame.swaplevel(<span class="st">"key1"</span>, <span class="st">"key2"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">27</span>]: </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>state      Ohio     Colorado</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>color     Green Red    Green</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>key2 key1                   </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    a        <span class="dv">0</span>   <span class="dv">1</span>        <span class="dv">2</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    a        <span class="dv">3</span>   <span class="dv">4</span>        <span class="dv">5</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    b        <span class="dv">6</span>   <span class="dv">7</span>        <span class="dv">8</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    b        <span class="dv">9</span>  <span class="dv">10</span>       <span class="dv">11</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>sort_index</code> by default sorts the data lexicographically using all the index levels, but you can choose to use only a single level or a subset of levels to sort by passing the <code>level</code> argument. For example:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">28</span>]: frame.sort_index(level<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">28</span>]: </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>state      Ohio     Colorado</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>color     Green Red    Green</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>key1 key2                   </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">1</span>        <span class="dv">0</span>   <span class="dv">1</span>        <span class="dv">2</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">1</span>        <span class="dv">6</span>   <span class="dv">7</span>        <span class="dv">8</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">2</span>        <span class="dv">3</span>   <span class="dv">4</span>        <span class="dv">5</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">2</span>        <span class="dv">9</span>  <span class="dv">10</span>       <span class="dv">11</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">29</span>]: frame.swaplevel(<span class="dv">0</span>, <span class="dv">1</span>).sort_index(level<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">29</span>]: </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>state      Ohio     Colorado</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>color     Green Red    Green</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>key2 key1                   </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    a        <span class="dv">0</span>   <span class="dv">1</span>        <span class="dv">2</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>     b        <span class="dv">6</span>   <span class="dv">7</span>        <span class="dv">8</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    a        <span class="dv">3</span>   <span class="dv">4</span>        <span class="dv">5</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>     b        <span class="dv">9</span>  <span class="dv">10</span>       <span class="dv">11</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Data selection performance is much better on hierarchically indexed objects if the index is lexicographically sorted starting with the outermost level—that is, the result of calling <code>sort_index(level=0)</code> or <code>sort_index()</code>.</p>
</div>
</div>
</section>
<section id="pandas_hierarchical_stats" class="level3">
<h3 class="anchored" data-anchor-id="pandas_hierarchical_stats">Summary Statistics by Level</h3>
<p>Many descriptive and summary statistics on DataFrame and Series have a <code>level</code> option in which you can specify the level you want to aggregate by on a particular axis. Consider the above DataFrame; we can aggregate by level on either the rows or columns, like so:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">30</span>]: frame.groupby(level<span class="op">=</span><span class="st">"key2"</span>).<span class="bu">sum</span>()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">30</span>]: </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>state  Ohio     Colorado</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>color Green Red    Green</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>key2                    </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>         <span class="dv">6</span>   <span class="dv">8</span>       <span class="dv">10</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>        <span class="dv">12</span>  <span class="dv">14</span>       <span class="dv">16</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">31</span>]: frame.groupby(level<span class="op">=</span><span class="st">"color"</span>, axis<span class="op">=</span><span class="st">"columns"</span>).<span class="bu">sum</span>()</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">31</span>]: </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>color      Green  Red</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>key1 key2            </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">1</span>         <span class="dv">2</span>    <span class="dv">1</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>     <span class="dv">2</span>         <span class="dv">8</span>    <span class="dv">4</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">1</span>        <span class="dv">14</span>    <span class="dv">7</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>     <span class="dv">2</span>        <span class="dv">20</span>   <span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We will discuss <code>groupby</code> in much more detail later in <a href='/book/data-aggregation'>Ch 10: Data Aggregation and Group Operations</a>.</p>
</section>
<section id="pandas_hierarchical_set_index" class="level3">
<h3 class="anchored" data-anchor-id="pandas_hierarchical_set_index">Indexing with a DataFrame's columns</h3>
<p>It’s not unusual to want to use one or more columns from a DataFrame as the row index; alternatively, you may wish to move the row index into the DataFrame’s columns. Here’s an example DataFrame:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">32</span>]: frame <span class="op">=</span> pd.DataFrame({<span class="st">"a"</span>: <span class="bu">range</span>(<span class="dv">7</span>), <span class="st">"b"</span>: <span class="bu">range</span>(<span class="dv">7</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>),</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>   ....:                       <span class="st">"c"</span>: [<span class="st">"one"</span>, <span class="st">"one"</span>, <span class="st">"one"</span>, <span class="st">"two"</span>, <span class="st">"two"</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>   ....:                             <span class="st">"two"</span>, <span class="st">"two"</span>],</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>   ....:                       <span class="st">"d"</span>: [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]})</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">33</span>]: frame</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">33</span>]: </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>   a  b    c  d</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="dv">0</span>  <span class="dv">7</span>  one  <span class="dv">0</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">1</span>  <span class="dv">6</span>  one  <span class="dv">1</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="dv">2</span>  <span class="dv">5</span>  one  <span class="dv">2</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="dv">3</span>  <span class="dv">4</span>  two  <span class="dv">0</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="dv">4</span>  <span class="dv">3</span>  two  <span class="dv">1</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="dv">5</span>  <span class="dv">2</span>  two  <span class="dv">2</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  <span class="dv">6</span>  <span class="dv">1</span>  two  <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>DataFrame’s <code>set_index</code> function will create a new DataFrame using one or more of its columns as the index:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">34</span>]: frame2 <span class="op">=</span> frame.set_index([<span class="st">"c"</span>, <span class="st">"d"</span>])</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">35</span>]: frame2</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">35</span>]: </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>       a  b</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>c   d      </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>one <span class="dv">0</span>  <span class="dv">0</span>  <span class="dv">7</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>  <span class="dv">1</span>  <span class="dv">6</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>  <span class="dv">2</span>  <span class="dv">5</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>two <span class="dv">0</span>  <span class="dv">3</span>  <span class="dv">4</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>  <span class="dv">4</span>  <span class="dv">3</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>  <span class="dv">5</span>  <span class="dv">2</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>  <span class="dv">6</span>  <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By default, the columns are removed from the DataFrame, though you can leave them in by passing <code>drop=False</code> to <code>set_index</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">36</span>]: frame.set_index([<span class="st">"c"</span>, <span class="st">"d"</span>], drop<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">36</span>]: </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>       a  b    c  d</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>c   d              </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>one <span class="dv">0</span>  <span class="dv">0</span>  <span class="dv">7</span>  one  <span class="dv">0</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>  <span class="dv">1</span>  <span class="dv">6</span>  one  <span class="dv">1</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>  <span class="dv">2</span>  <span class="dv">5</span>  one  <span class="dv">2</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>two <span class="dv">0</span>  <span class="dv">3</span>  <span class="dv">4</span>  two  <span class="dv">0</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>  <span class="dv">4</span>  <span class="dv">3</span>  two  <span class="dv">1</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>  <span class="dv">5</span>  <span class="dv">2</span>  two  <span class="dv">2</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>  <span class="dv">6</span>  <span class="dv">1</span>  two  <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>reset_index</code>, on the other hand, does the opposite of <code>set_index</code>; the hierarchical index levels are moved into the columns:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">37</span>]: frame2.reset_index()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">37</span>]: </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>     c  d  a  b</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  one  <span class="dv">0</span>  <span class="dv">0</span>  <span class="dv">7</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  one  <span class="dv">1</span>  <span class="dv">1</span>  <span class="dv">6</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  one  <span class="dv">2</span>  <span class="dv">2</span>  <span class="dv">5</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  two  <span class="dv">0</span>  <span class="dv">3</span>  <span class="dv">4</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  two  <span class="dv">1</span>  <span class="dv">4</span>  <span class="dv">3</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  two  <span class="dv">2</span>  <span class="dv">5</span>  <span class="dv">2</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  two  <span class="dv">3</span>  <span class="dv">6</span>  <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="prep_merge_join" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="prep_merge_join"><span class="header-section-number">8.2</span> Combining and Merging Datasets</h2>
<p>Data contained in pandas objects can be combined in a number of ways:</p>
<dl>
<dt><code>pandas.merge</code></dt>
<dd>
<p>Connect rows in DataFrames based on one or more keys. This will be familiar to users of SQL or other relational databases, as it implements database <em>join</em> operations.</p>
</dd>
<dt><code>pandas.concat</code></dt>
<dd>
<p>Concatenate or "stack" objects together along an axis.</p>
</dd>
<dt><code>combine_first</code></dt>
<dd>
<p>Splice together overlapping data to fill in missing values in one object with values from another.</p>
</dd>
</dl>
<p>I will address each of these and give a number of examples. They’ll be utilized in examples throughout the rest of the book.</p>
<section id="prep_merge_database" class="level3">
<h3 class="anchored" data-anchor-id="prep_merge_database">Database-Style DataFrame Joins</h3>
<p><em>Merge</em> or <em>join</em> operations combine datasets by linking rows using one or more <em>keys</em>. These operations are particularly important in relational databases (e.g., SQL-based). The <code>pandas.merge</code> function in pandas is the main entry point for using these algorithms on your data.</p>
<p>Let’s start with a simple example:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">38</span>]: df1 <span class="op">=</span> pd.DataFrame({<span class="st">"key"</span>: [<span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>],</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>   ....:                     <span class="st">"data1"</span>: pd.Series(<span class="bu">range</span>(<span class="dv">7</span>), dtype<span class="op">=</span><span class="st">"Int64"</span>)})</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">39</span>]: df2 <span class="op">=</span> pd.DataFrame({<span class="st">"key"</span>: [<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"d"</span>],</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>   ....:                     <span class="st">"data2"</span>: pd.Series(<span class="bu">range</span>(<span class="dv">3</span>), dtype<span class="op">=</span><span class="st">"Int64"</span>)})</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">40</span>]: df1</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">40</span>]: </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  key  data1</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   b      <span class="dv">0</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   b      <span class="dv">1</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   a      <span class="dv">2</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   c      <span class="dv">3</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   a      <span class="dv">4</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>   a      <span class="dv">5</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>   b      <span class="dv">6</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">41</span>]: df2</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">41</span>]: </span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  key  data2</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   a      <span class="dv">0</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   b      <span class="dv">1</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   d      <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here I am using pandas's <code>Int64</code> extension type for nullable integers, discussed in <a href='/book/data-cleaning#pandas-ext-types'>Ch 7.3: Extension Data Types</a>.</p>
<p>This is an example of a <em>many-to-one</em> join; the data in <code>df1</code> has multiple rows labeled <code>a</code> and <code>b</code>, whereas <code>df2</code> has only one row for each value in the <code>key</code> column. Calling <code>pandas.merge</code> with these objects, we obtain:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">42</span>]: pd.merge(df1, df2)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">42</span>]: </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  key  data1  data2</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   b      <span class="dv">0</span>      <span class="dv">1</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   b      <span class="dv">1</span>      <span class="dv">1</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   b      <span class="dv">6</span>      <span class="dv">1</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   a      <span class="dv">2</span>      <span class="dv">0</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   a      <span class="dv">4</span>      <span class="dv">0</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>   a      <span class="dv">5</span>      <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that I didn’t specify which column to join on. If that information is not specified, <code>pandas.merge</code> uses the overlapping column names as the keys. It’s a good practice to specify explicitly, though:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">43</span>]: pd.merge(df1, df2, on<span class="op">=</span><span class="st">"key"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">43</span>]: </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  key  data1  data2</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   b      <span class="dv">0</span>      <span class="dv">1</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   b      <span class="dv">1</span>      <span class="dv">1</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   b      <span class="dv">6</span>      <span class="dv">1</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   a      <span class="dv">2</span>      <span class="dv">0</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   a      <span class="dv">4</span>      <span class="dv">0</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>   a      <span class="dv">5</span>      <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In general, the order of column output in <code>pandas.merge</code> operations is unspecified.</p>
<p>If the column names are different in each object, you can specify them separately:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">44</span>]: df3 <span class="op">=</span> pd.DataFrame({<span class="st">"lkey"</span>: [<span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>],</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>   ....:                     <span class="st">"data1"</span>: pd.Series(<span class="bu">range</span>(<span class="dv">7</span>), dtype<span class="op">=</span><span class="st">"Int64"</span>)})</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">45</span>]: df4 <span class="op">=</span> pd.DataFrame({<span class="st">"rkey"</span>: [<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"d"</span>],</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>   ....:                     <span class="st">"data2"</span>: pd.Series(<span class="bu">range</span>(<span class="dv">3</span>), dtype<span class="op">=</span><span class="st">"Int64"</span>)})</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">46</span>]: pd.merge(df3, df4, left_on<span class="op">=</span><span class="st">"lkey"</span>, right_on<span class="op">=</span><span class="st">"rkey"</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">46</span>]: </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  lkey  data1 rkey  data2</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    b      <span class="dv">0</span>    b      <span class="dv">1</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    b      <span class="dv">1</span>    b      <span class="dv">1</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    b      <span class="dv">6</span>    b      <span class="dv">1</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    a      <span class="dv">2</span>    a      <span class="dv">0</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    a      <span class="dv">4</span>    a      <span class="dv">0</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    a      <span class="dv">5</span>    a      <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You may notice that the <code>"c"</code> and <code>"d"</code> values and associated data are missing from the result. By default, <code>pandas.merge</code> does an <code>"inner"</code> join; the keys in the result are the intersection, or the common set found in both tables. Other possible options are <code>"left"</code>, <code>"right"</code>, and <code>"outer"</code>. The outer join takes the union of the keys, combining the effect of applying both left and right joins:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">47</span>]: pd.merge(df1, df2, how<span class="op">=</span><span class="st">"outer"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">47</span>]: </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  key  data1  data2</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   b      <span class="dv">0</span>      <span class="dv">1</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   b      <span class="dv">1</span>      <span class="dv">1</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   b      <span class="dv">6</span>      <span class="dv">1</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   a      <span class="dv">2</span>      <span class="dv">0</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   a      <span class="dv">4</span>      <span class="dv">0</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>   a      <span class="dv">5</span>      <span class="dv">0</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>   c      <span class="dv">3</span>   <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>   d   <span class="op">&lt;</span>NA<span class="op">&gt;</span>      <span class="dv">2</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">48</span>]: pd.merge(df3, df4, left_on<span class="op">=</span><span class="st">"lkey"</span>, right_on<span class="op">=</span><span class="st">"rkey"</span>, how<span class="op">=</span><span class="st">"outer"</span>)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">48</span>]: </span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  lkey  data1 rkey  data2</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    b      <span class="dv">0</span>    b      <span class="dv">1</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    b      <span class="dv">1</span>    b      <span class="dv">1</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    b      <span class="dv">6</span>    b      <span class="dv">1</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    a      <span class="dv">2</span>    a      <span class="dv">0</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    a      <span class="dv">4</span>    a      <span class="dv">0</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    a      <span class="dv">5</span>    a      <span class="dv">0</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>    c      <span class="dv">3</span>  NaN   <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>  NaN   <span class="op">&lt;</span>NA<span class="op">&gt;</span>    d      <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In an outer join, rows from the left or right DataFrame objects that do not match on keys in the other DataFrame will appear with NA values in the other DataFrame's columns for the nonmatching rows.</p>
<p>See <a href="#tbl-table_merge_how_behavior">Table&nbsp;<span>8.1</span></a> for a summary of the options for <code>how</code>.</p>
<div id="tbl-table_merge_how_behavior" class="anchored">
<table class="table">
<caption>Table&nbsp;8.1: Different join types with the <code>how</code> argument</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Option</th>
<th style="text-align: left;">Behavior</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>how="inner"</code></td>
<td style="text-align: left;">Use only the key combinations observed in both tables</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>how="left"</code></td>
<td style="text-align: left;">Use all key combinations found in the left table</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>how="right"</code></td>
<td style="text-align: left;">Use all key combinations found in the right table</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>how="outer"</code></td>
<td style="text-align: left;">Use all key combinations observed in both tables together</td>
</tr>
</tbody>
</table>
</div>
<p><em>Many-to-many</em> merges form the Cartesian product of the matching keys. Here’s an example:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">49</span>]: df1 <span class="op">=</span> pd.DataFrame({<span class="st">"key"</span>: [<span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>],</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>   ....:                     <span class="st">"data1"</span>: pd.Series(<span class="bu">range</span>(<span class="dv">6</span>), dtype<span class="op">=</span><span class="st">"Int64"</span>)})</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">50</span>]: df2 <span class="op">=</span> pd.DataFrame({<span class="st">"key"</span>: [<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"d"</span>],</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>   ....:                     <span class="st">"data2"</span>: pd.Series(<span class="bu">range</span>(<span class="dv">5</span>), dtype<span class="op">=</span><span class="st">"Int64"</span>)})</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">51</span>]: df1</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">51</span>]: </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  key  data1</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   b      <span class="dv">0</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   b      <span class="dv">1</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   a      <span class="dv">2</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   c      <span class="dv">3</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   a      <span class="dv">4</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>   b      <span class="dv">5</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">52</span>]: df2</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">52</span>]: </span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  key  data2</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   a      <span class="dv">0</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   b      <span class="dv">1</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   a      <span class="dv">2</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   b      <span class="dv">3</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   d      <span class="dv">4</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">53</span>]: pd.merge(df1, df2, on<span class="op">=</span><span class="st">"key"</span>, how<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">53</span>]: </span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>   key  data1  data2</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    b      <span class="dv">0</span>      <span class="dv">1</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    b      <span class="dv">0</span>      <span class="dv">3</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    b      <span class="dv">1</span>      <span class="dv">1</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    b      <span class="dv">1</span>      <span class="dv">3</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    a      <span class="dv">2</span>      <span class="dv">0</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    a      <span class="dv">2</span>      <span class="dv">2</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>    c      <span class="dv">3</span>   <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>    a      <span class="dv">4</span>      <span class="dv">0</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>    a      <span class="dv">4</span>      <span class="dv">2</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>    b      <span class="dv">5</span>      <span class="dv">1</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>   b      <span class="dv">5</span>      <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Since there were three <code>"b"</code> rows in the left DataFrame and two in the right one, there are six <code>"b"</code> rows in the result. The join method passed to the <code>how</code> keyword argument affects only the distinct key values appearing in the result:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">54</span>]: pd.merge(df1, df2, how<span class="op">=</span><span class="st">"inner"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">54</span>]: </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  key  data1  data2</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   b      <span class="dv">0</span>      <span class="dv">1</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   b      <span class="dv">0</span>      <span class="dv">3</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   b      <span class="dv">1</span>      <span class="dv">1</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   b      <span class="dv">1</span>      <span class="dv">3</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   b      <span class="dv">5</span>      <span class="dv">1</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>   b      <span class="dv">5</span>      <span class="dv">3</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>   a      <span class="dv">2</span>      <span class="dv">0</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>   a      <span class="dv">2</span>      <span class="dv">2</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>   a      <span class="dv">4</span>      <span class="dv">0</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>   a      <span class="dv">4</span>      <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To merge with multiple keys, pass a list of column names:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">55</span>]: left <span class="op">=</span> pd.DataFrame({<span class="st">"key1"</span>: [<span class="st">"foo"</span>, <span class="st">"foo"</span>, <span class="st">"bar"</span>],</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>   ....:                      <span class="st">"key2"</span>: [<span class="st">"one"</span>, <span class="st">"two"</span>, <span class="st">"one"</span>],</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>   ....:                      <span class="st">"lval"</span>: pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], dtype<span class="op">=</span><span class="st">'Int64'</span>)})</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">56</span>]: right <span class="op">=</span> pd.DataFrame({<span class="st">"key1"</span>: [<span class="st">"foo"</span>, <span class="st">"foo"</span>, <span class="st">"bar"</span>, <span class="st">"bar"</span>],</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>   ....:                       <span class="st">"key2"</span>: [<span class="st">"one"</span>, <span class="st">"one"</span>, <span class="st">"one"</span>, <span class="st">"two"</span>],</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>   ....:                       <span class="st">"rval"</span>: pd.Series([<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>], dtype<span class="op">=</span><span class="st">'Int64'</span>)})</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">57</span>]: pd.merge(left, right, on<span class="op">=</span>[<span class="st">"key1"</span>, <span class="st">"key2"</span>], how<span class="op">=</span><span class="st">"outer"</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">57</span>]: </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  key1 key2  lval  rval</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  foo  one     <span class="dv">1</span>     <span class="dv">4</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  foo  one     <span class="dv">1</span>     <span class="dv">5</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  foo  two     <span class="dv">2</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  bar  one     <span class="dv">3</span>     <span class="dv">6</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  bar  two  <span class="op">&lt;</span>NA<span class="op">&gt;</span>     <span class="dv">7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To determine which key combinations will appear in the result depending on the choice of merge method, think of the multiple keys as forming an array of tuples to be used as a single join key.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>When you're joining columns on columns, the indexes on the passed DataFrame objects are discarded. If you need to preserve the index values, you can use <code>reset_index</code> to append the index to the columns.</p>
</div>
</div>
<p>A last issue to consider in merge operations is the treatment of overlapping column names. For example:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">58</span>]: pd.merge(left, right, on<span class="op">=</span><span class="st">"key1"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">58</span>]: </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  key1 key2_x  lval key2_y  rval</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  foo    one     <span class="dv">1</span>    one     <span class="dv">4</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  foo    one     <span class="dv">1</span>    one     <span class="dv">5</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  foo    two     <span class="dv">2</span>    one     <span class="dv">4</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  foo    two     <span class="dv">2</span>    one     <span class="dv">5</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  bar    one     <span class="dv">3</span>    one     <span class="dv">6</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  bar    one     <span class="dv">3</span>    two     <span class="dv">7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>While you can address the overlap manually (see the section <a href='/book/data-cleaning#prep_renaming'>Ch 7.2.4: Renaming Axis Indexes</a> for renaming axis labels), <code>pandas.merge</code> has a <code>suffixes</code> option for specifying strings to append to overlapping names in the left and right DataFrame objects:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">59</span>]: pd.merge(left, right, on<span class="op">=</span><span class="st">"key1"</span>, suffixes<span class="op">=</span>(<span class="st">"_left"</span>, <span class="st">"_right"</span>))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">59</span>]: </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  key1 key2_left  lval key2_right  rval</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  foo       one     <span class="dv">1</span>        one     <span class="dv">4</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  foo       one     <span class="dv">1</span>        one     <span class="dv">5</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  foo       two     <span class="dv">2</span>        one     <span class="dv">4</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  foo       two     <span class="dv">2</span>        one     <span class="dv">5</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  bar       one     <span class="dv">3</span>        one     <span class="dv">6</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  bar       one     <span class="dv">3</span>        two     <span class="dv">7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>See <a href="#tbl-table_merge_function">Table&nbsp;<span>8.2</span></a> for an argument reference on <code>pandas.merge</code>. The next section covers joining using the DataFrame's row index.</p>
<div id="tbl-table_merge_function" class="anchored">
<table class="table">
<caption>Table&nbsp;8.2: <code>pandas.merge</code> function arguments</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Argument</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>left</code></td>
<td style="text-align: left;">DataFrame to be merged on the left side.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>right</code></td>
<td style="text-align: left;">DataFrame to be merged on the right side.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>how</code></td>
<td style="text-align: left;">Type of join to apply: one of <code>"inner"</code>, <code>"outer"</code>, <code>"left"</code>, or <code>"right"</code>; defaults to <code>"inner"</code>.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>on</code></td>
<td style="text-align: left;">Column names to join on. Must be found in both DataFrame objects. If not specified and no other join keys given, will use the intersection of the column names in <code>left</code> and <code>right</code> as the join keys.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>left_on</code></td>
<td style="text-align: left;">Columns in <code>left</code> DataFrame to use as join keys. Can be a single column name or a list of column names.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>right_on</code></td>
<td style="text-align: left;">Analogous to <code>left_on</code> for <code>right</code> DataFrame.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>left_index</code></td>
<td style="text-align: left;">Use row index in <code>left</code> as its join key (or keys, if a <code>MultiIndex</code>).</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>right_index</code></td>
<td style="text-align: left;">Analogous to <code>left_index</code>.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>sort</code></td>
<td style="text-align: left;">Sort merged data lexicographically by join keys; <code>False</code> by default.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>suffixes</code></td>
<td style="text-align: left;">Tuple of string values to append to column names in case of overlap; defaults to <code>("_x", "_y")</code> (e.g., if <code>"data"</code> in both DataFrame objects, would appear as <code>"data_x"</code> and <code>"data_y"</code> in result).</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>copy</code></td>
<td style="text-align: left;">If <code>False</code>, avoid copying data into resulting data structure in some exceptional cases; by default always copies.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>validate</code></td>
<td style="text-align: left;">Verifies if the merge is of the specified type, whether one-to-one, one-to-many, or many-to-many. See the docstring for full details on the options.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>indicator</code></td>
<td style="text-align: left;">Adds a special column <code>_merge</code> that indicates the source of each row; values will be <code>"left_only"</code>, <code>"right_only"</code>, or <code>"both"</code> based on the origin of the joined data in each row.</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="prep_merge_index" class="level3">
<h3 class="anchored" data-anchor-id="prep_merge_index">Merging on Index</h3>
<p>In some cases, the merge key(s) in a DataFrame will be found in its index (row labels). In this case, you can pass <code>left_index=True</code> or <code>right_index=True</code> (or both) to indicate that the index should be used as the merge key:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">60</span>]: left1 <span class="op">=</span> pd.DataFrame({<span class="st">"key"</span>: [<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>],</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>   ....:                       <span class="st">"value"</span>: pd.Series(<span class="bu">range</span>(<span class="dv">6</span>), dtype<span class="op">=</span><span class="st">"Int64"</span>)})</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">61</span>]: right1 <span class="op">=</span> pd.DataFrame({<span class="st">"group_val"</span>: [<span class="fl">3.5</span>, <span class="dv">7</span>]}, index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"b"</span>])</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">62</span>]: left1</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">62</span>]: </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  key  value</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   a      <span class="dv">0</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   b      <span class="dv">1</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   a      <span class="dv">2</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   a      <span class="dv">3</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   b      <span class="dv">4</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>   c      <span class="dv">5</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">63</span>]: right1</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">63</span>]: </span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>   group_val</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>a        <span class="fl">3.5</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>b        <span class="fl">7.0</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">64</span>]: pd.merge(left1, right1, left_on<span class="op">=</span><span class="st">"key"</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">64</span>]: </span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>  key  value  group_val</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   a      <span class="dv">0</span>        <span class="fl">3.5</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   a      <span class="dv">2</span>        <span class="fl">3.5</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   a      <span class="dv">3</span>        <span class="fl">3.5</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   b      <span class="dv">1</span>        <span class="fl">7.0</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   b      <span class="dv">4</span>        <span class="fl">7.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you look carefully here, you will see that the index values for <code>left1</code> have been preserved, whereas in other examples above, the indexes of the input DataFrame objects are dropped. Because the index of <code>right1</code> is unique, this "many-to-one" merge (with the default <code>how="inner"</code> method) can preserve the index values from <code>left1</code> that correspond to rows in the output.</p>
</div>
</div>
<p>Since the default merge method is to intersect the join keys, you can instead form the union of them with an outer join:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">65</span>]: pd.merge(left1, right1, left_on<span class="op">=</span><span class="st">"key"</span>, right_index<span class="op">=</span><span class="va">True</span>, how<span class="op">=</span><span class="st">"outer"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">65</span>]: </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  key  value  group_val</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   a      <span class="dv">0</span>        <span class="fl">3.5</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   a      <span class="dv">2</span>        <span class="fl">3.5</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   a      <span class="dv">3</span>        <span class="fl">3.5</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   b      <span class="dv">1</span>        <span class="fl">7.0</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   b      <span class="dv">4</span>        <span class="fl">7.0</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>   c      <span class="dv">5</span>        NaN</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With hierarchically indexed data, things are more complicated, as joining on index is equivalent to a multiple-key merge:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">66</span>]: lefth <span class="op">=</span> pd.DataFrame({<span class="st">"key1"</span>: [<span class="st">"Ohio"</span>, <span class="st">"Ohio"</span>, <span class="st">"Ohio"</span>,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>   ....:                                <span class="st">"Nevada"</span>, <span class="st">"Nevada"</span>],</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>   ....:                       <span class="st">"key2"</span>: [<span class="dv">2000</span>, <span class="dv">2001</span>, <span class="dv">2002</span>, <span class="dv">2001</span>, <span class="dv">2002</span>],</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>   ....:                       <span class="st">"data"</span>: pd.Series(<span class="bu">range</span>(<span class="dv">5</span>), dtype<span class="op">=</span><span class="st">"Int64"</span>)})</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">67</span>]: righth_index <span class="op">=</span> pd.MultiIndex.from_arrays(</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>   ....:     [</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>   ....:         [<span class="st">"Nevada"</span>, <span class="st">"Nevada"</span>, <span class="st">"Ohio"</span>, <span class="st">"Ohio"</span>, <span class="st">"Ohio"</span>, <span class="st">"Ohio"</span>],</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>   ....:         [<span class="dv">2001</span>, <span class="dv">2000</span>, <span class="dv">2000</span>, <span class="dv">2000</span>, <span class="dv">2001</span>, <span class="dv">2002</span>]</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>   ....:     ]</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>   ....: )</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">68</span>]: righth <span class="op">=</span> pd.DataFrame({<span class="st">"event1"</span>: pd.Series([<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">10</span>], dtype<span class="op">=</span><span class="st">"I</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="er">nt64",</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>   ....:                                            index<span class="op">=</span>righth_index),</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>   ....:                        <span class="st">"event2"</span>: pd.Series([<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">11</span>], dtype<span class="op">=</span><span class="st">"I</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="er">nt64",</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>   ....:                                            index<span class="op">=</span>righth_index)})</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">69</span>]: lefth</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">69</span>]: </span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>     key1  key2  data</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    Ohio  <span class="dv">2000</span>     <span class="dv">0</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    Ohio  <span class="dv">2001</span>     <span class="dv">1</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    Ohio  <span class="dv">2002</span>     <span class="dv">2</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  Nevada  <span class="dv">2001</span>     <span class="dv">3</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  Nevada  <span class="dv">2002</span>     <span class="dv">4</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">70</span>]: righth</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">70</span>]: </span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>             event1  event2</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>Nevada <span class="dv">2001</span>       <span class="dv">0</span>       <span class="dv">1</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>       <span class="dv">2000</span>       <span class="dv">2</span>       <span class="dv">3</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>Ohio   <span class="dv">2000</span>       <span class="dv">4</span>       <span class="dv">5</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>       <span class="dv">2000</span>       <span class="dv">6</span>       <span class="dv">7</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>       <span class="dv">2001</span>       <span class="dv">8</span>       <span class="dv">9</span></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>       <span class="dv">2002</span>      <span class="dv">10</span>      <span class="dv">11</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In this case, you have to indicate multiple columns to merge on as a list (note the handling of duplicate index values with <code>how="outer"</code>):</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">71</span>]: pd.merge(lefth, righth, left_on<span class="op">=</span>[<span class="st">"key1"</span>, <span class="st">"key2"</span>], right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">71</span>]: </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>     key1  key2  data  event1  event2</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    Ohio  <span class="dv">2000</span>     <span class="dv">0</span>       <span class="dv">4</span>       <span class="dv">5</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    Ohio  <span class="dv">2000</span>     <span class="dv">0</span>       <span class="dv">6</span>       <span class="dv">7</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    Ohio  <span class="dv">2001</span>     <span class="dv">1</span>       <span class="dv">8</span>       <span class="dv">9</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    Ohio  <span class="dv">2002</span>     <span class="dv">2</span>      <span class="dv">10</span>      <span class="dv">11</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  Nevada  <span class="dv">2001</span>     <span class="dv">3</span>       <span class="dv">0</span>       <span class="dv">1</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">72</span>]: pd.merge(lefth, righth, left_on<span class="op">=</span>[<span class="st">"key1"</span>, <span class="st">"key2"</span>],</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>   ....:          right_index<span class="op">=</span><span class="va">True</span>, how<span class="op">=</span><span class="st">"outer"</span>)</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">72</span>]: </span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>     key1  key2  data  event1  event2</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    Ohio  <span class="dv">2000</span>     <span class="dv">0</span>       <span class="dv">4</span>       <span class="dv">5</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    Ohio  <span class="dv">2000</span>     <span class="dv">0</span>       <span class="dv">6</span>       <span class="dv">7</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    Ohio  <span class="dv">2001</span>     <span class="dv">1</span>       <span class="dv">8</span>       <span class="dv">9</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    Ohio  <span class="dv">2002</span>     <span class="dv">2</span>      <span class="dv">10</span>      <span class="dv">11</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  Nevada  <span class="dv">2001</span>     <span class="dv">3</span>       <span class="dv">0</span>       <span class="dv">1</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  Nevada  <span class="dv">2002</span>     <span class="dv">4</span>    <span class="op">&lt;</span>NA<span class="op">&gt;</span>    <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  Nevada  <span class="dv">2000</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span>       <span class="dv">2</span>       <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Using the indexes of both sides of the merge is also possible:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">73</span>]: left2 <span class="op">=</span> pd.DataFrame([[<span class="fl">1.</span>, <span class="fl">2.</span>], [<span class="fl">3.</span>, <span class="fl">4.</span>], [<span class="fl">5.</span>, <span class="fl">6.</span>]],</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>   ....:                      index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"e"</span>],</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>   ....:                      columns<span class="op">=</span>[<span class="st">"Ohio"</span>, <span class="st">"Nevada"</span>]).astype(<span class="st">"Int64"</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">74</span>]: right2 <span class="op">=</span> pd.DataFrame([[<span class="fl">7.</span>, <span class="fl">8.</span>], [<span class="fl">9.</span>, <span class="fl">10.</span>], [<span class="fl">11.</span>, <span class="fl">12.</span>], [<span class="dv">13</span>, <span class="dv">14</span>]],</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>   ....:                       index<span class="op">=</span>[<span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>],</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>   ....:                       columns<span class="op">=</span>[<span class="st">"Missouri"</span>, <span class="st">"Alabama"</span>]).astype(<span class="st">"Int64"</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">75</span>]: left2</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">75</span>]: </span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>   Ohio  Nevada</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>a     <span class="dv">1</span>       <span class="dv">2</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>c     <span class="dv">3</span>       <span class="dv">4</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>e     <span class="dv">5</span>       <span class="dv">6</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">76</span>]: right2</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">76</span>]: </span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>   Missouri  Alabama</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>b         <span class="dv">7</span>        <span class="dv">8</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>c         <span class="dv">9</span>       <span class="dv">10</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>d        <span class="dv">11</span>       <span class="dv">12</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>e        <span class="dv">13</span>       <span class="dv">14</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">77</span>]: pd.merge(left2, right2, how<span class="op">=</span><span class="st">"outer"</span>, left_index<span class="op">=</span><span class="va">True</span>, right_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">77</span>]: </span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>   Ohio  Nevada  Missouri  Alabama</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>a     <span class="dv">1</span>       <span class="dv">2</span>      <span class="op">&lt;</span>NA<span class="op">&gt;</span>     <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>b  <span class="op">&lt;</span>NA<span class="op">&gt;</span>    <span class="op">&lt;</span>NA<span class="op">&gt;</span>         <span class="dv">7</span>        <span class="dv">8</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>c     <span class="dv">3</span>       <span class="dv">4</span>         <span class="dv">9</span>       <span class="dv">10</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>d  <span class="op">&lt;</span>NA<span class="op">&gt;</span>    <span class="op">&lt;</span>NA<span class="op">&gt;</span>        <span class="dv">11</span>       <span class="dv">12</span></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>e     <span class="dv">5</span>       <span class="dv">6</span>        <span class="dv">13</span>       <span class="dv">14</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>DataFrame has a <code>join</code> instance method to simplify merging by index. It can also be used to combine many DataFrame objects having the same or similar indexes but nonoverlapping columns. In the prior example, we could have written:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">78</span>]: left2.join(right2, how<span class="op">=</span><span class="st">"outer"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">78</span>]: </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>   Ohio  Nevada  Missouri  Alabama</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>a     <span class="dv">1</span>       <span class="dv">2</span>      <span class="op">&lt;</span>NA<span class="op">&gt;</span>     <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>b  <span class="op">&lt;</span>NA<span class="op">&gt;</span>    <span class="op">&lt;</span>NA<span class="op">&gt;</span>         <span class="dv">7</span>        <span class="dv">8</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>c     <span class="dv">3</span>       <span class="dv">4</span>         <span class="dv">9</span>       <span class="dv">10</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>d  <span class="op">&lt;</span>NA<span class="op">&gt;</span>    <span class="op">&lt;</span>NA<span class="op">&gt;</span>        <span class="dv">11</span>       <span class="dv">12</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>e     <span class="dv">5</span>       <span class="dv">6</span>        <span class="dv">13</span>       <span class="dv">14</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Compared with <code>pandas.merge</code>, DataFrame’s <code>join</code> method performs a left join on the join keys by default. It also supports joining the index of the passed DataFrame on one of the columns of the calling DataFrame:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">79</span>]: left1.join(right1, on<span class="op">=</span><span class="st">"key"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">79</span>]: </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  key  value  group_val</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   a      <span class="dv">0</span>        <span class="fl">3.5</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   b      <span class="dv">1</span>        <span class="fl">7.0</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   a      <span class="dv">2</span>        <span class="fl">3.5</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   a      <span class="dv">3</span>        <span class="fl">3.5</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   b      <span class="dv">4</span>        <span class="fl">7.0</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>   c      <span class="dv">5</span>        NaN</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can think of this method as joining data "into" the object whose <code>join</code> method was called.</p>
<p>Lastly, for simple index-on-index merges, you can pass a list of DataFrames to <code>join</code> as an alternative to using the more general <code>pandas.concat</code> function described in the next section:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">80</span>]: another <span class="op">=</span> pd.DataFrame([[<span class="fl">7.</span>, <span class="fl">8.</span>], [<span class="fl">9.</span>, <span class="fl">10.</span>], [<span class="fl">11.</span>, <span class="fl">12.</span>], [<span class="fl">16.</span>, <span class="fl">17.</span>]],</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>   ....:                        index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"c"</span>, <span class="st">"e"</span>, <span class="st">"f"</span>],</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>   ....:                        columns<span class="op">=</span>[<span class="st">"New York"</span>, <span class="st">"Oregon"</span>])</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">81</span>]: another</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">81</span>]: </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>   New York  Oregon</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>a       <span class="fl">7.0</span>     <span class="fl">8.0</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>c       <span class="fl">9.0</span>    <span class="fl">10.0</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>e      <span class="fl">11.0</span>    <span class="fl">12.0</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>f      <span class="fl">16.0</span>    <span class="fl">17.0</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">82</span>]: left2.join([right2, another])</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">82</span>]: </span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>   Ohio  Nevada  Missouri  Alabama  New York  Oregon</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>a     <span class="dv">1</span>       <span class="dv">2</span>      <span class="op">&lt;</span>NA<span class="op">&gt;</span>     <span class="op">&lt;</span>NA<span class="op">&gt;</span>       <span class="fl">7.0</span>     <span class="fl">8.0</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>c     <span class="dv">3</span>       <span class="dv">4</span>         <span class="dv">9</span>       <span class="dv">10</span>       <span class="fl">9.0</span>    <span class="fl">10.0</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>e     <span class="dv">5</span>       <span class="dv">6</span>        <span class="dv">13</span>       <span class="dv">14</span>      <span class="fl">11.0</span>    <span class="fl">12.0</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">83</span>]: left2.join([right2, another], how<span class="op">=</span><span class="st">"outer"</span>)</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">83</span>]: </span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>   Ohio  Nevada  Missouri  Alabama  New York  Oregon</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>a     <span class="dv">1</span>       <span class="dv">2</span>      <span class="op">&lt;</span>NA<span class="op">&gt;</span>     <span class="op">&lt;</span>NA<span class="op">&gt;</span>       <span class="fl">7.0</span>     <span class="fl">8.0</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>c     <span class="dv">3</span>       <span class="dv">4</span>         <span class="dv">9</span>       <span class="dv">10</span>       <span class="fl">9.0</span>    <span class="fl">10.0</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>e     <span class="dv">5</span>       <span class="dv">6</span>        <span class="dv">13</span>       <span class="dv">14</span>      <span class="fl">11.0</span>    <span class="fl">12.0</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>b  <span class="op">&lt;</span>NA<span class="op">&gt;</span>    <span class="op">&lt;</span>NA<span class="op">&gt;</span>         <span class="dv">7</span>        <span class="dv">8</span>       NaN     NaN</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>d  <span class="op">&lt;</span>NA<span class="op">&gt;</span>    <span class="op">&lt;</span>NA<span class="op">&gt;</span>        <span class="dv">11</span>       <span class="dv">12</span>       NaN     NaN</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>f  <span class="op">&lt;</span>NA<span class="op">&gt;</span>    <span class="op">&lt;</span>NA<span class="op">&gt;</span>      <span class="op">&lt;</span>NA<span class="op">&gt;</span>     <span class="op">&lt;</span>NA<span class="op">&gt;</span>      <span class="fl">16.0</span>    <span class="fl">17.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="prep_concat" class="level3">
<h3 class="anchored" data-anchor-id="prep_concat">Concatenating Along an Axis</h3>
<p>Another kind of data combination operation is referred to interchangeably as <em>concatenation</em> or <em>stacking</em>. NumPy's <code>concatenate</code> function can do this with NumPy arrays:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">84</span>]: arr <span class="op">=</span> np.arange(<span class="dv">12</span>).reshape((<span class="dv">3</span>, <span class="dv">4</span>))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">85</span>]: arr</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">85</span>]: </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>array([[ <span class="dv">0</span>,  <span class="dv">1</span>,  <span class="dv">2</span>,  <span class="dv">3</span>],</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>       [ <span class="dv">4</span>,  <span class="dv">5</span>,  <span class="dv">6</span>,  <span class="dv">7</span>],</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>       [ <span class="dv">8</span>,  <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>]])</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">86</span>]: np.concatenate([arr, arr], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">86</span>]: </span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>array([[ <span class="dv">0</span>,  <span class="dv">1</span>,  <span class="dv">2</span>,  <span class="dv">3</span>,  <span class="dv">0</span>,  <span class="dv">1</span>,  <span class="dv">2</span>,  <span class="dv">3</span>],</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>       [ <span class="dv">4</span>,  <span class="dv">5</span>,  <span class="dv">6</span>,  <span class="dv">7</span>,  <span class="dv">4</span>,  <span class="dv">5</span>,  <span class="dv">6</span>,  <span class="dv">7</span>],</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>       [ <span class="dv">8</span>,  <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>,  <span class="dv">8</span>,  <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In the context of pandas objects such as Series and DataFrame, having labeled axes enable you to further generalize array concatenation. In particular, you have a number of additional concerns:</p>
<ul>
<li><p>If the objects are indexed differently on the other axes, should we combine the distinct elements in these axes or use only the values in common?</p></li>
<li><p>Do the concatenated chunks of data need to be identifiable as such in the resulting object?</p></li>
<li><p>Does the "concatenation axis" contain data that needs to be preserved? In many cases, the default integer labels in a DataFrame are best discarded during concatenation.</p></li>
</ul>
<p>The <code>concat</code> function in pandas provides a consistent way to address each of these questions. I’ll give a number of examples to illustrate how it works. Suppose we have three Series with no index overlap:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">87</span>]: s1 <span class="op">=</span> pd.Series([<span class="dv">0</span>, <span class="dv">1</span>], index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"b"</span>], dtype<span class="op">=</span><span class="st">"Int64"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">88</span>]: s2 <span class="op">=</span> pd.Series([<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>], index<span class="op">=</span>[<span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>], dtype<span class="op">=</span><span class="st">"Int64"</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">89</span>]: s3 <span class="op">=</span> pd.Series([<span class="dv">5</span>, <span class="dv">6</span>], index<span class="op">=</span>[<span class="st">"f"</span>, <span class="st">"g"</span>], dtype<span class="op">=</span><span class="st">"Int64"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Calling <code>pandas.concat</code> with these objects in a list glues together the values and indexes:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">90</span>]: s1</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">90</span>]: </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">0</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">1</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>dtype: Int64</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">91</span>]: s2</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">91</span>]: </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>c    <span class="dv">2</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>d    <span class="dv">3</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>e    <span class="dv">4</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>dtype: Int64</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">92</span>]: s3</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">92</span>]: </span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>f    <span class="dv">5</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>g    <span class="dv">6</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>dtype: Int64</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">93</span>]: pd.concat([s1, s2, s3])</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">93</span>]: </span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">0</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">1</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>c    <span class="dv">2</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>d    <span class="dv">3</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>e    <span class="dv">4</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>f    <span class="dv">5</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>g    <span class="dv">6</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>dtype: Int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By default, <code>pandas.concat</code> works along <code>axis="index"</code>, producing another Series. If you pass <code>axis="columns"</code>, the result will instead be a DataFrame:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">94</span>]: pd.concat([s1, s2, s3], axis<span class="op">=</span><span class="st">"columns"</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">94</span>]: </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span>     <span class="dv">1</span>     <span class="dv">2</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>a     <span class="dv">0</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>b     <span class="dv">1</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>c  <span class="op">&lt;</span>NA<span class="op">&gt;</span>     <span class="dv">2</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>d  <span class="op">&lt;</span>NA<span class="op">&gt;</span>     <span class="dv">3</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>e  <span class="op">&lt;</span>NA<span class="op">&gt;</span>     <span class="dv">4</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>f  <span class="op">&lt;</span>NA<span class="op">&gt;</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span>     <span class="dv">5</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>g  <span class="op">&lt;</span>NA<span class="op">&gt;</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span>     <span class="dv">6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In this case there is no overlap on the other axis, which as you can see is the union (the <code>"outer"</code> join) of the indexes. You can instead intersect them by passing <code>join="inner"</code>:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">95</span>]: s4 <span class="op">=</span> pd.concat([s1, s3])</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">96</span>]: s4</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">96</span>]: </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">0</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">1</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>f    <span class="dv">5</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>g    <span class="dv">6</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>dtype: Int64</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">97</span>]: pd.concat([s1, s4], axis<span class="op">=</span><span class="st">"columns"</span>)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">97</span>]: </span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span>  <span class="dv">1</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>a     <span class="dv">0</span>  <span class="dv">0</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>b     <span class="dv">1</span>  <span class="dv">1</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>f  <span class="op">&lt;</span>NA<span class="op">&gt;</span>  <span class="dv">5</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>g  <span class="op">&lt;</span>NA<span class="op">&gt;</span>  <span class="dv">6</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">98</span>]: pd.concat([s1, s4], axis<span class="op">=</span><span class="st">"columns"</span>, join<span class="op">=</span><span class="st">"inner"</span>)</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">98</span>]: </span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>   <span class="dv">0</span>  <span class="dv">1</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>a  <span class="dv">0</span>  <span class="dv">0</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>b  <span class="dv">1</span>  <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In this last example, the <code>"f"</code> and <code>"g"</code> labels disappeared because of the <code>join="inner"</code> option.</p>
<p>A potential issue is that the concatenated pieces are not identifiable in the result. Suppose instead you wanted to create a hierarchical index on the concatenation axis. To do this, use the <code>keys</code> argument:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">99</span>]: result <span class="op">=</span> pd.concat([s1, s1, s3], keys<span class="op">=</span>[<span class="st">"one"</span>, <span class="st">"two"</span>, <span class="st">"three"</span>])</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">100</span>]: result</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">100</span>]: </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>one    a    <span class="dv">0</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>       b    <span class="dv">1</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>two    a    <span class="dv">0</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>       b    <span class="dv">1</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>three  f    <span class="dv">5</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>       g    <span class="dv">6</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>dtype: Int64</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">101</span>]: result.unstack()</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">101</span>]: </span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>          a     b     f     g</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>one       <span class="dv">0</span>     <span class="dv">1</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>two       <span class="dv">0</span>     <span class="dv">1</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>three  <span class="op">&lt;</span>NA<span class="op">&gt;</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span>     <span class="dv">5</span>     <span class="dv">6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In the case of combining Series along <code>axis="columns"</code>, the <code>keys</code> become the DataFrame column headers:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">102</span>]: pd.concat([s1, s2, s3], axis<span class="op">=</span><span class="st">"columns"</span>, keys<span class="op">=</span>[<span class="st">"one"</span>, <span class="st">"two"</span>, <span class="st">"three"</span>])</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">102</span>]: </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    one   two  three</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>a     <span class="dv">0</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span>   <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>b     <span class="dv">1</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span>   <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>c  <span class="op">&lt;</span>NA<span class="op">&gt;</span>     <span class="dv">2</span>   <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>d  <span class="op">&lt;</span>NA<span class="op">&gt;</span>     <span class="dv">3</span>   <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>e  <span class="op">&lt;</span>NA<span class="op">&gt;</span>     <span class="dv">4</span>   <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>f  <span class="op">&lt;</span>NA<span class="op">&gt;</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span>      <span class="dv">5</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>g  <span class="op">&lt;</span>NA<span class="op">&gt;</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span>      <span class="dv">6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The same logic extends to DataFrame objects:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">103</span>]: df1 <span class="op">=</span> pd.DataFrame(np.arange(<span class="dv">6</span>).reshape(<span class="dv">3</span>, <span class="dv">2</span>), index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>],</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>   .....:                    columns<span class="op">=</span>[<span class="st">"one"</span>, <span class="st">"two"</span>])</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">104</span>]: df2 <span class="op">=</span> pd.DataFrame(<span class="dv">5</span> <span class="op">+</span> np.arange(<span class="dv">4</span>).reshape(<span class="dv">2</span>, <span class="dv">2</span>), index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"c"</span>],</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>   .....:                    columns<span class="op">=</span>[<span class="st">"three"</span>, <span class="st">"four"</span>])</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">105</span>]: df1</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">105</span>]: </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>   one  two</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">0</span>    <span class="dv">1</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">2</span>    <span class="dv">3</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>c    <span class="dv">4</span>    <span class="dv">5</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">106</span>]: df2</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">106</span>]: </span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>   three  four</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>a      <span class="dv">5</span>     <span class="dv">6</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>c      <span class="dv">7</span>     <span class="dv">8</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">107</span>]: pd.concat([df1, df2], axis<span class="op">=</span><span class="st">"columns"</span>, keys<span class="op">=</span>[<span class="st">"level1"</span>, <span class="st">"level2"</span>])</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">107</span>]: </span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>  level1     level2     </span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>     one two  three four</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>a      <span class="dv">0</span>   <span class="dv">1</span>    <span class="fl">5.0</span>  <span class="fl">6.0</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>b      <span class="dv">2</span>   <span class="dv">3</span>    NaN  NaN</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>c      <span class="dv">4</span>   <span class="dv">5</span>    <span class="fl">7.0</span>  <span class="fl">8.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here the <code>keys</code> argument is used to create a hierarchical index where the first level can be used to identify each of the concatenated DataFrame objects.</p>
<p>If you pass a dictionary of objects instead of a list, the dictionary’s keys will be used for the <code>keys</code> option:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">108</span>]: pd.concat({<span class="st">"level1"</span>: df1, <span class="st">"level2"</span>: df2}, axis<span class="op">=</span><span class="st">"columns"</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">108</span>]: </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  level1     level2     </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>     one two  three four</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>a      <span class="dv">0</span>   <span class="dv">1</span>    <span class="fl">5.0</span>  <span class="fl">6.0</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>b      <span class="dv">2</span>   <span class="dv">3</span>    NaN  NaN</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>c      <span class="dv">4</span>   <span class="dv">5</span>    <span class="fl">7.0</span>  <span class="fl">8.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>There are additional arguments governing how the hierarchical index is created (see <a href="#tbl-table_concat_function">Table&nbsp;<span>8.3</span></a>). For example, we can name the created axis levels with the <code>names</code> argument:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">109</span>]: pd.concat([df1, df2], axis<span class="op">=</span><span class="st">"columns"</span>, keys<span class="op">=</span>[<span class="st">"level1"</span>, <span class="st">"level2"</span>],</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>   .....:           names<span class="op">=</span>[<span class="st">"upper"</span>, <span class="st">"lower"</span>])</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">109</span>]: </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>upper level1     level2     </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>lower    one two  three four</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>a          <span class="dv">0</span>   <span class="dv">1</span>    <span class="fl">5.0</span>  <span class="fl">6.0</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>b          <span class="dv">2</span>   <span class="dv">3</span>    NaN  NaN</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>c          <span class="dv">4</span>   <span class="dv">5</span>    <span class="fl">7.0</span>  <span class="fl">8.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A last consideration concerns DataFrames in which the row index does not contain any relevant data:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">110</span>]: df1 <span class="op">=</span> pd.DataFrame(np.random.standard_normal((<span class="dv">3</span>, <span class="dv">4</span>)),</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>   .....:                    columns<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>])</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">111</span>]: df2 <span class="op">=</span> pd.DataFrame(np.random.standard_normal((<span class="dv">2</span>, <span class="dv">3</span>)),</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>   .....:                    columns<span class="op">=</span>[<span class="st">"b"</span>, <span class="st">"d"</span>, <span class="st">"a"</span>])</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">112</span>]: df1</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">112</span>]: </span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>          a         b         c         d</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="fl">1.248804</span>  <span class="fl">0.774191</span> <span class="op">-</span><span class="fl">0.319657</span> <span class="op">-</span><span class="fl">0.624964</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">1.078814</span>  <span class="fl">0.544647</span>  <span class="fl">0.855588</span>  <span class="fl">1.343268</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="op">-</span><span class="fl">0.267175</span>  <span class="fl">1.793095</span> <span class="op">-</span><span class="fl">0.652929</span> <span class="op">-</span><span class="fl">1.886837</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">113</span>]: df2</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">113</span>]: </span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>          b         d         a</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="fl">1.059626</span>  <span class="fl">0.644448</span> <span class="op">-</span><span class="fl">0.007799</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="op">-</span><span class="fl">0.449204</span>  <span class="fl">2.448963</span>  <span class="fl">0.667226</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In this case, you can pass <code>ignore_index=True</code>, which discards the indexes from each DataFrame and concatenates the data in the columns only, assigning a new default index:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">114</span>]: pd.concat([df1, df2], ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">114</span>]: </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>          a         b         c         d</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="fl">1.248804</span>  <span class="fl">0.774191</span> <span class="op">-</span><span class="fl">0.319657</span> <span class="op">-</span><span class="fl">0.624964</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">1.078814</span>  <span class="fl">0.544647</span>  <span class="fl">0.855588</span>  <span class="fl">1.343268</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="op">-</span><span class="fl">0.267175</span>  <span class="fl">1.793095</span> <span class="op">-</span><span class="fl">0.652929</span> <span class="op">-</span><span class="fl">1.886837</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="op">-</span><span class="fl">0.007799</span>  <span class="fl">1.059626</span>       NaN  <span class="fl">0.644448</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="fl">0.667226</span> <span class="op">-</span><span class="fl">0.449204</span>       NaN  <span class="fl">2.448963</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><a href="#tbl-table_concat_function">Table&nbsp;<span>8.3</span></a> describes the <code>pandas.concat</code> function arguments.</p>
<div id="tbl-table_concat_function" class="anchored">
<table class="table">
<caption>Table&nbsp;8.3: <code>pandas.concat</code> function arguments</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Argument</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>objs</code></td>
<td style="text-align: left;">List or dictionary of pandas objects to be concatenated; this is the only required argument</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>axis</code></td>
<td style="text-align: left;">Axis to concatenate along; defaults to concatenating along rows (<code>axis="index"</code>)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>join</code></td>
<td style="text-align: left;">Either <code>"inner"</code> or <code>"outer"</code> (<code>"outer"</code> by default); whether to intersect (inner) or union (outer) indexes along the other axes</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>keys</code></td>
<td style="text-align: left;">Values to associate with objects being concatenated, forming a hierarchical index along the concatenation axis; can be a list or array of arbitrary values, an array of tuples, or a list of arrays (if multiple-level arrays passed in <code>levels</code>)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>levels</code></td>
<td style="text-align: left;">Specific indexes to use as hierarchical index level or levels if keys passed</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>names</code></td>
<td style="text-align: left;">Names for created hierarchical levels if <code>keys</code> and/or <code>levels</code> passed</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>verify_integrity</code></td>
<td style="text-align: left;">Check new axis in concatenated object for duplicates and raise an exception if so; by default (<code>False</code>) allows duplicates</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>ignore_index</code></td>
<td style="text-align: left;">Do not preserve indexes along concatenation <code>axis</code>, instead produce a new <code>range(total_length)</code> index</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="combine_overlap" class="level3">
<h3 class="anchored" data-anchor-id="combine_overlap">Combining Data with Overlap</h3>
<p>There is another data combination situation that can’t be expressed as either a merge or concatenation operation. You may have two datasets with indexes that overlap in full or in part. As a motivating example, consider NumPy’s <code>where</code> function, which performs the array-oriented equivalent of an if-else expression:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">115</span>]: a <span class="op">=</span> pd.Series([np.nan, <span class="fl">2.5</span>, <span class="fl">0.0</span>, <span class="fl">3.5</span>, <span class="fl">4.5</span>, np.nan],</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>   .....:               index<span class="op">=</span>[<span class="st">"f"</span>, <span class="st">"e"</span>, <span class="st">"d"</span>, <span class="st">"c"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>])</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">116</span>]: b <span class="op">=</span> pd.Series([<span class="fl">0.</span>, np.nan, <span class="fl">2.</span>, np.nan, np.nan, <span class="fl">5.</span>],</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>   .....:               index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>, <span class="st">"f"</span>])</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">117</span>]: a</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">117</span>]: </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>f    NaN</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>e    <span class="fl">2.5</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>d    <span class="fl">0.0</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>c    <span class="fl">3.5</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>b    <span class="fl">4.5</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>a    NaN</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>dtype: float64</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">118</span>]: b</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">118</span>]: </span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>a    <span class="fl">0.0</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>b    NaN</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>c    <span class="fl">2.0</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>d    NaN</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>e    NaN</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>f    <span class="fl">5.0</span></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>dtype: float64</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">119</span>]: np.where(pd.isna(a), b, a)</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">119</span>]: array([<span class="fl">0.</span> , <span class="fl">2.5</span>, <span class="fl">0.</span> , <span class="fl">3.5</span>, <span class="fl">4.5</span>, <span class="fl">5.</span> ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here, whenever values in <code>a</code> are null, values from <code>b</code> are selected, otherwise the non-null values from <code>a</code> are selected. Using <code>numpy.where</code> does not check whether the index labels are aligned or not (and does not even require the objects to be the same length), so if you want to line up values by index, use the Series <code>combine_first</code> method:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">120</span>]: a.combine_first(b)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">120</span>]: </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>a    <span class="fl">0.0</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>b    <span class="fl">4.5</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>c    <span class="fl">3.5</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>d    <span class="fl">0.0</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>e    <span class="fl">2.5</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>f    <span class="fl">5.0</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With DataFrames, <code>combine_first</code> does the same thing column by column, so you can think of it as “patching” missing data in the calling object with data from the object you pass:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">121</span>]: df1 <span class="op">=</span> pd.DataFrame({<span class="st">"a"</span>: [<span class="fl">1.</span>, np.nan, <span class="fl">5.</span>, np.nan],</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>   .....:                     <span class="st">"b"</span>: [np.nan, <span class="fl">2.</span>, np.nan, <span class="fl">6.</span>],</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>   .....:                     <span class="st">"c"</span>: <span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">18</span>, <span class="dv">4</span>)})</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">122</span>]: df2 <span class="op">=</span> pd.DataFrame({<span class="st">"a"</span>: [<span class="fl">5.</span>, <span class="fl">4.</span>, np.nan, <span class="fl">3.</span>, <span class="fl">7.</span>],</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>   .....:                     <span class="st">"b"</span>: [np.nan, <span class="fl">3.</span>, <span class="fl">4.</span>, <span class="fl">6.</span>, <span class="fl">8.</span>]})</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">123</span>]: df1</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">123</span>]: </span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>     a    b   c</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="fl">1.0</span>  NaN   <span class="dv">2</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  NaN  <span class="fl">2.0</span>   <span class="dv">6</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">5.0</span>  NaN  <span class="dv">10</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  NaN  <span class="fl">6.0</span>  <span class="dv">14</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">124</span>]: df2</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">124</span>]: </span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>     a    b</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="fl">5.0</span>  NaN</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">4.0</span>  <span class="fl">3.0</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  NaN  <span class="fl">4.0</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="fl">3.0</span>  <span class="fl">6.0</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="fl">7.0</span>  <span class="fl">8.0</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">125</span>]: df1.combine_first(df2)</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">125</span>]: </span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>     a    b     c</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="fl">1.0</span>  NaN   <span class="fl">2.0</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">4.0</span>  <span class="fl">2.0</span>   <span class="fl">6.0</span></span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="fl">5.0</span>  <span class="fl">4.0</span>  <span class="fl">10.0</span></span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="fl">3.0</span>  <span class="fl">6.0</span>  <span class="fl">14.0</span></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="fl">7.0</span>  <span class="fl">8.0</span>   NaN</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The output of <code>combine_first</code> with DataFrame objects will have the union of all the column names.</p>
</section>
</section>
<section id="prep_reshape" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="prep_reshape"><span class="header-section-number">8.3</span> Reshaping and Pivoting</h2>
<p>There are a number of basic operations for rearranging tabular data. These are referred to as <em>reshape</em> or <em>pivot</em> operations.</p>
<section id="prep_reshape_hier" class="level3">
<h3 class="anchored" data-anchor-id="prep_reshape_hier">Reshaping with Hierarchical Indexing</h3>
<p>Hierarchical indexing provides a consistent way to rearrange data in a DataFrame. There are two primary actions:</p>
<dl>
<dt><code>stack</code></dt>
<dd>
<p>This “rotates” or pivots from the columns in the data to the rows.</p>
</dd>
<dt><code>unstack</code></dt>
<dd>
<p>This pivots from the rows into the columns.</p>
</dd>
</dl>
<p>I’ll illustrate these operations through a series of examples. Consider a small DataFrame with string arrays as row and column indexes:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">126</span>]: data <span class="op">=</span> pd.DataFrame(np.arange(<span class="dv">6</span>).reshape((<span class="dv">2</span>, <span class="dv">3</span>)),</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>   .....:                     index<span class="op">=</span>pd.Index([<span class="st">"Ohio"</span>, <span class="st">"Colorado"</span>], name<span class="op">=</span><span class="st">"state"</span>),</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>   .....:                     columns<span class="op">=</span>pd.Index([<span class="st">"one"</span>, <span class="st">"two"</span>, <span class="st">"three"</span>],</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>   .....:                     name<span class="op">=</span><span class="st">"number"</span>))</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">127</span>]: data</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">127</span>]: </span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>number    one  two  three</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>state                    </span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>Ohio        <span class="dv">0</span>    <span class="dv">1</span>      <span class="dv">2</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>Colorado    <span class="dv">3</span>    <span class="dv">4</span>      <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Using the <code>stack</code> method on this data pivots the columns into the rows, producing a Series:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">128</span>]: result <span class="op">=</span> data.stack()</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">129</span>]: result</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">129</span>]: </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>state     number</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>Ohio      one       <span class="dv">0</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>          two       <span class="dv">1</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>          three     <span class="dv">2</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>Colorado  one       <span class="dv">3</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>          two       <span class="dv">4</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>          three     <span class="dv">5</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>From a hierarchically indexed Series, you can rearrange the data back into a DataFrame with <code>unstack</code>:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">130</span>]: result.unstack()</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">130</span>]: </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>number    one  two  three</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>state                    </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>Ohio        <span class="dv">0</span>    <span class="dv">1</span>      <span class="dv">2</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>Colorado    <span class="dv">3</span>    <span class="dv">4</span>      <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By default, the innermost level is unstacked (same with <code>stack</code>). You can unstack a different level by passing a level number or name:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">131</span>]: result.unstack(level<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">131</span>]: </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>state   Ohio  Colorado</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>number                </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>one        <span class="dv">0</span>         <span class="dv">3</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>two        <span class="dv">1</span>         <span class="dv">4</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>three      <span class="dv">2</span>         <span class="dv">5</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">132</span>]: result.unstack(level<span class="op">=</span><span class="st">"state"</span>)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">132</span>]: </span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>state   Ohio  Colorado</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>number                </span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>one        <span class="dv">0</span>         <span class="dv">3</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>two        <span class="dv">1</span>         <span class="dv">4</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>three      <span class="dv">2</span>         <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Unstacking might introduce missing data if all of the values in the level aren’t found in each subgroup:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">133</span>]: s1 <span class="op">=</span> pd.Series([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], index<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>], dtype<span class="op">=</span><span class="st">"Int64"</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">134</span>]: s2 <span class="op">=</span> pd.Series([<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>], index<span class="op">=</span>[<span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>], dtype<span class="op">=</span><span class="st">"Int64"</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">135</span>]: data2 <span class="op">=</span> pd.concat([s1, s2], keys<span class="op">=</span>[<span class="st">"one"</span>, <span class="st">"two"</span>])</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">136</span>]: data2</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">136</span>]: </span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>one  a    <span class="dv">0</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>     b    <span class="dv">1</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>     c    <span class="dv">2</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>     d    <span class="dv">3</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>two  c    <span class="dv">4</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>     d    <span class="dv">5</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>     e    <span class="dv">6</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>dtype: Int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Stacking filters out missing data by default, so the operation is more easily invertible:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">137</span>]: data2.unstack()</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">137</span>]: </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>        a     b  c  d     e</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>one     <span class="dv">0</span>     <span class="dv">1</span>  <span class="dv">2</span>  <span class="dv">3</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>two  <span class="op">&lt;</span>NA<span class="op">&gt;</span>  <span class="op">&lt;</span>NA<span class="op">&gt;</span>  <span class="dv">4</span>  <span class="dv">5</span>     <span class="dv">6</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">138</span>]: data2.unstack().stack()</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">138</span>]: </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>one  a    <span class="dv">0</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>     b    <span class="dv">1</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>     c    <span class="dv">2</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>     d    <span class="dv">3</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>two  c    <span class="dv">4</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>     d    <span class="dv">5</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>     e    <span class="dv">6</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>dtype: Int64</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">139</span>]: data2.unstack().stack(dropna<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">139</span>]: </span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>one  a       <span class="dv">0</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>     b       <span class="dv">1</span></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>     c       <span class="dv">2</span></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>     d       <span class="dv">3</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>     e    <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>two  a    <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>     b    <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>     c       <span class="dv">4</span></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>     d       <span class="dv">5</span></span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>     e       <span class="dv">6</span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>dtype: Int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>When you unstack in a DataFrame, the level unstacked becomes the lowest level in the result:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">140</span>]: df <span class="op">=</span> pd.DataFrame({<span class="st">"left"</span>: result, <span class="st">"right"</span>: result <span class="op">+</span> <span class="dv">5</span>},</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>   .....:                   columns<span class="op">=</span>pd.Index([<span class="st">"left"</span>, <span class="st">"right"</span>], name<span class="op">=</span><span class="st">"side"</span>))</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">141</span>]: df</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">141</span>]: </span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>side             left  right</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>state    number             </span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>Ohio     one        <span class="dv">0</span>      <span class="dv">5</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>         two        <span class="dv">1</span>      <span class="dv">6</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>         three      <span class="dv">2</span>      <span class="dv">7</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>Colorado one        <span class="dv">3</span>      <span class="dv">8</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>         two        <span class="dv">4</span>      <span class="dv">9</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>         three      <span class="dv">5</span>     <span class="dv">10</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">142</span>]: df.unstack(level<span class="op">=</span><span class="st">"state"</span>)</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">142</span>]: </span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>side   left          right         </span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>state  Ohio Colorado  Ohio Colorado</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>number                             </span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>one       <span class="dv">0</span>        <span class="dv">3</span>     <span class="dv">5</span>        <span class="dv">8</span></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>two       <span class="dv">1</span>        <span class="dv">4</span>     <span class="dv">6</span>        <span class="dv">9</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>three     <span class="dv">2</span>        <span class="dv">5</span>     <span class="dv">7</span>       <span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As with <code>unstack</code>, when calling <code>stack</code> we can indicate the name of the axis to stack:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">143</span>]: df.unstack(level<span class="op">=</span><span class="st">"state"</span>).stack(level<span class="op">=</span><span class="st">"side"</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">143</span>]: </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>state         Colorado  Ohio</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>number side                 </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>one    left          <span class="dv">3</span>     <span class="dv">0</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>       right         <span class="dv">8</span>     <span class="dv">5</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>two    left          <span class="dv">4</span>     <span class="dv">1</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>       right         <span class="dv">9</span>     <span class="dv">6</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>three  left          <span class="dv">5</span>     <span class="dv">2</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>       right        <span class="dv">10</span>     <span class="dv">7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="prep_reshape_pivot" class="level3">
<h3 class="anchored" data-anchor-id="prep_reshape_pivot">Pivoting “Long” to “Wide” Format</h3>
<p>A common way to store multiple time series in databases and CSV files is what is sometimes called <em>long</em> or <em>stacked</em> format. In this format, individual values are represented by a single row in a table rather than multiple values per row.</p>
<p>Let's load some example data and do a small amount of time series wrangling and other data cleaning:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">144</span>]: data <span class="op">=</span> pd.read_csv(<span class="st">"examples/macrodata.csv"</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">145</span>]: data <span class="op">=</span> data.loc[:, [<span class="st">"year"</span>, <span class="st">"quarter"</span>, <span class="st">"realgdp"</span>, <span class="st">"infl"</span>, <span class="st">"unemp"</span>]]</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">146</span>]: data.head()</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">146</span>]: </span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>   year  quarter   realgdp  infl  unemp</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  <span class="dv">1959</span>        <span class="dv">1</span>  <span class="fl">2710.349</span>  <span class="fl">0.00</span>    <span class="fl">5.8</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">1959</span>        <span class="dv">2</span>  <span class="fl">2778.801</span>  <span class="fl">2.34</span>    <span class="fl">5.1</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="dv">1959</span>        <span class="dv">3</span>  <span class="fl">2775.488</span>  <span class="fl">2.74</span>    <span class="fl">5.3</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="dv">1959</span>        <span class="dv">4</span>  <span class="fl">2785.204</span>  <span class="fl">0.27</span>    <span class="fl">5.6</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="dv">1960</span>        <span class="dv">1</span>  <span class="fl">2847.699</span>  <span class="fl">2.31</span>    <span class="fl">5.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>First, I use <code>pandas.PeriodIndex</code> (which represents time intervals rather than points in time), discussed in more detail in <a href='/book/time-series'>Ch 11: Time Series</a>, to combine the <code>year</code> and <code>quarter</code> columns to set the index to consist of <code>datetime</code> values at the end of each quarter:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">147</span>]: periods <span class="op">=</span> pd.PeriodIndex(year<span class="op">=</span>data.pop(<span class="st">"year"</span>),</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>   .....:                          quarter<span class="op">=</span>data.pop(<span class="st">"quarter"</span>),</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>   .....:                          name<span class="op">=</span><span class="st">"date"</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">148</span>]: periods</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">148</span>]: </span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>PeriodIndex([<span class="st">'1959Q1'</span>, <span class="st">'1959Q2'</span>, <span class="st">'1959Q3'</span>, <span class="st">'1959Q4'</span>, <span class="st">'1960Q1'</span>, <span class="st">'1960Q2'</span>,</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">'1960Q3'</span>, <span class="st">'1960Q4'</span>, <span class="st">'1961Q1'</span>, <span class="st">'1961Q2'</span>,</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>             ...</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">'2007Q2'</span>, <span class="st">'2007Q3'</span>, <span class="st">'2007Q4'</span>, <span class="st">'2008Q1'</span>, <span class="st">'2008Q2'</span>, <span class="st">'2008Q3'</span>,</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">'2008Q4'</span>, <span class="st">'2009Q1'</span>, <span class="st">'2009Q2'</span>, <span class="st">'2009Q3'</span>],</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>            dtype<span class="op">=</span><span class="st">'period[Q-DEC]'</span>, name<span class="op">=</span><span class="st">'date'</span>, length<span class="op">=</span><span class="dv">203</span>)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">149</span>]: data.index <span class="op">=</span> periods.to_timestamp(<span class="st">"D"</span>)</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">150</span>]: data.head()</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">150</span>]: </span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>             realgdp  infl  unemp</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>date                             </span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2710.349</span>  <span class="fl">0.00</span>    <span class="fl">5.8</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">4</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2778.801</span>  <span class="fl">2.34</span>    <span class="fl">5.1</span></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">7</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2775.488</span>  <span class="fl">2.74</span>    <span class="fl">5.3</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2785.204</span>  <span class="fl">0.27</span>    <span class="fl">5.6</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a><span class="dv">1960</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2847.699</span>  <span class="fl">2.31</span>    <span class="fl">5.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here I used the <code>pop</code> method on the DataFrame, which returns a column while deleting it from the DataFrame at the same time.</p>
<p>Then, I select a subset of columns and give the <code>columns</code> index the name <code>"item"</code>:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">151</span>]: data <span class="op">=</span> data.reindex(columns<span class="op">=</span>[<span class="st">"realgdp"</span>, <span class="st">"infl"</span>, <span class="st">"unemp"</span>])</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">152</span>]: data.columns.name <span class="op">=</span> <span class="st">"item"</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">153</span>]: data.head()</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">153</span>]: </span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>item         realgdp  infl  unemp</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>date                             </span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2710.349</span>  <span class="fl">0.00</span>    <span class="fl">5.8</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">4</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2778.801</span>  <span class="fl">2.34</span>    <span class="fl">5.1</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">7</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2775.488</span>  <span class="fl">2.74</span>    <span class="fl">5.3</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2785.204</span>  <span class="fl">0.27</span>    <span class="fl">5.6</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="dv">1960</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2847.699</span>  <span class="fl">2.31</span>    <span class="fl">5.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Lastly, I reshape with <code>stack</code>, turn the new index levels into columns with <code>reset_index</code>, and finally give the column containing the data values the name <code>"value"</code>:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">154</span>]: long_data <span class="op">=</span> (data.stack()</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>   .....:              .reset_index()</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>   .....:              .rename(columns<span class="op">=</span>{<span class="dv">0</span>: <span class="st">"value"</span>}))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, <code>ldata</code> looks like:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">155</span>]: long_data[:<span class="dv">10</span>]</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">155</span>]: </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>        date     item     value</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> <span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  realgdp  <span class="fl">2710.349</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>     infl     <span class="fl">0.000</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>    unemp     <span class="fl">5.800</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">4</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  realgdp  <span class="fl">2778.801</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">4</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>     infl     <span class="fl">2.340</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">4</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>    unemp     <span class="fl">5.100</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> <span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">7</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  realgdp  <span class="fl">2775.488</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span> <span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">7</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>     infl     <span class="fl">2.740</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span> <span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">7</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>    unemp     <span class="fl">5.300</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span> <span class="dv">1959</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  realgdp  <span class="fl">2785.204</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In this so-called <em>long</em> format for multiple time series, each row in the table represents a single observation.</p>
<p>Data is frequently stored this way in relational SQL databases, as a fixed schema (column names and data types) allows the number of distinct values in the <code>item</code> column to change as data is added to the table. In the previous example, <code>date</code> and <code>item</code> would usually be the primary keys (in relational database parlance), offering both relational integrity and easier joins. In some cases, the data may be more difficult to work with in this format; you might prefer to have a DataFrame containing one column per distinct <code>item</code> value indexed by timestamps in the <code>date</code> column. DataFrame’s <code>pivot</code> method performs exactly this transformation:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">156</span>]: pivoted <span class="op">=</span> long_data.pivot(index<span class="op">=</span><span class="st">"date"</span>, columns<span class="op">=</span><span class="st">"item"</span>,</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>   .....:                           values<span class="op">=</span><span class="st">"value"</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">157</span>]: pivoted.head()</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">157</span>]: </span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>item        infl   realgdp  unemp</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>date                             </span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">0.00</span>  <span class="fl">2710.349</span>    <span class="fl">5.8</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">4</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2.34</span>  <span class="fl">2778.801</span>    <span class="fl">5.1</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">7</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2.74</span>  <span class="fl">2775.488</span>    <span class="fl">5.3</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">0.27</span>  <span class="fl">2785.204</span>    <span class="fl">5.6</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1960</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2.31</span>  <span class="fl">2847.699</span>    <span class="fl">5.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The first two values passed are the columns to be used, respectively, as the row and column index, then finally an optional value column to fill the DataFrame. Suppose you had two value columns that you wanted to reshape simultaneously:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">159</span>]: long_data[<span class="st">"value2"</span>] <span class="op">=</span> np.random.standard_normal(<span class="bu">len</span>(long_data))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">160</span>]: long_data[:<span class="dv">10</span>]</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">160</span>]: </span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>        date     item     value    value2</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> <span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  realgdp  <span class="fl">2710.349</span>  <span class="fl">0.802926</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>     infl     <span class="fl">0.000</span>  <span class="fl">0.575721</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>    unemp     <span class="fl">5.800</span>  <span class="fl">1.381918</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">4</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  realgdp  <span class="fl">2778.801</span>  <span class="fl">0.000992</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> <span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">4</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>     infl     <span class="fl">2.340</span> <span class="op">-</span><span class="fl">0.143492</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">4</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>    unemp     <span class="fl">5.100</span> <span class="op">-</span><span class="fl">0.206282</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span> <span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">7</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  realgdp  <span class="fl">2775.488</span> <span class="op">-</span><span class="fl">0.222392</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span> <span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">7</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>     infl     <span class="fl">2.740</span> <span class="op">-</span><span class="fl">1.682403</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span> <span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">7</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>    unemp     <span class="fl">5.300</span>  <span class="fl">1.811659</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span> <span class="dv">1959</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  realgdp  <span class="fl">2785.204</span> <span class="op">-</span><span class="fl">0.351305</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By omitting the last argument, you obtain a DataFrame with hierarchical columns:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">161</span>]: pivoted <span class="op">=</span> long_data.pivot(index<span class="op">=</span><span class="st">"date"</span>, columns<span class="op">=</span><span class="st">"item"</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">162</span>]: pivoted.head()</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">162</span>]: </span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>           value                    value2                    </span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>item        infl   realgdp unemp      infl   realgdp     unemp</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>date                                                          </span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">0.00</span>  <span class="fl">2710.349</span>   <span class="fl">5.8</span>  <span class="fl">0.575721</span>  <span class="fl">0.802926</span>  <span class="fl">1.381918</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">4</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2.34</span>  <span class="fl">2778.801</span>   <span class="fl">5.1</span> <span class="op">-</span><span class="fl">0.143492</span>  <span class="fl">0.000992</span> <span class="op">-</span><span class="fl">0.206282</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">7</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2.74</span>  <span class="fl">2775.488</span>   <span class="fl">5.3</span> <span class="op">-</span><span class="fl">1.682403</span> <span class="op">-</span><span class="fl">0.222392</span>  <span class="fl">1.811659</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">0.27</span>  <span class="fl">2785.204</span>   <span class="fl">5.6</span>  <span class="fl">0.128317</span> <span class="op">-</span><span class="fl">0.351305</span> <span class="op">-</span><span class="fl">1.313554</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1960</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2.31</span>  <span class="fl">2847.699</span>   <span class="fl">5.2</span> <span class="op">-</span><span class="fl">0.615939</span>  <span class="fl">0.498327</span>  <span class="fl">0.174072</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">163</span>]: pivoted[<span class="st">"value"</span>].head()</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">163</span>]: </span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>item        infl   realgdp  unemp</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>date                             </span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">0.00</span>  <span class="fl">2710.349</span>    <span class="fl">5.8</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">4</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2.34</span>  <span class="fl">2778.801</span>    <span class="fl">5.1</span></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">7</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2.74</span>  <span class="fl">2775.488</span>    <span class="fl">5.3</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">0.27</span>  <span class="fl">2785.204</span>    <span class="fl">5.6</span></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a><span class="dv">1960</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2.31</span>  <span class="fl">2847.699</span>    <span class="fl">5.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that <code>pivot</code> is equivalent to creating a hierarchical index using <code>set_index</code> followed by a call to <code>unstack</code>:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">164</span>]: unstacked <span class="op">=</span> long_data.set_index([<span class="st">"date"</span>, <span class="st">"item"</span>]).unstack(level<span class="op">=</span><span class="st">"item"</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">165</span>]: unstacked.head()</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">165</span>]: </span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>           value                    value2                    </span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>item        infl   realgdp unemp      infl   realgdp     unemp</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>date                                                          </span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">0.00</span>  <span class="fl">2710.349</span>   <span class="fl">5.8</span>  <span class="fl">0.575721</span>  <span class="fl">0.802926</span>  <span class="fl">1.381918</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">4</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2.34</span>  <span class="fl">2778.801</span>   <span class="fl">5.1</span> <span class="op">-</span><span class="fl">0.143492</span>  <span class="fl">0.000992</span> <span class="op">-</span><span class="fl">0.206282</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">0</span><span class="er">7</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2.74</span>  <span class="fl">2775.488</span>   <span class="fl">5.3</span> <span class="op">-</span><span class="fl">1.682403</span> <span class="op">-</span><span class="fl">0.222392</span>  <span class="fl">1.811659</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="dv">1959</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">0.27</span>  <span class="fl">2785.204</span>   <span class="fl">5.6</span>  <span class="fl">0.128317</span> <span class="op">-</span><span class="fl">0.351305</span> <span class="op">-</span><span class="fl">1.313554</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1960</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span>  <span class="fl">2.31</span>  <span class="fl">2847.699</span>   <span class="fl">5.2</span> <span class="op">-</span><span class="fl">0.615939</span>  <span class="fl">0.498327</span>  <span class="fl">0.174072</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="prep_reshape_melt" class="level3">
<h3 class="anchored" data-anchor-id="prep_reshape_melt">Pivoting “Wide” to “Long” Format</h3>
<p>An inverse operation to <code>pivot</code> for DataFrames is <code>pandas.melt</code>. Rather than transforming one column into many in a new DataFrame, it merges multiple columns into one, producing a DataFrame that is longer than the input. Let's look at an example:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">167</span>]: df <span class="op">=</span> pd.DataFrame({<span class="st">"key"</span>: [<span class="st">"foo"</span>, <span class="st">"bar"</span>, <span class="st">"baz"</span>],</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>   .....:                    <span class="st">"A"</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>],</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>   .....:                    <span class="st">"B"</span>: [<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>],</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>   .....:                    <span class="st">"C"</span>: [<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>]})</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">168</span>]: df</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">168</span>]: </span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>   key  A  B  C</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  foo  <span class="dv">1</span>  <span class="dv">4</span>  <span class="dv">7</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  bar  <span class="dv">2</span>  <span class="dv">5</span>  <span class="dv">8</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  baz  <span class="dv">3</span>  <span class="dv">6</span>  <span class="dv">9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>"key"</code> column may be a group indicator, and the other columns are data values. When using <code>pandas.melt</code>, we must indicate which columns (if any) are group indicators. Let's use <code>"key"</code> as the only group indicator here:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">169</span>]: melted <span class="op">=</span> pd.melt(df, id_vars<span class="op">=</span><span class="st">"key"</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">170</span>]: melted</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">170</span>]: </span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>   key variable  value</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  foo        A      <span class="dv">1</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  bar        A      <span class="dv">2</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  baz        A      <span class="dv">3</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  foo        B      <span class="dv">4</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  bar        B      <span class="dv">5</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  baz        B      <span class="dv">6</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  foo        C      <span class="dv">7</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>  bar        C      <span class="dv">8</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>  baz        C      <span class="dv">9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Using <code>pivot</code>, we can reshape back to the original layout:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">171</span>]: reshaped <span class="op">=</span> melted.pivot(index<span class="op">=</span><span class="st">"key"</span>, columns<span class="op">=</span><span class="st">"variable"</span>,</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>   .....:                         values<span class="op">=</span><span class="st">"value"</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">172</span>]: reshaped</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">172</span>]: </span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>variable  A  B  C</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>key              </span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>bar       <span class="dv">2</span>  <span class="dv">5</span>  <span class="dv">8</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>baz       <span class="dv">3</span>  <span class="dv">6</span>  <span class="dv">9</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>foo       <span class="dv">1</span>  <span class="dv">4</span>  <span class="dv">7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Since the result of <code>pivot</code> creates an index from the column used as the row labels, we may want to use <code>reset_index</code> to move the data back into a column:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">173</span>]: reshaped.reset_index()</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">173</span>]: </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>variable  key  A  B  C</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>         bar  <span class="dv">2</span>  <span class="dv">5</span>  <span class="dv">8</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>         baz  <span class="dv">3</span>  <span class="dv">6</span>  <span class="dv">9</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>         foo  <span class="dv">1</span>  <span class="dv">4</span>  <span class="dv">7</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can also specify a subset of columns to use as <code>value</code> columns:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">174</span>]: pd.melt(df, id_vars<span class="op">=</span><span class="st">"key"</span>, value_vars<span class="op">=</span>[<span class="st">"A"</span>, <span class="st">"B"</span>])</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">174</span>]: </span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>   key variable  value</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>  foo        A      <span class="dv">1</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  bar        A      <span class="dv">2</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  baz        A      <span class="dv">3</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  foo        B      <span class="dv">4</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  bar        B      <span class="dv">5</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  baz        B      <span class="dv">6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>pandas.melt</code> can be used without any group identifiers, too:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">175</span>]: pd.melt(df, value_vars<span class="op">=</span>[<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>])</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">175</span>]: </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  variable  value</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>        A      <span class="dv">1</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>        A      <span class="dv">2</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>        A      <span class="dv">3</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>        B      <span class="dv">4</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>        B      <span class="dv">5</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>        B      <span class="dv">6</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>        C      <span class="dv">7</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>        C      <span class="dv">8</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>        C      <span class="dv">9</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">176</span>]: pd.melt(df, value_vars<span class="op">=</span>[<span class="st">"key"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>])</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">176</span>]: </span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>  variable value</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>      key   foo</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>      key   bar</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>      key   baz</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>        A     <span class="dv">1</span></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>        A     <span class="dv">2</span></span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>        A     <span class="dv">3</span></span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>        B     <span class="dv">4</span></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>        B     <span class="dv">5</span></span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>        B     <span class="dv">6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="wrangling-conclusion" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="wrangling-conclusion"><span class="header-section-number">8.4</span> Conclusion</h2>
<p>Now that you have some pandas basics for data import, cleaning, and reorganization under your belt, we are ready to move on to data visualization with matplotlib. We will return to explore other areas of pandas later in the book when we discuss more advanced analytics.</p>


</section>

<script async="" defer="" src="https://scripts.simpleanalyticscdn.com/latest.js"></script></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a class='pagination-link' href='/book/data-cleaning'>
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Cleaning and Preparation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a class='pagination-link' href='/book/plotting-and-visualization'>
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Plotting and Visualization</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2023, Wes McKinney. All Rights Reserved.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/wesmckinn">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<script async="" src="https://media.ethicalads.io/media/client/ethicalads.min.js"></script>



</body></html>