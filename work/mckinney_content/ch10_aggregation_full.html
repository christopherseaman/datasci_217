<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Python for Data Analysis, 3E - 10&nbsp; Data Aggregation and Group Operations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./time-series.html" rel="next">
<link href="./plotting-and-visualization.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Python for Data Analysis, 3E - 10&nbsp; Data Aggregation and Group Operations">
<meta property="og:description" content="">
<meta property="og:image" content="images/cover.png">
<meta property="og:site-name" content="Python for Data Analysis, 3E">
<meta name="twitter:title" content="Python for Data Analysis, 3E - 10&nbsp; Data Aggregation and Group Operations">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="images/cover.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class='navbar-brand' href='/book/'>
    <span class="navbar-title">Python for Data Analysis, 3E</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class='nav-link' href='https://wesmckinney.com/archives' rel target>
 <span class="menu-text">Wes’s Blog</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/wesmckinn" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/wesm/pydata-book" rel="" target="">
 <span class="dropdown-text">Data and Notebooks (GitHub)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://gitee.com/wesmckinn/pydata-book" rel="" target="">
 <span class="dropdown-text">Data and Notebooks (Gitee)</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href='/book/preface'>Chapters</a></li><li class="breadcrumb-item"><a href='/book/data-aggregation'><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Aggregation and Group Operations</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/'>
 <span class="menu-text">About the Open Edition</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Chapters</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/preface'>
 <span class="menu-text">Preface</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/preliminaries'>
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Preliminaries</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/python-basics'>
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Python Language Basics, IPython, and Jupyter Notebooks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/python-builtin'>
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Built-In Data Structures, Functions, and Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/numpy-basics'>
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">NumPy Basics: Arrays and Vectorized Computation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/pandas-basics'>
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Getting Started with pandas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/accessing-data'>
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Loading, Storage, and File Formats</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/data-cleaning'>
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Cleaning and Preparation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/data-wrangling'>
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Data Wrangling: Join, Combine, and Reshape</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/plotting-and-visualization'>
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Plotting and Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link active' href='/book/data-aggregation'>
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Aggregation and Group Operations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/time-series'>
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Time Series</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/modeling'>
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to Modeling Libraries in Python</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/data-analysis-examples'>
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Data Analysis Examples</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/advanced-numpy'>
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Advanced NumPy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a class='sidebar-item-text sidebar-link' href='/book/ipython'>
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">More on the IPython System</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<a href="https://amzn.to/3DyLaJc"><img src="images/cover.png" class="img-fluid"></a>
<div data-ea-publisher="wesmckinneycom" data-ea-type="image">

</div>
</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#groupby_fundamentals" id="toc-groupby_fundamentals" class="nav-link active" data-scroll-target="#groupby_fundamentals"><span class="header-section-number">10.1</span> How to Think About Group Operations</a>
  <ul class="collapse">
  <li><a href="#groupby_mech_iteration" id="toc-groupby_mech_iteration" class="nav-link" data-scroll-target="#groupby_mech_iteration">Iterating over Groups</a></li>
  <li><a href="#groupby_agg_select_subset" id="toc-groupby_agg_select_subset" class="nav-link" data-scroll-target="#groupby_agg_select_subset">Selecting a Column or Subset of Columns</a></li>
  <li><a href="#groupby_mech_mapping" id="toc-groupby_mech_mapping" class="nav-link" data-scroll-target="#groupby_mech_mapping">Grouping with Dictionaries and Series</a></li>
  <li><a href="#groupby_mech_functions" id="toc-groupby_mech_functions" class="nav-link" data-scroll-target="#groupby_mech_functions">Grouping with Functions</a></li>
  <li><a href="#groupby_mech_levels" id="toc-groupby_mech_levels" class="nav-link" data-scroll-target="#groupby_mech_levels">Grouping by Index Levels</a></li>
  </ul></li>
  <li><a href="#groupby_aggregation" id="toc-groupby_aggregation" class="nav-link" data-scroll-target="#groupby_aggregation"><span class="header-section-number">10.2</span> Data Aggregation</a>
  <ul class="collapse">
  <li><a href="#groupby_multiple_functions" id="toc-groupby_multiple_functions" class="nav-link" data-scroll-target="#groupby_multiple_functions">Column-Wise and Multiple Function Application</a></li>
  <li><a href="#groupby_agg_no_use_index" id="toc-groupby_agg_no_use_index" class="nav-link" data-scroll-target="#groupby_agg_no_use_index">Returning Aggregated Data Without Row Indexes</a></li>
  </ul></li>
  <li><a href="#groupby_apply" id="toc-groupby_apply" class="nav-link" data-scroll-target="#groupby_apply"><span class="header-section-number">10.3</span> Apply: General split-apply-combine</a>
  <ul class="collapse">
  <li><a href="#groupby_apply_group_keys" id="toc-groupby_apply_group_keys" class="nav-link" data-scroll-target="#groupby_apply_group_keys">Suppressing the Group Keys</a></li>
  <li><a href="#groupby_apply_quantile" id="toc-groupby_apply_quantile" class="nav-link" data-scroll-target="#groupby_apply_quantile">Quantile and Bucket Analysis</a></li>
  <li><a href="#groupby_apply_fill_group_mean" id="toc-groupby_apply_fill_group_mean" class="nav-link" data-scroll-target="#groupby_apply_fill_group_mean">Example: Filling Missing Values with Group-Specific Values</a></li>
  <li><a href="#groupby_apply_sampling" id="toc-groupby_apply_sampling" class="nav-link" data-scroll-target="#groupby_apply_sampling">Example: Random Sampling and Permutation</a></li>
  <li><a href="#groupby_apply_wavg" id="toc-groupby_apply_wavg" class="nav-link" data-scroll-target="#groupby_apply_wavg">Example: Group Weighted Average and Correlation</a></li>
  <li><a href="#groupby_apply_linreg" id="toc-groupby_apply_linreg" class="nav-link" data-scroll-target="#groupby_apply_linreg">Example: Group-Wise Linear Regression</a></li>
  </ul></li>
  <li><a href="#pandas-groupby-transform" id="toc-pandas-groupby-transform" class="nav-link" data-scroll-target="#pandas-groupby-transform"><span class="header-section-number">10.4</span> Group Transforms and "Unwrapped" GroupBys</a></li>
  <li><a href="#groupby_pivot_table" id="toc-groupby_pivot_table" class="nav-link" data-scroll-target="#groupby_pivot_table"><span class="header-section-number">10.5</span> Pivot Tables and Cross-Tabulation</a>
  <ul class="collapse">
  <li><a href="#groupby_crosstab" id="toc-groupby_crosstab" class="nav-link" data-scroll-target="#groupby_crosstab">Cross-Tabulations: Crosstab</a></li>
  </ul></li>
  <li><a href="#groupby-summary" id="toc-groupby-summary" class="nav-link" data-scroll-target="#groupby-summary"><span class="header-section-number">10.6</span> Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="groupby" class="quarto-section-identifier"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Aggregation and Group Operations</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="callout callout-style-simple callout-note no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>This Open Access web version of <em>Python for Data Analysis 3rd Edition</em> is now available as a companion to the <a href="https://amzn.to/3DyLaJc">print and digital editions</a>. If you encounter any errata, <a href="https://oreilly.com/catalog/0636920519829/errata">please report them here</a>. Please note that some aspects of this site as produced by Quarto will differ from the formatting of the print and eBook versions from O’Reilly.</p>
<p>If you find the online edition of the book useful, please consider <a href="https://amzn.to/3DyLaJc">ordering a paper copy</a> or a <a href="https://www.ebooks.com/en-us/book/210644288/python-for-data-analysis/wes-mckinney/?affId=WES398681F">DRM-free eBook</a> to support the author. The content from this website may not be copied or reproduced. The code examples are MIT licensed and can be found on GitHub or Gitee.</p>
</div>
</div>
</div>
<p>Categorizing a dataset and applying a function to each group, whether an aggregation or transformation, can be a critical component of a data analysis workflow. After loading, merging, and preparing a dataset, you may need to compute group statistics or possibly <em>pivot tables</em> for reporting or visualization purposes. pandas provides a versatile <code>groupby</code> interface, enabling you to slice, dice, and summarize datasets in a natural way.</p>
<p>One reason for the popularity of relational databases and SQL (which stands for “structured query language”) is the ease with which data can be joined, filtered, transformed, and aggregated. However, query languages like SQL impose certain limitations on the kinds of group operations that can be performed. As you will see, with the expressiveness of Python and pandas, we can perform quite complex group operations by expressing them as custom Python functions that manipulate the data associated with each group. In this chapter, you will learn how to:</p>
<ul>
<li><p>Split a pandas object into pieces using one or more keys (in the form of functions, arrays, or DataFrame column names)</p></li>
<li><p>Calculate group summary statistics, like count, mean, or standard deviation, or a user-defined function</p></li>
<li><p>Apply within-group transformations or other manipulations, like normalization, linear regression, rank, or subset selection</p></li>
<li><p>Compute pivot tables and cross-tabulations</p></li>
<li><p>Perform quantile analysis and other statistical group analyses</p></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Time-based aggregation of time series data, a special use case of <code>groupby</code>, is referred to as <em>resampling</em> in this book and will receive separate treatment in <a href='/book/time-series'>Ch 11: Time Series</a>.</p>
</div>
</div>
<p>As with the rest of the chapters, we start by importing NumPy and pandas:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">12</span>]: <span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">13</span>]: <span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="groupby_fundamentals" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="groupby_fundamentals"><span class="header-section-number">10.1</span> How to Think About Group Operations</h2>
<p>Hadley Wickham, an author of many popular packages for the R programming language, coined the term <em>split-apply-combine</em> for describing group operations. In the first stage of the process, data contained in a pandas object, whether a Series, DataFrame, or otherwise, is <em>split</em> into groups based on one or more <em>keys</em> that you provide. The splitting is performed on a particular axis of an object. For example, a DataFrame can be grouped on its rows (<code>axis="index"</code>) or its columns (<code>axis="columns"</code>). Once this is done, a function is <em>applied</em> to each group, producing a new value. Finally, the results of all those function applications are <em>combined</em> into a result object. The form of the resulting object will usually depend on what’s being done to the data. See <a href="#fig-figure_groupby_agg">Figure&nbsp;<span>10.1</span></a> for a mockup of a simple group aggregation.</p>
<p>Each grouping key can take many forms, and the keys do not have to be all of the same type:</p>
<ul>
<li><p>A list or array of values that is the same length as the axis being grouped</p></li>
<li><p>A value indicating a column name in a DataFrame</p></li>
<li><p>A dictionary or Series giving a correspondence between the values on the axis being grouped and the group names</p></li>
<li><p>A function to be invoked on the axis index or the individual labels in the index</p></li>
</ul>
<div id="fig-figure_groupby_agg" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="images/pda3_1001.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;10.1: Illustration of a group aggregation</figcaption>
</figure>
</div>
<p>Note that the latter three methods are shortcuts for producing an array of values to be used to split up the object. Don’t worry if this all seems abstract. Throughout this chapter, I will give many examples of all these methods. To get started, here is a small tabular dataset as a DataFrame:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">14</span>]: df <span class="op">=</span> pd.DataFrame({<span class="st">"key1"</span> : [<span class="st">"a"</span>, <span class="st">"a"</span>, <span class="va">None</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="va">None</span>],</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>   ....:                    <span class="st">"key2"</span> : pd.Series([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="va">None</span>, <span class="dv">1</span>],</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>   ....:                                       dtype<span class="op">=</span><span class="st">"Int64"</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>   ....:                    <span class="st">"data1"</span> : np.random.standard_normal(<span class="dv">7</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>   ....:                    <span class="st">"data2"</span> : np.random.standard_normal(<span class="dv">7</span>)})</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">15</span>]: df</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">15</span>]: </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>   key1  key2     data1     data2</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     a     <span class="dv">1</span> <span class="op">-</span><span class="fl">0.204708</span>  <span class="fl">0.281746</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     a     <span class="dv">2</span>  <span class="fl">0.478943</span>  <span class="fl">0.769023</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="va">None</span>     <span class="dv">1</span> <span class="op">-</span><span class="fl">0.519439</span>  <span class="fl">1.246435</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     b     <span class="dv">2</span> <span class="op">-</span><span class="fl">0.555730</span>  <span class="fl">1.007189</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>     b     <span class="dv">1</span>  <span class="fl">1.965781</span> <span class="op">-</span><span class="fl">1.296221</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>     a  <span class="op">&lt;</span>NA<span class="op">&gt;</span>  <span class="fl">1.393406</span>  <span class="fl">0.274992</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  <span class="va">None</span>     <span class="dv">1</span>  <span class="fl">0.092908</span>  <span class="fl">0.228913</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Suppose you wanted to compute the mean of the <code>data1</code> column using the labels from <code>key1</code>. There are a number of ways to do this. One is to access <code>data1</code> and call <code>groupby</code> with the column (a Series) at <code>key1</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">16</span>]: grouped <span class="op">=</span> df[<span class="st">"data1"</span>].groupby(df[<span class="st">"key1"</span>])</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">17</span>]: grouped</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">17</span>]: <span class="op">&lt;</span>pandas.core.groupby.generic.SeriesGroupBy <span class="bu">object</span> at <span class="bn">0x17b7913f0</span><span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This <code>grouped</code> variable is now a special <em>"GroupBy"</em> object. It has not actually computed anything yet except for some intermediate data about the group key <code>df["key1"]</code>. The idea is that this object has all of the information needed to then apply some operation to each of the groups. For example, to compute group means we can call the GroupBy’s <code>mean</code> method:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">18</span>]: grouped.mean()</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">18</span>]: </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>key1</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>a    <span class="fl">0.555881</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>b    <span class="fl">0.705025</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>Name: data1, dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Later in <a href="#groupby_aggregation">Data Aggregation</a>, I'll explain more about what happens when you call <code>.mean()</code>. The important thing here is that the data (a Series) has been aggregated by splitting the data on the group key, producing a new Series that is now indexed by the unique values in the <code>key1</code> column. The result index has the name <code>"key1"</code> because the DataFrame column <code>df["key1"]</code> did.</p>
<p>If instead we had passed multiple arrays as a list, we'd get something different:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">19</span>]: means <span class="op">=</span> df[<span class="st">"data1"</span>].groupby([df[<span class="st">"key1"</span>], df[<span class="st">"key2"</span>]]).mean()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">20</span>]: means</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">20</span>]: </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>key1  key2</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>a     <span class="dv">1</span>      <span class="op">-</span><span class="fl">0.204708</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>      <span class="dv">2</span>       <span class="fl">0.478943</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>b     <span class="dv">1</span>       <span class="fl">1.965781</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>      <span class="dv">2</span>      <span class="op">-</span><span class="fl">0.555730</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>Name: data1, dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here we grouped the data using two keys, and the resulting Series now has a hierarchical index consisting of the unique pairs of keys observed:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">21</span>]: means.unstack()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">21</span>]: </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>key2         <span class="dv">1</span>         <span class="dv">2</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>key1                    </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>a    <span class="op">-</span><span class="fl">0.204708</span>  <span class="fl">0.478943</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>b     <span class="fl">1.965781</span> <span class="op">-</span><span class="fl">0.555730</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In this example, the group keys are all Series, though they could be any arrays of the right length:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">22</span>]: states <span class="op">=</span> np.array([<span class="st">"OH"</span>, <span class="st">"CA"</span>, <span class="st">"CA"</span>, <span class="st">"OH"</span>, <span class="st">"OH"</span>, <span class="st">"CA"</span>, <span class="st">"OH"</span>])</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">23</span>]: years <span class="op">=</span> [<span class="dv">2005</span>, <span class="dv">2005</span>, <span class="dv">2006</span>, <span class="dv">2005</span>, <span class="dv">2006</span>, <span class="dv">2005</span>, <span class="dv">2006</span>]</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">24</span>]: df[<span class="st">"data1"</span>].groupby([states, years]).mean()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">24</span>]: </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>CA  <span class="dv">2005</span>    <span class="fl">0.936175</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2006</span>   <span class="op">-</span><span class="fl">0.519439</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>OH  <span class="dv">2005</span>   <span class="op">-</span><span class="fl">0.380219</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2006</span>    <span class="fl">1.029344</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>Name: data1, dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Frequently, the grouping information is found in the same DataFrame as the data you want to work on. In that case, you can pass column names (whether those are strings, numbers, or other Python objects) as the group keys:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">25</span>]: df.groupby(<span class="st">"key1"</span>).mean()</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">25</span>]: </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>      key2     data1     data2</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>key1                          </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>a      <span class="fl">1.5</span>  <span class="fl">0.555881</span>  <span class="fl">0.441920</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>b      <span class="fl">1.5</span>  <span class="fl">0.705025</span> <span class="op">-</span><span class="fl">0.144516</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">26</span>]: df.groupby(<span class="st">"key2"</span>).mean(numeric_only<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">26</span>]: </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>         data1     data2</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>key2                    </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     <span class="fl">0.333636</span>  <span class="fl">0.115218</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="op">-</span><span class="fl">0.038393</span>  <span class="fl">0.888106</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">27</span>]: df.groupby([<span class="st">"key1"</span>, <span class="st">"key2"</span>]).mean()</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">27</span>]: </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>              data1     data2</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>key1 key2                    </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">1</span>    <span class="op">-</span><span class="fl">0.204708</span>  <span class="fl">0.281746</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>     <span class="dv">2</span>     <span class="fl">0.478943</span>  <span class="fl">0.769023</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">1</span>     <span class="fl">1.965781</span> <span class="op">-</span><span class="fl">1.296221</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>     <span class="dv">2</span>    <span class="op">-</span><span class="fl">0.555730</span>  <span class="fl">1.007189</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You may notice that in the second case, it is necessary to pass <code>numeric_only=True</code> because the <code>key1</code> column is not numeric and thus cannot be aggregated with <code>mean()</code>.</p>
<p>Regardless of the objective in using <code>groupby</code>, a generally useful GroupBy method is <code>size</code>, which returns a Series containing group sizes:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">28</span>]: df.groupby([<span class="st">"key1"</span>, <span class="st">"key2"</span>]).size()</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">28</span>]: </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>key1  key2</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>a     <span class="dv">1</span>       <span class="dv">1</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>      <span class="dv">2</span>       <span class="dv">1</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>b     <span class="dv">1</span>       <span class="dv">1</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>      <span class="dv">2</span>       <span class="dv">1</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that any missing values in a group key are excluded from the result by default. This behavior can be disabled by passing <code>dropna=False</code> to <code>groupby</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">29</span>]: df.groupby(<span class="st">"key1"</span>, dropna<span class="op">=</span><span class="va">False</span>).size()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">29</span>]: </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>key1</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>a      <span class="dv">3</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>b      <span class="dv">2</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>NaN    <span class="dv">2</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>dtype: int64</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">30</span>]: df.groupby([<span class="st">"key1"</span>, <span class="st">"key2"</span>], dropna<span class="op">=</span><span class="va">False</span>).size()</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">30</span>]: </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>key1  key2</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>a     <span class="dv">1</span>       <span class="dv">1</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>      <span class="dv">2</span>       <span class="dv">1</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;</span>NA<span class="op">&gt;</span>    <span class="dv">1</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>b     <span class="dv">1</span>       <span class="dv">1</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>      <span class="dv">2</span>       <span class="dv">1</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>NaN   <span class="dv">1</span>       <span class="dv">2</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A group function similar in spirit to <code>size</code> is count, which computes the number of nonnull values in each group:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">31</span>]: df.groupby(<span class="st">"key1"</span>).count()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">31</span>]: </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>      key2  data1  data2</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>key1                    </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>a        <span class="dv">2</span>      <span class="dv">3</span>      <span class="dv">3</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>b        <span class="dv">2</span>      <span class="dv">2</span>      <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="groupby_mech_iteration" class="level3">
<h3 class="anchored" data-anchor-id="groupby_mech_iteration">Iterating over Groups</h3>
<p>The object returned by <code>groupby</code> supports iteration, generating a sequence of 2-tuples containing the group name along with the chunk of data. Consider the following:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">32</span>]: <span class="cf">for</span> name, group <span class="kw">in</span> df.groupby(<span class="st">"key1"</span>):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>   ....:     <span class="bu">print</span>(name)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>   ....:     <span class="bu">print</span>(group)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>   ....:</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>a</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  key1  key2     data1     data2</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    a     <span class="dv">1</span> <span class="op">-</span><span class="fl">0.204708</span>  <span class="fl">0.281746</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    a     <span class="dv">2</span>  <span class="fl">0.478943</span>  <span class="fl">0.769023</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    a  <span class="op">&lt;</span>NA<span class="op">&gt;</span>  <span class="fl">1.393406</span>  <span class="fl">0.274992</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>b</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  key1  key2     data1     data2</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    b     <span class="dv">2</span> <span class="op">-</span><span class="fl">0.555730</span>  <span class="fl">1.007189</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    b     <span class="dv">1</span>  <span class="fl">1.965781</span> <span class="op">-</span><span class="fl">1.296221</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In the case of multiple keys, the first element in the tuple will be a tuple of key values:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">33</span>]: <span class="cf">for</span> (k1, k2), group <span class="kw">in</span> df.groupby([<span class="st">"key1"</span>, <span class="st">"key2"</span>]):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>   ....:     <span class="bu">print</span>((k1, k2))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>   ....:     <span class="bu">print</span>(group)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>   ....:</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>(<span class="st">'a'</span>, <span class="dv">1</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  key1  key2     data1     data2</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    a     <span class="dv">1</span> <span class="op">-</span><span class="fl">0.204708</span>  <span class="fl">0.281746</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>(<span class="st">'a'</span>, <span class="dv">2</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  key1  key2     data1     data2</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    a     <span class="dv">2</span>  <span class="fl">0.478943</span>  <span class="fl">0.769023</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>(<span class="st">'b'</span>, <span class="dv">1</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  key1  key2     data1     data2</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    b     <span class="dv">1</span>  <span class="fl">1.965781</span> <span class="op">-</span><span class="fl">1.296221</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>(<span class="st">'b'</span>, <span class="dv">2</span>)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  key1  key2    data1     data2</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    b     <span class="dv">2</span> <span class="op">-</span><span class="fl">0.55573</span>  <span class="fl">1.007189</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Of course, you can choose to do whatever you want with the pieces of data. A recipe you may find useful is computing a dictionary of the data pieces as a one-liner:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">34</span>]: pieces <span class="op">=</span> {name: group <span class="cf">for</span> name, group <span class="kw">in</span> df.groupby(<span class="st">"key1"</span>)}</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">35</span>]: pieces[<span class="st">"b"</span>]</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">35</span>]: </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  key1  key2     data1     data2</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    b     <span class="dv">2</span> <span class="op">-</span><span class="fl">0.555730</span>  <span class="fl">1.007189</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    b     <span class="dv">1</span>  <span class="fl">1.965781</span> <span class="op">-</span><span class="fl">1.296221</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>By default <code>groupby</code> groups on <code>axis="index"</code>, but you can group on any of the other axes. For example, we could group the columns of our example <code>df</code> here by whether they start with <code>"key"</code> or <code>"data"</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">36</span>]: grouped <span class="op">=</span> df.groupby({<span class="st">"key1"</span>: <span class="st">"key"</span>, <span class="st">"key2"</span>: <span class="st">"key"</span>,</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>   ....:                       <span class="st">"data1"</span>: <span class="st">"data"</span>, <span class="st">"data2"</span>: <span class="st">"data"</span>}, axis<span class="op">=</span><span class="st">"columns"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can print out the groups like so:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">37</span>]: <span class="cf">for</span> group_key, group_values <span class="kw">in</span> grouped:</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>   ....:     <span class="bu">print</span>(group_key)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>   ....:     <span class="bu">print</span>(group_values)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>   ....:</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>data</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>      data1     data2</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> <span class="op">-</span><span class="fl">0.204708</span>  <span class="fl">0.281746</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">0.478943</span>  <span class="fl">0.769023</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="op">-</span><span class="fl">0.519439</span>  <span class="fl">1.246435</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="op">-</span><span class="fl">0.555730</span>  <span class="fl">1.007189</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="fl">1.965781</span> <span class="op">-</span><span class="fl">1.296221</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>  <span class="fl">1.393406</span>  <span class="fl">0.274992</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  <span class="fl">0.092908</span>  <span class="fl">0.228913</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>key</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>   key1  key2</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     a     <span class="dv">1</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     a     <span class="dv">2</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="va">None</span>     <span class="dv">1</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     b     <span class="dv">2</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>     b     <span class="dv">1</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>     a  <span class="op">&lt;</span>NA<span class="op">&gt;</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  <span class="va">None</span>     <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="groupby_agg_select_subset" class="level3">
<h3 class="anchored" data-anchor-id="groupby_agg_select_subset">Selecting a Column or Subset of Columns</h3>
<p>Indexing a GroupBy object created from a DataFrame with a column name or array of column names has the effect of column subsetting for aggregation. This means that:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">"key1"</span>)[<span class="st">"data1"</span>]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">"key1"</span>)[[<span class="st">"data2"</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>are conveniences for:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"data1"</span>].groupby(df[<span class="st">"key1"</span>])</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">"data2"</span>]].groupby(df[<span class="st">"key1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Especially for large datasets, it may be desirable to aggregate only a few columns. For example, in the preceding dataset, to compute the means for just the <code>data2</code> column and get the result as a DataFrame, we could write:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">38</span>]: df.groupby([<span class="st">"key1"</span>, <span class="st">"key2"</span>])[[<span class="st">"data2"</span>]].mean()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">38</span>]: </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>              data2</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>key1 key2          </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">1</span>     <span class="fl">0.281746</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>     <span class="dv">2</span>     <span class="fl">0.769023</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">1</span>    <span class="op">-</span><span class="fl">1.296221</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>     <span class="dv">2</span>     <span class="fl">1.007189</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The object returned by this indexing operation is a grouped DataFrame if a list or array is passed, or a grouped Series if only a single column name is passed as a scalar:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">39</span>]: s_grouped <span class="op">=</span> df.groupby([<span class="st">"key1"</span>, <span class="st">"key2"</span>])[<span class="st">"data2"</span>]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">40</span>]: s_grouped</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">40</span>]: <span class="op">&lt;</span>pandas.core.groupby.generic.SeriesGroupBy <span class="bu">object</span> at <span class="bn">0x17b8356c0</span><span class="op">&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">41</span>]: s_grouped.mean()</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">41</span>]: </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>key1  key2</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>a     <span class="dv">1</span>       <span class="fl">0.281746</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>      <span class="dv">2</span>       <span class="fl">0.769023</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>b     <span class="dv">1</span>      <span class="op">-</span><span class="fl">1.296221</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>      <span class="dv">2</span>       <span class="fl">1.007189</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>Name: data2, dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="groupby_mech_mapping" class="level3">
<h3 class="anchored" data-anchor-id="groupby_mech_mapping">Grouping with Dictionaries and Series</h3>
<p>Grouping information may exist in a form other than an array. Let’s consider another example DataFrame:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">42</span>]: people <span class="op">=</span> pd.DataFrame(np.random.standard_normal((<span class="dv">5</span>, <span class="dv">5</span>)),</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>   ....:                       columns<span class="op">=</span>[<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>],</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>   ....:                       index<span class="op">=</span>[<span class="st">"Joe"</span>, <span class="st">"Steve"</span>, <span class="st">"Wanda"</span>, <span class="st">"Jill"</span>, <span class="st">"Trey"</span>])</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">43</span>]: people.iloc[<span class="dv">2</span>:<span class="dv">3</span>, [<span class="dv">1</span>, <span class="dv">2</span>]] <span class="op">=</span> np.nan <span class="co"># Add a few NA values</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">44</span>]: people</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">44</span>]: </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>              a         b         c         d         e</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>Joe    <span class="fl">1.352917</span>  <span class="fl">0.886429</span> <span class="op">-</span><span class="fl">2.001637</span> <span class="op">-</span><span class="fl">0.371843</span>  <span class="fl">1.669025</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>Steve <span class="op">-</span><span class="fl">0.438570</span> <span class="op">-</span><span class="fl">0.539741</span>  <span class="fl">0.476985</span>  <span class="fl">3.248944</span> <span class="op">-</span><span class="fl">1.021228</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>Wanda <span class="op">-</span><span class="fl">0.577087</span>       NaN       NaN  <span class="fl">0.523772</span>  <span class="fl">0.000940</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>Jill   <span class="fl">1.343810</span> <span class="op">-</span><span class="fl">0.713544</span> <span class="op">-</span><span class="fl">0.831154</span> <span class="op">-</span><span class="fl">2.370232</span> <span class="op">-</span><span class="fl">1.860761</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>Trey  <span class="op">-</span><span class="fl">0.860757</span>  <span class="fl">0.560145</span> <span class="op">-</span><span class="fl">1.265934</span>  <span class="fl">0.119827</span> <span class="op">-</span><span class="fl">1.063512</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, suppose I have a group correspondence for the columns and want to sum the columns by group:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">45</span>]: mapping <span class="op">=</span> {<span class="st">"a"</span>: <span class="st">"red"</span>, <span class="st">"b"</span>: <span class="st">"red"</span>, <span class="st">"c"</span>: <span class="st">"blue"</span>,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>   ....:            <span class="st">"d"</span>: <span class="st">"blue"</span>, <span class="st">"e"</span>: <span class="st">"red"</span>, <span class="st">"f"</span> : <span class="st">"orange"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, you could construct an array from this dictionary to pass to <code>groupby</code>, but instead we can just pass the dictionary (I included the key <code>"f"</code> to highlight that unused grouping keys are OK):</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">46</span>]: by_column <span class="op">=</span> people.groupby(mapping, axis<span class="op">=</span><span class="st">"columns"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">47</span>]: by_column.<span class="bu">sum</span>()</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">47</span>]: </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>           blue       red</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>Joe   <span class="op">-</span><span class="fl">2.373480</span>  <span class="fl">3.908371</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>Steve  <span class="fl">3.725929</span> <span class="op">-</span><span class="fl">1.999539</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>Wanda  <span class="fl">0.523772</span> <span class="op">-</span><span class="fl">0.576147</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>Jill  <span class="op">-</span><span class="fl">3.201385</span> <span class="op">-</span><span class="fl">1.230495</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>Trey  <span class="op">-</span><span class="fl">1.146107</span> <span class="op">-</span><span class="fl">1.364125</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The same functionality holds for Series, which can be viewed as a fixed-size mapping:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">48</span>]: map_series <span class="op">=</span> pd.Series(mapping)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">49</span>]: map_series</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">49</span>]: </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>a       red</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>b       red</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>c      blue</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>d      blue</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>e       red</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>f    orange</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>dtype: <span class="bu">object</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">50</span>]: people.groupby(map_series, axis<span class="op">=</span><span class="st">"columns"</span>).count()</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">50</span>]: </span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>       blue  red</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>Joe       <span class="dv">2</span>    <span class="dv">3</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>Steve     <span class="dv">2</span>    <span class="dv">3</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>Wanda     <span class="dv">1</span>    <span class="dv">2</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>Jill      <span class="dv">2</span>    <span class="dv">3</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>Trey      <span class="dv">2</span>    <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="groupby_mech_functions" class="level3">
<h3 class="anchored" data-anchor-id="groupby_mech_functions">Grouping with Functions</h3>
<p>Using Python functions is a more generic way of defining a group mapping compared with a dictionary or Series. Any function passed as a group key will be called once per index value (or once per column value if using <code>axis="columns"</code>), with the return values being used as the group names. More concretely, consider the example DataFrame from the previous section, which has people’s first names as index values. Suppose you wanted to group by name length. While you could compute an array of string lengths, it's simpler to just pass the <code>len</code> function:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">51</span>]: people.groupby(<span class="bu">len</span>).<span class="bu">sum</span>()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">51</span>]: </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>          a         b         c         d         e</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="fl">1.352917</span>  <span class="fl">0.886429</span> <span class="op">-</span><span class="fl">2.001637</span> <span class="op">-</span><span class="fl">0.371843</span>  <span class="fl">1.669025</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="fl">0.483052</span> <span class="op">-</span><span class="fl">0.153399</span> <span class="op">-</span><span class="fl">2.097088</span> <span class="op">-</span><span class="fl">2.250405</span> <span class="op">-</span><span class="fl">2.924273</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> <span class="op">-</span><span class="fl">1.015657</span> <span class="op">-</span><span class="fl">0.539741</span>  <span class="fl">0.476985</span>  <span class="fl">3.772716</span> <span class="op">-</span><span class="fl">1.020287</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Mixing functions with arrays, dictionaries, or Series is not a problem, as everything gets converted to arrays internally:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">52</span>]: key_list <span class="op">=</span> [<span class="st">"one"</span>, <span class="st">"one"</span>, <span class="st">"one"</span>, <span class="st">"two"</span>, <span class="st">"two"</span>]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">53</span>]: people.groupby([<span class="bu">len</span>, key_list]).<span class="bu">min</span>()</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">53</span>]: </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>              a         b         c         d         e</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> one  <span class="fl">1.352917</span>  <span class="fl">0.886429</span> <span class="op">-</span><span class="fl">2.001637</span> <span class="op">-</span><span class="fl">0.371843</span>  <span class="fl">1.669025</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span> two <span class="op">-</span><span class="fl">0.860757</span> <span class="op">-</span><span class="fl">0.713544</span> <span class="op">-</span><span class="fl">1.265934</span> <span class="op">-</span><span class="fl">2.370232</span> <span class="op">-</span><span class="fl">1.860761</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span> one <span class="op">-</span><span class="fl">0.577087</span> <span class="op">-</span><span class="fl">0.539741</span>  <span class="fl">0.476985</span>  <span class="fl">0.523772</span> <span class="op">-</span><span class="fl">1.021228</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="groupby_mech_levels" class="level3">
<h3 class="anchored" data-anchor-id="groupby_mech_levels">Grouping by Index Levels</h3>
<p>A final convenience for hierarchically indexed datasets is the ability to aggregate using one of the levels of an axis index. Let's look at an example:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">54</span>]: columns <span class="op">=</span> pd.MultiIndex.from_arrays([[<span class="st">"US"</span>, <span class="st">"US"</span>, <span class="st">"US"</span>, <span class="st">"JP"</span>, <span class="st">"JP"</span>],</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>   ....:                                     [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">3</span>]],</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>   ....:                                     names<span class="op">=</span>[<span class="st">"cty"</span>, <span class="st">"tenor"</span>])</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">55</span>]: hier_df <span class="op">=</span> pd.DataFrame(np.random.standard_normal((<span class="dv">4</span>, <span class="dv">5</span>)), columns<span class="op">=</span>column</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>s)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">56</span>]: hier_df</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">56</span>]: </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>cty          US                            JP          </span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>tenor         <span class="dv">1</span>         <span class="dv">3</span>         <span class="dv">5</span>         <span class="dv">1</span>         <span class="dv">3</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>      <span class="fl">0.332883</span> <span class="op">-</span><span class="fl">2.359419</span> <span class="op">-</span><span class="fl">0.199543</span> <span class="op">-</span><span class="fl">1.541996</span> <span class="op">-</span><span class="fl">0.970736</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     <span class="op">-</span><span class="fl">1.307030</span>  <span class="fl">0.286350</span>  <span class="fl">0.377984</span> <span class="op">-</span><span class="fl">0.753887</span>  <span class="fl">0.331286</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>      <span class="fl">1.349742</span>  <span class="fl">0.069877</span>  <span class="fl">0.246674</span> <span class="op">-</span><span class="fl">0.011862</span>  <span class="fl">1.004812</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>      <span class="fl">1.327195</span> <span class="op">-</span><span class="fl">0.919262</span> <span class="op">-</span><span class="fl">1.549106</span>  <span class="fl">0.022185</span>  <span class="fl">0.758363</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To group by level, pass the level number or name using the <code>level</code> keyword:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">57</span>]: hier_df.groupby(level<span class="op">=</span><span class="st">"cty"</span>, axis<span class="op">=</span><span class="st">"columns"</span>).count()</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">57</span>]: </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>cty  JP  US</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     <span class="dv">2</span>   <span class="dv">3</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     <span class="dv">2</span>   <span class="dv">3</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>     <span class="dv">2</span>   <span class="dv">3</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     <span class="dv">2</span>   <span class="dv">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="groupby_aggregation" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="groupby_aggregation"><span class="header-section-number">10.2</span> Data Aggregation</h2>
<p><em>Aggregations</em> refer to any data transformation that produces scalar values from arrays. The preceding examples have used several of them, including <code>mean</code>, <code>count</code>, <code>min</code>, and <code>sum</code>. You may wonder what is going on when you invoke <code>mean()</code> on a GroupBy object. Many common aggregations, such as those found in <a href="#tbl-table_opt_groupby_methods">Table&nbsp;<span>10.1</span></a>, have optimized implementations. However, you are not limited to only this set of methods.</p>
<div id="tbl-table_opt_groupby_methods" class="anchored">
<table class="table">
<caption>Table&nbsp;10.1: Optimized <code>groupby</code> methods</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Function name</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>any, all</code></td>
<td style="text-align: left;">Return <code>True</code> if any (one or more values) or all non-NA values are "truthy"</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>count</code></td>
<td style="text-align: left;">Number of non-NA values</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>cummin, cummax</code></td>
<td style="text-align: left;">Cumulative minimum and maximum of non-NA values</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>cumsum</code></td>
<td style="text-align: left;">Cumulative sum of non-NA values</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>cumprod</code></td>
<td style="text-align: left;">Cumulative product of non-NA values</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>first, last</code></td>
<td style="text-align: left;">First and last non-NA values</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>mean</code></td>
<td style="text-align: left;">Mean of non-NA values</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>median</code></td>
<td style="text-align: left;">Arithmetic median of non-NA values</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>min, max</code></td>
<td style="text-align: left;">Minimum and maximum of non-NA values</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>nth</code></td>
<td style="text-align: left;">Retrieve value that would appear at position <code>n</code> with the data in sorted order</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>ohlc</code></td>
<td style="text-align: left;">Compute four "open-high-low-close" statistics for time series-like data</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>prod</code></td>
<td style="text-align: left;">Product of non-NA values</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>quantile</code></td>
<td style="text-align: left;">Compute sample quantile</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>rank</code></td>
<td style="text-align: left;">Ordinal ranks of non-NA values, like calling <code>Series.rank</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>size</code></td>
<td style="text-align: left;">Compute group sizes, returning result as a Series</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>sum</code></td>
<td style="text-align: left;">Sum of non-NA values</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>std, var</code></td>
<td style="text-align: left;">Sample standard deviation and variance</td>
</tr>
</tbody>
</table>
</div>
<p>You can use aggregations of your own devising and additionally call any method that is also defined on the object being grouped. For example, the <code>nsmallest</code> Series method selects the smallest requested number of values from the data. While <code>nsmallest</code> is not explicitly implemented for GroupBy, we can still use it with a nonoptimized implementation. Internally, GroupBy slices up the Series, calls <code>piece.nsmallest(n)</code> for each piece, and then assembles those results into the result object:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">58</span>]: df</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">58</span>]: </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>   key1  key2     data1     data2</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     a     <span class="dv">1</span> <span class="op">-</span><span class="fl">0.204708</span>  <span class="fl">0.281746</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     a     <span class="dv">2</span>  <span class="fl">0.478943</span>  <span class="fl">0.769023</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>  <span class="va">None</span>     <span class="dv">1</span> <span class="op">-</span><span class="fl">0.519439</span>  <span class="fl">1.246435</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     b     <span class="dv">2</span> <span class="op">-</span><span class="fl">0.555730</span>  <span class="fl">1.007189</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>     b     <span class="dv">1</span>  <span class="fl">1.965781</span> <span class="op">-</span><span class="fl">1.296221</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>     a  <span class="op">&lt;</span>NA<span class="op">&gt;</span>  <span class="fl">1.393406</span>  <span class="fl">0.274992</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  <span class="va">None</span>     <span class="dv">1</span>  <span class="fl">0.092908</span>  <span class="fl">0.228913</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">59</span>]: grouped <span class="op">=</span> df.groupby(<span class="st">"key1"</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">60</span>]: grouped[<span class="st">"data1"</span>].nsmallest(<span class="dv">2</span>)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">60</span>]: </span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>key1   </span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>a     <span class="dv">0</span>   <span class="op">-</span><span class="fl">0.204708</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>      <span class="dv">1</span>    <span class="fl">0.478943</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>b     <span class="dv">3</span>   <span class="op">-</span><span class="fl">0.555730</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>      <span class="dv">4</span>    <span class="fl">1.965781</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>Name: data1, dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To use your own aggregation functions, pass any function that aggregates an array to the <code>aggregate</code> method or its short alias <code>agg</code>:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">61</span>]: <span class="kw">def</span> peak_to_peak(arr):</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>   ....:     <span class="cf">return</span> arr.<span class="bu">max</span>() <span class="op">-</span> arr.<span class="bu">min</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">62</span>]: grouped.agg(peak_to_peak)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">62</span>]: </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>      key2     data1     data2</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>key1                          </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>a        <span class="dv">1</span>  <span class="fl">1.598113</span>  <span class="fl">0.494031</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>b        <span class="dv">1</span>  <span class="fl">2.521511</span>  <span class="fl">2.303410</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You may notice that some methods, like <code>describe</code>, also work, even though they are not aggregations, strictly speaking:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">63</span>]: grouped.describe()</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">63</span>]: </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>      key2                                           data1            ...   </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>     count mean       std  <span class="bu">min</span>   <span class="dv">25</span><span class="op">%</span>  <span class="dv">50</span><span class="op">%</span>   <span class="dv">75</span><span class="op">%</span>  <span class="bu">max</span> count      mean  ...   </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>key1                                                                  ...   </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>a      <span class="fl">2.0</span>  <span class="fl">1.5</span>  <span class="fl">0.707107</span>  <span class="fl">1.0</span>  <span class="fl">1.25</span>  <span class="fl">1.5</span>  <span class="fl">1.75</span>  <span class="fl">2.0</span>   <span class="fl">3.0</span>  <span class="fl">0.555881</span>  ...  <span class="op">\</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>b      <span class="fl">2.0</span>  <span class="fl">1.5</span>  <span class="fl">0.707107</span>  <span class="fl">1.0</span>  <span class="fl">1.25</span>  <span class="fl">1.5</span>  <span class="fl">1.75</span>  <span class="fl">2.0</span>   <span class="fl">2.0</span>  <span class="fl">0.705025</span>  ...   </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>                         data2                                           </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>           <span class="dv">75</span><span class="op">%</span>       <span class="bu">max</span> count      mean       std       <span class="bu">min</span>       <span class="dv">25</span><span class="op">%</span>   </span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>key1                                                                     </span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>a     <span class="fl">0.936175</span>  <span class="fl">1.393406</span>   <span class="fl">3.0</span>  <span class="fl">0.441920</span>  <span class="fl">0.283299</span>  <span class="fl">0.274992</span>  <span class="fl">0.278369</span>  <span class="op">\</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>b     <span class="fl">1.335403</span>  <span class="fl">1.965781</span>   <span class="fl">2.0</span> <span class="op">-</span><span class="fl">0.144516</span>  <span class="fl">1.628757</span> <span class="op">-</span><span class="fl">1.296221</span> <span class="op">-</span><span class="fl">0.720368</span>   </span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>                                    </span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>           <span class="dv">50</span><span class="op">%</span>       <span class="dv">75</span><span class="op">%</span>       <span class="bu">max</span>  </span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>key1                                </span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>a     <span class="fl">0.281746</span>  <span class="fl">0.525384</span>  <span class="fl">0.769023</span>  </span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>b    <span class="op">-</span><span class="fl">0.144516</span>  <span class="fl">0.431337</span>  <span class="fl">1.007189</span>  </span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>[<span class="dv">2</span> rows x <span class="dv">24</span> columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>I will explain in more detail what has happened here in <a href="#groupby_apply">Apply: General split-apply-combine</a>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Custom aggregation functions are generally much slower than the optimized functions found in <a href="#tbl-table_opt_groupby_methods">Table&nbsp;<span>10.1</span></a>. This is because there is some extra overhead (function calls, data rearrangement) in constructing the intermediate group data chunks.</p>
</div>
</div>
<section id="groupby_multiple_functions" class="level3">
<h3 class="anchored" data-anchor-id="groupby_multiple_functions">Column-Wise and Multiple Function Application</h3>
<p>Let's return to the tipping dataset used in the last chapter. After loading it with <code>pandas.read_csv</code>, we add a tipping percentage column:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">64</span>]: tips <span class="op">=</span> pd.read_csv(<span class="st">"examples/tips.csv"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">65</span>]: tips.head()</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">65</span>]: </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>   total_bill   tip smoker  day    time  size</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>       <span class="fl">16.99</span>  <span class="fl">1.01</span>     No  Sun  Dinner     <span class="dv">2</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>       <span class="fl">10.34</span>  <span class="fl">1.66</span>     No  Sun  Dinner     <span class="dv">3</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>       <span class="fl">21.01</span>  <span class="fl">3.50</span>     No  Sun  Dinner     <span class="dv">3</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>       <span class="fl">23.68</span>  <span class="fl">3.31</span>     No  Sun  Dinner     <span class="dv">2</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>       <span class="fl">24.59</span>  <span class="fl">3.61</span>     No  Sun  Dinner     <span class="dv">4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now I will add a <code>tip_pct</code> column with the tip percentage of the total bill:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">66</span>]: tips[<span class="st">"tip_pct"</span>] <span class="op">=</span> tips[<span class="st">"tip"</span>] <span class="op">/</span> tips[<span class="st">"total_bill"</span>]</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">67</span>]: tips.head()</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">67</span>]: </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>   total_bill   tip smoker  day    time  size   tip_pct</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>       <span class="fl">16.99</span>  <span class="fl">1.01</span>     No  Sun  Dinner     <span class="dv">2</span>  <span class="fl">0.059447</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>       <span class="fl">10.34</span>  <span class="fl">1.66</span>     No  Sun  Dinner     <span class="dv">3</span>  <span class="fl">0.160542</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>       <span class="fl">21.01</span>  <span class="fl">3.50</span>     No  Sun  Dinner     <span class="dv">3</span>  <span class="fl">0.166587</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>       <span class="fl">23.68</span>  <span class="fl">3.31</span>     No  Sun  Dinner     <span class="dv">2</span>  <span class="fl">0.139780</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>       <span class="fl">24.59</span>  <span class="fl">3.61</span>     No  Sun  Dinner     <span class="dv">4</span>  <span class="fl">0.146808</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As you’ve already seen, aggregating a Series or all of the columns of a DataFrame is a matter of using <code>aggregate</code> (or <code>agg</code>) with the desired function or calling a method like <code>mean</code> or <code>std</code>. However, you may want to aggregate using a different function, depending on the column, or multiple functions at once. Fortunately, this is possible to do, which I’ll illustrate through a number of examples. First, I’ll group the <code>tips</code> by <code>day</code> and <code>smoker</code>:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">68</span>]: grouped <span class="op">=</span> tips.groupby([<span class="st">"day"</span>, <span class="st">"smoker"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that for descriptive statistics like those in <a href="#tbl-table_opt_groupby_methods">Table&nbsp;<span>10.1</span></a>, you can pass the name of the function as a string:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">69</span>]: grouped_pct <span class="op">=</span> grouped[<span class="st">"tip_pct"</span>]</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">70</span>]: grouped_pct.agg(<span class="st">"mean"</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">70</span>]: </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>day   smoker</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>Fri   No        <span class="fl">0.151650</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>      Yes       <span class="fl">0.174783</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>Sat   No        <span class="fl">0.158048</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>      Yes       <span class="fl">0.147906</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>Sun   No        <span class="fl">0.160113</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>      Yes       <span class="fl">0.187250</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>Thur  No        <span class="fl">0.160298</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>      Yes       <span class="fl">0.163863</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>Name: tip_pct, dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you pass a list of functions or function names instead, you get back a DataFrame with column names taken from the functions:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">71</span>]: grouped_pct.agg([<span class="st">"mean"</span>, <span class="st">"std"</span>, peak_to_peak])</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">71</span>]: </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                 mean       std  peak_to_peak</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>day  smoker                                  </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>Fri  No      <span class="fl">0.151650</span>  <span class="fl">0.028123</span>      <span class="fl">0.067349</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>     Yes     <span class="fl">0.174783</span>  <span class="fl">0.051293</span>      <span class="fl">0.159925</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>Sat  No      <span class="fl">0.158048</span>  <span class="fl">0.039767</span>      <span class="fl">0.235193</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>     Yes     <span class="fl">0.147906</span>  <span class="fl">0.061375</span>      <span class="fl">0.290095</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>Sun  No      <span class="fl">0.160113</span>  <span class="fl">0.042347</span>      <span class="fl">0.193226</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>     Yes     <span class="fl">0.187250</span>  <span class="fl">0.154134</span>      <span class="fl">0.644685</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>Thur No      <span class="fl">0.160298</span>  <span class="fl">0.038774</span>      <span class="fl">0.193350</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>     Yes     <span class="fl">0.163863</span>  <span class="fl">0.039389</span>      <span class="fl">0.151240</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here we passed a list of aggregation functions to <code>agg</code> to evaluate independently on the data groups.</p>
<p>You don’t need to accept the names that GroupBy gives to the columns; notably, <code>lambda</code> functions have the name <code>"&lt;lambda&gt;"</code>, which makes them hard to identify (you can see for yourself by looking at a function’s <code>__name__</code> attribute). Thus, if you pass a list of <code>(name, function)</code> tuples, the first element of each tuple will be used as the DataFrame column names (you can think of a list of 2-tuples as an ordered mapping):</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">72</span>]: grouped_pct.agg([(<span class="st">"average"</span>, <span class="st">"mean"</span>), (<span class="st">"stdev"</span>, np.std)])</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">72</span>]: </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>              average     stdev</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>day  smoker                    </span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>Fri  No      <span class="fl">0.151650</span>  <span class="fl">0.028123</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>     Yes     <span class="fl">0.174783</span>  <span class="fl">0.051293</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>Sat  No      <span class="fl">0.158048</span>  <span class="fl">0.039767</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>     Yes     <span class="fl">0.147906</span>  <span class="fl">0.061375</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>Sun  No      <span class="fl">0.160113</span>  <span class="fl">0.042347</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>     Yes     <span class="fl">0.187250</span>  <span class="fl">0.154134</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>Thur No      <span class="fl">0.160298</span>  <span class="fl">0.038774</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>     Yes     <span class="fl">0.163863</span>  <span class="fl">0.039389</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With a DataFrame you have more options, as you can specify a list of functions to apply to all of the columns or different functions per column. To start, suppose we wanted to compute the same three statistics for the <code>tip_pct</code> and <code>total_bill</code> columns:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">73</span>]: functions <span class="op">=</span> [<span class="st">"count"</span>, <span class="st">"mean"</span>, <span class="st">"max"</span>]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">74</span>]: result <span class="op">=</span> grouped[[<span class="st">"tip_pct"</span>, <span class="st">"total_bill"</span>]].agg(functions)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">75</span>]: result</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">75</span>]: </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>            tip_pct                     total_bill                  </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>              count      mean       <span class="bu">max</span>      count       mean    <span class="bu">max</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>day  smoker                                                         </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>Fri  No           <span class="dv">4</span>  <span class="fl">0.151650</span>  <span class="fl">0.187735</span>          <span class="dv">4</span>  <span class="fl">18.420000</span>  <span class="fl">22.75</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>     Yes         <span class="dv">15</span>  <span class="fl">0.174783</span>  <span class="fl">0.263480</span>         <span class="dv">15</span>  <span class="fl">16.813333</span>  <span class="fl">40.17</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>Sat  No          <span class="dv">45</span>  <span class="fl">0.158048</span>  <span class="fl">0.291990</span>         <span class="dv">45</span>  <span class="fl">19.661778</span>  <span class="fl">48.33</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>     Yes         <span class="dv">42</span>  <span class="fl">0.147906</span>  <span class="fl">0.325733</span>         <span class="dv">42</span>  <span class="fl">21.276667</span>  <span class="fl">50.81</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>Sun  No          <span class="dv">57</span>  <span class="fl">0.160113</span>  <span class="fl">0.252672</span>         <span class="dv">57</span>  <span class="fl">20.506667</span>  <span class="fl">48.17</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>     Yes         <span class="dv">19</span>  <span class="fl">0.187250</span>  <span class="fl">0.710345</span>         <span class="dv">19</span>  <span class="fl">24.120000</span>  <span class="fl">45.35</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>Thur No          <span class="dv">45</span>  <span class="fl">0.160298</span>  <span class="fl">0.266312</span>         <span class="dv">45</span>  <span class="fl">17.113111</span>  <span class="fl">41.19</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>     Yes         <span class="dv">17</span>  <span class="fl">0.163863</span>  <span class="fl">0.241255</span>         <span class="dv">17</span>  <span class="fl">19.190588</span>  <span class="fl">43.11</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As you can see, the resulting DataFrame has hierarchical columns, the same as you would get aggregating each column separately and using <code>concat</code> to glue the results together using the column names as the <code>keys</code> argument:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">76</span>]: result[<span class="st">"tip_pct"</span>]</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">76</span>]: </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>             count      mean       <span class="bu">max</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>day  smoker                           </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>Fri  No          <span class="dv">4</span>  <span class="fl">0.151650</span>  <span class="fl">0.187735</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>     Yes        <span class="dv">15</span>  <span class="fl">0.174783</span>  <span class="fl">0.263480</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>Sat  No         <span class="dv">45</span>  <span class="fl">0.158048</span>  <span class="fl">0.291990</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>     Yes        <span class="dv">42</span>  <span class="fl">0.147906</span>  <span class="fl">0.325733</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>Sun  No         <span class="dv">57</span>  <span class="fl">0.160113</span>  <span class="fl">0.252672</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>     Yes        <span class="dv">19</span>  <span class="fl">0.187250</span>  <span class="fl">0.710345</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>Thur No         <span class="dv">45</span>  <span class="fl">0.160298</span>  <span class="fl">0.266312</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>     Yes        <span class="dv">17</span>  <span class="fl">0.163863</span>  <span class="fl">0.241255</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As before, a list of tuples with custom names can be passed:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">77</span>]: ftuples <span class="op">=</span> [(<span class="st">"Average"</span>, <span class="st">"mean"</span>), (<span class="st">"Variance"</span>, np.var)]</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">78</span>]: grouped[[<span class="st">"tip_pct"</span>, <span class="st">"total_bill"</span>]].agg(ftuples)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">78</span>]: </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>              tip_pct           total_bill            </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>              Average  Variance    Average    Variance</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>day  smoker                                           </span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>Fri  No      <span class="fl">0.151650</span>  <span class="fl">0.000791</span>  <span class="fl">18.420000</span>   <span class="fl">25.596333</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>     Yes     <span class="fl">0.174783</span>  <span class="fl">0.002631</span>  <span class="fl">16.813333</span>   <span class="fl">82.562438</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>Sat  No      <span class="fl">0.158048</span>  <span class="fl">0.001581</span>  <span class="fl">19.661778</span>   <span class="fl">79.908965</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>     Yes     <span class="fl">0.147906</span>  <span class="fl">0.003767</span>  <span class="fl">21.276667</span>  <span class="fl">101.387535</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>Sun  No      <span class="fl">0.160113</span>  <span class="fl">0.001793</span>  <span class="fl">20.506667</span>   <span class="fl">66.099980</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>     Yes     <span class="fl">0.187250</span>  <span class="fl">0.023757</span>  <span class="fl">24.120000</span>  <span class="fl">109.046044</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>Thur No      <span class="fl">0.160298</span>  <span class="fl">0.001503</span>  <span class="fl">17.113111</span>   <span class="fl">59.625081</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>     Yes     <span class="fl">0.163863</span>  <span class="fl">0.001551</span>  <span class="fl">19.190588</span>   <span class="fl">69.808518</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, suppose you wanted to apply potentially different functions to one or more of the columns. To do this, pass a dictionary to <code>agg</code> that contains a mapping of column names to any of the function specifications listed so far:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">79</span>]: grouped.agg({<span class="st">"tip"</span> : np.<span class="bu">max</span>, <span class="st">"size"</span> : <span class="st">"sum"</span>})</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">79</span>]: </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>               tip  size</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>day  smoker             </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>Fri  No       <span class="fl">3.50</span>     <span class="dv">9</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>     Yes      <span class="fl">4.73</span>    <span class="dv">31</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>Sat  No       <span class="fl">9.00</span>   <span class="dv">115</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>     Yes     <span class="fl">10.00</span>   <span class="dv">104</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>Sun  No       <span class="fl">6.00</span>   <span class="dv">167</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>     Yes      <span class="fl">6.50</span>    <span class="dv">49</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>Thur No       <span class="fl">6.70</span>   <span class="dv">112</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>     Yes      <span class="fl">5.00</span>    <span class="dv">40</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">80</span>]: grouped.agg({<span class="st">"tip_pct"</span> : [<span class="st">"min"</span>, <span class="st">"max"</span>, <span class="st">"mean"</span>, <span class="st">"std"</span>],</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>   ....:              <span class="st">"size"</span> : <span class="st">"sum"</span>})</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">80</span>]: </span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>              tip_pct                               size</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>                  <span class="bu">min</span>       <span class="bu">max</span>      mean       std  <span class="bu">sum</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>day  smoker                                             </span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>Fri  No      <span class="fl">0.120385</span>  <span class="fl">0.187735</span>  <span class="fl">0.151650</span>  <span class="fl">0.028123</span>    <span class="dv">9</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>     Yes     <span class="fl">0.103555</span>  <span class="fl">0.263480</span>  <span class="fl">0.174783</span>  <span class="fl">0.051293</span>   <span class="dv">31</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>Sat  No      <span class="fl">0.056797</span>  <span class="fl">0.291990</span>  <span class="fl">0.158048</span>  <span class="fl">0.039767</span>  <span class="dv">115</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>     Yes     <span class="fl">0.035638</span>  <span class="fl">0.325733</span>  <span class="fl">0.147906</span>  <span class="fl">0.061375</span>  <span class="dv">104</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>Sun  No      <span class="fl">0.059447</span>  <span class="fl">0.252672</span>  <span class="fl">0.160113</span>  <span class="fl">0.042347</span>  <span class="dv">167</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>     Yes     <span class="fl">0.065660</span>  <span class="fl">0.710345</span>  <span class="fl">0.187250</span>  <span class="fl">0.154134</span>   <span class="dv">49</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>Thur No      <span class="fl">0.072961</span>  <span class="fl">0.266312</span>  <span class="fl">0.160298</span>  <span class="fl">0.038774</span>  <span class="dv">112</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>     Yes     <span class="fl">0.090014</span>  <span class="fl">0.241255</span>  <span class="fl">0.163863</span>  <span class="fl">0.039389</span>   <span class="dv">40</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A DataFrame will have hierarchical columns only if multiple functions are applied to at least one column.</p>
</section>
<section id="groupby_agg_no_use_index" class="level3">
<h3 class="anchored" data-anchor-id="groupby_agg_no_use_index">Returning Aggregated Data Without Row Indexes</h3>
<p>In all of the examples up until now, the aggregated data comes back with an index, potentially hierarchical, composed from the unique group key combinations. Since this isn’t always desirable, you can disable this behavior in most cases by passing <code>as_index=False</code> to <code>groupby</code>:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">81</span>]: grouped <span class="op">=</span> tips.groupby([<span class="st">"day"</span>, <span class="st">"smoker"</span>], as_index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">82</span>]: grouped.mean(numeric_only<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">82</span>]: </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    day smoker  total_bill       tip      size   tip_pct</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   Fri     No   <span class="fl">18.420000</span>  <span class="fl">2.812500</span>  <span class="fl">2.250000</span>  <span class="fl">0.151650</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>   Fri    Yes   <span class="fl">16.813333</span>  <span class="fl">2.714000</span>  <span class="fl">2.066667</span>  <span class="fl">0.174783</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   Sat     No   <span class="fl">19.661778</span>  <span class="fl">3.102889</span>  <span class="fl">2.555556</span>  <span class="fl">0.158048</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   Sat    Yes   <span class="fl">21.276667</span>  <span class="fl">2.875476</span>  <span class="fl">2.476190</span>  <span class="fl">0.147906</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   Sun     No   <span class="fl">20.506667</span>  <span class="fl">3.167895</span>  <span class="fl">2.929825</span>  <span class="fl">0.160113</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>   Sun    Yes   <span class="fl">24.120000</span>  <span class="fl">3.516842</span>  <span class="fl">2.578947</span>  <span class="fl">0.187250</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>  Thur     No   <span class="fl">17.113111</span>  <span class="fl">2.673778</span>  <span class="fl">2.488889</span>  <span class="fl">0.160298</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>  Thur    Yes   <span class="fl">19.190588</span>  <span class="fl">3.030000</span>  <span class="fl">2.352941</span>  <span class="fl">0.163863</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Of course, it’s always possible to obtain the result in this format by calling <code>reset_index</code> on the result. Using the <code>as_index=False</code> argument avoids some unnecessary computations.</p>
</section>
</section>
<section id="groupby_apply" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="groupby_apply"><span class="header-section-number">10.3</span> Apply: General split-apply-combine</h2>
<p>The most general-purpose GroupBy method is <code>apply</code>, which is the subject of this section. <code>apply</code> splits the object being manipulated into pieces, invokes the passed function on each piece, and then attempts to concatenate the pieces.</p>
<p>Returning to the tipping dataset from before, suppose you wanted to select the top five <code>tip_pct</code> values by group. First, write a function that selects the rows with the largest values in a particular column:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">83</span>]: <span class="kw">def</span> top(df, n<span class="op">=</span><span class="dv">5</span>, column<span class="op">=</span><span class="st">"tip_pct"</span>):</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>   ....:     <span class="cf">return</span> df.sort_values(column, ascending<span class="op">=</span><span class="va">False</span>)[:n]</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">84</span>]: top(tips, n<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">84</span>]: </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>     total_bill   tip smoker  day    time  size   tip_pct</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="dv">172</span>        <span class="fl">7.25</span>  <span class="fl">5.15</span>    Yes  Sun  Dinner     <span class="dv">2</span>  <span class="fl">0.710345</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="dv">178</span>        <span class="fl">9.60</span>  <span class="fl">4.00</span>    Yes  Sun  Dinner     <span class="dv">2</span>  <span class="fl">0.416667</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="dv">67</span>         <span class="fl">3.07</span>  <span class="fl">1.00</span>    Yes  Sat  Dinner     <span class="dv">1</span>  <span class="fl">0.325733</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="dv">232</span>       <span class="fl">11.61</span>  <span class="fl">3.39</span>     No  Sat  Dinner     <span class="dv">2</span>  <span class="fl">0.291990</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="dv">183</span>       <span class="fl">23.17</span>  <span class="fl">6.50</span>    Yes  Sun  Dinner     <span class="dv">4</span>  <span class="fl">0.280535</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="dv">109</span>       <span class="fl">14.31</span>  <span class="fl">4.00</span>    Yes  Sat  Dinner     <span class="dv">2</span>  <span class="fl">0.279525</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, if we group by <code>smoker</code>, say, and call <code>apply</code> with this function, we get the following:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">85</span>]: tips.groupby(<span class="st">"smoker"</span>).<span class="bu">apply</span>(top)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">85</span>]: </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>            total_bill   tip smoker   day    time  size   tip_pct</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>smoker                                                           </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>No     <span class="dv">232</span>       <span class="fl">11.61</span>  <span class="fl">3.39</span>     No   Sat  Dinner     <span class="dv">2</span>  <span class="fl">0.291990</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>       <span class="dv">149</span>        <span class="fl">7.51</span>  <span class="fl">2.00</span>     No  Thur   Lunch     <span class="dv">2</span>  <span class="fl">0.266312</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>       <span class="dv">51</span>        <span class="fl">10.29</span>  <span class="fl">2.60</span>     No   Sun  Dinner     <span class="dv">2</span>  <span class="fl">0.252672</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>       <span class="dv">185</span>       <span class="fl">20.69</span>  <span class="fl">5.00</span>     No   Sun  Dinner     <span class="dv">5</span>  <span class="fl">0.241663</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>       <span class="dv">88</span>        <span class="fl">24.71</span>  <span class="fl">5.85</span>     No  Thur   Lunch     <span class="dv">2</span>  <span class="fl">0.236746</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>Yes    <span class="dv">172</span>        <span class="fl">7.25</span>  <span class="fl">5.15</span>    Yes   Sun  Dinner     <span class="dv">2</span>  <span class="fl">0.710345</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>       <span class="dv">178</span>        <span class="fl">9.60</span>  <span class="fl">4.00</span>    Yes   Sun  Dinner     <span class="dv">2</span>  <span class="fl">0.416667</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>       <span class="dv">67</span>         <span class="fl">3.07</span>  <span class="fl">1.00</span>    Yes   Sat  Dinner     <span class="dv">1</span>  <span class="fl">0.325733</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>       <span class="dv">183</span>       <span class="fl">23.17</span>  <span class="fl">6.50</span>    Yes   Sun  Dinner     <span class="dv">4</span>  <span class="fl">0.280535</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>       <span class="dv">109</span>       <span class="fl">14.31</span>  <span class="fl">4.00</span>    Yes   Sat  Dinner     <span class="dv">2</span>  <span class="fl">0.279525</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>What has happened here? First, the <code>tips</code> DataFrame is split into groups based on the value of <code>smoker</code>. Then the <code>top</code> function is called on each group, and the results of each function call are glued together using <code>pandas.concat</code>, labeling the pieces with the group names. The result therefore has a hierarchical index with an inner level that contains index values from the original DataFrame.</p>
<p>If you pass a function to <code>apply</code> that takes other arguments or keywords, you can pass these after the function:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">86</span>]: tips.groupby([<span class="st">"smoker"</span>, <span class="st">"day"</span>]).<span class="bu">apply</span>(top, n<span class="op">=</span><span class="dv">1</span>, column<span class="op">=</span><span class="st">"total_bill"</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">86</span>]: </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>                 total_bill    tip smoker   day    time  size   tip_pct</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>smoker day                                                             </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>No     Fri  <span class="dv">94</span>        <span class="fl">22.75</span>   <span class="fl">3.25</span>     No   Fri  Dinner     <span class="dv">2</span>  <span class="fl">0.142857</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>       Sat  <span class="dv">212</span>       <span class="fl">48.33</span>   <span class="fl">9.00</span>     No   Sat  Dinner     <span class="dv">4</span>  <span class="fl">0.186220</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>       Sun  <span class="dv">156</span>       <span class="fl">48.17</span>   <span class="fl">5.00</span>     No   Sun  Dinner     <span class="dv">6</span>  <span class="fl">0.103799</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>       Thur <span class="dv">142</span>       <span class="fl">41.19</span>   <span class="fl">5.00</span>     No  Thur   Lunch     <span class="dv">5</span>  <span class="fl">0.121389</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>Yes    Fri  <span class="dv">95</span>        <span class="fl">40.17</span>   <span class="fl">4.73</span>    Yes   Fri  Dinner     <span class="dv">4</span>  <span class="fl">0.117750</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>       Sat  <span class="dv">170</span>       <span class="fl">50.81</span>  <span class="fl">10.00</span>    Yes   Sat  Dinner     <span class="dv">3</span>  <span class="fl">0.196812</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>       Sun  <span class="dv">182</span>       <span class="fl">45.35</span>   <span class="fl">3.50</span>    Yes   Sun  Dinner     <span class="dv">3</span>  <span class="fl">0.077178</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>       Thur <span class="dv">197</span>       <span class="fl">43.11</span>   <span class="fl">5.00</span>    Yes  Thur   Lunch     <span class="dv">4</span>  <span class="fl">0.115982</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Beyond these basic usage mechanics, getting the most out of <code>apply</code> may require some creativity. What occurs inside the function passed is up to you; it must either return a pandas object or a scalar value. The rest of this chapter will consist mainly of examples showing you how to solve various problems using <code>groupby</code>.</p>
<p>For example, you may recall that I earlier called <code>describe</code> on a GroupBy object:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">87</span>]: result <span class="op">=</span> tips.groupby(<span class="st">"smoker"</span>)[<span class="st">"tip_pct"</span>].describe()</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">88</span>]: result</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">88</span>]: </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>        count      mean       std       <span class="bu">min</span>       <span class="dv">25</span><span class="op">%</span>       <span class="dv">50</span><span class="op">%</span>       <span class="dv">75</span><span class="op">%</span>   </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>smoker                                                                      </span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>No      <span class="fl">151.0</span>  <span class="fl">0.159328</span>  <span class="fl">0.039910</span>  <span class="fl">0.056797</span>  <span class="fl">0.136906</span>  <span class="fl">0.155625</span>  <span class="fl">0.185014</span>  <span class="op">\</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>Yes      <span class="fl">93.0</span>  <span class="fl">0.163196</span>  <span class="fl">0.085119</span>  <span class="fl">0.035638</span>  <span class="fl">0.106771</span>  <span class="fl">0.153846</span>  <span class="fl">0.195059</span>   </span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>             <span class="bu">max</span>  </span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>smoker            </span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>No      <span class="fl">0.291990</span>  </span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>Yes     <span class="fl">0.710345</span>  </span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">89</span>]: result.unstack(<span class="st">"smoker"</span>)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">89</span>]: </span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>       smoker</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>count  No        <span class="fl">151.000000</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>       Yes        <span class="fl">93.000000</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>mean   No          <span class="fl">0.159328</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>       Yes         <span class="fl">0.163196</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>std    No          <span class="fl">0.039910</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>       Yes         <span class="fl">0.085119</span></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a><span class="bu">min</span>    No          <span class="fl">0.056797</span></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>       Yes         <span class="fl">0.035638</span></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a><span class="dv">25</span><span class="op">%</span>    No          <span class="fl">0.136906</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>       Yes         <span class="fl">0.106771</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a><span class="dv">50</span><span class="op">%</span>    No          <span class="fl">0.155625</span></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>       Yes         <span class="fl">0.153846</span></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a><span class="dv">75</span><span class="op">%</span>    No          <span class="fl">0.185014</span></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>       Yes         <span class="fl">0.195059</span></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a><span class="bu">max</span>    No          <span class="fl">0.291990</span></span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>       Yes         <span class="fl">0.710345</span></span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Inside GroupBy, when you invoke a method like <code>describe</code>, it is actually just a shortcut for:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(group):</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> group.describe()</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>grouped.<span class="bu">apply</span>(f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="groupby_apply_group_keys" class="level3">
<h3 class="anchored" data-anchor-id="groupby_apply_group_keys">Suppressing the Group Keys</h3>
<p>In the preceding examples, you see that the resulting object has a hierarchical index formed from the group keys, along with the indexes of each piece of the original object. You can disable this by passing <code>group_keys=False</code> to <code>groupby</code>:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">90</span>]: tips.groupby(<span class="st">"smoker"</span>, group_keys<span class="op">=</span><span class="va">False</span>).<span class="bu">apply</span>(top)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">90</span>]: </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>     total_bill   tip smoker   day    time  size   tip_pct</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="dv">232</span>       <span class="fl">11.61</span>  <span class="fl">3.39</span>     No   Sat  Dinner     <span class="dv">2</span>  <span class="fl">0.291990</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="dv">149</span>        <span class="fl">7.51</span>  <span class="fl">2.00</span>     No  Thur   Lunch     <span class="dv">2</span>  <span class="fl">0.266312</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="dv">51</span>        <span class="fl">10.29</span>  <span class="fl">2.60</span>     No   Sun  Dinner     <span class="dv">2</span>  <span class="fl">0.252672</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="dv">185</span>       <span class="fl">20.69</span>  <span class="fl">5.00</span>     No   Sun  Dinner     <span class="dv">5</span>  <span class="fl">0.241663</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="dv">88</span>        <span class="fl">24.71</span>  <span class="fl">5.85</span>     No  Thur   Lunch     <span class="dv">2</span>  <span class="fl">0.236746</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="dv">172</span>        <span class="fl">7.25</span>  <span class="fl">5.15</span>    Yes   Sun  Dinner     <span class="dv">2</span>  <span class="fl">0.710345</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="dv">178</span>        <span class="fl">9.60</span>  <span class="fl">4.00</span>    Yes   Sun  Dinner     <span class="dv">2</span>  <span class="fl">0.416667</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="dv">67</span>         <span class="fl">3.07</span>  <span class="fl">1.00</span>    Yes   Sat  Dinner     <span class="dv">1</span>  <span class="fl">0.325733</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="dv">183</span>       <span class="fl">23.17</span>  <span class="fl">6.50</span>    Yes   Sun  Dinner     <span class="dv">4</span>  <span class="fl">0.280535</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="dv">109</span>       <span class="fl">14.31</span>  <span class="fl">4.00</span>    Yes   Sat  Dinner     <span class="dv">2</span>  <span class="fl">0.279525</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="groupby_apply_quantile" class="level3">
<h3 class="anchored" data-anchor-id="groupby_apply_quantile">Quantile and Bucket Analysis</h3>
<p>As you may recall from <a href='/book/data-wrangling'>Ch 8: Data Wrangling: Join, Combine, and Reshape</a>, pandas has some tools, in particular <code>pandas.cut</code> and <code>pandas.qcut</code>, for slicing data up into buckets with bins of your choosing, or by sample quantiles. Combining these functions with <code>groupby</code> makes it convenient to perform bucket or quantile analysis on a dataset. Consider a simple random dataset and an equal-length bucket categorization using <code>pandas.cut</code>:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">91</span>]: frame <span class="op">=</span> pd.DataFrame({<span class="st">"data1"</span>: np.random.standard_normal(<span class="dv">1000</span>),</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>   ....:                       <span class="st">"data2"</span>: np.random.standard_normal(<span class="dv">1000</span>)})</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">92</span>]: frame.head()</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">92</span>]: </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>      data1     data2</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span> <span class="op">-</span><span class="fl">0.660524</span> <span class="op">-</span><span class="fl">0.612905</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">0.862580</span>  <span class="fl">0.316447</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="op">-</span><span class="fl">0.010032</span>  <span class="fl">0.838295</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>  <span class="fl">0.050009</span> <span class="op">-</span><span class="fl">1.034423</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>  <span class="fl">0.670216</span>  <span class="fl">0.434304</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">93</span>]: quartiles <span class="op">=</span> pd.cut(frame[<span class="st">"data1"</span>], <span class="dv">4</span>)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">94</span>]: quartiles.head(<span class="dv">10</span>)</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">94</span>]: </span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     (<span class="op">-</span><span class="fl">1.23</span>, <span class="fl">0.489</span>]</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     (<span class="fl">0.489</span>, <span class="fl">2.208</span>]</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>     (<span class="op">-</span><span class="fl">1.23</span>, <span class="fl">0.489</span>]</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     (<span class="op">-</span><span class="fl">1.23</span>, <span class="fl">0.489</span>]</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>     (<span class="fl">0.489</span>, <span class="fl">2.208</span>]</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>     (<span class="fl">0.489</span>, <span class="fl">2.208</span>]</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>     (<span class="op">-</span><span class="fl">1.23</span>, <span class="fl">0.489</span>]</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>     (<span class="op">-</span><span class="fl">1.23</span>, <span class="fl">0.489</span>]</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>    (<span class="op">-</span><span class="fl">2.956</span>, <span class="op">-</span><span class="fl">1.23</span>]</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>     (<span class="op">-</span><span class="fl">1.23</span>, <span class="fl">0.489</span>]</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>Name: data1, dtype: category</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>Categories (<span class="dv">4</span>, interval[float64, right]): [(<span class="op">-</span><span class="fl">2.956</span>, <span class="op">-</span><span class="fl">1.23</span>] <span class="op">&lt;</span> (<span class="op">-</span><span class="fl">1.23</span>, <span class="fl">0.489</span>] <span class="op">&lt;</span> (<span class="fl">0.</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a><span class="dv">489</span>, <span class="fl">2.208</span>] <span class="op">&lt;</span></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>                                           (<span class="fl">2.208</span>, <span class="fl">3.928</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>Categorical</code> object returned by <code>cut</code> can be passed directly to <code>groupby</code>. So we could compute a set of group statistics for the quartiles, like so:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">95</span>]: <span class="kw">def</span> get_stats(group):</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>   ....:     <span class="cf">return</span> pd.DataFrame(</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>   ....:         {<span class="st">"min"</span>: group.<span class="bu">min</span>(), <span class="st">"max"</span>: group.<span class="bu">max</span>(),</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>   ....:         <span class="st">"count"</span>: group.count(), <span class="st">"mean"</span>: group.mean()}</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>   ....:     )</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">96</span>]: grouped <span class="op">=</span> frame.groupby(quartiles)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">97</span>]: grouped.<span class="bu">apply</span>(get_stats)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">97</span>]: </span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>                            <span class="bu">min</span>       <span class="bu">max</span>  count      mean</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>data1                                                     </span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span><span class="fl">2.956</span>, <span class="op">-</span><span class="fl">1.23</span>] data1 <span class="op">-</span><span class="fl">2.949343</span> <span class="op">-</span><span class="fl">1.230179</span>     <span class="dv">94</span> <span class="op">-</span><span class="fl">1.658818</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>                data2 <span class="op">-</span><span class="fl">3.399312</span>  <span class="fl">1.670835</span>     <span class="dv">94</span> <span class="op">-</span><span class="fl">0.033333</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span><span class="fl">1.23</span>, <span class="fl">0.489</span>]  data1 <span class="op">-</span><span class="fl">1.228918</span>  <span class="fl">0.488675</span>    <span class="dv">598</span> <span class="op">-</span><span class="fl">0.329524</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>                data2 <span class="op">-</span><span class="fl">2.989741</span>  <span class="fl">3.260383</span>    <span class="dv">598</span> <span class="op">-</span><span class="fl">0.002622</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>(<span class="fl">0.489</span>, <span class="fl">2.208</span>]  data1  <span class="fl">0.489965</span>  <span class="fl">2.200997</span>    <span class="dv">298</span>  <span class="fl">1.065727</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>                data2 <span class="op">-</span><span class="fl">3.745356</span>  <span class="fl">2.954439</span>    <span class="dv">298</span>  <span class="fl">0.078249</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>(<span class="fl">2.208</span>, <span class="fl">3.928</span>]  data1  <span class="fl">2.212303</span>  <span class="fl">3.927528</span>     <span class="dv">10</span>  <span class="fl">2.644253</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>                data2 <span class="op">-</span><span class="fl">1.929776</span>  <span class="fl">1.765640</span>     <span class="dv">10</span>  <span class="fl">0.024750</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Keep in mind the same result could have been computed more simply with:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">98</span>]: grouped.agg([<span class="st">"min"</span>, <span class="st">"max"</span>, <span class="st">"count"</span>, <span class="st">"mean"</span>])</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">98</span>]: </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>                    data1                               data2                   </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>                      <span class="bu">min</span>       <span class="bu">max</span> count      mean       <span class="bu">min</span>       <span class="bu">max</span> count   </span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>data1                                                                           </span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span><span class="fl">2.956</span>, <span class="op">-</span><span class="fl">1.23</span>] <span class="op">-</span><span class="fl">2.949343</span> <span class="op">-</span><span class="fl">1.230179</span>    <span class="dv">94</span> <span class="op">-</span><span class="fl">1.658818</span> <span class="op">-</span><span class="fl">3.399312</span>  <span class="fl">1.670835</span>    <span class="dv">94</span>  <span class="op">\</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span><span class="fl">1.23</span>, <span class="fl">0.489</span>]  <span class="op">-</span><span class="fl">1.228918</span>  <span class="fl">0.488675</span>   <span class="dv">598</span> <span class="op">-</span><span class="fl">0.329524</span> <span class="op">-</span><span class="fl">2.989741</span>  <span class="fl">3.260383</span>   <span class="dv">598</span>   </span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>(<span class="fl">0.489</span>, <span class="fl">2.208</span>]   <span class="fl">0.489965</span>  <span class="fl">2.200997</span>   <span class="dv">298</span>  <span class="fl">1.065727</span> <span class="op">-</span><span class="fl">3.745356</span>  <span class="fl">2.954439</span>   <span class="dv">298</span>   </span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>(<span class="fl">2.208</span>, <span class="fl">3.928</span>]   <span class="fl">2.212303</span>  <span class="fl">3.927528</span>    <span class="dv">10</span>  <span class="fl">2.644253</span> <span class="op">-</span><span class="fl">1.929776</span>  <span class="fl">1.765640</span>    <span class="dv">10</span>   </span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>                           </span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>                     mean  </span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>data1                      </span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span><span class="fl">2.956</span>, <span class="op">-</span><span class="fl">1.23</span>] <span class="op">-</span><span class="fl">0.033333</span>  </span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span><span class="fl">1.23</span>, <span class="fl">0.489</span>]  <span class="op">-</span><span class="fl">0.002622</span>  </span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>(<span class="fl">0.489</span>, <span class="fl">2.208</span>]   <span class="fl">0.078249</span>  </span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>(<span class="fl">2.208</span>, <span class="fl">3.928</span>]   <span class="fl">0.024750</span>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These were equal-length buckets; to compute equal-size buckets based on sample quantiles, use <code>pandas.qcut</code>. We can pass <code>4</code> as the number of bucket compute sample quartiles, and pass <code>labels=False</code> to obtain just the quartile indices instead of intervals:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">99</span>]: quartiles_samp <span class="op">=</span> pd.qcut(frame[<span class="st">"data1"</span>], <span class="dv">4</span>, labels<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">100</span>]: quartiles_samp.head()</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">100</span>]: </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="dv">1</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="dv">3</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="dv">2</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="dv">2</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="dv">3</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>Name: data1, dtype: int64</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">101</span>]: grouped <span class="op">=</span> frame.groupby(quartiles_samp)</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">102</span>]: grouped.<span class="bu">apply</span>(get_stats)</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">102</span>]: </span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>                  <span class="bu">min</span>       <span class="bu">max</span>  count      mean</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>data1                                           </span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     data1 <span class="op">-</span><span class="fl">2.949343</span> <span class="op">-</span><span class="fl">0.685484</span>    <span class="dv">250</span> <span class="op">-</span><span class="fl">1.212173</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>      data2 <span class="op">-</span><span class="fl">3.399312</span>  <span class="fl">2.628441</span>    <span class="dv">250</span> <span class="op">-</span><span class="fl">0.027045</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     data1 <span class="op">-</span><span class="fl">0.683066</span> <span class="op">-</span><span class="fl">0.030280</span>    <span class="dv">250</span> <span class="op">-</span><span class="fl">0.368334</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>      data2 <span class="op">-</span><span class="fl">2.630247</span>  <span class="fl">3.260383</span>    <span class="dv">250</span> <span class="op">-</span><span class="fl">0.027845</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>     data1 <span class="op">-</span><span class="fl">0.027734</span>  <span class="fl">0.618965</span>    <span class="dv">250</span>  <span class="fl">0.295812</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>      data2 <span class="op">-</span><span class="fl">3.056990</span>  <span class="fl">2.458842</span>    <span class="dv">250</span>  <span class="fl">0.014450</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     data1  <span class="fl">0.623587</span>  <span class="fl">3.927528</span>    <span class="dv">250</span>  <span class="fl">1.248875</span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>      data2 <span class="op">-</span><span class="fl">3.745356</span>  <span class="fl">2.954439</span>    <span class="dv">250</span>  <span class="fl">0.115899</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="groupby_apply_fill_group_mean" class="level3">
<h3 class="anchored" data-anchor-id="groupby_apply_fill_group_mean">Example: Filling Missing Values with Group-Specific Values</h3>
<p>When cleaning up missing data, in some cases you will remove data observations using <code>dropna</code>, but in others you may want to fill in the null (NA) values using a fixed value or some value derived from the data. <code>fillna</code> is the right tool to use; for example, here I fill in the null values with the mean:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">103</span>]: s <span class="op">=</span> pd.Series(np.random.standard_normal(<span class="dv">6</span>))</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">104</span>]: s[::<span class="dv">2</span>] <span class="op">=</span> np.nan</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">105</span>]: s</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">105</span>]: </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>         NaN</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="fl">0.227290</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>         NaN</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   <span class="op">-</span><span class="fl">2.153545</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>         NaN</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>   <span class="op">-</span><span class="fl">0.375842</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>dtype: float64</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">106</span>]: s.fillna(s.mean())</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">106</span>]: </span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>   <span class="op">-</span><span class="fl">0.767366</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="fl">0.227290</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>   <span class="op">-</span><span class="fl">0.767366</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>   <span class="op">-</span><span class="fl">2.153545</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>   <span class="op">-</span><span class="fl">0.767366</span></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>   <span class="op">-</span><span class="fl">0.375842</span></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Suppose you need the fill value to vary by group. One way to do this is to group the data and use <code>apply</code> with a function that calls <code>fillna</code> on each data chunk. Here is some sample data on US states divided into eastern and western regions:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">107</span>]: states <span class="op">=</span> [<span class="st">"Ohio"</span>, <span class="st">"New York"</span>, <span class="st">"Vermont"</span>, <span class="st">"Florida"</span>,</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>   .....:           <span class="st">"Oregon"</span>, <span class="st">"Nevada"</span>, <span class="st">"California"</span>, <span class="st">"Idaho"</span>]</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">108</span>]: group_key <span class="op">=</span> [<span class="st">"East"</span>, <span class="st">"East"</span>, <span class="st">"East"</span>, <span class="st">"East"</span>,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>   .....:              <span class="st">"West"</span>, <span class="st">"West"</span>, <span class="st">"West"</span>, <span class="st">"West"</span>]</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">109</span>]: data <span class="op">=</span> pd.Series(np.random.standard_normal(<span class="dv">8</span>), index<span class="op">=</span>states)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">110</span>]: data</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">110</span>]: </span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>Ohio          <span class="fl">0.329939</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>New York      <span class="fl">0.981994</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>Vermont       <span class="fl">1.105913</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>Florida      <span class="op">-</span><span class="fl">1.613716</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>Oregon        <span class="fl">1.561587</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>Nevada        <span class="fl">0.406510</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>California    <span class="fl">0.359244</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>Idaho        <span class="op">-</span><span class="fl">0.614436</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let's set some values in the data to be missing:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">111</span>]: data[[<span class="st">"Vermont"</span>, <span class="st">"Nevada"</span>, <span class="st">"Idaho"</span>]] <span class="op">=</span> np.nan</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">112</span>]: data</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">112</span>]: </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>Ohio          <span class="fl">0.329939</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>New York      <span class="fl">0.981994</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>Vermont            NaN</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>Florida      <span class="op">-</span><span class="fl">1.613716</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>Oregon        <span class="fl">1.561587</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>Nevada             NaN</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>California    <span class="fl">0.359244</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>Idaho              NaN</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>dtype: float64</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">113</span>]: data.groupby(group_key).size()</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">113</span>]: </span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>East    <span class="dv">4</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>West    <span class="dv">4</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>dtype: int64</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">114</span>]: data.groupby(group_key).count()</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">114</span>]: </span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>East    <span class="dv">3</span></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>West    <span class="dv">2</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>dtype: int64</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">115</span>]: data.groupby(group_key).mean()</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">115</span>]: </span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>East   <span class="op">-</span><span class="fl">0.100594</span></span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>West    <span class="fl">0.960416</span></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can fill the NA values using the group means, like so:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">116</span>]: <span class="kw">def</span> fill_mean(group):</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>   .....:     <span class="cf">return</span> group.fillna(group.mean())</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">117</span>]: data.groupby(group_key).<span class="bu">apply</span>(fill_mean)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">117</span>]: </span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>East  Ohio          <span class="fl">0.329939</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>      New York      <span class="fl">0.981994</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>      Vermont      <span class="op">-</span><span class="fl">0.100594</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>      Florida      <span class="op">-</span><span class="fl">1.613716</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>West  Oregon        <span class="fl">1.561587</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>      Nevada        <span class="fl">0.960416</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>      California    <span class="fl">0.359244</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>      Idaho         <span class="fl">0.960416</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In another case, you might have predefined fill values in your code that vary by group. Since the groups have a <code>name</code> attribute set internally, we can use that:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">118</span>]: fill_values <span class="op">=</span> {<span class="st">"East"</span>: <span class="fl">0.5</span>, <span class="st">"West"</span>: <span class="op">-</span><span class="dv">1</span>}</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">119</span>]: <span class="kw">def</span> fill_func(group):</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>   .....:     <span class="cf">return</span> group.fillna(fill_values[group.name])</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">120</span>]: data.groupby(group_key).<span class="bu">apply</span>(fill_func)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">120</span>]: </span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>East  Ohio          <span class="fl">0.329939</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>      New York      <span class="fl">0.981994</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>      Vermont       <span class="fl">0.500000</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>      Florida      <span class="op">-</span><span class="fl">1.613716</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>West  Oregon        <span class="fl">1.561587</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>      Nevada       <span class="op">-</span><span class="fl">1.000000</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>      California    <span class="fl">0.359244</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>      Idaho        <span class="op">-</span><span class="fl">1.000000</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="groupby_apply_sampling" class="level3">
<h3 class="anchored" data-anchor-id="groupby_apply_sampling">Example: Random Sampling and Permutation</h3>
<p>Suppose you wanted to draw a random sample (with or without replacement) from a large dataset for Monte Carlo simulation purposes or some other application. There are a number of ways to perform the “draws”; here we use the <code>sample</code> method for Series.</p>
<p>To demonstrate, here’s a way to construct a deck of English-style playing cards:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>suits <span class="op">=</span> [<span class="st">"H"</span>, <span class="st">"S"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>]  <span class="co"># Hearts, Spades, Clubs, Diamonds</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>card_val <span class="op">=</span> (<span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">11</span>)) <span class="op">+</span> [<span class="dv">10</span>] <span class="op">*</span> <span class="dv">3</span>) <span class="op">*</span> <span class="dv">4</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>base_names <span class="op">=</span> [<span class="st">"A"</span>] <span class="op">+</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">11</span>)) <span class="op">+</span> [<span class="st">"J"</span>, <span class="st">"K"</span>, <span class="st">"Q"</span>]</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>cards <span class="op">=</span> []</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> suit <span class="kw">in</span> suits:</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    cards.extend(<span class="bu">str</span>(num) <span class="op">+</span> suit <span class="cf">for</span> num <span class="kw">in</span> base_names)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>deck <span class="op">=</span> pd.Series(card_val, index<span class="op">=</span>cards)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now we have a Series of length 52 whose index contains card names, and values are the ones used in blackjack and other games (to keep things simple, I let the ace <code>"A"</code> be 1):</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">122</span>]: deck.head(<span class="dv">13</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">122</span>]: </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>AH      <span class="dv">1</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span><span class="er">H</span>      <span class="dv">2</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="er">H</span>      <span class="dv">3</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="er">H</span>      <span class="dv">4</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="er">H</span>      <span class="dv">5</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span><span class="er">H</span>      <span class="dv">6</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span><span class="er">H</span>      <span class="dv">7</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span><span class="er">H</span>      <span class="dv">8</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span><span class="er">H</span>      <span class="dv">9</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span><span class="er">H</span>    <span class="dv">10</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>JH     <span class="dv">10</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>KH     <span class="dv">10</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>QH     <span class="dv">10</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, based on what I said before, drawing a hand of five cards from the deck could be written as:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">123</span>]: <span class="kw">def</span> draw(deck, n<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>   .....:     <span class="cf">return</span> deck.sample(n)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">124</span>]: draw(deck)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">124</span>]: </span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="er">D</span>     <span class="dv">4</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>QH    <span class="dv">10</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span><span class="er">S</span>     <span class="dv">8</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span><span class="er">D</span>     <span class="dv">7</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span><span class="er">C</span>     <span class="dv">9</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Suppose you wanted two random cards from each suit. Because the suit is the last character of each card name, we can group based on this and use <code>apply</code>:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">125</span>]: <span class="kw">def</span> get_suit(card):</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>   .....:     <span class="co"># last letter is suit</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>   .....:     <span class="cf">return</span> card[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">126</span>]: deck.groupby(get_suit).<span class="bu">apply</span>(draw, n<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">126</span>]: </span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>C  <span class="dv">6</span><span class="er">C</span>     <span class="dv">6</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>   KC    <span class="dv">10</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>D  <span class="dv">7</span><span class="er">D</span>     <span class="dv">7</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>   <span class="dv">3</span><span class="er">D</span>     <span class="dv">3</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>H  <span class="dv">7</span><span class="er">H</span>     <span class="dv">7</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>   <span class="dv">9</span><span class="er">H</span>     <span class="dv">9</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>S  <span class="dv">2</span><span class="er">S</span>     <span class="dv">2</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>   QS    <span class="dv">10</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Alternatively, we could pass <code>group_keys=False</code> to drop the outer suit index, leaving in just the selected cards:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">127</span>]: deck.groupby(get_suit, group_keys<span class="op">=</span><span class="va">False</span>).<span class="bu">apply</span>(draw, n<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">127</span>]: </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>AC      <span class="dv">1</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="er">C</span>      <span class="dv">3</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span><span class="er">D</span>      <span class="dv">5</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span><span class="er">D</span>      <span class="dv">4</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span><span class="er">H</span>    <span class="dv">10</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span><span class="er">H</span>      <span class="dv">7</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>QS     <span class="dv">10</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span><span class="er">S</span>      <span class="dv">7</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>dtype: int64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="groupby_apply_wavg" class="level3">
<h3 class="anchored" data-anchor-id="groupby_apply_wavg">Example: Group Weighted Average and Correlation</h3>
<p>Under the split-apply-combine paradigm of <code>groupby</code>, operations between columns in a DataFrame or two Series, such as a group weighted average, are possible. As an example, take this dataset containing group keys, values, and some weights:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">128</span>]: df <span class="op">=</span> pd.DataFrame({<span class="st">"category"</span>: [<span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"a"</span>,</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>   .....:                                 <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>],</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>   .....:                    <span class="st">"data"</span>: np.random.standard_normal(<span class="dv">8</span>),</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>   .....:                    <span class="st">"weights"</span>: np.random.uniform(size<span class="op">=</span><span class="dv">8</span>)})</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">129</span>]: df</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">129</span>]: </span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  category      data   weights</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>        a <span class="op">-</span><span class="fl">1.691656</span>  <span class="fl">0.955905</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>        a  <span class="fl">0.511622</span>  <span class="fl">0.012745</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>        a <span class="op">-</span><span class="fl">0.401675</span>  <span class="fl">0.137009</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>        a  <span class="fl">0.968578</span>  <span class="fl">0.763037</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>        b <span class="op">-</span><span class="fl">1.818215</span>  <span class="fl">0.492472</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>        b  <span class="fl">0.279963</span>  <span class="fl">0.832908</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>        b <span class="op">-</span><span class="fl">0.200819</span>  <span class="fl">0.658331</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>        b <span class="op">-</span><span class="fl">0.217221</span>  <span class="fl">0.612009</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The weighted average by <code>category</code> would then be:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">130</span>]: grouped <span class="op">=</span> df.groupby(<span class="st">"category"</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">131</span>]: <span class="kw">def</span> get_wavg(group):</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>   .....:     <span class="cf">return</span> np.average(group[<span class="st">"data"</span>], weights<span class="op">=</span>group[<span class="st">"weights"</span>])</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">132</span>]: grouped.<span class="bu">apply</span>(get_wavg)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">132</span>]: </span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>category</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>a   <span class="op">-</span><span class="fl">0.495807</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>b   <span class="op">-</span><span class="fl">0.357273</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As another example, consider a financial dataset originally obtained from Yahoo! Finance containing end-of-day prices for a few stocks and the S&amp;P 500 index (the <code>SPX</code> symbol):</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">133</span>]: close_px <span class="op">=</span> pd.read_csv(<span class="st">"examples/stock_px.csv"</span>, parse_dates<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>   .....:                        index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">134</span>]: close_px.info()</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span><span class="kw">class</span> <span class="st">'pandas.core.frame.DataFrame'</span><span class="op">&gt;</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>DatetimeIndex: <span class="dv">2214</span> entries, <span class="dv">2003</span><span class="op">-</span><span class="dv">0</span><span class="er">1</span><span class="op">-</span><span class="dv">0</span><span class="er">2</span> to <span class="dv">2011</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">14</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>Data columns (total <span class="dv">4</span> columns):</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a> <span class="co">#   Column  Non-Null Count  Dtype  </span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="op">---</span>  <span class="op">------</span>  <span class="op">--------------</span>  <span class="op">-----</span>  </span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a> <span class="dv">0</span>   AAPL    <span class="dv">2214</span> non<span class="op">-</span>null   float64</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a> <span class="dv">1</span>   MSFT    <span class="dv">2214</span> non<span class="op">-</span>null   float64</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a> <span class="dv">2</span>   XOM     <span class="dv">2214</span> non<span class="op">-</span>null   float64</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a> <span class="dv">3</span>   SPX     <span class="dv">2214</span> non<span class="op">-</span>null   float64</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>dtypes: float64(<span class="dv">4</span>)</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>memory usage: <span class="fl">86.5</span> KB</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">135</span>]: close_px.tail(<span class="dv">4</span>)</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">135</span>]: </span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>              AAPL   MSFT    XOM      SPX</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a><span class="dv">2011</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">11</span>  <span class="fl">400.29</span>  <span class="fl">27.00</span>  <span class="fl">76.27</span>  <span class="fl">1195.54</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a><span class="dv">2011</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">12</span>  <span class="fl">402.19</span>  <span class="fl">26.96</span>  <span class="fl">77.16</span>  <span class="fl">1207.25</span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a><span class="dv">2011</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">13</span>  <span class="fl">408.43</span>  <span class="fl">27.18</span>  <span class="fl">76.37</span>  <span class="fl">1203.66</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a><span class="dv">2011</span><span class="op">-</span><span class="dv">10</span><span class="op">-</span><span class="dv">14</span>  <span class="fl">422.00</span>  <span class="fl">27.27</span>  <span class="fl">78.11</span>  <span class="fl">1224.58</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The DataFrame <code>info()</code> method here is a convenient way to get an overview of the contents of a DataFrame.</p>
<p>One task of interest might be to compute a DataFrame consisting of the yearly correlations of daily returns (computed from percent changes) with <code>SPX</code>. As one way to do this, we first create a function that computes the pair-wise correlation of each column with the <code>"SPX"</code> column:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">136</span>]: <span class="kw">def</span> spx_corr(group):</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>   .....:     <span class="cf">return</span> group.corrwith(group[<span class="st">"SPX"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next, we compute percent change on <code>close_px</code> using <code>pct_change</code>:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">137</span>]: rets <span class="op">=</span> close_px.pct_change().dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Lastly, we group these percent changes by year, which can be extracted from each row label with a one-line function that returns the <code>year</code> attribute of each <code>datetime</code> label:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">138</span>]: <span class="kw">def</span> get_year(x):</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>   .....:     <span class="cf">return</span> x.year</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">139</span>]: by_year <span class="op">=</span> rets.groupby(get_year)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">140</span>]: by_year.<span class="bu">apply</span>(spx_corr)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">140</span>]: </span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>          AAPL      MSFT       XOM  SPX</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2003</span>  <span class="fl">0.541124</span>  <span class="fl">0.745174</span>  <span class="fl">0.661265</span>  <span class="fl">1.0</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2004</span>  <span class="fl">0.374283</span>  <span class="fl">0.588531</span>  <span class="fl">0.557742</span>  <span class="fl">1.0</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2005</span>  <span class="fl">0.467540</span>  <span class="fl">0.562374</span>  <span class="fl">0.631010</span>  <span class="fl">1.0</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="dv">2006</span>  <span class="fl">0.428267</span>  <span class="fl">0.406126</span>  <span class="fl">0.518514</span>  <span class="fl">1.0</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a><span class="dv">2007</span>  <span class="fl">0.508118</span>  <span class="fl">0.658770</span>  <span class="fl">0.786264</span>  <span class="fl">1.0</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="dv">2008</span>  <span class="fl">0.681434</span>  <span class="fl">0.804626</span>  <span class="fl">0.828303</span>  <span class="fl">1.0</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="dv">2009</span>  <span class="fl">0.707103</span>  <span class="fl">0.654902</span>  <span class="fl">0.797921</span>  <span class="fl">1.0</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a><span class="dv">2010</span>  <span class="fl">0.710105</span>  <span class="fl">0.730118</span>  <span class="fl">0.839057</span>  <span class="fl">1.0</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a><span class="dv">2011</span>  <span class="fl">0.691931</span>  <span class="fl">0.800996</span>  <span class="fl">0.859975</span>  <span class="fl">1.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You could also compute intercolumn correlations. Here we compute the annual correlation between Apple and Microsoft:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">141</span>]: <span class="kw">def</span> corr_aapl_msft(group):</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>   .....:     <span class="cf">return</span> group[<span class="st">"AAPL"</span>].corr(group[<span class="st">"MSFT"</span>])</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">142</span>]: by_year.<span class="bu">apply</span>(corr_aapl_msft)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">142</span>]: </span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2003</span>    <span class="fl">0.480868</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2004</span>    <span class="fl">0.259024</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2005</span>    <span class="fl">0.300093</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2006</span>    <span class="fl">0.161735</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2007</span>    <span class="fl">0.417738</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2008</span>    <span class="fl">0.611901</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="dv">2009</span>    <span class="fl">0.432738</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="dv">2010</span>    <span class="fl">0.571946</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a><span class="dv">2011</span>    <span class="fl">0.581987</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="groupby_apply_linreg" class="level3">
<h3 class="anchored" data-anchor-id="groupby_apply_linreg">Example: Group-Wise Linear Regression</h3>
<p>In the same theme as the previous example, you can use <code>groupby</code> to perform more complex group-wise statistical analysis, as long as the function returns a pandas object or scalar value. For example, I can define the following <code>regress</code> function (using the <code>statsmodels</code> econometrics library), which executes an ordinary least squares (OLS) regression on each chunk of data:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> regress(data, yvar<span class="op">=</span><span class="va">None</span>, xvars<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    Y <span class="op">=</span> data[yvar]</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> data[xvars]</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    X[<span class="st">"intercept"</span>] <span class="op">=</span> <span class="fl">1.</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> sm.OLS(Y, X).fit()</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result.params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can install <code>statsmodels</code> with conda if you don't have it already:</p>
<pre><code>conda install statsmodels</code></pre>
<p>Now, to run a yearly linear regression of <code>AAPL</code> on <code>SPX</code> returns, execute:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">144</span>]: by_year.<span class="bu">apply</span>(regress, yvar<span class="op">=</span><span class="st">"AAPL"</span>, xvars<span class="op">=</span>[<span class="st">"SPX"</span>])</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">144</span>]: </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>           SPX  intercept</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="dv">2003</span>  <span class="fl">1.195406</span>   <span class="fl">0.000710</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2004</span>  <span class="fl">1.363463</span>   <span class="fl">0.004201</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2005</span>  <span class="fl">1.766415</span>   <span class="fl">0.003246</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2006</span>  <span class="fl">1.645496</span>   <span class="fl">0.000080</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2007</span>  <span class="fl">1.198761</span>   <span class="fl">0.003438</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2008</span>  <span class="fl">0.968016</span>  <span class="op">-</span><span class="fl">0.001110</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="dv">2009</span>  <span class="fl">0.879103</span>   <span class="fl">0.002954</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="dv">2010</span>  <span class="fl">1.052608</span>   <span class="fl">0.001261</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a><span class="dv">2011</span>  <span class="fl">0.806605</span>   <span class="fl">0.001514</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="pandas-groupby-transform" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="pandas-groupby-transform"><span class="header-section-number">10.4</span> Group Transforms and "Unwrapped" GroupBys</h2>
<p>In <a href="#groupby_apply">Apply: General split-apply-combine</a>, we looked at the <code>apply</code> method in grouped operations for performing transformations. There is another built-in method called <code>transform</code>, which is similar to <code>apply</code> but imposes more constraints on the kind of function you can use:</p>
<ul>
<li><p>It can produce a scalar value to be broadcast to the shape of the group.</p></li>
<li><p>It can produce an object of the same shape as the input group.</p></li>
<li><p>It must not mutate its input.</p></li>
</ul>
<p>Let's consider a simple example for illustration:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">145</span>]: df <span class="op">=</span> pd.DataFrame({<span class="st">'key'</span>: [<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>] <span class="op">*</span> <span class="dv">4</span>,</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>   .....:                    <span class="st">'value'</span>: np.arange(<span class="fl">12.</span>)})</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">146</span>]: df</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">146</span>]: </span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>   key  value</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    a    <span class="fl">0.0</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    b    <span class="fl">1.0</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    c    <span class="fl">2.0</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    a    <span class="fl">3.0</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    b    <span class="fl">4.0</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    c    <span class="fl">5.0</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>    a    <span class="fl">6.0</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>    b    <span class="fl">7.0</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>    c    <span class="fl">8.0</span></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>    a    <span class="fl">9.0</span></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>   b   <span class="fl">10.0</span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span>   c   <span class="fl">11.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here are the group means by key:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">147</span>]: g <span class="op">=</span> df.groupby(<span class="st">'key'</span>)[<span class="st">'value'</span>]</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">148</span>]: g.mean()</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">148</span>]: </span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>key</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>a    <span class="fl">4.5</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>b    <span class="fl">5.5</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>c    <span class="fl">6.5</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>Name: value, dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Suppose instead we wanted to produce a Series of the same shape as <code>df['value']</code> but with values replaced by the average grouped by <code>'key'</code>. We can pass a function that computes the mean of a single group to <code>transform</code>:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">149</span>]: <span class="kw">def</span> get_mean(group):</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>   .....:     <span class="cf">return</span> group.mean()</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">150</span>]: g.transform(get_mean)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">150</span>]: </span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     <span class="fl">4.5</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     <span class="fl">5.5</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>     <span class="fl">6.5</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     <span class="fl">4.5</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>     <span class="fl">5.5</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>     <span class="fl">6.5</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>     <span class="fl">4.5</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>     <span class="fl">5.5</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>     <span class="fl">6.5</span></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>     <span class="fl">4.5</span></span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>    <span class="fl">5.5</span></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span>    <span class="fl">6.5</span></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>Name: value, dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For built-in aggregation functions, we can pass a string alias as with the GroupBy <code>agg</code> method:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">151</span>]: g.transform(<span class="st">'mean'</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">151</span>]: </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     <span class="fl">4.5</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     <span class="fl">5.5</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>     <span class="fl">6.5</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     <span class="fl">4.5</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>     <span class="fl">5.5</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>     <span class="fl">6.5</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>     <span class="fl">4.5</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>     <span class="fl">5.5</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>     <span class="fl">6.5</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>     <span class="fl">4.5</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>    <span class="fl">5.5</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span>    <span class="fl">6.5</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>Name: value, dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Like <code>apply</code>, <code>transform</code> works with functions that return Series, but the result must be the same size as the input. For example, we can multiply each group by 2 using a helper function:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">152</span>]: <span class="kw">def</span> times_two(group):</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>   .....:     <span class="cf">return</span> group <span class="op">*</span> <span class="dv">2</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">153</span>]: g.transform(times_two)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">153</span>]: </span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>      <span class="fl">0.0</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>      <span class="fl">2.0</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>      <span class="fl">4.0</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>      <span class="fl">6.0</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>      <span class="fl">8.0</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>     <span class="fl">10.0</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>     <span class="fl">12.0</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>     <span class="fl">14.0</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>     <span class="fl">16.0</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>     <span class="fl">18.0</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>    <span class="fl">20.0</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span>    <span class="fl">22.0</span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>Name: value, dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As a more complicated example, we can compute the ranks in descending order for each group:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">154</span>]: <span class="kw">def</span> get_ranks(group):</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>   .....:     <span class="cf">return</span> group.rank(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">155</span>]: g.transform(get_ranks)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">155</span>]: </span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     <span class="fl">4.0</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     <span class="fl">4.0</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>     <span class="fl">4.0</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     <span class="fl">3.0</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>     <span class="fl">3.0</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>     <span class="fl">3.0</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>     <span class="fl">2.0</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>     <span class="fl">2.0</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>     <span class="fl">2.0</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>     <span class="fl">1.0</span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>    <span class="fl">1.0</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span>    <span class="fl">1.0</span></span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>Name: value, dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Consider a group transformation function composed from simple aggregations:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">156</span>]: <span class="kw">def</span> normalize(x):</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>   .....:     <span class="cf">return</span> (x <span class="op">-</span> x.mean()) <span class="op">/</span> x.std()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can obtain equivalent results in this case using either <code>transform</code> or <code>apply</code>:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">157</span>]: g.transform(normalize)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">157</span>]: </span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="op">-</span><span class="fl">1.161895</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="op">-</span><span class="fl">1.161895</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="op">-</span><span class="fl">1.161895</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="op">-</span><span class="fl">0.387298</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="op">-</span><span class="fl">0.387298</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    <span class="op">-</span><span class="fl">0.387298</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>     <span class="fl">0.387298</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>     <span class="fl">0.387298</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>     <span class="fl">0.387298</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>     <span class="fl">1.161895</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>    <span class="fl">1.161895</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span>    <span class="fl">1.161895</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>Name: value, dtype: float64</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">158</span>]: g.<span class="bu">apply</span>(normalize)</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">158</span>]: </span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>key    </span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>a    <span class="dv">0</span>    <span class="op">-</span><span class="fl">1.161895</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>     <span class="dv">3</span>    <span class="op">-</span><span class="fl">0.387298</span></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>     <span class="dv">6</span>     <span class="fl">0.387298</span></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>     <span class="dv">9</span>     <span class="fl">1.161895</span></span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>b    <span class="dv">1</span>    <span class="op">-</span><span class="fl">1.161895</span></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>     <span class="dv">4</span>    <span class="op">-</span><span class="fl">0.387298</span></span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>     <span class="dv">7</span>     <span class="fl">0.387298</span></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>     <span class="dv">10</span>    <span class="fl">1.161895</span></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>c    <span class="dv">2</span>    <span class="op">-</span><span class="fl">1.161895</span></span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>     <span class="dv">5</span>    <span class="op">-</span><span class="fl">0.387298</span></span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>     <span class="dv">8</span>     <span class="fl">0.387298</span></span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>     <span class="dv">11</span>    <span class="fl">1.161895</span></span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>Name: value, dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Built-in aggregate functions like <code>'mean'</code> or <code>'sum'</code> are often much faster than a general <code>apply</code> function. These also have a "fast path" when used with <code>transform</code>. This allows us to perform what is called an <em>unwrapped</em> group operation:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">159</span>]: g.transform(<span class="st">'mean'</span>)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">159</span>]: </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>     <span class="fl">4.5</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     <span class="fl">5.5</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>     <span class="fl">6.5</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     <span class="fl">4.5</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>     <span class="fl">5.5</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>     <span class="fl">6.5</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>     <span class="fl">4.5</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>     <span class="fl">5.5</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>     <span class="fl">6.5</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>     <span class="fl">4.5</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>    <span class="fl">5.5</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span>    <span class="fl">6.5</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>Name: value, dtype: float64</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">160</span>]: normalized <span class="op">=</span> (df[<span class="st">'value'</span>] <span class="op">-</span> g.transform(<span class="st">'mean'</span>)) <span class="op">/</span> g.transform(<span class="st">'std'</span>)</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">161</span>]: normalized</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">161</span>]: </span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>    <span class="op">-</span><span class="fl">1.161895</span></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>    <span class="op">-</span><span class="fl">1.161895</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>    <span class="op">-</span><span class="fl">1.161895</span></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>    <span class="op">-</span><span class="fl">0.387298</span></span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>    <span class="op">-</span><span class="fl">0.387298</span></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>    <span class="op">-</span><span class="fl">0.387298</span></span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>     <span class="fl">0.387298</span></span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>     <span class="fl">0.387298</span></span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>     <span class="fl">0.387298</span></span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>     <span class="fl">1.161895</span></span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>    <span class="fl">1.161895</span></span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a><span class="dv">11</span>    <span class="fl">1.161895</span></span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a>Name: value, dtype: float64</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here, we are doing arithmetic between the outputs of multiple GroupBy operations instead of writing a function and passing it to <code>groupby(...).apply</code>. That is what is meant by "unwrapped."</p>
<p>While an unwrapped group operation may involve multiple group aggregations, the overall benefit of vectorized operations often outweighs this.</p>
</section>
<section id="groupby_pivot_table" class="level2" data-number="10.5">
<h2 data-number="10.5" class="anchored" data-anchor-id="groupby_pivot_table"><span class="header-section-number">10.5</span> Pivot Tables and Cross-Tabulation</h2>
<p>A <em>pivot table</em> is a data summarization tool frequently found in spreadsheet programs and other data analysis software. It aggregates a table of data by one or more keys, arranging the data in a rectangle with some of the group keys along the rows and some along the columns. Pivot tables in Python with pandas are made possible through the <code>groupby</code> facility described in this chapter, combined with reshape operations utilizing hierarchical indexing. DataFrame also has a <code>pivot_table</code> method, and there is also a top-level <code>pandas.pivot_table</code> function. In addition to providing a convenience interface to <code>groupby</code>, <code>pivot_table</code> can add partial totals, also known as <em>margins</em>.</p>
<p>Returning to the tipping dataset, suppose you wanted to compute a table of group means (the default <code>pivot_table</code> aggregation type) arranged by <code>day</code> and <code>smoker</code> on the rows:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">162</span>]: tips.head()</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">162</span>]: </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>   total_bill   tip smoker  day    time  size   tip_pct</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>       <span class="fl">16.99</span>  <span class="fl">1.01</span>     No  Sun  Dinner     <span class="dv">2</span>  <span class="fl">0.059447</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>       <span class="fl">10.34</span>  <span class="fl">1.66</span>     No  Sun  Dinner     <span class="dv">3</span>  <span class="fl">0.160542</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>       <span class="fl">21.01</span>  <span class="fl">3.50</span>     No  Sun  Dinner     <span class="dv">3</span>  <span class="fl">0.166587</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>       <span class="fl">23.68</span>  <span class="fl">3.31</span>     No  Sun  Dinner     <span class="dv">2</span>  <span class="fl">0.139780</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>       <span class="fl">24.59</span>  <span class="fl">3.61</span>     No  Sun  Dinner     <span class="dv">4</span>  <span class="fl">0.146808</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">163</span>]: tips.pivot_table(index<span class="op">=</span>[<span class="st">"day"</span>, <span class="st">"smoker"</span>],</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>   .....:                  values<span class="op">=</span>[<span class="st">"size"</span>, <span class="st">"tip"</span>, <span class="st">"tip_pct"</span>, <span class="st">"total_bill"</span>])</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">163</span>]: </span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>                 size       tip   tip_pct  total_bill</span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>day  smoker                                          </span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>Fri  No      <span class="fl">2.250000</span>  <span class="fl">2.812500</span>  <span class="fl">0.151650</span>   <span class="fl">18.420000</span></span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>     Yes     <span class="fl">2.066667</span>  <span class="fl">2.714000</span>  <span class="fl">0.174783</span>   <span class="fl">16.813333</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>Sat  No      <span class="fl">2.555556</span>  <span class="fl">3.102889</span>  <span class="fl">0.158048</span>   <span class="fl">19.661778</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>     Yes     <span class="fl">2.476190</span>  <span class="fl">2.875476</span>  <span class="fl">0.147906</span>   <span class="fl">21.276667</span></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>Sun  No      <span class="fl">2.929825</span>  <span class="fl">3.167895</span>  <span class="fl">0.160113</span>   <span class="fl">20.506667</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>     Yes     <span class="fl">2.578947</span>  <span class="fl">3.516842</span>  <span class="fl">0.187250</span>   <span class="fl">24.120000</span></span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>Thur No      <span class="fl">2.488889</span>  <span class="fl">2.673778</span>  <span class="fl">0.160298</span>   <span class="fl">17.113111</span></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a>     Yes     <span class="fl">2.352941</span>  <span class="fl">3.030000</span>  <span class="fl">0.163863</span>   <span class="fl">19.190588</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This could have been produced with <code>groupby</code> directly, using <code>tips.groupby(["day", "smoker"]).mean()</code>. Now, suppose we want to take the average of only <code>tip_pct</code> and <code>size</code>, and additionally group by <code>time</code>. I’ll put <code>smoker</code> in the table columns and <code>time</code> and <code>day</code> in the rows:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">164</span>]: tips.pivot_table(index<span class="op">=</span>[<span class="st">"time"</span>, <span class="st">"day"</span>], columns<span class="op">=</span><span class="st">"smoker"</span>,</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>   .....:                  values<span class="op">=</span>[<span class="st">"tip_pct"</span>, <span class="st">"size"</span>])</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">164</span>]: </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>                 size             tip_pct          </span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>smoker             No       Yes        No       Yes</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>time   day                                         </span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>Dinner Fri   <span class="fl">2.000000</span>  <span class="fl">2.222222</span>  <span class="fl">0.139622</span>  <span class="fl">0.165347</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>       Sat   <span class="fl">2.555556</span>  <span class="fl">2.476190</span>  <span class="fl">0.158048</span>  <span class="fl">0.147906</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>       Sun   <span class="fl">2.929825</span>  <span class="fl">2.578947</span>  <span class="fl">0.160113</span>  <span class="fl">0.187250</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>       Thur  <span class="fl">2.000000</span>       NaN  <span class="fl">0.159744</span>       NaN</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>Lunch  Fri   <span class="fl">3.000000</span>  <span class="fl">1.833333</span>  <span class="fl">0.187735</span>  <span class="fl">0.188937</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>       Thur  <span class="fl">2.500000</span>  <span class="fl">2.352941</span>  <span class="fl">0.160311</span>  <span class="fl">0.163863</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We could augment this table to include partial totals by passing <code>margins=True</code>. This has the effect of adding <code>All</code> row and column labels, with corresponding values being the group statistics for all the data within a single tier:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">165</span>]: tips.pivot_table(index<span class="op">=</span>[<span class="st">"time"</span>, <span class="st">"day"</span>], columns<span class="op">=</span><span class="st">"smoker"</span>,</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>   .....:                  values<span class="op">=</span>[<span class="st">"tip_pct"</span>, <span class="st">"size"</span>], margins<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">165</span>]: </span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>                 size                       tip_pct                    </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>smoker             No       Yes       All        No       Yes       All</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>time   day                                                             </span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>Dinner Fri   <span class="fl">2.000000</span>  <span class="fl">2.222222</span>  <span class="fl">2.166667</span>  <span class="fl">0.139622</span>  <span class="fl">0.165347</span>  <span class="fl">0.158916</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>       Sat   <span class="fl">2.555556</span>  <span class="fl">2.476190</span>  <span class="fl">2.517241</span>  <span class="fl">0.158048</span>  <span class="fl">0.147906</span>  <span class="fl">0.153152</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>       Sun   <span class="fl">2.929825</span>  <span class="fl">2.578947</span>  <span class="fl">2.842105</span>  <span class="fl">0.160113</span>  <span class="fl">0.187250</span>  <span class="fl">0.166897</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>       Thur  <span class="fl">2.000000</span>       NaN  <span class="fl">2.000000</span>  <span class="fl">0.159744</span>       NaN  <span class="fl">0.159744</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>Lunch  Fri   <span class="fl">3.000000</span>  <span class="fl">1.833333</span>  <span class="fl">2.000000</span>  <span class="fl">0.187735</span>  <span class="fl">0.188937</span>  <span class="fl">0.188765</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>       Thur  <span class="fl">2.500000</span>  <span class="fl">2.352941</span>  <span class="fl">2.459016</span>  <span class="fl">0.160311</span>  <span class="fl">0.163863</span>  <span class="fl">0.161301</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>All          <span class="fl">2.668874</span>  <span class="fl">2.408602</span>  <span class="fl">2.569672</span>  <span class="fl">0.159328</span>  <span class="fl">0.163196</span>  <span class="fl">0.160803</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here, the <code>All</code> values are means without taking into account smoker versus non-smoker (the <code>All</code> columns) or any of the two levels of grouping on the rows (the <code>All</code> row).</p>
<p>To use an aggregation function other than <code>mean</code>, pass it to the <code>aggfunc</code> keyword argument. For example, <code>"count"</code> or <code>len</code> will give you a cross-tabulation (count or frequency) of group sizes (though <code>"count"</code> will exclude null values from the count within data groups, while <code>len</code> will not):</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">166</span>]: tips.pivot_table(index<span class="op">=</span>[<span class="st">"time"</span>, <span class="st">"smoker"</span>], columns<span class="op">=</span><span class="st">"day"</span>,</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>   .....:                  values<span class="op">=</span><span class="st">"tip_pct"</span>, aggfunc<span class="op">=</span><span class="bu">len</span>, margins<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">166</span>]: </span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>day             Fri   Sat   Sun  Thur  All</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>time   smoker                             </span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>Dinner No       <span class="fl">3.0</span>  <span class="fl">45.0</span>  <span class="fl">57.0</span>   <span class="fl">1.0</span>  <span class="dv">106</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>       Yes      <span class="fl">9.0</span>  <span class="fl">42.0</span>  <span class="fl">19.0</span>   NaN   <span class="dv">70</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>Lunch  No       <span class="fl">1.0</span>   NaN   NaN  <span class="fl">44.0</span>   <span class="dv">45</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>       Yes      <span class="fl">6.0</span>   NaN   NaN  <span class="fl">17.0</span>   <span class="dv">23</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>All            <span class="fl">19.0</span>  <span class="fl">87.0</span>  <span class="fl">76.0</span>  <span class="fl">62.0</span>  <span class="dv">244</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If some combinations are empty (or otherwise NA), you may wish to pass a <code>fill_value</code>:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">167</span>]: tips.pivot_table(index<span class="op">=</span>[<span class="st">"time"</span>, <span class="st">"size"</span>, <span class="st">"smoker"</span>], columns<span class="op">=</span><span class="st">"day"</span>,</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>   .....:                  values<span class="op">=</span><span class="st">"tip_pct"</span>, fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">167</span>]: </span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>day                      Fri       Sat       Sun      Thur</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>time   size smoker                                        </span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>Dinner <span class="dv">1</span>    No      <span class="fl">0.000000</span>  <span class="fl">0.137931</span>  <span class="fl">0.000000</span>  <span class="fl">0.000000</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>            Yes     <span class="fl">0.000000</span>  <span class="fl">0.325733</span>  <span class="fl">0.000000</span>  <span class="fl">0.000000</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>       <span class="dv">2</span>    No      <span class="fl">0.139622</span>  <span class="fl">0.162705</span>  <span class="fl">0.168859</span>  <span class="fl">0.159744</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>            Yes     <span class="fl">0.171297</span>  <span class="fl">0.148668</span>  <span class="fl">0.207893</span>  <span class="fl">0.000000</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>       <span class="dv">3</span>    No      <span class="fl">0.000000</span>  <span class="fl">0.154661</span>  <span class="fl">0.152663</span>  <span class="fl">0.000000</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>...                      ...       ...       ...       ...</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>Lunch  <span class="dv">3</span>    Yes     <span class="fl">0.000000</span>  <span class="fl">0.000000</span>  <span class="fl">0.000000</span>  <span class="fl">0.204952</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>       <span class="dv">4</span>    No      <span class="fl">0.000000</span>  <span class="fl">0.000000</span>  <span class="fl">0.000000</span>  <span class="fl">0.138919</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>            Yes     <span class="fl">0.000000</span>  <span class="fl">0.000000</span>  <span class="fl">0.000000</span>  <span class="fl">0.155410</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>       <span class="dv">5</span>    No      <span class="fl">0.000000</span>  <span class="fl">0.000000</span>  <span class="fl">0.000000</span>  <span class="fl">0.121389</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>       <span class="dv">6</span>    No      <span class="fl">0.000000</span>  <span class="fl">0.000000</span>  <span class="fl">0.000000</span>  <span class="fl">0.173706</span></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>[<span class="dv">21</span> rows x <span class="dv">4</span> columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>See <a href="#tbl-table_pivot_table">Table&nbsp;<span>10.2</span></a> for a summary of <code>pivot_table</code> options.</p>
<div id="tbl-table_pivot_table" class="anchored">
<table class="table">
<caption>Table&nbsp;10.2: <code>pivot_table</code> options</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Argument</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>values</code></td>
<td style="text-align: left;">Column name or names to aggregate; by default, aggregates all numeric columns</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>index</code></td>
<td style="text-align: left;">Column names or other group keys to group on the rows of the resulting pivot table</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>columns</code></td>
<td style="text-align: left;">Column names or other group keys to group on the columns of the resulting pivot table</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>aggfunc</code></td>
<td style="text-align: left;">Aggregation function or list of functions (<code>"mean"</code> by default); can be any function valid in a <code>groupby</code> context</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>fill_value</code></td>
<td style="text-align: left;">Replace missing values in the result table</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>dropna</code></td>
<td style="text-align: left;">If <code>True</code>, do not include columns whose entries are all <code>NA</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>margins</code></td>
<td style="text-align: left;">Add row/column subtotals and grand total (<code>False</code> by default)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>margins_name</code></td>
<td style="text-align: left;">Name to use for the margin row/column labels when passing <code>margins=True</code>; defaults to <code>"All"</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>observed</code></td>
<td style="text-align: left;">With Categorical group keys, if <code>True</code>, show only the observed category values in the keys rather than all categories</td>
</tr>
</tbody>
</table>
</div>
<section id="groupby_crosstab" class="level3">
<h3 class="anchored" data-anchor-id="groupby_crosstab">Cross-Tabulations: Crosstab</h3>
<p>A <em>cross-tabulation</em> (or <em>crosstab</em> for short) is a special case of a pivot table that computes group frequencies. Here is an example:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">168</span>]: <span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">169</span>]: data <span class="op">=</span> <span class="st">"""Sample  Nationality  Handedness</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="st">   .....: 1   USA  Right-handed</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="st">   .....: 2   Japan    Left-handed</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="st">   .....: 3   USA  Right-handed</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="st">   .....: 4   Japan    Right-handed</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="st">   .....: 5   Japan    Left-handed</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="st">   .....: 6   Japan    Right-handed</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="st">   .....: 7   USA  Right-handed</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a><span class="st">   .....: 8   USA  Left-handed</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a><span class="st">   .....: 9   Japan    Right-handed</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a><span class="st">   .....: 10  USA  Right-handed"""</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>   .....:</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">170</span>]: data <span class="op">=</span> pd.read_table(StringIO(data), sep<span class="op">=</span><span class="st">"\s+"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">171</span>]: data</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">171</span>]: </span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>   Sample Nationality    Handedness</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="dv">0</span>       <span class="dv">1</span>         USA  Right<span class="op">-</span>handed</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>       <span class="dv">2</span>       Japan   Left<span class="op">-</span>handed</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>       <span class="dv">3</span>         USA  Right<span class="op">-</span>handed</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>       <span class="dv">4</span>       Japan  Right<span class="op">-</span>handed</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>       <span class="dv">5</span>       Japan   Left<span class="op">-</span>handed</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>       <span class="dv">6</span>       Japan  Right<span class="op">-</span>handed</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>       <span class="dv">7</span>         USA  Right<span class="op">-</span>handed</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>       <span class="dv">8</span>         USA   Left<span class="op">-</span>handed</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>       <span class="dv">9</span>       Japan  Right<span class="op">-</span>handed</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>      <span class="dv">10</span>         USA  Right<span class="op">-</span>handed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As part of some survey analysis, we might want to summarize this data by nationality and handedness. You could use <code>pivot_table</code> to do this, but the <code>pandas.crosstab</code> function can be more convenient:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">172</span>]: pd.crosstab(data[<span class="st">"Nationality"</span>], data[<span class="st">"Handedness"</span>], margins<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">172</span>]: </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>Handedness   Left<span class="op">-</span>handed  Right<span class="op">-</span>handed  All</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>Nationality                                </span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>Japan                  <span class="dv">2</span>             <span class="dv">3</span>    <span class="dv">5</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>USA                    <span class="dv">1</span>             <span class="dv">4</span>    <span class="dv">5</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>All                    <span class="dv">3</span>             <span class="dv">7</span>   <span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The first two arguments to <code>crosstab</code> can each be an array or Series or a list of arrays. As in the tips data:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>In [<span class="dv">173</span>]: pd.crosstab([tips[<span class="st">"time"</span>], tips[<span class="st">"day"</span>]], tips[<span class="st">"smoker"</span>], margins<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>Out[<span class="dv">173</span>]: </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>smoker        No  Yes  All</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>time   day                </span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>Dinner Fri     <span class="dv">3</span>    <span class="dv">9</span>   <span class="dv">12</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>       Sat    <span class="dv">45</span>   <span class="dv">42</span>   <span class="dv">87</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>       Sun    <span class="dv">57</span>   <span class="dv">19</span>   <span class="dv">76</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>       Thur    <span class="dv">1</span>    <span class="dv">0</span>    <span class="dv">1</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>Lunch  Fri     <span class="dv">1</span>    <span class="dv">6</span>    <span class="dv">7</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>       Thur   <span class="dv">44</span>   <span class="dv">17</span>   <span class="dv">61</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>All          <span class="dv">151</span>   <span class="dv">93</span>  <span class="dv">244</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="groupby-summary" class="level2" data-number="10.6">
<h2 data-number="10.6" class="anchored" data-anchor-id="groupby-summary"><span class="header-section-number">10.6</span> Conclusion</h2>
<p>Mastering pandas's data grouping tools can help with data cleaning and modeling or statistical analysis work. In <a href="#data-analysis-examples">Ch 13: Data Analysis Examples</a> we will look at several more example use cases for <code>groupby</code> on real data.</p>
<p>In the next chapter, we turn our attention to time series data.</p>


</section>

<script async="" defer="" src="https://scripts.simpleanalyticscdn.com/latest.js"></script></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a class='pagination-link' href='/book/plotting-and-visualization'>
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Plotting and Visualization</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a class='pagination-link' href='/book/time-series'>
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Time Series</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2023, Wes McKinney. All Rights Reserved.</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/wesmckinn">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>
<script async="" src="https://media.ethicalads.io/media/client/ethicalads.min.js"></script>



</body></html>